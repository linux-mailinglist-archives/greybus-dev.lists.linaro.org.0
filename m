Return-Path: <greybus-dev-bounces@lists.linaro.org>
X-Original-To: lists+greybus-dev@lfdr.de
Delivered-To: lists+greybus-dev@lfdr.de
Received: from lists.linaro.org (lists.linaro.org [107.22.173.205])
	by mail.lfdr.de (Postfix) with ESMTPS id 9BC6D248580
	for <lists+greybus-dev@lfdr.de>; Tue, 18 Aug 2020 14:58:19 +0200 (CEST)
Received: from lists.linaro.org (localhost [127.0.0.1])
	by lists.linaro.org (Postfix) with ESMTP id AA1096162C
	for <lists+greybus-dev@lfdr.de>; Tue, 18 Aug 2020 12:58:18 +0000 (UTC)
Received: by lists.linaro.org (Postfix, from userid 109)
	id 9B69C619D1; Tue, 18 Aug 2020 12:58:18 +0000 (UTC)
X-Spam-Checker-Version: SpamAssassin 3.4.2 (2018-09-13) on lists.linaro.org
X-Spam-Level: 
X-Spam-Status: No, score=-1.4 required=5.0 tests=BAYES_00,MAILING_LIST_MULTI,
	RCVD_IN_DNSWL_NONE,RCVD_IN_MSPIKE_H3,RCVD_IN_MSPIKE_WL,
	RCVD_IN_SORBS_WEB,SPF_HELO_NONE autolearn=disabled version=3.4.2
Received: from lists.linaro.org (localhost [127.0.0.1])
	by lists.linaro.org (Postfix) with ESMTP id 81B77665E8;
	Tue, 18 Aug 2020 12:51:29 +0000 (UTC)
X-Original-To: greybus-dev@lists.linaro.org
Delivered-To: greybus-dev@lists.linaro.org
Received: from lists.linaro.org (localhost [127.0.0.1])
 by lists.linaro.org (Postfix) with ESMTP id D7BAC65F83
 for <greybus-dev@lists.linaro.org>; Tue, 18 Aug 2020 12:51:09 +0000 (UTC)
Received: by lists.linaro.org (Postfix, from userid 109)
 id C9AFD665CB; Tue, 18 Aug 2020 12:51:09 +0000 (UTC)
Received: from mail-pl1-f194.google.com (mail-pl1-f194.google.com
 [209.85.214.194])
 by lists.linaro.org (Postfix) with ESMTPS id CA9A565F83
 for <greybus-dev@lists.linaro.org>; Tue, 18 Aug 2020 12:48:50 +0000 (UTC)
Received: by mail-pl1-f194.google.com with SMTP id bh1so9156612plb.12
 for <greybus-dev@lists.linaro.org>; Tue, 18 Aug 2020 05:48:50 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=P8FUTcAkSzX0gwG+BzSomHVjTY5h0EVdky25ut42j9c=;
 b=YZ1Nj0DKXXnhJn7JBNSDAWlmQk62IlhtLpIr2x442t9GnJcGSIlz5Ak6zMp0TzfGDz
 Llt/Rrm0GlsI3GRrB2O1pf2YPz2MneR+66Jq4gpKB4X1tFsMtVVCCM6BIB5rycOxW56s
 PMbgpd4Ieq+zSCD9+lKY43kL5rJ58Fx8dYZQO3S0A2Bq1pDFII86Oo28oKuUFFgR83Xq
 2hupK0VOcuyUilpVm5daIHxZNRJPWkQZhWvX3qFkJsKoQQeaMYBTtXjAU++KrRuADjDZ
 rJwScInL9IrE2t4uTlOm3bhjtyMVUqGbJ6Xvcnl7mRHRuSGJ1MPjcdV3v7uZFP8efhVO
 2Bgg==
X-Gm-Message-State: AOAM531+vtqH+wzEZnQF2U6Eobv6XKgcEM49nw0dR+0E6+osfsoC/gmA
 x0YEUENcN1lirnG6Yr1MhIXS1OdNkdBGswk=
X-Google-Smtp-Source: ABdhPJx28n81y4GQXHaLcgVSaLHHQdziZMuoyZRDNvybtmWzQA1XQp9SLuYeKO8XqsrOrEa+MYoJNA==
X-Received: by 2002:a17:90a:ab96:: with SMTP id
 n22mr16462084pjq.52.1597754928522; 
 Tue, 18 Aug 2020 05:48:48 -0700 (PDT)
Received: from localhost.localdomain ([116.68.79.111])
 by smtp.gmail.com with ESMTPSA id e4sm24264221pfd.204.2020.08.18.05.48.43
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Tue, 18 Aug 2020 05:48:48 -0700 (PDT)
From: Vaishnav M A <vaishnav@beagleboard.org>
To: greybus-dev@lists.linaro.org, linux-kernel@vger.kernel.org,
 gregkh@linuxfoundation.org, arnd@arndb.de, johan@kernel.org,
 elder@kernel.org
Date: Tue, 18 Aug 2020 18:18:14 +0530
Message-Id: <20200818124815.11029-3-vaishnav@beagleboard.org>
X-Mailer: git-send-email 2.25.1
In-Reply-To: <20200818124815.11029-1-vaishnav@beagleboard.org>
References: <20200818124815.11029-1-vaishnav@beagleboard.org>
MIME-Version: 1.0
X-Virus-Scanned: ClamAV using ClamSMTP
Cc: rajkovic@mikroe.com, robh@kernel.org, mchehab+huawei@kernel.org,
 robertcnelson@beagleboard.org, drew@beagleboard.org,
 Vaishnav M A <vaishnav@beagleboard.org>, davem@davemloft.net,
 zoran.stojsavljevic@gmail.com
Subject: [greybus-dev] [RFC PATCH v2 2/3] mikroBUS driver for add-on boards
	on mikrobus ports
X-BeenThere: greybus-dev@lists.linaro.org
X-Mailman-Version: 2.1.16
Precedence: list
List-Id: Greybus Development Mail List <greybus-dev.lists.linaro.org>
List-Unsubscribe: <https://lists.linaro.org/mailman/options/greybus-dev>,
 <mailto:greybus-dev-request@lists.linaro.org?subject=unsubscribe>
List-Archive: <http://lists.linaro.org/pipermail/greybus-dev/>
List-Post: <mailto:greybus-dev@lists.linaro.org>
List-Help: <mailto:greybus-dev-request@lists.linaro.org?subject=help>
List-Subscribe: <https://lists.linaro.org/mailman/listinfo/greybus-dev>,
 <mailto:greybus-dev-request@lists.linaro.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: greybus-dev-bounces@lists.linaro.org
Sender: "greybus-dev" <greybus-dev-bounces@lists.linaro.org>
X-Virus-Scanned: ClamAV using ClamSMTP

VGhlIG1pa3JvYnVzIGRyaXZlciBpcyB1cGRhdGVkIHRvIGFkZCBtaWtyb2J1cyBwb3J0cyBmcm9t
IGRldmljZS10cmVlCm92ZXJsYXlzLCB0aGUgZGVidWcgaW50ZXJmYWNlcyBmb3IgYWRkaW5nIG1p
a3JvYnVzIHBvcnRzIHRocm91Z2ggc3lzRlMKaXMgcmVtb3ZlZCwgYW5kIHRoZSBkcml2ZXIgY29u
c2lkZXJzIHRoZSBleHRlbmRlZCB1c2FnZSBvZiBtaWtyb2J1cwpwb3J0IHBpbnMgZnJvbSB0aGVp
ciBzdGFuZGFyZCBwdXJwb3NlLCBmb3IgZXhhbXBsZSBhbiBTSFQxNSBhZGQtb24KYm9hcmQgd2ls
bCBuZWVkIHRoZSBJMkMgcGlucyB0byBiZSBjb25maWd1cmVkIGFzIEdQSU9zIGZvciB0aGUKY29y
cmVzcG9uZGluZyBkcml2ZXIoZHJpdmVycy9od21vbi9zaHQxNS5jKSB0byB3b3JrIGNvcnJlY3Rs
eQp0byBjb25zaWRlciBjYXNlcyBsaWtlIHRoZXNlIHRoZSBtaWtyb2J1cyBkcml2ZXIgc3VwcG9y
dHMgc2V0dGluZwp0aGUgcGlubXV4IHN0YXRlcyBhbmQgY2FuIGNvbnNpZGVyIGVhY2ggUGluIG9m
IHRoZSBtaWtyb2J1cyBwb3J0CmFzIEdQSU8gaWYgcmVxdWlyZWQuCgogVGhlIG1hbmlmZXN0cyBm
b3Igc3VwcG9ydGVkIDExMCBhZGQtb24gYm9hcmRzIGFyZSBhdmFpbGFibGUgaGVyZToKIGh0dHBz
Oi8vZ2l0aHViLmNvbS92YWlzaG5hdjk4L21hbmlmZXN0by90cmVlL21pa3JvYnVzdjMKClNpZ25l
ZC1vZmYtYnk6IFZhaXNobmF2IE0gQSA8dmFpc2huYXZAYmVhZ2xlYm9hcmQub3JnPgotLS0KIE1B
SU5UQUlORVJTICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHwgICA2ICsKIGRyaXZlcnMv
bWlzYy9LY29uZmlnICAgICAgICAgICAgICAgICAgICAgIHwgICAxICsKIGRyaXZlcnMvbWlzYy9N
YWtlZmlsZSAgICAgICAgICAgICAgICAgICAgIHwgICAxICsKIGRyaXZlcnMvbWlzYy9taWtyb2J1
cy9LY29uZmlnICAgICAgICAgICAgIHwgIDE2ICsKIGRyaXZlcnMvbWlzYy9taWtyb2J1cy9NYWtl
ZmlsZSAgICAgICAgICAgIHwgICA3ICsKIGRyaXZlcnMvbWlzYy9taWtyb2J1cy9taWtyb2J1c19j
b3JlLmMgICAgIHwgNjkyICsrKysrKysrKysrKysrKysrKysrKysKIGRyaXZlcnMvbWlzYy9taWty
b2J1cy9taWtyb2J1c19jb3JlLmggICAgIHwgMTkxICsrKysrKwogZHJpdmVycy9taXNjL21pa3Jv
YnVzL21pa3JvYnVzX21hbmlmZXN0LmMgfCA0NDQgKysrKysrKysrKysrKysKIGRyaXZlcnMvbWlz
Yy9taWtyb2J1cy9taWtyb2J1c19tYW5pZmVzdC5oIHwgIDIxICsKIGRyaXZlcnMvbWlzYy9taWty
b2J1cy9taWtyb2J1c19wb3J0LmMgICAgIHwgMTcxICsrKysrKwogMTAgZmlsZXMgY2hhbmdlZCwg
MTU1MCBpbnNlcnRpb25zKCspCiBjcmVhdGUgbW9kZSAxMDA2NDQgZHJpdmVycy9taXNjL21pa3Jv
YnVzL0tjb25maWcKIGNyZWF0ZSBtb2RlIDEwMDY0NCBkcml2ZXJzL21pc2MvbWlrcm9idXMvTWFr
ZWZpbGUKIGNyZWF0ZSBtb2RlIDEwMDY0NCBkcml2ZXJzL21pc2MvbWlrcm9idXMvbWlrcm9idXNf
Y29yZS5jCiBjcmVhdGUgbW9kZSAxMDA2NDQgZHJpdmVycy9taXNjL21pa3JvYnVzL21pa3JvYnVz
X2NvcmUuaAogY3JlYXRlIG1vZGUgMTAwNjQ0IGRyaXZlcnMvbWlzYy9taWtyb2J1cy9taWtyb2J1
c19tYW5pZmVzdC5jCiBjcmVhdGUgbW9kZSAxMDA2NDQgZHJpdmVycy9taXNjL21pa3JvYnVzL21p
a3JvYnVzX21hbmlmZXN0LmgKIGNyZWF0ZSBtb2RlIDEwMDY0NCBkcml2ZXJzL21pc2MvbWlrcm9i
dXMvbWlrcm9idXNfcG9ydC5jCgpkaWZmIC0tZ2l0IGEvTUFJTlRBSU5FUlMgYi9NQUlOVEFJTkVS
UwppbmRleCBkZWFhZmI2MTczNjEuLmZmZDBlYjY4ODYxOCAxMDA2NDQKLS0tIGEvTUFJTlRBSU5F
UlMKKysrIGIvTUFJTlRBSU5FUlMKQEAgLTExNTQzLDYgKzExNTQzLDEyIEBAIE06CU9saXZlciBO
ZXVrdW0gPG9saXZlckBuZXVrdW0ub3JnPgogUzoJTWFpbnRhaW5lZAogRjoJZHJpdmVycy91c2Iv
aW1hZ2UvbWljcm90ZWsuKgogCitNSUtST0JVUyBBRERPTiBCT0FSRCBEUklWRVIKK006CVZhaXNo
bmF2IE0gQSA8dmFpc2huYXZAYmVhZ2xlYm9hcmQub3JnPgorUzoJTWFpbnRhaW5lZAorVzoJaHR0
cHM6Ly9lbGludXgub3JnL01pa3JvYnVzCitGOglkcml2ZXJzL21pc2MvbWlrcm9idXMvCisKIE1J
UFMKIE06CVRob21hcyBCb2dlbmRvZXJmZXIgPHRzYm9nZW5kQGFscGhhLmZyYW5rZW4uZGU+CiBM
OglsaW51eC1taXBzQHZnZXIua2VybmVsLm9yZwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9taXNjL0tj
b25maWcgYi9kcml2ZXJzL21pc2MvS2NvbmZpZwppbmRleCBjZTEzNmQ2ODVkMTQuLmNiMTUzOWYz
OWIzMCAxMDA2NDQKLS0tIGEvZHJpdmVycy9taXNjL0tjb25maWcKKysrIGIvZHJpdmVycy9taXNj
L0tjb25maWcKQEAgLTQ3Miw0ICs0NzIsNSBAQCBzb3VyY2UgImRyaXZlcnMvbWlzYy9vY3hsL0tj
b25maWciCiBzb3VyY2UgImRyaXZlcnMvbWlzYy9jYXJkcmVhZGVyL0tjb25maWciCiBzb3VyY2Ug
ImRyaXZlcnMvbWlzYy9oYWJhbmFsYWJzL0tjb25maWciCiBzb3VyY2UgImRyaXZlcnMvbWlzYy91
YWNjZS9LY29uZmlnIgorc291cmNlICJkcml2ZXJzL21pc2MvbWlrcm9idXMvS2NvbmZpZyIKIGVu
ZG1lbnUKZGlmZiAtLWdpdCBhL2RyaXZlcnMvbWlzYy9NYWtlZmlsZSBiL2RyaXZlcnMvbWlzYy9N
YWtlZmlsZQppbmRleCBjN2JkMDFhYzYyOTEuLjQ1NDg2ZGQ3N2RhNSAxMDA2NDQKLS0tIGEvZHJp
dmVycy9taXNjL01ha2VmaWxlCisrKyBiL2RyaXZlcnMvbWlzYy9NYWtlZmlsZQpAQCAtNDAsNiAr
NDAsNyBAQCBvYmotJChDT05GSUdfVk1XQVJFX0JBTExPT04pCSs9IHZtd19iYWxsb29uLm8KIG9i
ai0kKENPTkZJR19QQ0hfUEhVQikJCSs9IHBjaF9waHViLm8KIG9iai15CQkJCSs9IHRpLXN0Lwog
b2JqLXkJCQkJKz0gbGlzM2x2MDJkLworb2JqLXkJCQkJKz0gbWlrcm9idXMvCiBvYmotJChDT05G
SUdfQUxURVJBX1NUQVBMKQkrPWFsdGVyYS1zdGFwbC8KIG9iai0kKENPTkZJR19JTlRFTF9NRUkp
CQkrPSBtZWkvCiBvYmotJChDT05GSUdfVk1XQVJFX1ZNQ0kpCSs9IHZtd192bWNpLwpkaWZmIC0t
Z2l0IGEvZHJpdmVycy9taXNjL21pa3JvYnVzL0tjb25maWcgYi9kcml2ZXJzL21pc2MvbWlrcm9i
dXMvS2NvbmZpZwpuZXcgZmlsZSBtb2RlIDEwMDY0NAppbmRleCAwMDAwMDAwMDAwMDAuLjVmNDJi
YzRlOTQxMAotLS0gL2Rldi9udWxsCisrKyBiL2RyaXZlcnMvbWlzYy9taWtyb2J1cy9LY29uZmln
CkBAIC0wLDAgKzEsMTYgQEAKK21lbnVjb25maWcgTUlLUk9CVVMKKwl0cmlzdGF0ZSAiTW9kdWxl
IGZvciBpbnN0YW50aWF0aW5nIGRldmljZXMgb24gbWlrcm9CVVMgcG9ydHMiCisJaGVscAorCSAg
VGhpcyBvcHRpb24gZW5hYmxlcyB0aGUgbWlrcm9CVVMgZHJpdmVyLiBtaWtyb0JVUyBpcyBhbiBh
ZGQtb24KKwkgIGJvYXJkIHNvY2tldCBzdGFuZGFyZCB0aGF0IG9mZmVycyBtYXhpbXVtIGV4cGFu
ZGFiaWxpdHkgd2l0aAorCSAgdGhlIHNtYWxsZXN0IG51bWJlciBvZiBwaW5zLiBUaGUgbWlrcm9C
VVMgZHJpdmVyIGluc3RhbnRpYXRlcworCSAgZGV2aWNlcyBvbiBhIG1pa3JvQlVTIHBvcnQgZGVz
Y3JpYmVkIGJ5IGlkZW50aWZ5aW5nIGRhdGEgcHJlc2VudAorCSAgaW4gYW4gYWRkLW9uIGJvYXJk
IHJlc2lkZW50IEVFUFJPTSwgbW9yZSBkZXRhaWxzIG9uIHRoZSBtaWtyb0JVUworCSAgZHJpdmVy
IHN1cHBvcnQgYW5kIGRpc2N1c3Npb24gY2FuIGJlIGZvdW5kIGluIHRoaXMgZUxpbnV4IHdpa2kg
OgorCSAgZWxpbnV4Lm9yZy9NaWtyb2J1cworCisKKwkgIFNheSBZIGhlcmUgdG8gZW5hYmxlIHN1
cHBvcnQgZm9yIHRoaXMgZHJpdmVyLgorCisJICBUbyBjb21waWxlIHRoaXMgY29kZSBhcyBhIG1v
ZHVsZSwgY2hvc2UgTSBoZXJlOiB0aGUgbW9kdWxlCisJICB3aWxsIGJlIGNhbGxlZCBtaWtyb2J1
cy5rbwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9taXNjL21pa3JvYnVzL01ha2VmaWxlIGIvZHJpdmVy
cy9taXNjL21pa3JvYnVzL01ha2VmaWxlCm5ldyBmaWxlIG1vZGUgMTAwNjQ0CmluZGV4IDAwMDAw
MDAwMDAwMC4uYWY3MjU2NTEwMzEwCi0tLSAvZGV2L251bGwKKysrIGIvZHJpdmVycy9taXNjL21p
a3JvYnVzL01ha2VmaWxlCkBAIC0wLDAgKzEsNyBAQAorIyBTUERYLUxpY2Vuc2UtSWRlbnRpZmll
cjogR1BMLTIuMAorIyBtaWtyb0JVUyBDb3JlCisKK21pa3JvYnVzLXkgOj0JbWlrcm9idXNfY29y
ZS5vCW1pa3JvYnVzX21hbmlmZXN0Lm8KK21pa3JvYnVzX3BvcnQteSA6PQltaWtyb2J1c19wb3J0
Lm8KK29iai0kKENPTkZJR19NSUtST0JVUykgKz0gbWlrcm9idXMubworb2JqLSQoQ09ORklHX01J
S1JPQlVTKSArPSBtaWtyb2J1c19wb3J0Lm8KXCBObyBuZXdsaW5lIGF0IGVuZCBvZiBmaWxlCmRp
ZmYgLS1naXQgYS9kcml2ZXJzL21pc2MvbWlrcm9idXMvbWlrcm9idXNfY29yZS5jIGIvZHJpdmVy
cy9taXNjL21pa3JvYnVzL21pa3JvYnVzX2NvcmUuYwpuZXcgZmlsZSBtb2RlIDEwMDY0NAppbmRl
eCAwMDAwMDAwMDAwMDAuLjMxMmUyZDBkNjM0YwotLS0gL2Rldi9udWxsCisrKyBiL2RyaXZlcnMv
bWlzYy9taWtyb2J1cy9taWtyb2J1c19jb3JlLmMKQEAgLTAsMCArMSw2OTIgQEAKKy8vIFNQRFgt
TGljZW5zZS1JZGVudGlmaWVyOiBHUEwtMi4wCisvKgorICogbWlrcm9CVVMgZHJpdmVyIGZvciBp
bnN0YW50aWF0aW5nIGFkZC1vbgorICogYm9hcmQgZGV2aWNlcyB3aXRoIGFuIGlkZW50aWZpZXIg
RUVQUk9NCisgKgorICogQ29weXJpZ2h0IDIwMjAgVmFpc2huYXYgTSBBLCBCZWFnbGVCb2FyZC5v
cmcgRm91bmRhdGlvbi4KKyAqLworCisjZGVmaW5lIHByX2ZtdChmbXQpICJtaWtyb2J1czolczog
IiBmbXQsIF9fZnVuY19fCisKKyNpbmNsdWRlIDxsaW51eC9lcnIuaD4KKyNpbmNsdWRlIDxsaW51
eC9lcnJuby5oPgorI2luY2x1ZGUgPGxpbnV4L2lkci5oPgorI2luY2x1ZGUgPGxpbnV4L2luaXQu
aD4KKyNpbmNsdWRlIDxsaW51eC9qdW1wX2xhYmVsLmg+CisjaW5jbHVkZSA8bGludXgva2VybmVs
Lmg+CisjaW5jbHVkZSA8bGludXgvbW9kdWxlLmg+CisjaW5jbHVkZSA8bGludXgvZ3Bpby9jb25z
dW1lci5oPgorI2luY2x1ZGUgPGxpbnV4L211dGV4Lmg+CisjaW5jbHVkZSA8bGludXgvZGV2aWNl
Lmg+CisjaW5jbHVkZSA8bGludXgvaTJjLmg+CisjaW5jbHVkZSA8bGludXgvZ3Bpby5oPgorI2lu
Y2x1ZGUgPGxpbnV4L2dwaW8vbWFjaGluZS5oPgorI2luY2x1ZGUgPGxpbnV4L252bWVtLWNvbnN1
bWVyLmg+CisjaW5jbHVkZSA8bGludXgvbnZtZW0tcHJvdmlkZXIuaD4KKyNpbmNsdWRlIDxsaW51
eC9pbnRlcnJ1cHQuaD4KKyNpbmNsdWRlIDxsaW51eC9zcGkvc3BpLmg+CisjaW5jbHVkZSA8bGlu
dXgvc2VyZGV2Lmg+CisjaW5jbHVkZSA8bGludXgvcHJvcGVydHkuaD4KKyNpbmNsdWRlIDxsaW51
eC9wbGF0Zm9ybV9kZXZpY2UuaD4KKyNpbmNsdWRlIDxsaW51eC9waW5jdHJsL3BpbmN0cmwuaD4K
KyNpbmNsdWRlIDxsaW51eC9waW5jdHJsL3Bpbm11eC5oPgorI2luY2x1ZGUgPGxpbnV4L3BpbmN0
cmwvY29uc3VtZXIuaD4KKyNpbmNsdWRlIDxsaW51eC9ncmV5YnVzL2dyZXlidXNfbWFuaWZlc3Qu
aD4KKworI2luY2x1ZGUgIm1pa3JvYnVzX2NvcmUuaCIKKyNpbmNsdWRlICJtaWtyb2J1c19tYW5p
ZmVzdC5oIgorCitzdGF0aWMgREVGSU5FX01VVEVYKGNvcmVfbG9jayk7CitzdGF0aWMgREVGSU5F
X0lEUihtaWtyb2J1c19wb3J0X2lkcik7CitzdGF0aWMgc3RydWN0IGNsYXNzX2NvbXBhdCAqbWlr
cm9idXNfcG9ydF9jb21wYXRfY2xhc3M7CitpbnQJX19taWtyb2J1c19maXJzdF9keW5hbWljX2J1
c19udW07CitzdGF0aWMgYm9vbCBpc19yZWdpc3RlcmVkOworCitjb25zdCBjaGFyICpNSUtST0JV
U19QSU5DVFJMX1NUUltdID0geyJwd20iLCAidWFydCIsICJpMmMiLCAic3BpIn07CisKK3N0cnVj
dCBidXNfdHlwZSBtaWtyb2J1c19idXNfdHlwZSA9IHsKKwkubmFtZSA9ICJtaWtyb2J1cyIsCit9
OworRVhQT1JUX1NZTUJPTF9HUEwobWlrcm9idXNfYnVzX3R5cGUpOworCitzdGF0aWMgaW50IG1p
a3JvYnVzX3BvcnRfc2Nhbl9lZXByb20oc3RydWN0IG1pa3JvYnVzX3BvcnQgKnBvcnQpCit7CisJ
c3RydWN0IGFkZG9uX2JvYXJkX2luZm8gKmJvYXJkOworCWludCBtYW5pZmVzdF9zaXplOworCWNo
YXIgaGVhZGVyWzEyXTsKKwlpbnQgcmV0dmFsOworCWNoYXIgKmJ1ZjsKKworCXJldHZhbCA9IG52
bWVtX2RldmljZV9yZWFkKHBvcnQtPmVlcHJvbSwgMCwgMTIsIGhlYWRlcik7CisJaWYgKHJldHZh
bCAhPSAxMikgeworCQlkZXZfZXJyKCZwb3J0LT5kZXYsICJmYWlsZWQgdG8gZmV0Y2ggbWFuaWZl
c3QgaGVhZGVyICVkXG4iLAorCQkJcmV0dmFsKTsKKwkJcmV0dXJuIC1FSU5WQUw7CisJfQorCW1h
bmlmZXN0X3NpemUgPSBtaWtyb2J1c19tYW5pZmVzdF9oZWFkZXJfdmFsaWRhdGUoaGVhZGVyLCAx
Mik7CisJaWYgKG1hbmlmZXN0X3NpemUgPCAwKSB7CisJCWRldl9lcnIoJnBvcnQtPmRldiwgImlu
dmFsaWQgbWFuaWZlc3Qgc2l6ZSAlZFxuIiwKKwkJCW1hbmlmZXN0X3NpemUpOworCQlyZXR1cm4g
LUVJTlZBTDsKKwl9CisJYnVmID0ga3phbGxvYyhtYW5pZmVzdF9zaXplLCBHRlBfS0VSTkVMKTsK
KwlpZiAoIWJ1ZikKKwkJcmV0dXJuIC1FTk9NRU07CisJcmV0dmFsID0gbnZtZW1fZGV2aWNlX3Jl
YWQocG9ydC0+ZWVwcm9tLCAwLCBtYW5pZmVzdF9zaXplLCBidWYpOworCWlmIChyZXR2YWwgIT0g
bWFuaWZlc3Rfc2l6ZSkgeworCQlkZXZfZXJyKCZwb3J0LT5kZXYsICJmYWlsZWQgdG8gZmV0Y2gg
bWFuaWZlc3QgJWRcbiIsIHJldHZhbCk7CisJCXJldHZhbCA9IC1FSU5WQUw7CisJCWdvdG8gZXJy
X2ZyZWVfYnVmOworCX0KKwlib2FyZCA9IGt6YWxsb2Moc2l6ZW9mKCpib2FyZCksIEdGUF9LRVJO
RUwpOworCWlmICghYm9hcmQpIHsKKwkJcmV0dmFsID0gLUVOT01FTTsKKwkJZ290byBlcnJfZnJl
ZV9idWY7CisJfQorCUlOSVRfTElTVF9IRUFEKCZib2FyZC0+bWFuaWZlc3RfZGVzY3MpOworCUlO
SVRfTElTVF9IRUFEKCZib2FyZC0+ZGV2aWNlcyk7CisJcmV0dmFsID0gbWlrcm9idXNfbWFuaWZl
c3RfcGFyc2UoYm9hcmQsIGJ1ZiwgbWFuaWZlc3Rfc2l6ZSk7CisJaWYgKHJldHZhbCkgeworCQlk
ZXZfZXJyKCZwb3J0LT5kZXYsICJmYWlsZWQgdG8gcGFyc2UgbWFuaWZlc3QsIHNpemUgJWRcbiIs
CisJCQltYW5pZmVzdF9zaXplKTsKKwkJZ290byBlcnJfZnJlZV9ib2FyZDsKKwl9CisJcmV0dmFs
ID0gbWlrcm9idXNfYm9hcmRfcmVnaXN0ZXIocG9ydCwgYm9hcmQpOworCWlmIChyZXR2YWwpIHsK
KwkJZGV2X2VycigmcG9ydC0+ZGV2LCAiZmFpbGVkIHRvIHJlZ2lzdGVyIGJvYXJkICVzXG4iLAor
CQkJYm9hcmQtPm5hbWUpOworCQlnb3RvIGVycl9mcmVlX2JvYXJkOworCX0KKwlrZnJlZShidWYp
OworCXJldHVybiAwOworZXJyX2ZyZWVfYm9hcmQ6CisJa2ZyZWUoYm9hcmQpOworZXJyX2ZyZWVf
YnVmOgorCWtmcmVlKGJ1Zik7CisJcmV0dXJuIHJldHZhbDsKK30KKworc3RhdGljIHNzaXplX3Qg
bmFtZV9zaG93KHN0cnVjdCBkZXZpY2UgKmRldiwgc3RydWN0IGRldmljZV9hdHRyaWJ1dGUgKmF0
dHIsCisJCQkgY2hhciAqYnVmKQoreworCXJldHVybiBzcHJpbnRmKGJ1ZiwgIiVzXG4iLCB0b19t
aWtyb2J1c19wb3J0KGRldiktPm5hbWUpOworfQorc3RhdGljIERFVklDRV9BVFRSX1JPKG5hbWUp
OworCitzdGF0aWMgc3NpemVfdCBuZXdfZGV2aWNlX3N0b3JlKHN0cnVjdCBkZXZpY2UgKmRldiwg
c3RydWN0IGRldmljZV9hdHRyaWJ1dGUgKmF0dHIsCisJCQkJY29uc3QgY2hhciAqYnVmLCBzaXpl
X3QgY291bnQpCit7CisJc3RydWN0IG1pa3JvYnVzX3BvcnQgKnBvcnQgPSB0b19taWtyb2J1c19w
b3J0KGRldik7CisJc3RydWN0IGFkZG9uX2JvYXJkX2luZm8gKmJvYXJkOworCWludCByZXR2YWw7
CisKKwlpZiAocG9ydC0+Ym9hcmQpIHsKKwkJZGV2X2VycihkZXYsICJhbHJlYWR5IGhhcyBib2Fy
ZCByZWdpc3RlcmVkXG4iKTsKKwkJcmV0dXJuIC1FQlVTWTsKKwl9CisKKwlib2FyZCA9IGt6YWxs
b2Moc2l6ZW9mKCpib2FyZCksIEdGUF9LRVJORUwpOworCWlmICghYm9hcmQpCisJCXJldHVybiAt
RU5PTUVNOworCUlOSVRfTElTVF9IRUFEKCZib2FyZC0+bWFuaWZlc3RfZGVzY3MpOworCUlOSVRf
TElTVF9IRUFEKCZib2FyZC0+ZGV2aWNlcyk7CisJcmV0dmFsID0gbWlrcm9idXNfbWFuaWZlc3Rf
cGFyc2UoYm9hcmQsICh2b2lkICopYnVmLCBjb3VudCk7CisJaWYgKHJldHZhbCkgeworCQlkZXZf
ZXJyKGRldiwgImZhaWxlZCB0byBwYXJzZSBtYW5pZmVzdFxuIik7CisJCWdvdG8gZXJyX2ZyZWVf
Ym9hcmQ7CisJfQorCXJldHZhbCA9IG1pa3JvYnVzX2JvYXJkX3JlZ2lzdGVyKHBvcnQsIGJvYXJk
KTsKKwlpZiAocmV0dmFsKSB7CisJCWRldl9lcnIoZGV2LCAiZmFpbGVkIHRvIHJlZ2lzdGVyIGJv
YXJkICVzXG4iLCBib2FyZC0+bmFtZSk7CisJCWdvdG8gZXJyX2ZyZWVfYm9hcmQ7CisJfQorCXJl
dHVybiBjb3VudDsKK2Vycl9mcmVlX2JvYXJkOgorCWtmcmVlKGJvYXJkKTsKKwlyZXR1cm4gcmV0
dmFsOworfQorc3RhdGljIERFVklDRV9BVFRSX1dPKG5ld19kZXZpY2UpOworCitzdGF0aWMgc3Np
emVfdCByZXNjYW5fc3RvcmUoc3RydWN0IGRldmljZSAqZGV2LCBzdHJ1Y3QgZGV2aWNlX2F0dHJp
YnV0ZSAqYXR0ciwKKwkJCSAgICBjb25zdCBjaGFyICpidWYsIHNpemVfdCBjb3VudCkKK3sKKwlz
dHJ1Y3QgbWlrcm9idXNfcG9ydCAqcG9ydCA9IHRvX21pa3JvYnVzX3BvcnQoZGV2KTsKKwl1bnNp
Z25lZCBsb25nIGlkOworCWludCByZXR2YWw7CisKKwlpZiAoa3N0cnRvdWwoYnVmLCAwLCAmaWQp
KSB7CisJCWRldl9lcnIoZGV2LCAiY2Fubm90IHBhcnNlIHRyaWdnZXJcbiIpOworCQlyZXR1cm4g
LUVJTlZBTDsKKwl9CisJaWYgKHBvcnQtPmJvYXJkKSB7CisJCWRldl9lcnIoZGV2LCAiYWxyZWFk
eSBoYXMgYm9hcmQgcmVnaXN0ZXJlZFxuIik7CisJCXJldHVybiAtRUJVU1k7CisJfQorCXJldHZh
bCA9IG1pa3JvYnVzX3BvcnRfc2Nhbl9lZXByb20ocG9ydCk7CisJaWYgKHJldHZhbCkgeworCQlk
ZXZfZXJyKGRldiwgImJvYXJkIHJlZ2lzdGVyIGZyb20gbWFuaWZlc3QgZmFpbGVkXG4iKTsKKwkJ
cmV0dXJuIC1FSU5WQUw7CisJfQorCXJldHVybiBjb3VudDsKK30KK3N0YXRpYyBERVZJQ0VfQVRU
Ul9XTyhyZXNjYW4pOworCitzdGF0aWMgc3NpemVfdCBkZWxldGVfZGV2aWNlX3N0b3JlKHN0cnVj
dCBkZXZpY2UgKmRldiwgc3RydWN0IGRldmljZV9hdHRyaWJ1dGUgKmF0dHIsCisJCQkJICAgY29u
c3QgY2hhciAqYnVmLCBzaXplX3QgY291bnQpCit7CisJc3RydWN0IG1pa3JvYnVzX3BvcnQgKnBv
cnQgPSB0b19taWtyb2J1c19wb3J0KGRldik7CisJdW5zaWduZWQgbG9uZyBpZDsKKworCWlmIChr
c3RydG91bChidWYsIDAsICZpZCkpIHsKKwkJZGV2X2VycihkZXYsICJjYW5ub3QgcGFyc2UgYm9h
cmQgaWQiKTsKKwkJcmV0dXJuIC1FSU5WQUw7CisJfQorCWlmICghcG9ydC0+Ym9hcmQpIHsKKwkJ
ZGV2X2VycihkZXYsICJkb2VzIG5vdCBoYXZlIHJlZ2lzdGVyZWQgYm9hcmRzIik7CisJCXJldHVy
biAtRU5PREVWOworCX0KKwltaWtyb2J1c19ib2FyZF91bnJlZ2lzdGVyKHBvcnQsIHBvcnQtPmJv
YXJkKTsKKwlyZXR1cm4gY291bnQ7Cit9CitzdGF0aWMgREVWSUNFX0FUVFJfSUdOT1JFX0xPQ0tE
RVAoZGVsZXRlX2RldmljZSwgMDIwMCwgTlVMTCwgZGVsZXRlX2RldmljZV9zdG9yZSk7CisKK3N0
YXRpYyBzdHJ1Y3QgYXR0cmlidXRlICptaWtyb2J1c19wb3J0X2F0dHJzW10gPSB7CisJJmRldl9h
dHRyX25ld19kZXZpY2UuYXR0ciwgJmRldl9hdHRyX3Jlc2Nhbi5hdHRyLAorCSZkZXZfYXR0cl9k
ZWxldGVfZGV2aWNlLmF0dHIsICZkZXZfYXR0cl9uYW1lLmF0dHIsIE5VTEx9OworQVRUUklCVVRF
X0dST1VQUyhtaWtyb2J1c19wb3J0KTsKKworc3RhdGljIHZvaWQgbWlrcm9idXNfcG9ydF9yZWxl
YXNlKHN0cnVjdCBkZXZpY2UgKmRldikKK3sKKwlzdHJ1Y3QgbWlrcm9idXNfcG9ydCAqcG9ydCA9
IHRvX21pa3JvYnVzX3BvcnQoZGV2KTsKKworCW11dGV4X2xvY2soJmNvcmVfbG9jayk7CisJaWRy
X3JlbW92ZSgmbWlrcm9idXNfcG9ydF9pZHIsIHBvcnQtPmlkKTsKKwltdXRleF91bmxvY2soJmNv
cmVfbG9jayk7CisJa2ZyZWUocG9ydCk7Cit9CisKK3N0cnVjdCBkZXZpY2VfdHlwZSBtaWtyb2J1
c19wb3J0X3R5cGUgPSB7CisJLmdyb3VwcyA9IG1pa3JvYnVzX3BvcnRfZ3JvdXBzLAorCS5yZWxl
YXNlID0gbWlrcm9idXNfcG9ydF9yZWxlYXNlLAorfTsKK0VYUE9SVF9TWU1CT0xfR1BMKG1pa3Jv
YnVzX3BvcnRfdHlwZSk7CisKK2ludCBtaWtyb2J1c19wb3J0X3BpbmN0cmxfc2VsZWN0KHN0cnVj
dCBtaWtyb2J1c19wb3J0ICpwb3J0KQoreworCXN0cnVjdCBwaW5jdHJsX3N0YXRlICpzdGF0ZTsK
KwlpbnQgcmV0dmFsOworCWludCBpOworCisJZm9yIChpID0gMDsgaSA8IE1JS1JPQlVTX05VTV9Q
SU5DVFJMX1NUQVRFOyBpKyspIHsKKwkJc3RhdGUgPSBwaW5jdHJsX2xvb2t1cF9zdGF0ZShwb3J0
LT5waW5jdHJsLAorCQkJCQkgICAgIHBvcnQtPnBpbmN0cmxfc2VsZWN0ZWRbaV0pOworCQlpZiAo
IUlTX0VSUihzdGF0ZSkpIHsKKwkJCXJldHZhbCA9IHBpbmN0cmxfc2VsZWN0X3N0YXRlKHBvcnQt
PnBpbmN0cmwsIHN0YXRlKTsKKwkJCXByX2luZm8oInNldHRpbmcgcGluY3RybCAlc1xuIiwKKwkJ
CQlwb3J0LT5waW5jdHJsX3NlbGVjdGVkW2ldKTsKKwkJCWlmIChyZXR2YWwgIT0gMCkgeworCQkJ
CWRldl9lcnIoJnBvcnQtPmRldiwgImZhaWxlZCB0byBzZWxlY3Qgc3RhdGUgJXNcbiIsCisJCQkJ
CXBvcnQtPnBpbmN0cmxfc2VsZWN0ZWRbaV0pOworCQkJCXJldHVybiByZXR2YWw7CisJCQl9CisJ
CX0gZWxzZSB7CisJCQlkZXZfZXJyKCZwb3J0LT5kZXYsICJmYWlsZWQgdG8gZmluZCBzdGF0ZSAl
c1xuIiwKKwkJCQlwb3J0LT5waW5jdHJsX3NlbGVjdGVkW2ldKTsKKwkJCXJldHVybiBQVFJfRVJS
KHN0YXRlKTsKKwkJfQorCX0KKworCXJldHVybiByZXR2YWw7Cit9CitFWFBPUlRfU1lNQk9MX0dQ
TChtaWtyb2J1c19wb3J0X3BpbmN0cmxfc2VsZWN0KTsKKworc3RhdGljIGludCBtaWtyb2J1c19w
b3J0X3BpbmN0cmxfc2V0dXAoc3RydWN0IG1pa3JvYnVzX3BvcnQgKnBvcnQsIHN0cnVjdCBhZGRv
bl9ib2FyZF9pbmZvICpib2FyZCkKK3sKKwlpbnQgcmV0dmFsOworCWludCBpOworCisJZm9yIChp
ID0gMDsgaSA8IE1JS1JPQlVTX05VTV9QSU5DVFJMX1NUQVRFOyBpKyspIHsKKwkJc3dpdGNoIChp
KSB7CisJCWNhc2UgTUlLUk9CVVNfUElOQ1RSTF9QV006CisJCQlpZiAoYm9hcmQtPnBpbl9zdGF0
ZVtNSUtST0JVU19QSU5fUFdNXSA9PSBNSUtST0JVU19TVEFURV9QV00pCisJCQkJc3ByaW50Zihw
b3J0LT5waW5jdHJsX3NlbGVjdGVkW2ldLCAiJXNfJXMiLAorCQkJCQlNSUtST0JVU19QSU5DVFJM
X1NUUltpXSwgUElOQ1RSTF9TVEFURV9ERUZBVUxUKTsKKwkJCWVsc2UKKwkJCQlzcHJpbnRmKHBv
cnQtPnBpbmN0cmxfc2VsZWN0ZWRbaV0sICIlc18lcyIsCisJCQkJCU1JS1JPQlVTX1BJTkNUUkxf
U1RSW2ldLCBNSUtST0JVU19QSU5DVFJMX1NUQVRFX0dQSU8pOworCQkJYnJlYWs7CisJCWNhc2Ug
TUlLUk9CVVNfUElOQ1RSTF9VQVJUOgorCQkJaWYgKGJvYXJkLT5waW5fc3RhdGVbTUlLUk9CVVNf
UElOX1JYXSA9PSBNSUtST0JVU19TVEFURV9VQVJUKQorCQkJCXNwcmludGYocG9ydC0+cGluY3Ry
bF9zZWxlY3RlZFtpXSwgIiVzXyVzIiwKKwkJCQkJTUlLUk9CVVNfUElOQ1RSTF9TVFJbaV0sIFBJ
TkNUUkxfU1RBVEVfREVGQVVMVCk7CisJCQllbHNlCisJCQkJc3ByaW50Zihwb3J0LT5waW5jdHJs
X3NlbGVjdGVkW2ldLCAiJXNfJXMiLAorCQkJCQlNSUtST0JVU19QSU5DVFJMX1NUUltpXSwgTUlL
Uk9CVVNfUElOQ1RSTF9TVEFURV9HUElPKTsKKwkJCWJyZWFrOworCQljYXNlIE1JS1JPQlVTX1BJ
TkNUUkxfSTJDOgorCQkJaWYgKGJvYXJkLT5waW5fc3RhdGVbTUlLUk9CVVNfUElOX1NDTF0gPT0g
TUlLUk9CVVNfU1RBVEVfSTJDKQorCQkJCXNwcmludGYocG9ydC0+cGluY3RybF9zZWxlY3RlZFtp
XSwgIiVzXyVzIiwKKwkJCQkJTUlLUk9CVVNfUElOQ1RSTF9TVFJbaV0sIFBJTkNUUkxfU1RBVEVf
REVGQVVMVCk7CisJCQllbHNlCisJCQkJc3ByaW50Zihwb3J0LT5waW5jdHJsX3NlbGVjdGVkW2ld
LCAiJXNfJXMiLAorCQkJCQlNSUtST0JVU19QSU5DVFJMX1NUUltpXSwgTUlLUk9CVVNfUElOQ1RS
TF9TVEFURV9HUElPKTsKKwkJCWJyZWFrOworCQljYXNlIE1JS1JPQlVTX1BJTkNUUkxfU1BJOgor
CQkJaWYgKGJvYXJkLT5waW5fc3RhdGVbTUlLUk9CVVNfUElOX01PU0ldID09IE1JS1JPQlVTX1NU
QVRFX1NQSSkKKwkJCQlzcHJpbnRmKHBvcnQtPnBpbmN0cmxfc2VsZWN0ZWRbaV0sICIlc18lcyIs
CisJCQkJCU1JS1JPQlVTX1BJTkNUUkxfU1RSW2ldLCBQSU5DVFJMX1NUQVRFX0RFRkFVTFQpOwor
CQkJZWxzZQorCQkJCXNwcmludGYocG9ydC0+cGluY3RybF9zZWxlY3RlZFtpXSwgIiVzXyVzIiwK
KwkJCQkJTUlLUk9CVVNfUElOQ1RSTF9TVFJbaV0sIE1JS1JPQlVTX1BJTkNUUkxfU1RBVEVfR1BJ
Tyk7CisJCQlicmVhazsKKwkJfQorCX0KKworCXJldHZhbCA9IG1pa3JvYnVzX3BvcnRfcGluY3Ry
bF9zZWxlY3QocG9ydCk7CisJaWYgKHJldHZhbCkKKwkJZGV2X2VycigmcG9ydC0+ZGV2LCAiZmFp
bGVkIHRvIHNlbGVjdCBwaW5jdHJsIHN0YXRlcyBbJWRdIiwgcmV0dmFsKTsKKwlyZXR1cm4gcmV0
dmFsOworfQorCitzdGF0aWMgaW50IG1pa3JvYnVzX2lycV9nZXQoc3RydWN0IG1pa3JvYnVzX3Bv
cnQgKnBvcnQsIGludCBpcnFubywKKwkJCSAgICBpbnQgaXJxX3R5cGUpCit7CisJaW50IGlycTsK
KworCWlmIChpcnFubyA+IHBvcnQtPmdwaW9zLT5uZGVzY3MgLSAxKSB7CisJCWRldl9lcnIoJnBv
cnQtPmRldiwgIkdQSU8gJWQgZG9lcyBub3QgZXhpc3QiLCBpcnFubyk7CisJCXJldHVybiAtRU5P
REVWOworCX0KKworCWlycSA9IGdwaW9kX3RvX2lycShwb3J0LT5ncGlvcy0+ZGVzY1tpcnFub10p
OworCWlmIChpcnEgPCAwKSB7CisJCWRldl9lcnIoJnBvcnQtPmRldiwgImNvdWxkIG5vdCBnZXQg
aXJxICVkIiwgaXJxbm8pOworCQlyZXR1cm4gLUVJTlZBTDsKKwl9CisJaXJxX3NldF9pcnFfdHlw
ZShpcnEsIGlycV90eXBlKTsKKwlyZXR1cm4gaXJxOworfQorCitzdGF0aWMgaW50IG1pa3JvYnVz
X2dwaW9fc2V0dXAoc3RydWN0IGdwaW9fZGVzYyAqZ3BpbywgaW50IGdwaW9fc3RhdGUpCit7CisJ
aW50IHJldHZhbDsKKworCXN3aXRjaCAoZ3Bpb19zdGF0ZSkgeworCWNhc2UgTUlLUk9CVVNfU1RB
VEVfSU5QVVQ6CisJCXJldHZhbCA9IGdwaW9kX2RpcmVjdGlvbl9pbnB1dChncGlvKTsKKwkJYnJl
YWs7CisJY2FzZSBNSUtST0JVU19TVEFURV9PVVRQVVRfSElHSDoKKwkJcmV0dmFsID0gZ3Bpb2Rf
ZGlyZWN0aW9uX291dHB1dChncGlvLCAxKTsKKwkJYnJlYWs7CisJY2FzZSBNSUtST0JVU19TVEFU
RV9PVVRQVVRfTE9XOgorCQlyZXR2YWwgPSBncGlvZF9kaXJlY3Rpb25fb3V0cHV0KGdwaW8sIDAp
OworCQlicmVhazsKKwljYXNlIE1JS1JPQlVTX1NUQVRFX1BXTToKKwljYXNlIE1JS1JPQlVTX1NU
QVRFX1NQSToKKwljYXNlIE1JS1JPQlVTX1NUQVRFX0kyQzoKKwlkZWZhdWx0OgorCQlyZXR1cm4g
MDsKKwl9CisJcmV0dXJuIHJldHZhbDsKK30KKworc3RhdGljIGNoYXIgKm1pa3JvYnVzX2dwaW9f
Y2hpcF9uYW1lX2dldChzdHJ1Y3QgbWlrcm9idXNfcG9ydCAqcG9ydCwgaW50IGdwaW8pCit7CisJ
Y2hhciAqbmFtZTsKKwlzdHJ1Y3QgZ3Bpb19jaGlwICpncGlvY2hpcDsKKworCWlmIChncGlvID4g
cG9ydC0+Z3Bpb3MtPm5kZXNjcyAtIDEpCisJCXJldHVybiBOVUxMOworCisJZ3Bpb2NoaXAgPSBn
cGlvZF90b19jaGlwKHBvcnQtPmdwaW9zLT5kZXNjW2dwaW9dKTsKKwluYW1lID0ga21lbWR1cChn
cGlvY2hpcC0+bGFiZWwsIE1JS1JPQlVTX05BTUVfU0laRSwgR0ZQX0tFUk5FTCk7CisJcmV0dXJu
IG5hbWU7Cit9CisKK3N0YXRpYyBpbnQgbWlrcm9idXNfZ3Bpb19od251bV9nZXQoc3RydWN0IG1p
a3JvYnVzX3BvcnQgKnBvcnQsIGludCBncGlvKQoreworCWludCBod251bTsKKwlzdHJ1Y3QgZ3Bp
b19jaGlwICpncGlvY2hpcDsKKworCWlmIChncGlvID4gcG9ydC0+Z3Bpb3MtPm5kZXNjcyAtIDEp
CisJCXJldHVybiAtRU5PREVWOworCisJZ3Bpb2NoaXAgPSBncGlvZF90b19jaGlwKHBvcnQtPmdw
aW9zLT5kZXNjW2dwaW9dKTsKKwlod251bSA9IGRlc2NfdG9fZ3Bpbyhwb3J0LT5ncGlvcy0+ZGVz
Y1tncGlvXSkgLSBncGlvY2hpcC0+YmFzZTsKKwlyZXR1cm4gaHdudW07Cit9CisKK3N0YXRpYyB2
b2lkIG1pa3JvYnVzX2JvYXJkX2RldmljZV9yZWxlYXNlX2FsbChzdHJ1Y3QgYWRkb25fYm9hcmRf
aW5mbyAqaW5mbykKK3sKKwlzdHJ1Y3QgYm9hcmRfZGV2aWNlX2luZm8gKmRldjsKKwlzdHJ1Y3Qg
Ym9hcmRfZGV2aWNlX2luZm8gKm5leHQ7CisKKwlsaXN0X2Zvcl9lYWNoX2VudHJ5X3NhZmUoZGV2
LCBuZXh0LCAmaW5mby0+ZGV2aWNlcywgbGlua3MpIHsKKwkJbGlzdF9kZWwoJmRldi0+bGlua3Mp
OworCQlrZnJlZShkZXYpOworCX0KK30KKworc3RhdGljIGludCBtaWtyb2J1c19kZXZpY2VfcmVn
aXN0ZXIoc3RydWN0IG1pa3JvYnVzX3BvcnQgKnBvcnQsCisJCQkJICAgIHN0cnVjdCBib2FyZF9k
ZXZpY2VfaW5mbyAqZGV2LCBjaGFyICpib2FyZF9uYW1lKQoreworCXN0cnVjdCBpMmNfYm9hcmRf
aW5mbyAqaTJjOworCXN0cnVjdCBzcGlfYm9hcmRfaW5mbyAqc3BpOworCXN0cnVjdCBwbGF0Zm9y
bV9kZXZpY2UgKnBkZXY7CisJc3RydWN0IGdwaW9kX2xvb2t1cF90YWJsZSAqbG9va3VwOworCWNo
YXIgZGV2bmFtZVtNSUtST0JVU19OQU1FX1NJWkVdOworCWludCBpOworCisJZGV2X2luZm8oJnBv
cnQtPmRldiwgInJlZ2lzdGVyaW5nIGRldmljZSA6ICVzIiwgZGV2LT5kcnZfbmFtZSk7CisKKwlp
ZiAoZGV2LT5ncGlvX2xvb2t1cCkgeworCQlsb29rdXAgPSBkZXYtPmdwaW9fbG9va3VwOworCQlp
ZiAoZGV2LT5wcm90b2NvbCA9PSBHUkVZQlVTX1BST1RPQ09MX1NQSSkgeworCQkJc25wcmludGYo
ZGV2bmFtZSwgc2l6ZW9mKGRldm5hbWUpLCAiJXMuJXUiLAorCQkJCSBkZXZfbmFtZSgmcG9ydC0+
c3BpX21zdHItPmRldiksCisJCQkJcG9ydC0+Y2hpcF9zZWxlY3RbZGV2LT5yZWddKTsKKwkJCWxv
b2t1cC0+ZGV2X2lkID0ga21lbWR1cChkZXZuYW1lLCBNSUtST0JVU19OQU1FX1NJWkUsIEdGUF9L
RVJORUwpOworCQl9IGVsc2UgaWYgKGRldi0+cHJvdG9jb2wgPT0gR1JFWUJVU19QUk9UT0NPTF9S
QVcpIHsKKwkJCXNucHJpbnRmKGRldm5hbWUsIHNpemVvZihkZXZuYW1lKSwgIiVzLiV1IiwKKwkJ
CQkgZGV2LT5kcnZfbmFtZSwgZGV2LT5yZWcpOworCQkJbG9va3VwLT5kZXZfaWQgPSBrbWVtZHVw
KGRldm5hbWUsIE1JS1JPQlVTX05BTUVfU0laRSwgR0ZQX0tFUk5FTCk7CisJCX0gZWxzZSB7CisJ
CQlsb29rdXAtPmRldl9pZCA9IGRldi0+ZHJ2X25hbWU7CisJCX0KKwkJZGV2X2luZm8oJnBvcnQt
PmRldiwgIiBhZGRpbmcgbG9va3VwIHRhYmxlIDogJXNcbiIsCisJCQkgbG9va3VwLT5kZXZfaWQp
OworCQlmb3IgKGkgPSAwOyBpIDwgZGV2LT5udW1fZ3Bpb19yZXNvdXJjZXM7IGkrKykgeworCQkJ
bG9va3VwLT50YWJsZVtpXS5rZXkgPQorCQkJbWlrcm9idXNfZ3Bpb19jaGlwX25hbWVfZ2V0KHBv
cnQsCisJCQkJCQkgICAgbG9va3VwLT50YWJsZVtpXS5jaGlwX2h3bnVtKTsKKwkJCWxvb2t1cC0+
dGFibGVbaV0uY2hpcF9od251bSA9CisJCQltaWtyb2J1c19ncGlvX2h3bnVtX2dldChwb3J0LAor
CQkJCQkJbG9va3VwLT50YWJsZVtpXS5jaGlwX2h3bnVtKTsKKwkJCWxvb2t1cC0+dGFibGVbaV0u
ZmxhZ3MgPSBHUElPX0FDVElWRV9ISUdIOworCQl9CisJCWdwaW9kX2FkZF9sb29rdXBfdGFibGUo
bG9va3VwKTsKKwl9CisJc3dpdGNoIChkZXYtPnByb3RvY29sKSB7CisJY2FzZSBHUkVZQlVTX1BS
T1RPQ09MX1NQSToKKwkJc3BpID0ga3phbGxvYyhzaXplb2YoKnNwaSksIEdGUF9LRVJORUwpOwor
CQlpZiAoIXNwaSkKKwkJCXJldHVybiAtRU5PTUVNOworCQlzdHJuY3B5KHNwaS0+bW9kYWxpYXMs
IGRldi0+ZHJ2X25hbWUsIHNpemVvZihzcGktPm1vZGFsaWFzKSAtIDEpOworCQlpZiAoZGV2LT5p
cnEpCisJCQlzcGktPmlycSA9IG1pa3JvYnVzX2lycV9nZXQocG9ydCwgZGV2LT5pcnEsIGRldi0+
aXJxX3R5cGUpOworCQlpZiAoZGV2LT5wcm9wZXJ0aWVzKQorCQkJc3BpLT5wcm9wZXJ0aWVzID0g
ZGV2LT5wcm9wZXJ0aWVzOworCQlzcGktPmNoaXBfc2VsZWN0ID0gcG9ydC0+Y2hpcF9zZWxlY3Rb
ZGV2LT5yZWddOworCQlzcGktPm1heF9zcGVlZF9oeiA9IGRldi0+bWF4X3NwZWVkX2h6OworCQlz
cGktPm1vZGUgPSBkZXYtPm1vZGU7CisJCWRldi0+ZGV2X2NsaWVudCA9ICh2b2lkICopc3BpX25l
d19kZXZpY2UocG9ydC0+c3BpX21zdHIsIHNwaSk7CisJCWJyZWFrOworCWNhc2UgR1JFWUJVU19Q
Uk9UT0NPTF9JMkM6CisJCWkyYyA9IGt6YWxsb2Moc2l6ZW9mKCppMmMpLCBHRlBfS0VSTkVMKTsK
KwkJaWYgKCFpMmMpCisJCQlyZXR1cm4gLUVOT01FTTsKKwkJc3RybmNweShpMmMtPnR5cGUsIGRl
di0+ZHJ2X25hbWUsIHNpemVvZihpMmMtPnR5cGUpIC0gMSk7CisJCWlmIChkZXYtPmlycSkKKwkJ
CWkyYy0+aXJxID0gbWlrcm9idXNfaXJxX2dldChwb3J0LCBkZXYtPmlycSwgZGV2LT5pcnFfdHlw
ZSk7CisJCWlmIChkZXYtPnByb3BlcnRpZXMpCisJCQlpMmMtPnByb3BlcnRpZXMgPSBkZXYtPnBy
b3BlcnRpZXM7CisJCWkyYy0+YWRkciA9IGRldi0+cmVnOworCQlkZXYtPmRldl9jbGllbnQgPSAo
dm9pZCAqKWkyY19uZXdfY2xpZW50X2RldmljZShwb3J0LT5pMmNfYWRhcCwgaTJjKTsKKwkJYnJl
YWs7CisJY2FzZSBHUkVZQlVTX1BST1RPQ09MX1JBVzoKKwkJcGRldiA9IHBsYXRmb3JtX2Rldmlj
ZV9hbGxvYyhkZXYtPmRydl9uYW1lLCAwKTsKKwkJaWYgKCFwZGV2KQorCQkJcmV0dXJuIC1FTk9N
RU07CisJCWlmIChkZXYtPnByb3BlcnRpZXMpCisJCQlwbGF0Zm9ybV9kZXZpY2VfYWRkX3Byb3Bl
cnRpZXMocGRldiwgZGV2LT5wcm9wZXJ0aWVzKTsKKwkJZGV2LT5kZXZfY2xpZW50ID0gcGRldjsK
KwkJcGxhdGZvcm1fZGV2aWNlX2FkZChkZXYtPmRldl9jbGllbnQpOworCQlicmVhazsKKwljYXNl
IEdSRVlCVVNfUFJPVE9DT0xfVUFSVDoKKwkJZGV2X2luZm8oJnBvcnQtPmRldiwgInNlcmRldiBk
ZXZpY2VzIHN1cHBvcnQgbm90IHlldCBhZGRlZCIpOworCWJyZWFrOworCWRlZmF1bHQ6CisJcmV0
dXJuIC1FSU5WQUw7CisJfQorCXJldHVybiAwOworfQorCitzdGF0aWMgdm9pZCBtaWtyb2J1c19k
ZXZpY2VfdW5yZWdpc3RlcihzdHJ1Y3QgbWlrcm9idXNfcG9ydCAqcG9ydCwKKwkJCQkgICAgICAg
c3RydWN0IGJvYXJkX2RldmljZV9pbmZvICpkZXYsIGNoYXIgKmJvYXJkX25hbWUpCit7CisJZGV2
X2luZm8oJnBvcnQtPmRldiwgInJlbW92aW5nIGRldmljZSAlc1xuIiwgZGV2LT5kcnZfbmFtZSk7
CisJaWYgKGRldi0+Z3Bpb19sb29rdXApIHsKKwkJZ3Bpb2RfcmVtb3ZlX2xvb2t1cF90YWJsZShk
ZXYtPmdwaW9fbG9va3VwKTsKKwkJa2ZyZWUoZGV2LT5ncGlvX2xvb2t1cCk7CisJfQorCWtmcmVl
KGRldi0+cHJvcGVydGllcyk7CisJc3dpdGNoIChkZXYtPnByb3RvY29sKSB7CisJY2FzZSBHUkVZ
QlVTX1BST1RPQ09MX1NQSToKKwkJc3BpX3VucmVnaXN0ZXJfZGV2aWNlKChzdHJ1Y3Qgc3BpX2Rl
dmljZSAqKWRldi0+ZGV2X2NsaWVudCk7CisJCWJyZWFrOworCWNhc2UgR1JFWUJVU19QUk9UT0NP
TF9JMkM6CisJCWkyY191bnJlZ2lzdGVyX2RldmljZSgoc3RydWN0IGkyY19jbGllbnQgKilkZXYt
PmRldl9jbGllbnQpOworCQlicmVhazsKKwljYXNlIEdSRVlCVVNfUFJPVE9DT0xfUkFXOgorCQlw
bGF0Zm9ybV9kZXZpY2VfdW5yZWdpc3Rlcigoc3RydWN0IHBsYXRmb3JtX2RldmljZSAgKilkZXYt
PmRldl9jbGllbnQpOworCQlicmVhazsKKwljYXNlIEdSRVlCVVNfUFJPVE9DT0xfVUFSVDoKKwkJ
ZGV2X2VycigmcG9ydC0+ZGV2LCAic2VyZGV2IGRldmljZXMgc3VwcG9ydCBub3QgeWV0IGFkZGVk
Iik7CisJCWJyZWFrOworCX0KK30KKworaW50IG1pa3JvYnVzX2JvYXJkX3JlZ2lzdGVyKHN0cnVj
dCBtaWtyb2J1c19wb3J0ICpwb3J0LAlzdHJ1Y3QgYWRkb25fYm9hcmRfaW5mbyAqYm9hcmQpCit7
CisJc3RydWN0IGJvYXJkX2RldmljZV9pbmZvICpkZXZpbmZvOworCXN0cnVjdCBib2FyZF9kZXZp
Y2VfaW5mbyAqbmV4dDsKKwlpbnQgcmV0dmFsOworCWludCBpOworCisJaWYgKFdBUk5fT04obGlz
dF9lbXB0eSgmYm9hcmQtPmRldmljZXMpKSkKKwkJcmV0dXJuIC1FTk9ERVY7CisJaWYgKHBvcnQt
PnBpbmN0cmwpIHsKKwkJcmV0dmFsID0gbWlrcm9idXNfcG9ydF9waW5jdHJsX3NldHVwKHBvcnQs
IGJvYXJkKTsKKwkJaWYgKHJldHZhbCkKKwkJCWRldl9lcnIoJnBvcnQtPmRldiwgImZhaWxlZCB0
byBzZXR1cCBwaW5jdHJsIHN0YXRlIFslZF0iLCByZXR2YWwpOworCX0KKwlpZiAocG9ydC0+Z3Bp
b3MpIHsKKwkJZm9yIChpID0gMDsgaSA8IHBvcnQtPmdwaW9zLT5uZGVzY3M7IGkrKykgeworCQkJ
cmV0dmFsID0gbWlrcm9idXNfZ3Bpb19zZXR1cChwb3J0LT5ncGlvcy0+ZGVzY1tpXSwgYm9hcmQt
PnBpbl9zdGF0ZVtpXSk7CisJCQlpZiAocmV0dmFsKQorCQkJCWRldl9lcnIoJnBvcnQtPmRldiwg
ImZhaWxlZCB0byBzZXR1cCBncGlvICVkLCBzdGF0ZSAlZCIsCisJCQkJCWksIGJvYXJkLT5waW5f
c3RhdGVbaV0pOworCQl9CisJfQorCWxpc3RfZm9yX2VhY2hfZW50cnlfc2FmZShkZXZpbmZvLCBu
ZXh0LCAmYm9hcmQtPmRldmljZXMsIGxpbmtzKQorCQltaWtyb2J1c19kZXZpY2VfcmVnaXN0ZXIo
cG9ydCwgZGV2aW5mbywgYm9hcmQtPm5hbWUpOworCXBvcnQtPmJvYXJkID0gYm9hcmQ7CisJcmV0
dXJuIDA7Cit9CitFWFBPUlRfU1lNQk9MX0dQTChtaWtyb2J1c19ib2FyZF9yZWdpc3Rlcik7CisK
K3ZvaWQgbWlrcm9idXNfYm9hcmRfdW5yZWdpc3RlcihzdHJ1Y3QgbWlrcm9idXNfcG9ydCAqcG9y
dCwgc3RydWN0IGFkZG9uX2JvYXJkX2luZm8gKmJvYXJkKQoreworCXN0cnVjdCBib2FyZF9kZXZp
Y2VfaW5mbyAqZGV2aW5mbzsKKwlzdHJ1Y3QgYm9hcmRfZGV2aWNlX2luZm8gKm5leHQ7CisKKwlp
ZiAoV0FSTl9PTihsaXN0X2VtcHR5KCZib2FyZC0+ZGV2aWNlcykpKQorCQlyZXR1cm47CisJcG9y
dC0+Ym9hcmQgPSBOVUxMOworCWxpc3RfZm9yX2VhY2hfZW50cnlfc2FmZShkZXZpbmZvLCBuZXh0
LCAmYm9hcmQtPmRldmljZXMsIGxpbmtzKQorCQltaWtyb2J1c19kZXZpY2VfdW5yZWdpc3Rlcihw
b3J0LCBkZXZpbmZvLCBib2FyZC0+bmFtZSk7CisJbWlrcm9idXNfYm9hcmRfZGV2aWNlX3JlbGVh
c2VfYWxsKGJvYXJkKTsKKwlrZnJlZShib2FyZCk7CisJcG9ydC0+Ym9hcmQgPSBOVUxMOworfQor
RVhQT1JUX1NZTUJPTF9HUEwobWlrcm9idXNfYm9hcmRfdW5yZWdpc3Rlcik7CisKKy8qCisgKiB0
ZW1wb3Jhcnkgc2V0dXAgZm9yIEF0bWVsIEFUMjRDMzIgSTJDIEVFUFJPTSBvbiAweDU3CisgKiB3
aWxsIGJlIHJlbW92ZWQgb25jZSB0aGUgbWlrcm9idXN2MyBzdGFuZGFyZCBpbiBmaW5hbGl6ZWQu
CisgKi8KK3N0YXRpYyBzdHJ1Y3QgaTJjX2JvYXJkX2luZm8gbWlrcm9idXNfZWVwcm9tX2luZm8g
PSB7CisJSTJDX0JPQVJEX0lORk8oIjI0YzMyIiwgMHg1NyksCit9OworCitzdGF0aWMgaW50IG1p
a3JvYnVzX3BvcnRfZWVwcm9tX3Byb2JlKHN0cnVjdCBtaWtyb2J1c19wb3J0ICpwb3J0KQorewor
CXN0cnVjdCBpMmNfY2xpZW50ICplZXByb21fY2xpZW50OworCXN0cnVjdCBudm1lbV9kZXZpY2Ug
KmVlcHJvbTsKKwljaGFyIGRldl9uYW1lW01JS1JPQlVTX05BTUVfU0laRV07CisKKwllZXByb21f
Y2xpZW50ID0gaTJjX25ld19jbGllbnRfZGV2aWNlKHBvcnQtPmkyY19hZGFwLCAmbWlrcm9idXNf
ZWVwcm9tX2luZm8pOworCWlmICghSVNfRVJSKGVlcHJvbV9jbGllbnQpKSB7CisJCXByX2luZm8o
IiBtaWtyb2J1cyBwb3J0ICVkIGRlZmF1bHQgZWVwcm9tIGlzIHByb2JlZCBhdCAlMDJ4XG4iLCBw
b3J0LT5pZCwKKwkJCWVlcHJvbV9jbGllbnQtPmFkZHIpOworCQlzbnByaW50ZihkZXZfbmFtZSwg
c2l6ZW9mKGRldl9uYW1lKSwgIiVkLSUwNHgwIiwgcG9ydC0+aTJjX2FkYXAtPm5yLAorCQkJIGVl
cHJvbV9jbGllbnQtPmFkZHIpOworCQllZXByb20gPSBudm1lbV9kZXZpY2VfZ2V0KCZlZXByb21f
Y2xpZW50LT5kZXYsIGRldl9uYW1lKTsKKwkJaWYgKElTX0VSUihlZXByb20pKSB7CisJCQlwcl9l
cnIoIm1pa3JvYnVzIHBvcnQgJWQgZWVwcm9tIG52bWVtIGRldmljZSBwcm9iZSBmYWlsZWRcbiIs
IHBvcnQtPmlkKTsKKwkJCWkyY191bnJlZ2lzdGVyX2RldmljZShlZXByb21fY2xpZW50KTsKKwkJ
CXBvcnQtPmVlcHJvbSA9IE5VTEw7CisJCQlyZXR1cm4gMDsKKwkJfQorCX0gZWxzZSB7CisJCXBy
X2luZm8oIm1pa3JvYnVzIHBvcnQgJWQgZGVmYXVsdCBlZXByb20gcHJvYmUgZmFpbGVkXG4iLCBw
b3J0LT5pZCk7CisJCXJldHVybiAwOworCX0KKwlwb3J0LT5lZXByb20gPSBlZXByb207CisJcG9y
dC0+ZWVwcm9tX2NsaWVudCA9IGVlcHJvbV9jbGllbnQ7CisJcmV0dXJuIDA7Cit9CisKK2ludCBt
aWtyb2J1c19wb3J0X3JlZ2lzdGVyKHN0cnVjdCBtaWtyb2J1c19wb3J0ICpwb3J0KQoreworCXN0
cnVjdCBkZXZpY2UgKmRldiA9ICZwb3J0LT5kZXY7CisJaW50IHJldHZhbDsKKwlpbnQgaWQ7CisK
KwlpZiAoV0FSTl9PTighaXNfcmVnaXN0ZXJlZCkpCisJCXJldHVybiAtRUFHQUlOOworCisJaWYg
KGRldi0+b2Zfbm9kZSkgeworCQlpZCA9IG9mX2FsaWFzX2dldF9pZChkZXYtPm9mX25vZGUsICJt
aWtyb2J1cyIpOworCQlpZiAoaWQgPj0gMCkgeworCQkJcG9ydC0+aWQgPSBpZDsKKwkJCW11dGV4
X2xvY2soJmNvcmVfbG9jayk7CisJCQlpZCA9IGlkcl9hbGxvYygmbWlrcm9idXNfcG9ydF9pZHIs
IHBvcnQsIHBvcnQtPmlkLCBwb3J0LT5pZCArIDEsCisJCQkJICAgICAgIEdGUF9LRVJORUwpOwor
CQkJbXV0ZXhfdW5sb2NrKCZjb3JlX2xvY2spOworCQkJaWYgKFdBUk4oaWQgPCAwLCAiY291bGRu
J3QgZ2V0IGlkciIpKQorCQkJCXJldHVybiBpZCA9PSAtRU5PU1BDID8gLUVCVVNZIDogaWQ7CisJ
CX0KKwl9IGVsc2UgeworCQltdXRleF9sb2NrKCZjb3JlX2xvY2spOworCQlpZCA9IGlkcl9hbGxv
YygmbWlrcm9idXNfcG9ydF9pZHIsIHBvcnQsIF9fbWlrcm9idXNfZmlyc3RfZHluYW1pY19idXNf
bnVtLCAwLAorCQkJICAgICAgIEdGUF9LRVJORUwpOworCQltdXRleF91bmxvY2soJmNvcmVfbG9j
ayk7CisJCWlmIChpZCA8IDApCisJCQlyZXR1cm4gaWQ7CisJCXBvcnQtPmlkID0gaWQ7CisJfQor
CXBvcnQtPmRldi5idXMgPSAmbWlrcm9idXNfYnVzX3R5cGU7CisJcG9ydC0+ZGV2LnR5cGUgPSAm
bWlrcm9idXNfcG9ydF90eXBlOworCXN0cm5jcHkocG9ydC0+bmFtZSwgIm1pa3JvYnVzLXBvcnQi
LCBzaXplb2YocG9ydC0+bmFtZSkgLSAxKTsKKwlkZXZfc2V0X25hbWUoJnBvcnQtPmRldiwgIm1p
a3JvYnVzLSVkIiwgcG9ydC0+aWQpOworCXByX2luZm8oInJlZ2lzdGVyaW5nIHBvcnQgbWlrcm9i
dXMtJWQgIiwgcG9ydC0+aWQpOworCXJldHZhbCA9IGRldmljZV9yZWdpc3RlcigmcG9ydC0+ZGV2
KTsKKwlpZiAocmV0dmFsKSB7CisJCXByX2VycigicG9ydCAnJWQnOiBjYW4ndCByZWdpc3RlciBk
ZXZpY2UgKCVkKSIsIHBvcnQtPmlkLCByZXR2YWwpOworCQlwdXRfZGV2aWNlKCZwb3J0LT5kZXYp
OworCQlyZXR1cm4gcmV0dmFsOworCX0KKwlyZXR2YWwgPSBjbGFzc19jb21wYXRfY3JlYXRlX2xp
bmsobWlrcm9idXNfcG9ydF9jb21wYXRfY2xhc3MsICZwb3J0LT5kZXYsCisJCQkJCSAgcG9ydC0+
ZGV2LnBhcmVudCk7CisJaWYgKHJldHZhbCkKKwkJZGV2X3dhcm4oJnBvcnQtPmRldiwgImZhaWxl
ZCB0byBjcmVhdGUgY29tcGF0aWJpbGl0eSBjbGFzcyBsaW5rXG4iKTsKKwlpZiAoIXBvcnQtPmVl
cHJvbSkgeworCQlkZXZfaW5mbygmcG9ydC0+ZGV2LCAibWlrcm9idXMgcG9ydCAlZCBlZXByb20g
ZW1wdHkgcHJvYmluZyBkZWZhdWx0IGVlcHJvbVxuIiwKKwkJCSBwb3J0LT5pZCk7CisJCXJldHZh
bCA9IG1pa3JvYnVzX3BvcnRfZWVwcm9tX3Byb2JlKHBvcnQpOworCX0KKwlpZiAocG9ydC0+ZWVw
cm9tKSB7CisJCXJldHZhbCA9IG1pa3JvYnVzX3BvcnRfc2Nhbl9lZXByb20ocG9ydCk7CisJCWlm
IChyZXR2YWwpIHsKKwkJCWRldl93YXJuKCZwb3J0LT5kZXYsICJmYWlsZWQgdG8gcmVnaXN0ZXIg
Ym9hcmQgZnJvbSBtYW5pZmVzdFxuIik7CisJCQlyZXR1cm4gMDsKKwkJfQorCX0KKwlyZXR1cm4g
cmV0dmFsOworfQorRVhQT1JUX1NZTUJPTF9HUEwobWlrcm9idXNfcG9ydF9yZWdpc3Rlcik7CisK
K3ZvaWQgbWlrcm9idXNfcG9ydF9kZWxldGUoc3RydWN0IG1pa3JvYnVzX3BvcnQgKnBvcnQpCit7
CisJc3RydWN0IG1pa3JvYnVzX3BvcnQgKmZvdW5kOworCisJbXV0ZXhfbG9jaygmY29yZV9sb2Nr
KTsKKwlmb3VuZCA9IGlkcl9maW5kKCZtaWtyb2J1c19wb3J0X2lkciwgcG9ydC0+aWQpOworCW11
dGV4X3VubG9jaygmY29yZV9sb2NrKTsKKwlpZiAoZm91bmQgIT0gcG9ydCkgeworCQlwcl9lcnIo
InBvcnQgWyVzXSBub3QgcmVnaXN0ZXJlZCIsIHBvcnQtPm5hbWUpOworCQlyZXR1cm47CisJfQor
CWlmIChwb3J0LT5ib2FyZCkgeworCQlkZXZfZXJyKCZwb3J0LT5kZXYsICJhdHRlbXB0aW5nIHRv
IGRlbGV0ZSBwb3J0IHdpdGggcmVnaXN0ZXJlZCBib2FyZHMsIHBvcnQgWyVzXVxuIiwKKwkJCXBv
cnQtPm5hbWUpOworCQlyZXR1cm47CisJfQorCisJaWYgKHBvcnQtPmVlcHJvbSkgeworCQludm1l
bV9kZXZpY2VfcHV0KHBvcnQtPmVlcHJvbSk7CisJCWkyY191bnJlZ2lzdGVyX2RldmljZShwb3J0
LT5lZXByb21fY2xpZW50KTsKKwl9CisKKwljbGFzc19jb21wYXRfcmVtb3ZlX2xpbmsobWlrcm9i
dXNfcG9ydF9jb21wYXRfY2xhc3MsICZwb3J0LT5kZXYsCisJCQkJIHBvcnQtPmRldi5wYXJlbnQp
OworCWRldmljZV91bnJlZ2lzdGVyKCZwb3J0LT5kZXYpOworCW11dGV4X2xvY2soJmNvcmVfbG9j
ayk7CisJaWRyX3JlbW92ZSgmbWlrcm9idXNfcG9ydF9pZHIsIHBvcnQtPmlkKTsKKwltdXRleF91
bmxvY2soJmNvcmVfbG9jayk7CisJbWVtc2V0KCZwb3J0LT5kZXYsIDAsIHNpemVvZihwb3J0LT5k
ZXYpKTsKK30KK0VYUE9SVF9TWU1CT0xfR1BMKG1pa3JvYnVzX3BvcnRfZGVsZXRlKTsKKworc3Rh
dGljIGludCBfX2luaXQgbWlrcm9idXNfaW5pdCh2b2lkKQoreworCWludCByZXR2YWw7CisKKwly
ZXR2YWwgPSBidXNfcmVnaXN0ZXIoJm1pa3JvYnVzX2J1c190eXBlKTsKKwlpZiAocmV0dmFsKSB7
CisJCXByX2VycigiYnVzX3JlZ2lzdGVyIGZhaWxlZCAoJWQpXG4iLCByZXR2YWwpOworCQlyZXR1
cm4gcmV0dmFsOworCX0KKwltaWtyb2J1c19wb3J0X2NvbXBhdF9jbGFzcyA9IGNsYXNzX2NvbXBh
dF9yZWdpc3RlcigibWlrcm9idXMtcG9ydCIpOworCWlmICghbWlrcm9idXNfcG9ydF9jb21wYXRf
Y2xhc3MpIHsKKwkJcHJfZXJyKCJjbGFzc19jb21wYXQgcmVnaXN0ZXIgZmFpbGVkICglZClcbiIs
IHJldHZhbCk7CisJCXJldHZhbCA9IC1FTk9NRU07CisJCWdvdG8gY2xhc3NfZXJyOworCX0KKwly
ZXR2YWwgPSBvZl9hbGlhc19nZXRfaGlnaGVzdF9pZCgibWlrcm9idXMiKTsKKwlpZiAocmV0dmFs
ID49IF9fbWlrcm9idXNfZmlyc3RfZHluYW1pY19idXNfbnVtKQorCQlfX21pa3JvYnVzX2ZpcnN0
X2R5bmFtaWNfYnVzX251bSA9IHJldHZhbCArIDE7CisKKwlpc19yZWdpc3RlcmVkID0gdHJ1ZTsK
KwlyZXR1cm4gMDsKKworY2xhc3NfZXJyOgorCWJ1c191bnJlZ2lzdGVyKCZtaWtyb2J1c19idXNf
dHlwZSk7CisJaWRyX2Rlc3Ryb3koJm1pa3JvYnVzX3BvcnRfaWRyKTsKKwlpc19yZWdpc3RlcmVk
ID0gZmFsc2U7CisJcmV0dXJuIHJldHZhbDsKK30KK3N1YnN5c19pbml0Y2FsbChtaWtyb2J1c19p
bml0KTsKKworc3RhdGljIHZvaWQgX19leGl0IG1pa3JvYnVzX2V4aXQodm9pZCkKK3sKKwlidXNf
dW5yZWdpc3RlcigmbWlrcm9idXNfYnVzX3R5cGUpOworCWNsYXNzX2NvbXBhdF91bnJlZ2lzdGVy
KG1pa3JvYnVzX3BvcnRfY29tcGF0X2NsYXNzKTsKKwlpZHJfZGVzdHJveSgmbWlrcm9idXNfcG9y
dF9pZHIpOworfQorbW9kdWxlX2V4aXQobWlrcm9idXNfZXhpdCk7CisKK01PRFVMRV9BVVRIT1Io
IlZhaXNobmF2IE0gQSA8dmFpc2huYXZAYmVhZ2xlYm9hcmQub3JnPiIpOworTU9EVUxFX0RFU0NS
SVBUSU9OKCJtaWtyb0JVUyBtYWluIG1vZHVsZSIpOworTU9EVUxFX0xJQ0VOU0UoIkdQTCB2MiIp
OwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9taXNjL21pa3JvYnVzL21pa3JvYnVzX2NvcmUuaCBiL2Ry
aXZlcnMvbWlzYy9taWtyb2J1cy9taWtyb2J1c19jb3JlLmgKbmV3IGZpbGUgbW9kZSAxMDA2NDQK
aW5kZXggMDAwMDAwMDAwMDAwLi5iNWRhNDIyNWJjNmMKLS0tIC9kZXYvbnVsbAorKysgYi9kcml2
ZXJzL21pc2MvbWlrcm9idXMvbWlrcm9idXNfY29yZS5oCkBAIC0wLDAgKzEsMTkxIEBACisvKiBT
UERYLUxpY2Vuc2UtSWRlbnRpZmllcjogR1BMLTIuMCAqLworLyoKKyAqIG1pa3JvQlVTIERyaXZl
ciBmb3IgaW5zdGFudGlhdGluZyBhZGQtb24KKyAqIGJvYXJkIGRldmljZXMgd2l0aCBhbiBpZGVu
dGlmaWVyIEVFUFJPTQorICoKKyAqIENvcHlyaWdodCAyMDIwIFZhaXNobmF2IE0gQSwgQmVhZ2xl
Qm9hcmQub3JnIEZvdW5kYXRpb24uCisgKi8KKworI2lmbmRlZiBfX01JS1JPQlVTX0gKKyNkZWZp
bmUgX19NSUtST0JVU19ICisKKyNpbmNsdWRlIDxsaW51eC9rZXJuZWwuaD4KKyNpbmNsdWRlIDxs
aW51eC9kZXZpY2UuaD4KKyNpbmNsdWRlIDxsaW51eC9pMmMuaD4KKyNpbmNsdWRlIDxsaW51eC9n
cGlvLmg+CisjaW5jbHVkZSA8bGludXgvZ3Bpby9jb25zdW1lci5oPgorI2luY2x1ZGUgPGxpbnV4
L2dwaW8vbWFjaGluZS5oPgorI2luY2x1ZGUgPGxpbnV4L3NwaS9zcGkuaD4KKyNpbmNsdWRlIDxs
aW51eC9zZXJkZXYuaD4KKyNpbmNsdWRlIDxsaW51eC9wcm9wZXJ0eS5oPgorI2luY2x1ZGUgPGxp
bnV4L3BpbmN0cmwvcGluY3RybC5oPgorI2luY2x1ZGUgPGxpbnV4L3BpbmN0cmwvcGlubXV4Lmg+
CisjaW5jbHVkZSA8bGludXgvcGluY3RybC9jb25zdW1lci5oPgorI2luY2x1ZGUgPGxpbnV4L252
bWVtLWNvbnN1bWVyLmg+CisjaW5jbHVkZSA8bGludXgvbnZtZW0tcHJvdmlkZXIuaD4KKworI2Rl
ZmluZSBNSUtST0JVU19WRVJTSU9OX01BSk9SIDB4MDAKKyNkZWZpbmUgTUlLUk9CVVNfVkVSU0lP
Tl9NSU5PUiAweDAzCisKKyNkZWZpbmUgTUlLUk9CVVNfTkFNRV9TSVpFCQk0MAorI2RlZmluZSBN
SUtST0JVU19QSU5DVFJMX05BTUVfU0laRQkyMAorCisjZGVmaW5lIE1JS1JPQlVTX05VTV9QSU5D
VFJMX1NUQVRFCTQKKyNkZWZpbmUgTUlLUk9CVVNfTlVNX0NTCQkJMgorCisjZGVmaW5lIE1JS1JP
QlVTX1BJTkNUUkxfUFdNCQkwCisjZGVmaW5lIE1JS1JPQlVTX1BJTkNUUkxfVUFSVAkJMQorI2Rl
ZmluZSBNSUtST0JVU19QSU5DVFJMX0kyQwkJMgorI2RlZmluZSBNSUtST0JVU19QSU5DVFJMX1NQ
SQkJMworCisjZGVmaW5lIE1JS1JPQlVTX1BJTkNUUkxfU1RBVEVfR1BJTwkiZ3BpbyIKKworZXh0
ZXJuIHN0cnVjdCBidXNfdHlwZSBtaWtyb2J1c19idXNfdHlwZTsKK2V4dGVybiBzdHJ1Y3QgZGV2
aWNlX3R5cGUgbWlrcm9idXNfcG9ydF90eXBlOworZXh0ZXJuIGNvbnN0IGNoYXIgKk1JS1JPQlVT
X1BJTkNUUkxfU1RSW107CisKK2VudW0gbWlrcm9idXNfcHJvcGVydHlfdHlwZSB7CisJTUlLUk9C
VVNfUFJPUEVSVFlfVFlQRV9NSUtST0JVUyA9IDB4MDAsCisJTUlLUk9CVVNfUFJPUEVSVFlfVFlQ
RV9MSU5LCT0gMHgwMSwKKwlNSUtST0JVU19QUk9QRVJUWV9UWVBFX0dQSU8JPSAweDAyLAorCU1J
S1JPQlVTX1BST1BFUlRZX1RZUEVfVTgJPSAweDAzLAorCU1JS1JPQlVTX1BST1BFUlRZX1RZUEVf
VTE2CT0gMHgwNCwKKwlNSUtST0JVU19QUk9QRVJUWV9UWVBFX1UzMgk9IDB4MDUsCisJTUlLUk9C
VVNfUFJPUEVSVFlfVFlQRV9VNjQJPSAweDA2LAorfTsKKworZW51bSBtaWtyb2J1c19waW4gewor
CU1JS1JPQlVTX1BJTl9QV00JPSAweDAwLAorCU1JS1JPQlVTX1BJTl9JTlQJPSAweDAxLAorCU1J
S1JPQlVTX1BJTl9SWAkJPSAweDAyLAorCU1JS1JPQlVTX1BJTl9UWAkJPSAweDAzLAorCU1JS1JP
QlVTX1BJTl9TQ0wJPSAweDA0LAorCU1JS1JPQlVTX1BJTl9TREEJPSAweDA1LAorCU1JS1JPQlVT
X1BJTl9NT1NJCT0gMHgwNiwKKwlNSUtST0JVU19QSU5fTUlTTwk9IDB4MDcsCisJTUlLUk9CVVNf
UElOX1NDSwk9IDB4MDgsCisJTUlLUk9CVVNfUElOX0NTCQk9IDB4MDksCisJTUlLUk9CVVNfUElO
X1JTVAk9IDB4MEEsCisJTUlLUk9CVVNfUElOX0FOCQk9IDB4MEIsCisJTUlLUk9CVVNfUE9SVF9Q
SU5fQ09VTlQgPSAweDBDLAorfTsKKworZW51bSBtaWtyb2J1c19waW5fc3RhdGUgeworCU1JS1JP
QlVTX1NUQVRFX0lOUFVUCQk9IDB4MDEsCisJTUlLUk9CVVNfU1RBVEVfT1VUUFVUX0hJR0gJPSAw
eDAyLAorCU1JS1JPQlVTX1NUQVRFX09VVFBVVF9MT1cJPSAweDAzLAorCU1JS1JPQlVTX1NUQVRF
X1BXTQkJPSAweDA0LAorCU1JS1JPQlVTX1NUQVRFX1NQSQkJPSAweDA1LAorCU1JS1JPQlVTX1NU
QVRFX0kyQwkJPSAweDA2LAorCU1JS1JPQlVTX1NUQVRFX1VBUlQJCT0gMHgwNywKK307CisKKy8q
CisgKiBib2FyZF9kZXZpY2VfaW5mbyBkZXNjcmliZXMgYSBzaW5nbGUgZGV2aWNlIG9uIGEgbWlr
cm9idXMgYWRkLW9uCisgKiBib2FyZCwgYW4gYWRkLW9uIGJvYXJkIGNhbiBwcmVzZW50IG9uZSBv
ciBtb3JlIGRldmljZSB0byB0aGUgaG9zdAorICoKKyAqIEBncGlvX2xvb2t1cDogdXNlZCB0byBw
cm92aWRlIHRoZSBHUElPIGxvb2t1cCB0YWJsZSBmb3IKKyAqIHBhc3NpbmcgdGhlIG5hbWVkIEdQ
SU9zIHRvIGRldmljZSBkcml2ZXJzLgorICogQHByb3BlcnRpZXM6IHVzZWQgdG8gcHJvdmlkZSB0
aGUgcHJvcGVydHlfZW50cnkgdG8gcGFzcyBuYW1lZAorICogcHJvcGVydGllcyB0byBkZXZpY2Ug
ZHJpdmVycywgYXBwbGljYWJsZSBvbmx5IHdoZW4gZHJpdmVyIHVzZXMKKyAqIGRldmljZV9wcm9w
ZXJ0eV9yZWFkXyogY2FsbHMgdG8gZmV0Y2ggdGhlIHByb3BlcnRpZXMuCisgKiBAbnVtX2dwaW9f
cmVzb3VyY2VzOiBudW1iZXIgb2YgbmFtZWQgZ3BpbyByZXNvdXJjZXMgZm9yIHRoZSBkZXZpY2Us
CisgKiB1c2VkIG1haW5seSBmb3IgZ3Bpb2RfbG9va3VwX3RhYmxlIG1lbW9yeSBhbGxvY2F0aW9u
LgorICogQG51bV9wcm9wZXJ0aWVzOiBudW1iZXIgb2YgY3VzdG9tIHByb3BlcnRpZXMgZm9yIHRo
ZSBkZXZpY2UsCisgKiB1c2VkIG1haW5seSBmb3IgcHJvcGVydHlfZW50cnkgbWVtb3J5IGFsbG9j
YXRpb24uCisgKiBAcHJvdG9jb2w6IHVzZWQgdG8ga25vdyB0aGUgdHlwZSBvZiB0aGUgZGV2aWNl
IGFuZCBpdCBzaG91bGQKKyAqIGNvbnRhaW4gb25lIG9mIHRoZSB2YWx1ZXMgZGVmaW5lZCB1bmRl
ciAnZW51bSBncmV5YnVzX2NsYXNzX3R5cGUnCisgKiB1bmRlciBsaW51eC9ncmV5YnVzL2dyZXli
dXNfbWFuaWZlc3QuaAorICogQHJlZzogSTJDIGFkZHJlc3MgZm9yIHRoZSBkZXZpY2UsIGZvciBk
ZXZpY2VzIG9uIHRoZSBTUEkgYnVzCisgKiB0aGlzIGZpZWxkIGlzIHRoZSBjaGlwIHNlbGVjdCBh
ZGRyZXNzIHJlbGF0aXZlIHRvIHRoZSBtaWtyb2J1cworICogcG9ydDowLT5kZXZpY2UgY2hpcCBz
ZWxlY3QgY29ubmVjdGVkIHRvIENTIHBpbiBvbiBtaWtyb0JVUyBwb3J0CisgKgkxLT5kZXZpY2Ug
Y2hpcCBzZWxlY3QgY29ubmVjdGVkIHRvIFJTVCBQaW4gb24gbWlrcm9CVVMgcG9ydAorICogQG1v
ZGU6IFNQSSBtb2RlCisgKiBAbWF4X3NwZWVkX2h6OiBTUEkgbWF4IHNwZWVkKEh6KQorICogQGRy
dl9uYW1lOiBkZXZpY2VfaWQgdG8gbWF0Y2ggd2l0aCB0aGUgZHJpdmVyCisgKiBAaXJxX3R5cGU6
IHR5cGUgb2YgSVJRIHRyaWdnZXIgLCBtYXRjaCB3aXRoIGRlZmluZXMgaW4gbGludXgvaW50ZXJy
dXB0LmgKKyAqIEBpcnE6IGlycSBudW1iZXIgcmVsYXRpdmUgdG8gdGhlIG1pa3JvYnVzIHBvcnQg
c2hvdWxkIGNvbnRhaW4gb25lIG9mIHRoZQorICogdmFsdWVzIGRlZmluZWQgdW5kZXIgJ2VudW0g
bWlrcm9idXNfcGluJworICogQGlkOiBkZXZpY2UgaWQgc3RhcnRpbmcgZnJvbSAxCisgKi8KK3N0
cnVjdCBib2FyZF9kZXZpY2VfaW5mbyB7CisJc3RydWN0IGdwaW9kX2xvb2t1cF90YWJsZSAqZ3Bp
b19sb29rdXA7CisJc3RydWN0IHByb3BlcnR5X2VudHJ5ICpwcm9wZXJ0aWVzOworCXN0cnVjdCBs
aXN0X2hlYWQgbGlua3M7CisJdW5zaWduZWQgc2hvcnQgbnVtX2dwaW9fcmVzb3VyY2VzOworCXVu
c2lnbmVkIHNob3J0IG51bV9wcm9wZXJ0aWVzOworCXVuc2lnbmVkIHNob3J0IHByb3RvY29sOwor
CXVuc2lnbmVkIHNob3J0IHJlZzsKKwl1bnNpZ25lZCBpbnQgbW9kZTsKKwl2b2lkICpkZXZfY2xp
ZW50OworCXUzMiBtYXhfc3BlZWRfaHo7CisJY2hhciAqZHJ2X25hbWU7CisJaW50IGlycV90eXBl
OworCWludCBpcnE7CisJaW50IGlkOworfTsKKworLyoKKyAqIGFkZG9uX2JvYXJkX2luZm8gZGVz
Y3JpYmVzIGEgbWlrcm9idXMgYWRkLW9uIGRldmljZSB0aGUgYWRkLW9uCisgKiBib2FyZCwgYW4g
YWRkLW9uIGJvYXJkIGNhbiBwcmVzZW50IG9uZSBvciBtb3JlIGRldmljZSB0byB0aGUgaG9zdAor
ICoKKyAqIEBtYW5pZmVzdF9kZXNjczogbGlzdCBvZiBtYW5pZmVzdCBkZXNjcmlwdG9ycworICog
QGRldmljZXM6IGxpc3Qgb2YgZGV2aWNlcyBvbiB0aGUgYm9hcmQKKyAqIEBwaW5fc3RhdGU6IHRo
ZSBzdGF0ZSBvZiBlYWNoIHBpbiBvbiB0aGUgbWlrcm9idXMgcG9ydCByZXF1aXJlZAorICogZm9y
IHRoZSBhZGQtb24gYm9hcmQgc2hvdWxkIGNvbnRhaW4gb25lIG9mIHRoZSB2YWx1ZXMgZGVmaW5l
ZCB1bmRlcgorICogJ2VudW0gbWlrcm9idXNfcGluX3N0YXRlJyByZXN0cmljdGlvbnMgYXJlIGFz
IHBlciBtaWtyb2J1cyBzdGFuZGFyZAorICogc3BlY2lmaWNhdGlvbnMuCisgKiBAbmFtZTogYWRk
LW9uIGJvYXJkIG5hbWUKKyAqLworc3RydWN0IGFkZG9uX2JvYXJkX2luZm8geworCXN0cnVjdCBs
aXN0X2hlYWQgbWFuaWZlc3RfZGVzY3M7CisJc3RydWN0IGxpc3RfaGVhZCBkZXZpY2VzOworCXU4
IHBpbl9zdGF0ZVtNSUtST0JVU19QT1JUX1BJTl9DT1VOVF07CisJY2hhciAqbmFtZTsKK307CisK
Ky8qCisgKiBtaWtyb2J1c19wb3J0IGRlc2NyaWJlcyB0aGUgcGVyaXBoZXJhbHMgbWFwcGVkIHRv
IGEKKyAqIG1pa3JvYnVzIHBvcnQuCisgKgorICogQGVlcHJvbV9jbGllbnQ6IGkyY19jbGllbnQg
Y29ycmVzcG9uZGluZyB0byB0aGUgZWVwcm9tCisgKiBvbiB0aGUgYWRkLW9uIGJvYXJkLgorICog
QGJvYXJkOiBwb2ludGVyIHRvIHRoZSBhdHRhY2hlZCBhZGQtb24gYm9hcmQuCisgKiBAaTJjX2Fk
YXA6IEkyQyBhZGFwdGVyIGF0dGFjaGVkIHRvIHRoZSBtaWtyb2J1cyBwb3J0LgorICogQHNwaV9t
c3RyOiBTUEkgbWFzdGVyIGF0dGFjaGVkIHRvIHRoZSBtaWtyb2J1cyBwb3J0LgorICogQGVlcHJv
bTogbnZtZW1fZGV2aWNlIGZvciB0aGUgZWVwcm9tIG9uIHRoZSBhZGQtb24gYm9hcmQuCisgKiBA
cHdtOiBwd21fZGV2aWNlIGF0dGFjaGVkIHRvIHRoZSBtaWtyb2J1cyBwb3J0IFBXTSBwaW4uCisg
KiBAcGluY3RybF9zZWxlY3RlZDogY3VycmVudCBwaW5jdHJsX3NlbGVjdGVkIHN0YXRlLgorICog
QGNoaXBfc2VsZWN0OiBjaGlwIHNlbGVjdCBudW1iZXIgbWFwcGVkIHRvIHRoZSBTUEkKKyAqIENT
IHBpbiBvbiB0aGUgbWlrcm9idXMgcG9ydCBhbmQgdGhlIFJTVCBwaW4gb24gdGhlIG1pa3JvYnVz
CisgKiBwb3J0CisgKiBAaWQ6IHBvcnQgaWQgc3RhcnRpbmcgZnJvbSAxCisgKi8KK3N0cnVjdCBt
aWtyb2J1c19wb3J0IHsKKwlzdHJ1Y3QgaTJjX2NsaWVudCAqZWVwcm9tX2NsaWVudDsKKwlzdHJ1
Y3QgYWRkb25fYm9hcmRfaW5mbyAqYm9hcmQ7CisJc3RydWN0IGkyY19hZGFwdGVyICppMmNfYWRh
cDsKKwlzdHJ1Y3Qgc3BpX21hc3RlciAqc3BpX21zdHI7CisJc3RydWN0IG52bWVtX2RldmljZSAq
ZWVwcm9tOworCXN0cnVjdCBncGlvX2Rlc2NzICpncGlvczsKKwlzdHJ1Y3QgcHdtX2RldmljZSAq
cHdtOworCXN0cnVjdCBwaW5jdHJsICpwaW5jdHJsOworCXN0cnVjdCBtb2R1bGUgKm93bmVyOwor
CXN0cnVjdCBkZXZpY2UgZGV2OworCWNoYXIgbmFtZVtNSUtST0JVU19OQU1FX1NJWkVdOworCWNo
YXIgKnBpbmN0cmxfc2VsZWN0ZWRbTUlLUk9CVVNfTlVNX1BJTkNUUkxfU1RBVEVdOworCXVuc2ln
bmVkIGludCBjaGlwX3NlbGVjdFtNSUtST0JVU19OVU1fQ1NdOworCWludCBpZDsKK307CisKKyNk
ZWZpbmUgdG9fbWlrcm9idXNfcG9ydChkKSBjb250YWluZXJfb2YoZCwgc3RydWN0IG1pa3JvYnVz
X3BvcnQsIGRldikKKwordm9pZCBtaWtyb2J1c19ib2FyZF91bnJlZ2lzdGVyKHN0cnVjdCBtaWty
b2J1c19wb3J0ICpwb3J0LAorCQkJICAgICAgIHN0cnVjdCBhZGRvbl9ib2FyZF9pbmZvICpib2Fy
ZCk7CitpbnQgbWlrcm9idXNfYm9hcmRfcmVnaXN0ZXIoc3RydWN0IG1pa3JvYnVzX3BvcnQgKnBv
cnQsCisJCQkgICAgc3RydWN0IGFkZG9uX2JvYXJkX2luZm8gKmJvYXJkKTsKK2ludCBtaWtyb2J1
c19wb3J0X3JlZ2lzdGVyKHN0cnVjdCBtaWtyb2J1c19wb3J0ICpwb3J0KTsKK2ludCBtaWtyb2J1
c19wb3J0X3BpbmN0cmxfc2VsZWN0KHN0cnVjdCBtaWtyb2J1c19wb3J0ICpwb3J0KTsKK3ZvaWQg
bWlrcm9idXNfcG9ydF9kZWxldGUoc3RydWN0IG1pa3JvYnVzX3BvcnQgKnBvcnQpOworCisjZW5k
aWYgLyogX19NSUtST0JVU19IICovCmRpZmYgLS1naXQgYS9kcml2ZXJzL21pc2MvbWlrcm9idXMv
bWlrcm9idXNfbWFuaWZlc3QuYyBiL2RyaXZlcnMvbWlzYy9taWtyb2J1cy9taWtyb2J1c19tYW5p
ZmVzdC5jCm5ldyBmaWxlIG1vZGUgMTAwNjQ0CmluZGV4IDAwMDAwMDAwMDAwMC4uOTUyYTY4YzZk
OGQxCi0tLSAvZGV2L251bGwKKysrIGIvZHJpdmVycy9taXNjL21pa3JvYnVzL21pa3JvYnVzX21h
bmlmZXN0LmMKQEAgLTAsMCArMSw0NDQgQEAKKy8vIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBH
UEwtMi4wCisvKgorICogbWlrcm9CVVMgbWFuaWZlc3QgcGFyc2luZywgYW4KKyAqIGV4dGVuc2lv
biB0byBHcmV5YnVzIE1hbmlmZXN0IFBhcnNpbmcKKyAqIHVuZGVyIGRyaXZlcnMvZ3JleWJ1cy9t
YW5pZmVzdC5jCisgKgorICogQ29weXJpZ2h0IDIwMTQtMjAxNSBHb29nbGUgSW5jLgorICogQ29w
eXJpZ2h0IDIwMTQtMjAxNSBMaW5hcm8gTHRkLgorICovCisKKyNkZWZpbmUgcHJfZm10KGZtdCkg
Im1pa3JvYnVzX21hbmlmZXN0OiVzOiAiIGZtdCwgX19mdW5jX18KKworI2luY2x1ZGUgPGxpbnV4
L2JpdHMuaD4KKyNpbmNsdWRlIDxsaW51eC90eXBlcy5oPgorI2luY2x1ZGUgPGxpbnV4L3Byb3Bl
cnR5Lmg+CisjaW5jbHVkZSA8bGludXgvZ3JleWJ1cy9ncmV5YnVzX21hbmlmZXN0Lmg+CisKKyNp
bmNsdWRlICJtaWtyb2J1c19tYW5pZmVzdC5oIgorCitzdHJ1Y3QgbWFuaWZlc3RfZGVzYyB7CisJ
c3RydWN0IGxpc3RfaGVhZCBsaW5rczsKKwlzaXplX3Qgc2l6ZTsKKwl2b2lkICpkYXRhOworCWVu
dW0gZ3JleWJ1c19kZXNjcmlwdG9yX3R5cGUgdHlwZTsKK307CisKK3N0YXRpYyB2b2lkIG1hbmlm
ZXN0X2Rlc2NyaXB0b3JfcmVsZWFzZV9hbGwoc3RydWN0IGFkZG9uX2JvYXJkX2luZm8gKmJvYXJk
KQoreworCXN0cnVjdCBtYW5pZmVzdF9kZXNjICpkZXNjcmlwdG9yOworCXN0cnVjdCBtYW5pZmVz
dF9kZXNjICpuZXh0OworCisJbGlzdF9mb3JfZWFjaF9lbnRyeV9zYWZlKGRlc2NyaXB0b3IsIG5l
eHQsICZib2FyZC0+bWFuaWZlc3RfZGVzY3MsCisJCQkJIGxpbmtzKSB7CisJCWxpc3RfZGVsKCZk
ZXNjcmlwdG9yLT5saW5rcyk7CisJCWtmcmVlKGRlc2NyaXB0b3IpOworCX0KK30KKworc3RhdGlj
IGludCBib2FyZF9kZXNjcmlwdG9yX2FkZChzdHJ1Y3QgYWRkb25fYm9hcmRfaW5mbyAqYm9hcmQs
CisJCQkJc3RydWN0IGdyZXlidXNfZGVzY3JpcHRvciAqZGVzYywgc2l6ZV90IHNpemUpCit7CisJ
c3RydWN0IGdyZXlidXNfZGVzY3JpcHRvcl9oZWFkZXIgKmRlc2NfaGVhZGVyID0gJmRlc2MtPmhl
YWRlcjsKKwlzdHJ1Y3QgbWFuaWZlc3RfZGVzYyAqZGVzY3JpcHRvcjsKKwlzaXplX3QgZGVzY19z
aXplOworCXNpemVfdCBleHBlY3RlZF9zaXplOworCisJaWYgKHNpemUgPCBzaXplb2YoKmRlc2Nf
aGVhZGVyKSkgeworCQlwcl9lcnIoInNob3J0IGRlc2NyaXB0b3IgKCV6dSA8ICV6dSkiLCBzaXpl
LAorCQkgICAgICAgc2l6ZW9mKCpkZXNjX2hlYWRlcikpOworCQlyZXR1cm4gLUVJTlZBTDsKKwl9
CisJZGVzY19zaXplID0gbGUxNl90b19jcHUoZGVzY19oZWFkZXItPnNpemUpOworCWlmIChkZXNj
X3NpemUgPiBzaXplKSB7CisJCXByX2VycigiaW5jb3JyZWN0IGRlc2NyaXB0b3Igc2l6ZSAoJXp1
ICE9ICV6dSkiLCBzaXplLAorCQkgICAgICAgZGVzY19zaXplKTsKKwkJcmV0dXJuIC1FSU5WQUw7
CisJfQorCWV4cGVjdGVkX3NpemUgPSBzaXplb2YoKmRlc2NfaGVhZGVyKTsKKwlzd2l0Y2ggKGRl
c2NfaGVhZGVyLT50eXBlKSB7CisJY2FzZSBHUkVZQlVTX1RZUEVfU1RSSU5HOgorCQlleHBlY3Rl
ZF9zaXplICs9IHNpemVvZihzdHJ1Y3QgZ3JleWJ1c19kZXNjcmlwdG9yX3N0cmluZyk7CisJCWV4
cGVjdGVkX3NpemUgKz0gZGVzYy0+c3RyaW5nLmxlbmd0aDsKKwkJZXhwZWN0ZWRfc2l6ZSA9IEFM
SUdOKGV4cGVjdGVkX3NpemUsIDQpOworCQlicmVhazsKKwljYXNlIEdSRVlCVVNfVFlQRV9QUk9Q
RVJUWToKKwkJZXhwZWN0ZWRfc2l6ZSArPSBzaXplb2Yoc3RydWN0IGdyZXlidXNfZGVzY3JpcHRv
cl9wcm9wZXJ0eSk7CisJCWV4cGVjdGVkX3NpemUgKz0gZGVzYy0+cHJvcGVydHkubGVuZ3RoOwor
CQlleHBlY3RlZF9zaXplID0gQUxJR04oZXhwZWN0ZWRfc2l6ZSwgNCk7CisJCWJyZWFrOworCWNh
c2UgR1JFWUJVU19UWVBFX0RFVklDRToKKwkJZXhwZWN0ZWRfc2l6ZSArPSBzaXplb2Yoc3RydWN0
IGdyZXlidXNfZGVzY3JpcHRvcl9kZXZpY2UpOworCQlicmVhazsKKwljYXNlIEdSRVlCVVNfVFlQ
RV9NSUtST0JVUzoKKwkJZXhwZWN0ZWRfc2l6ZSArPSBzaXplb2Yoc3RydWN0IGdyZXlidXNfZGVz
Y3JpcHRvcl9taWtyb2J1cyk7CisJCWJyZWFrOworCWNhc2UgR1JFWUJVU19UWVBFX0lOVEVSRkFD
RToKKwkJZXhwZWN0ZWRfc2l6ZSArPSBzaXplb2Yoc3RydWN0IGdyZXlidXNfZGVzY3JpcHRvcl9p
bnRlcmZhY2UpOworCQlicmVhazsKKwljYXNlIEdSRVlCVVNfVFlQRV9DUE9SVDoKKwkJZXhwZWN0
ZWRfc2l6ZSArPSBzaXplb2Yoc3RydWN0IGdyZXlidXNfZGVzY3JpcHRvcl9jcG9ydCk7CisJCWJy
ZWFrOworCWNhc2UgR1JFWUJVU19UWVBFX0JVTkRMRToKKwkJZXhwZWN0ZWRfc2l6ZSArPSBzaXpl
b2Yoc3RydWN0IGdyZXlidXNfZGVzY3JpcHRvcl9idW5kbGUpOworCQlicmVhazsKKwljYXNlIEdS
RVlCVVNfVFlQRV9JTlZBTElEOgorCWRlZmF1bHQ6CisJCXByX2VycigiaW52YWxpZCBkZXNjcmlw
dG9yIHR5cGUgJWQiLCBkZXNjX2hlYWRlci0+dHlwZSk7CisJCXJldHVybiAtRUlOVkFMOworCX0K
KworCWRlc2NyaXB0b3IgPSBremFsbG9jKHNpemVvZigqZGVzY3JpcHRvciksIEdGUF9LRVJORUwp
OworCWlmICghZGVzY3JpcHRvcikKKwkJcmV0dXJuIC1FTk9NRU07CisJZGVzY3JpcHRvci0+c2l6
ZSA9IGRlc2Nfc2l6ZTsKKwlkZXNjcmlwdG9yLT5kYXRhID0gKGNoYXIgKilkZXNjICsgc2l6ZW9m
KCpkZXNjX2hlYWRlcik7CisJZGVzY3JpcHRvci0+dHlwZSA9IGRlc2NfaGVhZGVyLT50eXBlOwor
CWxpc3RfYWRkX3RhaWwoJmRlc2NyaXB0b3ItPmxpbmtzLCAmYm9hcmQtPm1hbmlmZXN0X2Rlc2Nz
KTsKKwlyZXR1cm4gZGVzY19zaXplOworfQorCitzdGF0aWMgY2hhciAqbWlrcm9idXNfc3RyaW5n
X2dldChzdHJ1Y3QgYWRkb25fYm9hcmRfaW5mbyAqYm9hcmQsIHU4IHN0cmluZ19pZCkKK3sKKwlz
dHJ1Y3QgZ3JleWJ1c19kZXNjcmlwdG9yX3N0cmluZyAqZGVzY19zdHJpbmc7CisJc3RydWN0IG1h
bmlmZXN0X2Rlc2MgKmRlc2NyaXB0b3I7CisJYm9vbCBmb3VuZCA9IGZhbHNlOworCWNoYXIgKnN0
cmluZzsKKworCWlmICghc3RyaW5nX2lkKQorCQlyZXR1cm4gTlVMTDsKKworCWxpc3RfZm9yX2Vh
Y2hfZW50cnkoZGVzY3JpcHRvciwgJmJvYXJkLT5tYW5pZmVzdF9kZXNjcywgbGlua3MpIHsKKwkJ
aWYgKGRlc2NyaXB0b3ItPnR5cGUgIT0gR1JFWUJVU19UWVBFX1NUUklORykKKwkJCWNvbnRpbnVl
OworCQlkZXNjX3N0cmluZyA9IGRlc2NyaXB0b3ItPmRhdGE7CisJCWlmIChkZXNjX3N0cmluZy0+
aWQgPT0gc3RyaW5nX2lkKSB7CisJCQlmb3VuZCA9IHRydWU7CisJCQlicmVhazsKKwkJfQorCX0K
KwlpZiAoIWZvdW5kKQorCQlyZXR1cm4gRVJSX1BUUigtRU5PRU5UKTsKKwlzdHJpbmcgPSBrbWVt
ZHVwKCZkZXNjX3N0cmluZy0+c3RyaW5nLCBkZXNjX3N0cmluZy0+bGVuZ3RoICsgMSwKKwkJCSBH
RlBfS0VSTkVMKTsKKwlpZiAoIXN0cmluZykKKwkJcmV0dXJuIEVSUl9QVFIoLUVOT01FTSk7CisJ
c3RyaW5nW2Rlc2Nfc3RyaW5nLT5sZW5ndGhdID0gJ1wwJzsKKwlyZXR1cm4gc3RyaW5nOworfQor
CitzdGF0aWMgdm9pZCBtaWtyb2J1c19zdGF0ZV9nZXQoc3RydWN0IGFkZG9uX2JvYXJkX2luZm8g
KmJvYXJkKQoreworCXN0cnVjdCBncmV5YnVzX2Rlc2NyaXB0b3JfbWlrcm9idXMgKm1pa3JvYnVz
OworCXN0cnVjdCBncmV5YnVzX2Rlc2NyaXB0b3JfaW50ZXJmYWNlICppbnRlcmZhY2U7CisJc3Ry
dWN0IG1hbmlmZXN0X2Rlc2MgKmRlc2NyaXB0b3I7CisJYm9vbCBmb3VuZCA9IGZhbHNlOworCWlu
dCBpOworCisJbGlzdF9mb3JfZWFjaF9lbnRyeShkZXNjcmlwdG9yLCAmYm9hcmQtPm1hbmlmZXN0
X2Rlc2NzLCBsaW5rcykgeworCQlpZiAoZGVzY3JpcHRvci0+dHlwZSA9PSBHUkVZQlVTX1RZUEVf
TUlLUk9CVVMpIHsKKwkJCW1pa3JvYnVzID0gZGVzY3JpcHRvci0+ZGF0YTsKKwkJCWZvdW5kID0g
dHJ1ZTsKKwkJCWJyZWFrOworCQl9CisJfQorCWlmICghZm91bmQpIHsKKwkJcHJfZXJyKCJtaWty
b2J1cyBkZXNjcmlwdG9yIG5vdCBmb3VuZCIpOworCQlyZXR1cm47CisJfQorCWZvciAoaSA9IDA7
IGkgPCBNSUtST0JVU19QT1JUX1BJTl9DT1VOVDsgaSsrKQorCQlib2FyZC0+cGluX3N0YXRlW2ld
ID0gIG1pa3JvYnVzLT5waW5fc3RhdGVbaV07CisKKwlmb3VuZCA9IGZhbHNlOworCWxpc3RfZm9y
X2VhY2hfZW50cnkoZGVzY3JpcHRvciwgJmJvYXJkLT5tYW5pZmVzdF9kZXNjcywgbGlua3MpIHsK
KwkJaWYgKGRlc2NyaXB0b3ItPnR5cGUgPT0gR1JFWUJVU19UWVBFX0lOVEVSRkFDRSkgeworCQkJ
aW50ZXJmYWNlID0gZGVzY3JpcHRvci0+ZGF0YTsKKwkJCWZvdW5kID0gdHJ1ZTsKKwkJCWJyZWFr
OworCQl9CisJfQorCWlmICghZm91bmQpIHsKKwkJcHJfZXJyKCJpbnRlcmZhY2UgZGVzY3JpcHRv
ciBub3QgZm91bmQiKTsKKwkJcmV0dXJuOworCX0KKwlib2FyZC0+bmFtZSA9IG1pa3JvYnVzX3N0
cmluZ19nZXQoYm9hcmQsIGludGVyZmFjZS0+cHJvZHVjdF9zdHJpbmdpZCk7Cit9CisKK3N0YXRp
YyBzdHJ1Y3QgcHJvcGVydHlfZW50cnkgKgorbWlrcm9idXNfcHJvcGVydHlfZW50cnlfZ2V0KHN0
cnVjdCBhZGRvbl9ib2FyZF9pbmZvICpib2FyZCwgdTggKnByb3BfbGluaywKKwkJCSAgICBpbnQg
bnVtX3Byb3BlcnRpZXMpCit7CisJc3RydWN0IGdyZXlidXNfZGVzY3JpcHRvcl9wcm9wZXJ0eSAq
ZGVzY19wcm9wZXJ0eTsKKwlzdHJ1Y3QgbWFuaWZlc3RfZGVzYyAqZGVzY3JpcHRvcjsKKwlzdHJ1
Y3QgcHJvcGVydHlfZW50cnkgKnByb3BlcnRpZXM7CisJYm9vbCBmb3VuZCA9IGZhbHNlOworCWNo
YXIgKnByb3BfbmFtZTsKKwl1NjQgKnZhbF91NjQ7CisJdTMyICp2YWxfdTMyOworCXUxNiAqdmFs
X3UxNjsKKwl1OCAqdmFsX3U4OworCWludCBpOworCisJcHJvcGVydGllcyA9IGtjYWxsb2MobnVt
X3Byb3BlcnRpZXMsIHNpemVvZigqcHJvcGVydGllcyksIEdGUF9LRVJORUwpOworCWlmICghcHJv
cGVydGllcykKKwkJcmV0dXJuIEVSUl9QVFIoLUVOT01FTSk7CisJZm9yIChpID0gMDsgaSA8IG51
bV9wcm9wZXJ0aWVzOyBpKyspIHsKKwkJbGlzdF9mb3JfZWFjaF9lbnRyeShkZXNjcmlwdG9yLCAm
Ym9hcmQtPm1hbmlmZXN0X2Rlc2NzLCBsaW5rcykgeworCQkJaWYgKGRlc2NyaXB0b3ItPnR5cGUg
IT0gR1JFWUJVU19UWVBFX1BST1BFUlRZKQorCQkJCWNvbnRpbnVlOworCQkJZGVzY19wcm9wZXJ0
eSA9IGRlc2NyaXB0b3ItPmRhdGE7CisJCQlpZiAoZGVzY19wcm9wZXJ0eS0+aWQgPT0gcHJvcF9s
aW5rW2ldKSB7CisJCQkJZm91bmQgPSB0cnVlOworCQkJCWJyZWFrOworCQkJfQorCQl9CisJCWlm
ICghZm91bmQpIHsKKwkJCWtmcmVlKHByb3BlcnRpZXMpOworCQkJcmV0dXJuIEVSUl9QVFIoLUVO
T0VOVCk7CisJCX0KKwkJcHJvcF9uYW1lID0gbWlrcm9idXNfc3RyaW5nX2dldChib2FyZCwKKwkJ
CQkJCWRlc2NfcHJvcGVydHktPnByb3BuYW1lX3N0cmluZ2lkKTsKKwkJaWYgKCFwcm9wX25hbWUp
IHsKKwkJCWtmcmVlKHByb3BlcnRpZXMpOworCQkJcmV0dXJuIEVSUl9QVFIoLUVOT0VOVCk7CisJ
CX0KKwkJc3dpdGNoIChkZXNjX3Byb3BlcnR5LT50eXBlKSB7CisJCWNhc2UgTUlLUk9CVVNfUFJP
UEVSVFlfVFlQRV9VODoKKwkJCXZhbF91OCA9IGttZW1kdXAoJmRlc2NfcHJvcGVydHktPnZhbHVl
LAorCQkJCQkgKGRlc2NfcHJvcGVydHktPmxlbmd0aCkgKiBzaXplb2YodTgpLCBHRlBfS0VSTkVM
KTsKKwkJCWlmIChkZXNjX3Byb3BlcnR5LT5sZW5ndGggPT0gMSkKKwkJCQlwcm9wZXJ0aWVzW2ld
ID0gUFJPUEVSVFlfRU5UUllfVTgocHJvcF9uYW1lLCAqdmFsX3U4KTsKKwkJCWVsc2UKKwkJCQlw
cm9wZXJ0aWVzW2ldID0gUFJPUEVSVFlfRU5UUllfVThfQVJSQVlfTEVOKHByb3BfbmFtZSwKKwkJ
CQkJKHZvaWQgKilkZXNjX3Byb3BlcnR5LT52YWx1ZSwgZGVzY19wcm9wZXJ0eS0+bGVuZ3RoKTsK
KwkJCWJyZWFrOworCQljYXNlIE1JS1JPQlVTX1BST1BFUlRZX1RZUEVfVTE2OgorCQkJdmFsX3Ux
NiA9IGttZW1kdXAoJmRlc2NfcHJvcGVydHktPnZhbHVlLAorCQkJCQkgIChkZXNjX3Byb3BlcnR5
LT5sZW5ndGgpICogc2l6ZW9mKHUxNiksIEdGUF9LRVJORUwpOworCQkJaWYgKGRlc2NfcHJvcGVy
dHktPmxlbmd0aCA9PSAxKQorCQkJCXByb3BlcnRpZXNbaV0gPSBQUk9QRVJUWV9FTlRSWV9VMTYo
cHJvcF9uYW1lLCAqdmFsX3UxNik7CisJCQllbHNlCisJCQkJcHJvcGVydGllc1tpXSA9IFBST1BF
UlRZX0VOVFJZX1UxNl9BUlJBWV9MRU4ocHJvcF9uYW1lLAorCQkJCQkodm9pZCAqKWRlc2NfcHJv
cGVydHktPnZhbHVlLCBkZXNjX3Byb3BlcnR5LT5sZW5ndGgpOworCQkJYnJlYWs7CisJCWNhc2Ug
TUlLUk9CVVNfUFJPUEVSVFlfVFlQRV9VMzI6CisJCQl2YWxfdTMyID0ga21lbWR1cCgmZGVzY19w
cm9wZXJ0eS0+dmFsdWUsCisJCQkJCSAgKGRlc2NfcHJvcGVydHktPmxlbmd0aCkgKiBzaXplb2Yo
dTMyKSwgR0ZQX0tFUk5FTCk7CisJCQlpZiAoZGVzY19wcm9wZXJ0eS0+bGVuZ3RoID09IDEpCisJ
CQkJcHJvcGVydGllc1tpXSA9IFBST1BFUlRZX0VOVFJZX1UzMihwcm9wX25hbWUsICp2YWxfdTMy
KTsKKwkJCWVsc2UKKwkJCQlwcm9wZXJ0aWVzW2ldID0gUFJPUEVSVFlfRU5UUllfVTMyX0FSUkFZ
X0xFTihwcm9wX25hbWUsCisJCQkJCSh2b2lkICopZGVzY19wcm9wZXJ0eS0+dmFsdWUsIGRlc2Nf
cHJvcGVydHktPmxlbmd0aCk7CisJCQlicmVhazsKKwkJY2FzZSBNSUtST0JVU19QUk9QRVJUWV9U
WVBFX1U2NDoKKwkJCXZhbF91NjQgPSBrbWVtZHVwKCZkZXNjX3Byb3BlcnR5LT52YWx1ZSwKKwkJ
CQkJICAoZGVzY19wcm9wZXJ0eS0+bGVuZ3RoKSAqIHNpemVvZih1NjQpLCBHRlBfS0VSTkVMKTsK
KwkJCWlmIChkZXNjX3Byb3BlcnR5LT5sZW5ndGggPT0gMSkKKwkJCQlwcm9wZXJ0aWVzW2ldID0g
UFJPUEVSVFlfRU5UUllfVTY0KHByb3BfbmFtZSwgKnZhbF91NjQpOworCQkJZWxzZQorCQkJCXBy
b3BlcnRpZXNbaV0gPSBQUk9QRVJUWV9FTlRSWV9VNjRfQVJSQVlfTEVOKHByb3BfbmFtZSwKKwkJ
CQkJKHZvaWQgKilkZXNjX3Byb3BlcnR5LT52YWx1ZSwgZGVzY19wcm9wZXJ0eS0+bGVuZ3RoKTsK
KwkJCWJyZWFrOworCQlkZWZhdWx0OgorCQkJa2ZyZWUocHJvcGVydGllcyk7CisJCQlyZXR1cm4g
RVJSX1BUUigtRUlOVkFMKTsKKwkJfQorCX0KKwlyZXR1cm4gcHJvcGVydGllczsKK30KKworc3Rh
dGljIHU4ICptaWtyb2J1c19wcm9wZXJ0eV9saW5rX2dldChzdHJ1Y3QgYWRkb25fYm9hcmRfaW5m
byAqYm9hcmQsIHU4IHByb3BfaWQsCisJCQkJICAgICAgc3RydWN0IGJvYXJkX2RldmljZV9pbmZv
ICpib2FyZF9kZXYsICB1OCBwcm9wX3R5cGUpCit7CisJc3RydWN0IGdyZXlidXNfZGVzY3JpcHRv
cl9wcm9wZXJ0eSAqZGVzY19wcm9wZXJ0eTsKKwlzdHJ1Y3QgbWFuaWZlc3RfZGVzYyAqZGVzY3Jp
cHRvcjsKKwlib29sIGZvdW5kID0gZmFsc2U7CisJdTggKnZhbF91ODsKKworCWlmICghcHJvcF9p
ZCkKKwkJcmV0dXJuIE5VTEw7CisJbGlzdF9mb3JfZWFjaF9lbnRyeShkZXNjcmlwdG9yLCAmYm9h
cmQtPm1hbmlmZXN0X2Rlc2NzLCBsaW5rcykgeworCQlpZiAoZGVzY3JpcHRvci0+dHlwZSAhPSBH
UkVZQlVTX1RZUEVfUFJPUEVSVFkpCisJCQljb250aW51ZTsKKwkJZGVzY19wcm9wZXJ0eSA9IGRl
c2NyaXB0b3ItPmRhdGE7CisJCWlmIChkZXNjX3Byb3BlcnR5LT5pZCA9PSBwcm9wX2lkICYmIGRl
c2NfcHJvcGVydHktPnR5cGUgPT0gcHJvcF90eXBlKSB7CisJCQlmb3VuZCA9IHRydWU7CisJCQli
cmVhazsKKwkJfQorCX0KKwlpZiAoIWZvdW5kKQorCQlyZXR1cm4gRVJSX1BUUigtRU5PRU5UKTsK
Kwl2YWxfdTggPSBrbWVtZHVwKCZkZXNjX3Byb3BlcnR5LT52YWx1ZSwgZGVzY19wcm9wZXJ0eS0+
bGVuZ3RoLCBHRlBfS0VSTkVMKTsKKwlpZiAocHJvcF90eXBlID09IE1JS1JPQlVTX1BST1BFUlRZ
X1RZUEVfR1BJTykKKwkJYm9hcmRfZGV2LT5udW1fZ3Bpb19yZXNvdXJjZXMgPSBkZXNjX3Byb3Bl
cnR5LT5sZW5ndGg7CisJZWxzZSBpZiAocHJvcF90eXBlID09IE1JS1JPQlVTX1BST1BFUlRZX1RZ
UEVfTElOSykKKwkJYm9hcmRfZGV2LT5udW1fcHJvcGVydGllcyA9IGRlc2NfcHJvcGVydHktPmxl
bmd0aDsKKwlyZXR1cm4gdmFsX3U4OworfQorCitzdGF0aWMgaW50IG1pa3JvYnVzX21hbmlmZXN0
X2F0dGFjaF9kZXZpY2Uoc3RydWN0IGFkZG9uX2JvYXJkX2luZm8gKmJvYXJkLAorCQkJCQkgICBz
dHJ1Y3QgZ3JleWJ1c19kZXNjcmlwdG9yX2RldmljZSAqZGV2X2Rlc2MpCit7CisJc3RydWN0IGJv
YXJkX2RldmljZV9pbmZvICpib2FyZF9kZXY7CisJc3RydWN0IGdwaW9kX2xvb2t1cF90YWJsZSAq
bG9va3VwOworCXN0cnVjdCBncmV5YnVzX2Rlc2NyaXB0b3JfcHJvcGVydHkgKmRlc2NfcHJvcGVy
dHk7CisJc3RydWN0IG1hbmlmZXN0X2Rlc2MgKmRlc2NyaXB0b3I7CisJdTggKmdwaW9fZGVzY19s
aW5rOworCXU4ICpwcm9wX2xpbms7CisJaW50IHJldHZhbDsKKwlpbnQgaTsKKworCWJvYXJkX2Rl
diA9IGt6YWxsb2Moc2l6ZW9mKCpib2FyZF9kZXYpLCBHRlBfS0VSTkVMKTsKKwlpZiAoIWJvYXJk
X2RldikKKwkJcmV0dXJuIC1FTk9NRU07CisJYm9hcmRfZGV2LT5pZCA9IGRldl9kZXNjLT5pZDsK
Kwlib2FyZF9kZXYtPmRydl9uYW1lID0gbWlrcm9idXNfc3RyaW5nX2dldChib2FyZCwgZGV2X2Rl
c2MtPmRyaXZlcl9zdHJpbmdpZCk7CisJaWYgKCFib2FyZF9kZXYtPmRydl9uYW1lKSB7CisJCXJl
dHZhbCA9IC1FTk9FTlQ7CisJCWdvdG8gZXJyX2ZyZWVfYm9hcmRfZGV2OworCX0KKwlib2FyZF9k
ZXYtPnByb3RvY29sID0gZGV2X2Rlc2MtPnByb3RvY29sOworCWJvYXJkX2Rldi0+cmVnID0gZGV2
X2Rlc2MtPnJlZzsKKwlib2FyZF9kZXYtPmlycSA9IGRldl9kZXNjLT5pcnE7CisJYm9hcmRfZGV2
LT5pcnFfdHlwZSA9IGRldl9kZXNjLT5pcnFfdHlwZTsKKwlib2FyZF9kZXYtPm1heF9zcGVlZF9o
eiA9IGxlMzJfdG9fY3B1KGRldl9kZXNjLT5tYXhfc3BlZWRfaHopOworCWJvYXJkX2Rldi0+bW9k
ZSA9IGRldl9kZXNjLT5tb2RlOworCXByX2luZm8oInBhcnNlZCBkZXZpY2UgJWQsIGRyaXZlcj0l
cyIsIGJvYXJkX2Rldi0+aWQsIGJvYXJkX2Rldi0+ZHJ2X25hbWUpOworCisJaWYgKGRldl9kZXNj
LT5wcm9wX2xpbmsgPiAwKSB7CisJCXByb3BfbGluayA9IG1pa3JvYnVzX3Byb3BlcnR5X2xpbmtf
Z2V0KGJvYXJkLCBkZXZfZGVzYy0+cHJvcF9saW5rLAorCQkJCQkJICAgICAgIGJvYXJkX2Rldiwg
TUlLUk9CVVNfUFJPUEVSVFlfVFlQRV9MSU5LKTsKKwkJaWYgKCFwcm9wX2xpbmspIHsKKwkJCXJl
dHZhbCA9IC1FTk9FTlQ7CisJCQlnb3RvIGVycl9mcmVlX2JvYXJkX2RldjsKKwkJfQorCQlwcl9p
bmZvKCJkZXZpY2UgJWQsIG51bWJlciBvZiBwcm9wZXJ0aWVzPSVkIiwgYm9hcmRfZGV2LT5pZCwK
KwkJCWJvYXJkX2Rldi0+bnVtX3Byb3BlcnRpZXMpOworCQlib2FyZF9kZXYtPnByb3BlcnRpZXMg
PSBtaWtyb2J1c19wcm9wZXJ0eV9lbnRyeV9nZXQoYm9hcmQsIHByb3BfbGluaywKKwkJCQkJCQkJ
ICAgIGJvYXJkX2Rldi0+bnVtX3Byb3BlcnRpZXMpOworCX0KKworCWlmIChkZXZfZGVzYy0+Z3Bp
b19saW5rID4gMCkgeworCQlncGlvX2Rlc2NfbGluayA9IG1pa3JvYnVzX3Byb3BlcnR5X2xpbmtf
Z2V0KGJvYXJkLCBkZXZfZGVzYy0+Z3Bpb19saW5rLCBib2FyZF9kZXYsCisJCQkJCQkJICAgIE1J
S1JPQlVTX1BST1BFUlRZX1RZUEVfR1BJTyk7CisJCWlmICghZ3Bpb19kZXNjX2xpbmspIHsKKwkJ
CXJldHZhbCA9IC1FTk9FTlQ7CisJCQlnb3RvIGVycl9mcmVlX2JvYXJkX2RldjsKKwkJfQorCQlw
cl9pbmZvKCJkZXZpY2UgJWQsIG51bWJlciBvZiBncGlvIHJlc291cmNlPSVkIiwgYm9hcmRfZGV2
LT5pZCwKKwkJCWJvYXJkX2Rldi0+bnVtX2dwaW9fcmVzb3VyY2VzKTsKKwkJbG9va3VwID0ga3ph
bGxvYyhzdHJ1Y3Rfc2l6ZShsb29rdXAsIHRhYmxlLCBib2FyZF9kZXYtPm51bV9ncGlvX3Jlc291
cmNlcyksCisJCQkJIEdGUF9LRVJORUwpOworCQlpZiAoIWxvb2t1cCkgeworCQkJcmV0dmFsID0g
LUVOT01FTTsKKwkJCWdvdG8gZXJyX2ZyZWVfYm9hcmRfZGV2OworCQl9CisJCWZvciAoaSA9IDA7
IGkgPCBib2FyZF9kZXYtPm51bV9ncGlvX3Jlc291cmNlczsgaSsrKSB7CisJCQlsaXN0X2Zvcl9l
YWNoX2VudHJ5KGRlc2NyaXB0b3IsICZib2FyZC0+bWFuaWZlc3RfZGVzY3MsIGxpbmtzKSB7CisJ
CQkJaWYgKGRlc2NyaXB0b3ItPnR5cGUgIT0gR1JFWUJVU19UWVBFX1BST1BFUlRZKQorCQkJCQlj
b250aW51ZTsKKwkJCQlkZXNjX3Byb3BlcnR5ID0gZGVzY3JpcHRvci0+ZGF0YTsKKwkJCQlpZiAo
ZGVzY19wcm9wZXJ0eS0+aWQgPT0gZ3Bpb19kZXNjX2xpbmtbaV0pIHsKKwkJCQkJbG9va3VwLT50
YWJsZVtpXS5jaGlwX2h3bnVtID0gKmRlc2NfcHJvcGVydHktPnZhbHVlOworCQkJCQlsb29rdXAt
PnRhYmxlW2ldLmNvbl9pZCA9CisJCQkJCW1pa3JvYnVzX3N0cmluZ19nZXQoYm9hcmQsCisJCQkJ
CQkJICAgIGRlc2NfcHJvcGVydHktPnByb3BuYW1lX3N0cmluZ2lkKTsKKwkJCQkJYnJlYWs7CisJ
CQkJfQorCQkJfQorCQl9CisJCWJvYXJkX2Rldi0+Z3Bpb19sb29rdXAgPSBsb29rdXA7CisJfQor
CWxpc3RfYWRkX3RhaWwoJmJvYXJkX2Rldi0+bGlua3MsICZib2FyZC0+ZGV2aWNlcyk7CisJcmV0
dXJuIDA7CitlcnJfZnJlZV9ib2FyZF9kZXY6CisJa2ZyZWUoYm9hcmRfZGV2KTsKKwlyZXR1cm4g
cmV0dmFsOworfQorCitzdGF0aWMgaW50IG1pa3JvYnVzX21hbmlmZXN0X3BhcnNlX2RldmljZXMo
c3RydWN0IGFkZG9uX2JvYXJkX2luZm8gKmJvYXJkKQoreworCXN0cnVjdCBncmV5YnVzX2Rlc2Ny
aXB0b3JfZGV2aWNlICpkZXNjX2RldmljZTsKKwlzdHJ1Y3QgbWFuaWZlc3RfZGVzYyAqZGVzYywg
Km5leHQ7CisJaW50IHJldHZhbDsKKwlpbnQgZGV2Y291bnQgPSAwOworCisJbGlzdF9mb3JfZWFj
aF9lbnRyeV9zYWZlKGRlc2MsIG5leHQsICZib2FyZC0+bWFuaWZlc3RfZGVzY3MsIGxpbmtzKSB7
CisJCWlmIChkZXNjLT50eXBlICE9IEdSRVlCVVNfVFlQRV9ERVZJQ0UpCisJCQljb250aW51ZTsK
KwkJZGVzY19kZXZpY2UgPSBkZXNjLT5kYXRhOworCQlyZXR2YWwgPSBtaWtyb2J1c19tYW5pZmVz
dF9hdHRhY2hfZGV2aWNlKGJvYXJkLCBkZXNjX2RldmljZSk7CisJCWRldmNvdW50Kys7CisJfQor
CXJldHVybiBkZXZjb3VudDsKK30KKworaW50IG1pa3JvYnVzX21hbmlmZXN0X3BhcnNlKHN0cnVj
dCBhZGRvbl9ib2FyZF9pbmZvICpib2FyZCwgdm9pZCAqZGF0YSwKKwkJCSAgICBzaXplX3Qgc2l6
ZSkKK3sKKwlzdHJ1Y3QgZ3JleWJ1c19tYW5pZmVzdF9oZWFkZXIgKmhlYWRlcjsKKwlzdHJ1Y3Qg
Z3JleWJ1c19tYW5pZmVzdCAqbWFuaWZlc3Q7CisJc3RydWN0IGdyZXlidXNfZGVzY3JpcHRvciAq
ZGVzYzsKKwl1MTYgbWFuaWZlc3Rfc2l6ZTsKKwlpbnQgZGV2X2NvdW50OworCWludCBkZXNjX3Np
emU7CisKKwlpZiAoc2l6ZSA8IHNpemVvZigqaGVhZGVyKSkgeworCQlwcl9lcnIoInNob3J0IG1h
bmlmZXN0ICglenUgPCAlenUpIiwgc2l6ZSwgc2l6ZW9mKCpoZWFkZXIpKTsKKwkJcmV0dXJuIC1F
SU5WQUw7CisJfQorCisJbWFuaWZlc3QgPSBkYXRhOworCWhlYWRlciA9ICZtYW5pZmVzdC0+aGVh
ZGVyOworCW1hbmlmZXN0X3NpemUgPSBsZTE2X3RvX2NwdShoZWFkZXItPnNpemUpOworCisJaWYg
KG1hbmlmZXN0X3NpemUgIT0gc2l6ZSkgeworCQlwcl9lcnIoImludmFsaWQgbWFuaWZlc3Qgc2l6
ZSglenUgPCAlenUpIiwgc2l6ZSwgbWFuaWZlc3Rfc2l6ZSk7CisJCXJldHVybiAtRUlOVkFMOwor
CX0KKworCWlmIChoZWFkZXItPnZlcnNpb25fbWFqb3IgPiBNSUtST0JVU19WRVJTSU9OX01BSk9S
KSB7CisJCXByX2VycigibWFuaWZlc3QgdmVyc2lvbiB0b28gbmV3ICgldS4ldSA+ICV1LiV1KSIs
CisJCSAgICAgICBoZWFkZXItPnZlcnNpb25fbWFqb3IsIGhlYWRlci0+dmVyc2lvbl9taW5vciwK
KwkJICAgICAgIE1JS1JPQlVTX1ZFUlNJT05fTUFKT1IsIE1JS1JPQlVTX1ZFUlNJT05fTUlOT1Ip
OworCQlyZXR1cm4gLUVJTlZBTDsKKwl9CisKKwlkZXNjID0gbWFuaWZlc3QtPmRlc2NyaXB0b3Jz
OworCXNpemUgLT0gc2l6ZW9mKCpoZWFkZXIpOworCXdoaWxlIChzaXplKSB7CisJCWRlc2Nfc2l6
ZSA9IGJvYXJkX2Rlc2NyaXB0b3JfYWRkKGJvYXJkLCBkZXNjLCBzaXplKTsKKwkJaWYgKGRlc2Nf
c2l6ZSA8IDApIHsKKwkJCXByX2VycigiaW52YWxpZCBtYW5pZmVzdCBkZXNjcmlwdG9yLCBzaXpl
OiAlenUiLCBkZXNjX3NpemUpOworCQkJcmV0dXJuIC1FSU5WQUw7CisJCX0KKwkJZGVzYyA9ICh2
b2lkICopZGVzYyArIGRlc2Nfc2l6ZTsKKwkJc2l6ZSAtPSBkZXNjX3NpemU7CisJfQorCW1pa3Jv
YnVzX3N0YXRlX2dldChib2FyZCk7CisJZGV2X2NvdW50ID0gbWlrcm9idXNfbWFuaWZlc3RfcGFy
c2VfZGV2aWNlcyhib2FyZCk7CisJcHJfaW5mbygiICVzIG1hbmlmZXN0IHBhcnNlZCB3aXRoICVk
IGRldmljZXMiLCBib2FyZC0+bmFtZSwgZGV2X2NvdW50KTsKKwltYW5pZmVzdF9kZXNjcmlwdG9y
X3JlbGVhc2VfYWxsKGJvYXJkKTsKKwlyZXR1cm4gMDsKK30KKworc2l6ZV90IG1pa3JvYnVzX21h
bmlmZXN0X2hlYWRlcl92YWxpZGF0ZSh2b2lkICpkYXRhLCBzaXplX3Qgc2l6ZSkKK3sKKwlzdHJ1
Y3QgZ3JleWJ1c19tYW5pZmVzdF9oZWFkZXIgKmhlYWRlcjsKKwl1MTYgbWFuaWZlc3Rfc2l6ZTsK
KworCWlmIChzaXplIDwgc2l6ZW9mKCpoZWFkZXIpKSB7CisJCXByX2Vycigic2hvcnQgbWFuaWZl
c3QgKCV6dSA8ICV6dSkiLCBzaXplLCBzaXplb2YoKmhlYWRlcikpOworCQlyZXR1cm4gLUVJTlZB
TDsKKwl9CisJaGVhZGVyID0gZGF0YTsKKwltYW5pZmVzdF9zaXplID0gbGUxNl90b19jcHUoaGVh
ZGVyLT5zaXplKTsKKwlpZiAoaGVhZGVyLT52ZXJzaW9uX21ham9yID4gTUlLUk9CVVNfVkVSU0lP
Tl9NQUpPUikgeworCQlwcl9lcnIoIm1hbmlmZXN0IHZlcnNpb24gdG9vIG5ldyAoJXUuJXUgPiAl
dS4ldSkiLAorCQkgICAgICAgaGVhZGVyLT52ZXJzaW9uX21ham9yLCBoZWFkZXItPnZlcnNpb25f
bWlub3IsCisJCSAgICAgICBNSUtST0JVU19WRVJTSU9OX01BSk9SLCBNSUtST0JVU19WRVJTSU9O
X01JTk9SKTsKKwkJcmV0dXJuIC1FSU5WQUw7CisJfQorCXJldHVybiBtYW5pZmVzdF9zaXplOwor
fQorCmRpZmYgLS1naXQgYS9kcml2ZXJzL21pc2MvbWlrcm9idXMvbWlrcm9idXNfbWFuaWZlc3Qu
aCBiL2RyaXZlcnMvbWlzYy9taWtyb2J1cy9taWtyb2J1c19tYW5pZmVzdC5oCm5ldyBmaWxlIG1v
ZGUgMTAwNjQ0CmluZGV4IDAwMDAwMDAwMDAwMC4uMjBjYmM2NDY1OTI3Ci0tLSAvZGV2L251bGwK
KysrIGIvZHJpdmVycy9taXNjL21pa3JvYnVzL21pa3JvYnVzX21hbmlmZXN0LmgKQEAgLTAsMCAr
MSwyMSBAQAorLyogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0yLjAgKi8KKy8qCisgKiBt
aWtyb0JVUyBtYW5pZmVzdCBkZWZpbml0aW9uCisgKiBleHRlbnNpb24gdG8gR3JleWJ1cyBNYW5p
ZmVzdCBEZWZpbml0aW9uCisgKgorICogQ29weXJpZ2h0IDIwMTQtMjAxNSBHb29nbGUgSW5jLgor
ICogQ29weXJpZ2h0IDIwMTQtMjAxNSBMaW5hcm8gTHRkLgorICoKKyAqIFJlbGVhc2VkIHVuZGVy
IHRoZSBHUEx2MiBhbmQgQlNEIGxpY2Vuc2VzLgorICovCisKKyNpZm5kZWYgX19NSUtST0JVU19N
QU5JRkVTVF9ICisjZGVmaW5lIF9fTUlLUk9CVVNfTUFOSUZFU1RfSAorCisjaW5jbHVkZSAibWlr
cm9idXNfY29yZS5oIgorCitpbnQgbWlrcm9idXNfbWFuaWZlc3RfcGFyc2Uoc3RydWN0IGFkZG9u
X2JvYXJkX2luZm8gKmluZm8sIHZvaWQgKmRhdGEsCisJCQkgICAgc2l6ZV90IHNpemUpOworc2l6
ZV90IG1pa3JvYnVzX21hbmlmZXN0X2hlYWRlcl92YWxpZGF0ZSh2b2lkICpkYXRhLCBzaXplX3Qg
c2l6ZSk7CisKKyNlbmRpZiAvKiBfX01JS1JPQlVTX01BTklGRVNUX0ggKi8KZGlmZiAtLWdpdCBh
L2RyaXZlcnMvbWlzYy9taWtyb2J1cy9taWtyb2J1c19wb3J0LmMgYi9kcml2ZXJzL21pc2MvbWlr
cm9idXMvbWlrcm9idXNfcG9ydC5jCm5ldyBmaWxlIG1vZGUgMTAwNjQ0CmluZGV4IDAwMDAwMDAw
MDAwMC4uYTVhMWNiYzA0ZjMwCi0tLSAvZGV2L251bGwKKysrIGIvZHJpdmVycy9taXNjL21pa3Jv
YnVzL21pa3JvYnVzX3BvcnQuYwpAQCAtMCwwICsxLDE3MSBAQAorLy8gU1BEWC1MaWNlbnNlLUlk
ZW50aWZpZXI6IEdQTC0yLjAKKy8qCisgKiBtaWtyb0JVUyBkcml2ZXIgZm9yIGFkZGluZyBtaWty
b2J1cyBwb3J0IGZyb20gZGV2aWNlIHRyZWUKKyAqCisgKiBDb3B5cmlnaHQgMjAyMCBWYWlzaG5h
diBNIEEsIEJlYWdsZUJvYXJkLm9yZyBGb3VuZGF0aW9uLgorICovCisjZGVmaW5lIHByX2ZtdChm
bXQpICJtaWtyb2J1c19wb3J0OiVzOiAiIGZtdCwgX19mdW5jX18KKworI2luY2x1ZGUgPGxpbnV4
L2Vyci5oPgorI2luY2x1ZGUgPGxpbnV4L2Vycm5vLmg+CisjaW5jbHVkZSA8bGludXgvaW5pdC5o
PgorI2luY2x1ZGUgPGxpbnV4L2p1bXBfbGFiZWwuaD4KKyNpbmNsdWRlIDxsaW51eC9rZXJuZWwu
aD4KKyNpbmNsdWRlIDxsaW51eC9tb2R1bGUuaD4KKyNpbmNsdWRlIDxsaW51eC9kZXZpY2UuaD4K
KyNpbmNsdWRlIDxsaW51eC9vZi5oPgorI2luY2x1ZGUgPGxpbnV4L29mX2RldmljZS5oPgorI2lu
Y2x1ZGUgPGxpbnV4L29mX2dwaW8uaD4KKyNpbmNsdWRlIDxsaW51eC9pMmMuaD4KKyNpbmNsdWRl
IDxsaW51eC9ncGlvLmg+CisjaW5jbHVkZSA8bGludXgvcHdtLmg+CisjaW5jbHVkZSA8bGludXgv
c3BpL3NwaS5oPgorI2luY2x1ZGUgPGxpbnV4L3NlcmRldi5oPgorI2luY2x1ZGUgPGxpbnV4L3Bp
bmN0cmwvcGluY3RybC5oPgorI2luY2x1ZGUgPGxpbnV4L3BpbmN0cmwvcGlubXV4Lmg+CisjaW5j
bHVkZSA8bGludXgvcGluY3RybC9jb25zdW1lci5oPgorCisjaW5jbHVkZSAibWlrcm9idXNfY29y
ZS5oIgorCitzdGF0aWMgaW50IG1pa3JvYnVzX3BvcnRfcHJvYmVfcGluY3RybF9zZXR1cChzdHJ1
Y3QgbWlrcm9idXNfcG9ydCAqcG9ydCkKK3sKKwlzdHJ1Y3QgcGluY3RybF9zdGF0ZSAqc3RhdGU7
CisJc3RydWN0IGRldmljZSAqZGV2ID0gcG9ydC0+ZGV2LnBhcmVudDsKKwlpbnQgcmV0dmFsLCBp
OworCisJc3RhdGUgPSBwaW5jdHJsX2xvb2t1cF9zdGF0ZShwb3J0LT5waW5jdHJsLCBQSU5DVFJM
X1NUQVRFX0RFRkFVTFQpOworCWlmICghSVNfRVJSKHN0YXRlKSkgeworCQlyZXR2YWwgPSBwaW5j
dHJsX3NlbGVjdF9zdGF0ZShwb3J0LT5waW5jdHJsLCBzdGF0ZSk7CisJCWlmIChyZXR2YWwgIT0g
MCkgeworCQkJZGV2X2VycihkZXYsICJGYWlsZWQgdG8gc2VsZWN0IHN0YXRlICVzXG4iLAorCQkJ
CVBJTkNUUkxfU1RBVEVfREVGQVVMVCk7CisJCQlyZXR1cm4gcmV0dmFsOworCQl9CisJfSBlbHNl
IHsKKwkJZGV2X2VycihkZXYsICJmYWlsZWQgdG8gZmluZCBzdGF0ZSAlc1xuIiwKKwkJCVBJTkNU
UkxfU1RBVEVfREVGQVVMVCk7CisJCXJldHVybiBQVFJfRVJSKHN0YXRlKTsKKwl9CisKKwlmb3Ig
KGkgPSAwOyBpIDwgTUlLUk9CVVNfTlVNX1BJTkNUUkxfU1RBVEU7IGkrKykgeworCQlwb3J0LT5w
aW5jdHJsX3NlbGVjdGVkW2ldID0KKwkJCQlrbWFsbG9jKE1JS1JPQlVTX1BJTkNUUkxfTkFNRV9T
SVpFLCBHRlBfS0VSTkVMKTsKKwkJc3ByaW50Zihwb3J0LT5waW5jdHJsX3NlbGVjdGVkW2ldLCAi
JXNfJXMiLAorCQkJTUlLUk9CVVNfUElOQ1RSTF9TVFJbaV0sIFBJTkNUUkxfU1RBVEVfREVGQVVM
VCk7CisJfQorCisJcmV0dmFsID0gbWlrcm9idXNfcG9ydF9waW5jdHJsX3NlbGVjdChwb3J0KTsK
KwlpZiAocmV0dmFsKQorCQlkZXZfZXJyKGRldiwgImZhaWxlZCB0byBzZWxlY3QgcGluY3RybCBz
dGF0ZXMgWyVkXSIsIHJldHZhbCk7CisJcmV0dXJuIHJldHZhbDsKK30KKworc3RhdGljIGludCBt
aWtyb2J1c19wb3J0X3Byb2JlKHN0cnVjdCBwbGF0Zm9ybV9kZXZpY2UgKnBkZXYpCit7CisJc3Ry
dWN0IG1pa3JvYnVzX3BvcnQgKnBvcnQ7CisJc3RydWN0IGRldmljZSAqZGV2ID0gJnBkZXYtPmRl
djsKKwlzdHJ1Y3QgZGV2aWNlX25vZGUgKmkyY19hZGFwX25wOworCWludCByZXR2YWw7CisJdTMy
IHZhbDsKKworCXBvcnQgPSBremFsbG9jKHNpemVvZigqcG9ydCksIEdGUF9LRVJORUwpOworCWlm
ICghcG9ydCkKKwkJcmV0dXJuIC1FTk9NRU07CisKKwlpMmNfYWRhcF9ucCA9IG9mX3BhcnNlX3Bo
YW5kbGUoZGV2LT5vZl9ub2RlLCAiaTJjLWFkYXB0ZXIiLCAwKTsKKwlpZiAoIWkyY19hZGFwX25w
KSB7CisJCWRldl9lcnIoZGV2LCAiY2Fubm90IHBhcnNlIGkyYy1hZGFwdGVyXG4iKTsKKwkJcmV0
dmFsID0gLUVOT0RFVjsKKwkJZ290byBlcnJfcG9ydDsKKwl9CisJcG9ydC0+aTJjX2FkYXAgPSBv
Zl9maW5kX2kyY19hZGFwdGVyX2J5X25vZGUoaTJjX2FkYXBfbnApOworCW9mX25vZGVfcHV0KGky
Y19hZGFwX25wKTsKKwlyZXR2YWwgPSBkZXZpY2VfcHJvcGVydHlfcmVhZF91MzIoZGV2LCAic3Bp
LW1hc3RlciIsICZ2YWwpOworCWlmIChyZXR2YWwpIHsKKwkJZGV2X2VycihkZXYsICJmYWlsZWQg
dG8gZ2V0IHNwaS1tYXN0ZXIgWyVkXVxuIiwgcmV0dmFsKTsKKwkJZ290byBlcnJfcG9ydDsKKwl9
CisJcG9ydC0+c3BpX21zdHIgPSBzcGlfYnVzbnVtX3RvX21hc3Rlcih2YWwpOworCXJldHZhbCA9
IGRldmljZV9wcm9wZXJ0eV9yZWFkX3UzMl9hcnJheShkZXYsICJzcGktY3MiLAorCQkJCQkJcG9y
dC0+Y2hpcF9zZWxlY3QsIDIpOworCWlmIChyZXR2YWwpIHsKKwkJZGV2X2VycihkZXYsICJmYWls
ZWQgdG8gZ2V0IHNwaS1jcyBbJWRdXG4iLCByZXR2YWwpOworCQlnb3RvIGVycl9wb3J0OworCX0K
Kwlwb3J0LT5ncGlvcyA9IGdwaW9kX2dldF9hcnJheShkZXYsICJtaWtyb2J1cyIsIEdQSU9EX09V
VF9MT1cpOworCWlmIChJU19FUlIocG9ydC0+Z3Bpb3MpKSB7CisJCXJldHZhbCA9IFBUUl9FUlIo
cG9ydC0+Z3Bpb3MpOworCQlkZXZfZXJyKGRldiwgImZhaWxlZCB0byBnZXQgZ3BpbyBhcnJheSBb
JWRdXG4iLCByZXR2YWwpOworCQlnb3RvIGVycl9wb3J0OworCX0KKwlwb3J0LT5waW5jdHJsID0g
ZGV2bV9waW5jdHJsX2dldChkZXYpOworCWlmIChJU19FUlIocG9ydC0+cGluY3RybCkpIHsKKwkJ
cmV0dmFsID0gUFRSX0VSUihwb3J0LT5waW5jdHJsKTsKKwkJZGV2X2VycihkZXYsICJmYWlsZWQg
dG8gZ2V0IHBpbmN0cmwgWyVkXVxuIiwgcmV0dmFsKTsKKwkJZ290byBlcnJfcG9ydDsKKwl9CisJ
cG9ydC0+ZGV2LnBhcmVudCA9IGRldjsKKwlwb3J0LT5kZXYub2Zfbm9kZSA9IHBkZXYtPmRldi5v
Zl9ub2RlOworCisJcmV0dmFsID0gbWlrcm9idXNfcG9ydF9wcm9iZV9waW5jdHJsX3NldHVwKHBv
cnQpOworCWlmIChyZXR2YWwpIHsKKwkJZGV2X2VycihkZXYsICJmYWlsZWQgdG8gc2V0dXAgcGlu
Y3RybCBbJWRdXG4iLCByZXR2YWwpOworCQlnb3RvIGVycl9wb3J0OworCX0KKworCXJldHZhbCA9
IG1pa3JvYnVzX3BvcnRfcmVnaXN0ZXIocG9ydCk7CisJaWYgKHJldHZhbCkgeworCQlwcl9lcnIo
InBvcnQgOiBjYW4ndCByZWdpc3RlciBwb3J0IFslZF1cbiIsIHJldHZhbCk7CisJCWdvdG8gZXJy
X3BvcnQ7CisJfQorCXBsYXRmb3JtX3NldF9kcnZkYXRhKHBkZXYsIHBvcnQpOworCXJldHVybiAw
OworZXJyX3BvcnQ6CisJa2ZyZWUocG9ydCk7CisJcmV0dXJuIHJldHZhbDsKK30KKworc3RhdGlj
IGludCBtaWtyb2J1c19wb3J0X3JlbW92ZShzdHJ1Y3QgcGxhdGZvcm1fZGV2aWNlICpwZGV2KQor
eworCXN0cnVjdCBtaWtyb2J1c19wb3J0CSpwb3J0ID0gcGxhdGZvcm1fZ2V0X2RydmRhdGEocGRl
dik7CisKKwltaWtyb2J1c19wb3J0X2RlbGV0ZShwb3J0KTsKKwlyZXR1cm4gMDsKK30KKworc3Rh
dGljIGNvbnN0IHN0cnVjdCBvZl9kZXZpY2VfaWQgbWlrcm9idXNfcG9ydF9vZl9tYXRjaFtdID0g
eworCXsuY29tcGF0aWJsZSA9ICJsaW51eCxtaWtyb2J1cyJ9LAorCXt9LAorfTsKK01PRFVMRV9E
RVZJQ0VfVEFCTEUob2YsIG1pa3JvYnVzX3BvcnRfb2ZfbWF0Y2gpOworCitzdGF0aWMgc3RydWN0
IHBsYXRmb3JtX2RyaXZlciBtaWtyb2J1c19wb3J0X2RyaXZlciA9IHsKKwkucHJvYmUgPSBtaWty
b2J1c19wb3J0X3Byb2JlLAorCS5yZW1vdmUgPSBtaWtyb2J1c19wb3J0X3JlbW92ZSwKKwkuZHJp
dmVyID0geworCQkubmFtZSA9ICJtaWtyb2J1cyIsCisJCS5vZl9tYXRjaF90YWJsZSA9IG9mX21h
dGNoX3B0cihtaWtyb2J1c19wb3J0X29mX21hdGNoKSwKKwl9LAorfTsKKworc3RhdGljIGludCBf
X2luaXQKK21pa3JvYnVzX3BvcnRfaW5pdF9kcml2ZXIodm9pZCkKK3sKKwlpbnQgcmV0dmFsOwor
CisJcmV0dmFsID0gcGxhdGZvcm1fZHJpdmVyX3JlZ2lzdGVyKCZtaWtyb2J1c19wb3J0X2RyaXZl
cik7CisJaWYgKHJldHZhbCkKKwkJcHJfZXJyKCJkcml2ZXIgcmVnaXN0ZXIgZmFpbGVkIFslZF1c
biIsIHJldHZhbCk7CisJcmV0dXJuIHJldHZhbDsKK30KK3N1YnN5c19pbml0Y2FsbChtaWtyb2J1
c19wb3J0X2luaXRfZHJpdmVyKTsKKworc3RhdGljIHZvaWQgX19leGl0IG1pa3JvYnVzX3BvcnRf
ZXhpdF9kcml2ZXIodm9pZCkKK3sKKwlwbGF0Zm9ybV9kcml2ZXJfdW5yZWdpc3RlcigmbWlrcm9i
dXNfcG9ydF9kcml2ZXIpOworfQorbW9kdWxlX2V4aXQobWlrcm9idXNfcG9ydF9leGl0X2RyaXZl
cik7CisKK01PRFVMRV9BVVRIT1IoIlZhaXNobmF2IE0gQSA8dmFpc2huYXZAYmVhZ2xlYm9hcmQu
b3JnPiIpOworTU9EVUxFX0RFU0NSSVBUSU9OKCJtaWtyb0JVUyBwb3J0IG1vZHVsZSIpOworTU9E
VUxFX0xJQ0VOU0UoIkdQTCIpOwotLSAKMi4yNS4xCgpfX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fXwpncmV5YnVzLWRldiBtYWlsaW5nIGxpc3QKZ3JleWJ1cy1k
ZXZAbGlzdHMubGluYXJvLm9yZwpodHRwczovL2xpc3RzLmxpbmFyby5vcmcvbWFpbG1hbi9saXN0
aW5mby9ncmV5YnVzLWRldgo=
