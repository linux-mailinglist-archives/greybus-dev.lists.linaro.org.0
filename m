Return-Path: <greybus-dev-bounces@lists.linaro.org>
X-Original-To: lists+greybus-dev@lfdr.de
Delivered-To: lists+greybus-dev@lfdr.de
Received: from lists.linaro.org (lists.linaro.org [107.22.173.205])
	by mail.lfdr.de (Postfix) with ESMTPS id A097022D79F
	for <lists+greybus-dev@lfdr.de>; Sat, 25 Jul 2020 15:00:13 +0200 (CEST)
Received: from lists.linaro.org (localhost [127.0.0.1])
	by lists.linaro.org (Postfix) with ESMTP id ACA71617F1
	for <lists+greybus-dev@lfdr.de>; Sat, 25 Jul 2020 13:00:12 +0000 (UTC)
Received: by lists.linaro.org (Postfix, from userid 109)
	id 9C73766539; Sat, 25 Jul 2020 13:00:12 +0000 (UTC)
X-Spam-Checker-Version: SpamAssassin 3.4.2 (2018-09-13) on lists.linaro.org
X-Spam-Level: 
X-Spam-Status: No, score=0.4 required=5.0 tests=BAYES_00,MAILING_LIST_MULTI,
	RCVD_IN_DNSWL_NONE,RCVD_IN_MSPIKE_H3,RCVD_IN_MSPIKE_WL,RCVD_IN_SBL_CSS,
	SPF_HELO_NONE autolearn=disabled version=3.4.2
Received: from lists.linaro.org (localhost [127.0.0.1])
	by lists.linaro.org (Postfix) with ESMTP id E5A8C617F1;
	Sat, 25 Jul 2020 12:58:45 +0000 (UTC)
X-Original-To: greybus-dev@lists.linaro.org
Delivered-To: greybus-dev@lists.linaro.org
Received: from lists.linaro.org (localhost [127.0.0.1])
 by lists.linaro.org (Postfix) with ESMTP id CC41966063
 for <greybus-dev@lists.linaro.org>; Fri, 24 Jul 2020 12:06:56 +0000 (UTC)
Received: by lists.linaro.org (Postfix, from userid 109)
 id BF193665F3; Fri, 24 Jul 2020 12:06:56 +0000 (UTC)
Received: from mail-pf1-f194.google.com (mail-pf1-f194.google.com
 [209.85.210.194])
 by lists.linaro.org (Postfix) with ESMTPS id DBA0566063
 for <greybus-dev@lists.linaro.org>; Fri, 24 Jul 2020 12:06:48 +0000 (UTC)
Received: by mail-pf1-f194.google.com with SMTP id j20so4991811pfe.5
 for <greybus-dev@lists.linaro.org>; Fri, 24 Jul 2020 05:06:48 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:date:from:to:cc:subject:message-id:mime-version
 :content-disposition;
 bh=WicFJKwYVApjY7WOQn3UlonDvzNx9m7OxKKDC/cUBfw=;
 b=KvrdpWVThE9tspkgrzH0Y+eKcYt3NmehuWO2obp7i8YZXNI83vdyljGjK9muzrblun
 Ee30AKGNtJ9bSl3/3AV7nhKEY/OoIs9yvQ7CvZwfjar8tNhQyvyvccwxjXDHNvhJ7ZVM
 L2ExrByvwTifsS9VFfMKp56DpTyd1MDWSmE5HOdv4dRNyJQmTuY8sWnIqWt7Cxkck2R8
 JoNej8okidAMLHgg7FTdzsIpF0Th03zJbRTI68aZnJ/LSbah1qj0F+rvfscIhDIxU/xJ
 QvEgLK7kYwthwVg+qdrT33n0e0GwsB9jyUM6EzZvhgceglJEA7CBKF6ow3sl0qyW7Niv
 lsYg==
X-Gm-Message-State: AOAM530/aYbx8edEp+tdvIeVf1Wm7IxOqfF6m7UAj5+GAOMrjkBZeiiq
 zhBNypGCKXjHGMh1Xp9prR3WVCSBYev8
X-Google-Smtp-Source: ABdhPJxO0/+jaIOz9nEO3UHtgvHzRLM4PEfSwljL3MiGupnP55XkrMlaN55Wa8iBucWugZqBMV1n3A==
X-Received: by 2002:aa7:8096:: with SMTP id v22mr9027450pff.132.1595592406870; 
 Fri, 24 Jul 2020 05:06:46 -0700 (PDT)
Received: from vaishnav-VirtualBox ([111.92.52.87])
 by smtp.gmail.com with ESMTPSA id n14sm6382758pgd.78.2020.07.24.05.06.41
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Fri, 24 Jul 2020 05:06:46 -0700 (PDT)
Date: Fri, 24 Jul 2020 17:36:37 +0530
From: Vaishnav M A <vaishnav@beagleboard.org>
To: greybus-dev@lists.linaro.org, linux-kernel@vger.kernel.org,
 gregkh@linuxfoundation.org, arnd@arndb.de, johan@kernel.org,
 elder@kernel.org
Message-ID: <20200724120637.GA427284@vaishnav-VirtualBox>
MIME-Version: 1.0
Content-Disposition: inline
X-Virus-Scanned: ClamAV using ClamSMTP
X-Mailman-Approved-At: Sat, 25 Jul 2020 12:58:45 +0000
Cc: rajkovic@mikroe.com, robh@kernel.org, mchehab+huawei@kernel.org,
 robertcnelson@beagleboard.org, drew@beagleboard.org, vaishnav@beagleboard.org,
 davem@davemloft.net, zoran.stojsavljevic@gmail.com
Subject: [greybus-dev] [PATCH] RFC : mikroBUS driver for add-on boards
X-BeenThere: greybus-dev@lists.linaro.org
X-Mailman-Version: 2.1.16
Precedence: list
List-Id: Greybus Development Mail List <greybus-dev.lists.linaro.org>
List-Unsubscribe: <https://lists.linaro.org/mailman/options/greybus-dev>,
 <mailto:greybus-dev-request@lists.linaro.org?subject=unsubscribe>
List-Archive: <http://lists.linaro.org/pipermail/greybus-dev/>
List-Post: <mailto:greybus-dev@lists.linaro.org>
List-Help: <mailto:greybus-dev-request@lists.linaro.org?subject=help>
List-Subscribe: <https://lists.linaro.org/mailman/listinfo/greybus-dev>,
 <mailto:greybus-dev-request@lists.linaro.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: greybus-dev-bounces@lists.linaro.org
Sender: "greybus-dev" <greybus-dev-bounces@lists.linaro.org>
X-Virus-Scanned: ClamAV using ClamSMTP

QXR0YWNoZWQgaXMgYSBwYXRjaCBmb3IgdGhlIG1pa3JvQlVTIGRyaXZlciB3aGljaCBoZWxwcyB0
bwppbnN0YW50aWF0ZSBhbiBhZGQtb24gYm9hcmQgZGV2aWNlIG9uIGEgbWlrcm9idXMgcG9ydCBi
eSBmZXRjaGluZwp0aGUgZGV2aWNlIGlkZW50aWZpZXIgbWFuaWZlc3QgYmluYXJ5IGZyb20gYW4g
RUVQUk9NIG9uLWJvYXJkCnRoZSBkZXZpY2UuIG1pa3JvQlVTIGlzIGFuIGFkZC1vbiBib2FyZCBz
b2NrZXQgc3RhbmRhcmQgYnkKTWlrcm9FbGVrdHJvbmlrYSB0aGF0IGNhbiBiZSBmcmVlbHkgdXNl
ZCBieSBhbnlvbmUKZm9sbG93aW5nIHRoZSBndWlkZWxpbmVzLCBtb3JlIGRldGFpbHMgYW5kIGRp
c2N1c3Npb25zIG9uCnRoZSBzdGF0dXMgb2YgdGhlIGRyaXZlciBjYW4gYmUgZm91bmQgaGVyZSBp
biB0aGlzIGVMaW51eCB3aWtpOgpodHRwczovL2VsaW51eC5vcmcvTWlrcm9idXMKCkluIHRoZSBj
dXJyZW50IHN0YXRlIG9mIHRoZSBkcml2ZXIsIG1vcmUgdGhhbiA4MCBkaWZmZXJlbnQKYWRkLW9u
IGJvYXJkcyBoYXZlIGJlZW4gdGVzdGVkIG9uIHRoZSBCZWFnbGVCb2FyZC5vcmcKUG9ja2V0QmVh
Z2xlIGFuZCB0aGUgbWFuaWZlc3QgYmluYXJ5IGlzIGdlbmVyYXRlZCB1c2luZyB0aGUgc2FtZQpt
YW5pZmVzdG8gdG9vbCB1c2VkIHRvIGdlbmVyYXRlIEdyZXlidXMgbWFuaWZlc3QgYmluYXJpZXMs
ClRoZSBwdWxsIHJlcXVlc3QgdG8gbWFuaWZlc3RvIHRvIGFkZCBuZXcgZGVzY3JpcHRvcnMgc3Bl
Y2lmaWMKdG8gbWlrcm9idXMgaXMgaGVyZSA6IGh0dHBzOi8vZ2l0aHViLmNvbS9wcm9qZWN0YXJh
L21hbmlmZXN0by9wdWxsLzIKVGhlIHV0aWxpemF0aW9uIG9mIEdyZXlidXMgbWFuaWZlc3QgYmlu
YXJpZXMgaGVyZSBpcyBub3QgZW50aXJlbHkKY29pbmNpZGVudGFsLCBXZSBhcmUgZXZhbHVhdGlu
ZyB3YXlzIHRvIGFkZCBtaWtyb0JVUyBzb2NrZXRzIGFuZApkZXZpY2VzIHZpYSBHcmV5YnVzIGV4
cGFuc2lvbi4KClRoZSBtaWtyb0JVUyBzdGFuZGFyZCBpbmNsdWRlcyBTUEksIEkyQywgVUFSVCwg
UFdNLCBBREMsIEdQSU8KYW5kIHBvd2VyICgzLjNWIGFuZCA1VikgY29ubmVjdGlvbnMgdG8gaW50
ZXJmYWNlIGNvbW1vbiBlbWJlZGRlZApwZXJpcGhlcmFscywgVGhlcmUgYXJlIG1vcmUgdGhhbiA3
NTAgYWRkLW9uIGJvYXJkcyByYW5naW5nIGZyb20Kd2lyZWxlc3MgY29ubmVjdGl2aXR5IGJvYXJk
cyB0byBodW1hbi1tYWNoaW5lIGludGVyZmFjZSBzZW5zb3JzCndoaWNoIGNvbmZvcm0gdG8gdGhl
IG1pa3JvQlVTIHN0YW5kYXJkLCBvdXQgb2Ygd2hpY2ggbW9yZSB0aGFuIDE0MApib2FyZHMgYWxy
ZWFkeSBoYXZlIHN1cHBvcnQgaW4gdGhlIExpbnV4IGtlcm5lbC5Ub2RheSwgdGhlcmUgaXMgbm8K
bWFpbmxpbmVzb2x1dGlvbiBmb3IgZW5hYmxpbmcgbWlrcm9CVVMgYWRkLW9uIGJvYXJkcyBhdCBy
dW4tdGltZSwgdGhlCm1vc3Qgc3RyYWlnaHQgZm9yd2FyZCBtZXRob2QgZm9yIGxvYWRpbmcgZHJp
dmVycyBpcyB0byBwcm92aWRlCmRldmljZS10cmVlIG92ZXJsYXkgZnJhZ21lbnRzIGF0IGJvb3Qg
dGltZSwgdGhpcyBtZXRob2Qgc3VmZmVycwpmcm9tIHRoZSBuZWVkIHRvIG1haW50YWluIGEgbGFy
Z2Ugb3V0LW9mLXRyZWUgZGF0YWJhc2UgZm9yIHdoaWNoIHRoZXJlCmlzIG5lZWQgdG8gbWFpbnRh
aW4gYW4gb3ZlcmxheSBmb3IgZXZlcnkgbWlrcm9CVVMgYWRkLW9uIGJvYXJkIGZvciBldmVyeQpM
aW51eCBzeXN0ZW0gYW5kIGZvciBldmVyeSBtaWtyb0JVUyBzb2NrZXQgb24gdGhhdCBzeXN0ZW0u
CgpUaGUgbWlrcm9CVVMgZHJpdmVyIHRyaWVzIHRvIHNvbHZlIHRoZSBwcm9ibGVtIGJ5IHVzaW5n
IGV4dGVuZGVkIHZlcnNpb24Kb2YgdGhlIGdyZXlidXMgbWFuaWZlc3QgdG8gZGVzY3JpYmUgdGhl
IGFkZC1vbiBib2FyZCBkZXZpY2Ugc3BlY2lmaWMKaW5mb3JtYXRpb24gcmVxdWlyZWQgYnkgdGhl
IGRldmljZSBkcml2ZXIgYW5kIHVzZXMgaXQgYWxvbmcgd2l0aCB0aGUgZml4ZWQKcG9ydCBzcGVj
aWZpYyBpbmZvcm1hdGlvbiB0byBwcm9iZSB0aGUgc3BlY2lmaWMgZGV2aWNlIGRyaXZlci5UaGUg
bWFuaWZlc3QKYmluYXJ5IGlzIG5vdyBmZXRjaGVkIGZyb20gYW4gSTJDIEVFUFJPTSBvdmVyIHRo
ZSBJMkMgYnVzIG9uIHRoZSBtaWtyb0JVUwpwb3J0KHN1YmplY3QgdG8gY2hhbmdlIGluIG1pa3Jv
QlVTIHYzIHNwZWNpZmljYXRpb24pIGFuZCBlbnVtZXJhdGUgZHJpdmVycwpmb3IgdGhlIGFkZC1v
biBkZXZpY2VzLlRoZXJlIGlzIGFsc28gb25nb2luZyB3b3JrIHRvIGRlZmluZSBhIG1pa3JvQlVT
CnYzIHN0YW5kYXJkIGluIHdoaWNoIHRoZSBhZGRvbiBib2FyZCBpbmNsdWRlcyBhIG5vbi12b2xh
dGlsZSBzdG9yYWdlIHRvCnN0b3JlIHRoZSBkZXZpY2UgaWRlbnRpZmllciBtYW5pZmVzdCBiaW5h
cnksIG9uY2UgdGhlIG1pa3JvQlVTIHYzIHN0YW5kYXJkCmlzIHJlbGVhc2VkLCB0aGUgbWlrcm9C
VVMgY2FuIGJlIHNlZW4gYXMgYSBwcm9iZWFibGUgYnVzIHN1Y2ggdGhhdCB0aGUKa2VybmVsIGNh
biBkaXNjb3ZlciB0aGUgZGV2aWNlIG9uIHRoZSBidXMgYXQgYm9vdCB0aW1lLgoKVGhlIGRyaXZl
ciBhbHNvIGhhcyBhIGZldyBkZWJ1ZyBTeXNGUyBpbnRlcmZhY2VzIGZvciB0ZXN0aW5nIG9uIGFk
ZC1vbgpib2FyZHMgd2l0aG91dCBhbiBFRVBST00sIHRoZXNlIGNhbiBiZSB1c2VkIGluIHRoZSBm
b2xsb3dpbmcgbWFubmVyOgooZXhhbXBsZSBmb3IgbWlrcm9CVVMgcG9ydCAxIG9uIEJlYWdsZUJv
YXJkLm9yZyBQb2NrZXRCZWFnbGUpOgoKcHJpbnRmICIlYiIgJ1x4MDFceDAwXHgwMFx4NTlceDMy
XHgxNycgPiAvc3lzL2J1cy9taWtyb2J1cy9hZGRfcG9ydAoKVGhlIGJ5dGVzIGluIHRoZSBieXRl
IGFycmF5IHNlcXVlbmNlIGFyZSAoaW4gb3JkZXIpOgoKCSogaTJjX2FkYXBfbnIKCSogc3BpX21h
c3Rlcl9ucgoJKiBzZXJkZXZfY3Rscl9ucgoJKiByc3RfZ3Bpb19ucgoJKiBwd21fZ3Bpb19ucgoJ
KiBpbnRfZ3Bpb19ucgoqIGFkZF9wb3J0IHN5c0ZTIGVudHJ5IGlzIHB1cmVseSBmb3IgZGVidWcg
YW5kIGluIHRoZSBhY3R1YWwgc3RhdGUKb2YgdGhlIGRyaXZlciwgcG9ydCBjb25maWd1cmF0aW9u
IHdpbGwgYmUgbG9hZGVkIGZyb20gYSBzdWl0YWJsZQpkZXZpY2UgdHJlZSBvdmVybGF5IGZyYWdt
ZW50LgoKZWNobyAwID4gL3N5cy9idXMvbWlrcm9idXMvZGVsX3BvcnQgKHRvIGRlbGV0ZSB0aGUg
YXR0YWNoZWQgcG9ydCkKZWNobyAxID4gIC9zeXMvY2xhc3MvbWlrcm9idXMtcG9ydC9taWtyb2J1
cy0wL3Jlc2NhbiAodG8gcmVzY2FuIHRoZSBFRVBST00KY29udGVudHMgb24gdGhlIEkyQyBidXMg
b24gdGhlIG1pa3JvQlVTIHBvcnQpLgoKY2F0IGJvYXJkX21hbmlmZXN0Lm1uZmIgPiAgL3N5cy9j
bGFzcy9taWtyb2J1cy1wb3J0L21pa3JvYnVzLTAvbmV3X2RldmljZQoqIGRlYnVnIGludGVyZmFj
ZSB0byBwYXNzIHRoZSBtYW5pZmVzdCBiaW5hcnkgaW4gY2FzZSBhbiBFRVBST00gaXMgYWJzZW50
CmVjaG8gMCA+ICAvc3lzL2NsYXNzL21pa3JvYnVzLXBvcnQvbWlrcm9idXMtMC9kZWxldGVfZGV2
aWNlCiogdG8gdW5sb2FkIHRoZSBsb2FkZWQgYm9hcmQgb24gdGhlIG1pa3JvYnVzIHBvcnQKClRo
ZXNlIHN5c0ZTIGludGVyZmFjZXMgYXJlIG9ubHkgaW1wbGVtZW50ZWQgZm9yIGRlYnVnIHB1cnBv
c2VzIGFuZAppbiB0aGUgYWN0dWFsIGltcGxlbWVudGF0aW9uIG9mIHRoZSBkcml2ZXIgdGhlc2Ug
d2lsbCBiZSByZW1vdmVkIGFuZAp0aGUgbWFuaWZlc3QgYmluYXJ5IHdpbGwgYmUgZmV0Y2hlZCBm
cm9tIHRoZSBub24gdm9sYXRpbGUgc3RvcmFnZSBvbi1ib2FyZAp0aGUgZGV2aWNlLgoKVGhlIG1p
a3JvQlVTIGRyaXZlciBlbmFibGUgdGhlIG1pa3JvQlVTIHRvIGJlIGEgcHJvYmVhYmxlIGJ1cyBz
dWNoIHRoYXQKdGhlIGtlcm5lbCBjYW4gZGlzY292ZXIgdGhlIGRldmljZSBhbmQgYXV0b21hdGlj
YWxseSBsb2FkIHRoZSBkcml2ZXJzLgpUaGVyZSBhcmUgYWxyZWFkeSBzZXZlcmFsIExpbnV4IHBs
YXRmb3JtcyB3aXRoIG1pa3JvQlVTIHNvY2tldHMgYW5kIHRoZQptaWtyb0JVUyBkcml2ZXIgaGVs
cHMgdG8gcmVkdWNlIHRoZSB0aW1lIHRvIGRldmVsb3AgYW5kIGRlYnVnCnN1cHBvcnQgZm9yIHZh
cmlvdXMgbWlrcm9CVVMgYWRkLW9uIGJvYXJkcy4gRnVydGhlciwgaXQgb3BlbnMgdXAKdGhlIHBv
c3NpYmlsaXR5IGZvciBzdXBwb3J0IHVuZGVyIGR5bmFtaWNhbGx5IGluc3RhbnRpYXRlZCBidXNl
cwpzdWNoIGFzIHdpdGggR3JleWJ1cy4KClBsZWFzZSBsZXQga25vdyB0aGUgZmVlZGJhY2sgeW91
IGhhdmUgb24gdGhpcyBwYXRjaCBvciB0aGUgYXBwcm9hY2ggdXNlZC4KClRoYW5rcywKClZhaXNo
bmF2IE0gQQoKU2lnbmVkLW9mZi1ieTogVmFpc2huYXYgTSBBIDx2YWlzaG5hdkBiZWFnbGVib2Fy
ZC5vcmc+Ci0tLQogTUFJTlRBSU5FUlMgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfCAg
IDYgKwogZHJpdmVycy9taXNjL0tjb25maWcgICAgICAgICAgICAgICAgICAgICAgfCAgIDEgKwog
ZHJpdmVycy9taXNjL01ha2VmaWxlICAgICAgICAgICAgICAgICAgICAgfCAgIDEgKwogZHJpdmVy
cy9taXNjL21pa3JvYnVzL0tjb25maWcgICAgICAgICAgICAgfCAgMTYgKwogZHJpdmVycy9taXNj
L21pa3JvYnVzL01ha2VmaWxlICAgICAgICAgICAgfCAgIDUgKwogZHJpdmVycy9taXNjL21pa3Jv
YnVzL21pa3JvYnVzX2NvcmUuYyAgICAgfCA2NDkgKysrKysrKysrKysrKysrKysrKysrKwogZHJp
dmVycy9taXNjL21pa3JvYnVzL21pa3JvYnVzX2NvcmUuaCAgICAgfCAxMzAgKysrKysKIGRyaXZl
cnMvbWlzYy9taWtyb2J1cy9taWtyb2J1c19tYW5pZmVzdC5jIHwgMzkwICsrKysrKysrKysrKysK
IGRyaXZlcnMvbWlzYy9taWtyb2J1cy9taWtyb2J1c19tYW5pZmVzdC5oIHwgIDIxICsKIGluY2x1
ZGUvbGludXgvZ3JleWJ1cy9ncmV5YnVzX21hbmlmZXN0LmggIHwgIDUzICsrCiAxMCBmaWxlcyBj
aGFuZ2VkLCAxMjcyIGluc2VydGlvbnMoKykKIGNyZWF0ZSBtb2RlIDEwMDY0NCBkcml2ZXJzL21p
c2MvbWlrcm9idXMvS2NvbmZpZwogY3JlYXRlIG1vZGUgMTAwNjQ0IGRyaXZlcnMvbWlzYy9taWty
b2J1cy9NYWtlZmlsZQogY3JlYXRlIG1vZGUgMTAwNjQ0IGRyaXZlcnMvbWlzYy9taWtyb2J1cy9t
aWtyb2J1c19jb3JlLmMKIGNyZWF0ZSBtb2RlIDEwMDY0NCBkcml2ZXJzL21pc2MvbWlrcm9idXMv
bWlrcm9idXNfY29yZS5oCiBjcmVhdGUgbW9kZSAxMDA2NDQgZHJpdmVycy9taXNjL21pa3JvYnVz
L21pa3JvYnVzX21hbmlmZXN0LmMKIGNyZWF0ZSBtb2RlIDEwMDY0NCBkcml2ZXJzL21pc2MvbWlr
cm9idXMvbWlrcm9idXNfbWFuaWZlc3QuaAoKZGlmZiAtLWdpdCBhL01BSU5UQUlORVJTIGIvTUFJ
TlRBSU5FUlMKaW5kZXggZDUzZGIzMGQxMzY1Li45YTA0OTc0NjIwM2YgMTAwNjQ0Ci0tLSBhL01B
SU5UQUlORVJTCisrKyBiL01BSU5UQUlORVJTCkBAIC0xMTQwMiw2ICsxMTQwMiwxMiBAQCBNOglP
bGl2ZXIgTmV1a3VtIDxvbGl2ZXJAbmV1a3VtLm9yZz4KIFM6CU1haW50YWluZWQKIEY6CWRyaXZl
cnMvdXNiL2ltYWdlL21pY3JvdGVrLioKIAorTUlLUk9CVVMgQURET04gQk9BUkQgRFJJVkVSCitN
OglWYWlzaG5hdiBNIEEgPHZhaXNobmF2QGJlYWdsZWJvYXJkLm9yZz4KK1M6CU1haW50YWluZWQK
K1c6CWh0dHBzOi8vZWxpbnV4Lm9yZy9NaWtyb2J1cworRjoJZHJpdmVycy9taXNjL21pa3JvYnVz
LworCiBNSVBTCiBNOglUaG9tYXMgQm9nZW5kb2VyZmVyIDx0c2JvZ2VuZEBhbHBoYS5mcmFua2Vu
LmRlPgogTDoJbGludXgtbWlwc0B2Z2VyLmtlcm5lbC5vcmcKZGlmZiAtLWdpdCBhL2RyaXZlcnMv
bWlzYy9LY29uZmlnIGIvZHJpdmVycy9taXNjL0tjb25maWcKaW5kZXggZTFiMWJhNWUyYjkyLi4z
MzRmMGMzOWQ1NmIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvbWlzYy9LY29uZmlnCisrKyBiL2RyaXZl
cnMvbWlzYy9LY29uZmlnCkBAIC00NzIsNCArNDcyLDUgQEAgc291cmNlICJkcml2ZXJzL21pc2Mv
b2N4bC9LY29uZmlnIgogc291cmNlICJkcml2ZXJzL21pc2MvY2FyZHJlYWRlci9LY29uZmlnIgog
c291cmNlICJkcml2ZXJzL21pc2MvaGFiYW5hbGFicy9LY29uZmlnIgogc291cmNlICJkcml2ZXJz
L21pc2MvdWFjY2UvS2NvbmZpZyIKK3NvdXJjZSAiZHJpdmVycy9taXNjL21pa3JvYnVzL0tjb25m
aWciCiBlbmRtZW51CmRpZmYgLS1naXQgYS9kcml2ZXJzL21pc2MvTWFrZWZpbGUgYi9kcml2ZXJz
L21pc2MvTWFrZWZpbGUKaW5kZXggYzdiZDAxYWM2MjkxLi40NTQ4NmRkNzdkYTUgMTAwNjQ0Ci0t
LSBhL2RyaXZlcnMvbWlzYy9NYWtlZmlsZQorKysgYi9kcml2ZXJzL21pc2MvTWFrZWZpbGUKQEAg
LTQwLDYgKzQwLDcgQEAgb2JqLSQoQ09ORklHX1ZNV0FSRV9CQUxMT09OKQkrPSB2bXdfYmFsbG9v
bi5vCiBvYmotJChDT05GSUdfUENIX1BIVUIpCQkrPSBwY2hfcGh1Yi5vCiBvYmoteQkJCQkrPSB0
aS1zdC8KIG9iai15CQkJCSs9IGxpczNsdjAyZC8KK29iai15CQkJCSs9IG1pa3JvYnVzLwogb2Jq
LSQoQ09ORklHX0FMVEVSQV9TVEFQTCkJKz1hbHRlcmEtc3RhcGwvCiBvYmotJChDT05GSUdfSU5U
RUxfTUVJKQkJKz0gbWVpLwogb2JqLSQoQ09ORklHX1ZNV0FSRV9WTUNJKQkrPSB2bXdfdm1jaS8K
ZGlmZiAtLWdpdCBhL2RyaXZlcnMvbWlzYy9taWtyb2J1cy9LY29uZmlnIGIvZHJpdmVycy9taXNj
L21pa3JvYnVzL0tjb25maWcKbmV3IGZpbGUgbW9kZSAxMDA2NDQKaW5kZXggMDAwMDAwMDAwMDAw
Li5jM2I5M2UxMmRhYWQKLS0tIC9kZXYvbnVsbAorKysgYi9kcml2ZXJzL21pc2MvbWlrcm9idXMv
S2NvbmZpZwpAQCAtMCwwICsxLDE2IEBACittZW51Y29uZmlnIE1JS1JPQlVTCisJdHJpc3RhdGUg
Ik1vZHVsZSBmb3IgaW5zdGFudGlhdGluZyBkZXZpY2VzIG9uIG1pa3JvQlVTIHBvcnRzIgorCWhl
bHAKKwkgIFRoaXMgb3B0aW9uIGVuYWJsZXMgdGhlIG1pa3JvQlVTIGRyaXZlci4gbWlrcm9CVVMg
aXMgYW4gYWRkLW9uCisJICBib2FyZCBzb2NrZXQgc3RhbmRhcmQgdGhhdCBvZmZlcnMgbWF4aW11
bSBleHBhbmRhYmlsaXR5IHdpdGgKKwkgIHRoZSBzbWFsbGVzdCBudW1iZXIgb2YgcGlucy4gVGhl
IG1pa3JvQlVTIGRyaXZlciBoZWxwcyBpbgorCSAgaW5zdGFudGlhdGluZyBkZXZpY2VzIG9uIHRo
ZSBtaWtyb0JVUyBwb3J0IHdpdGggaWRlbnRpZmllcgorCSAgZGF0YSBmZXRjaGVkIGZyb20gYW4g
RUVQUk9NIG9uIHRoZSBkZXZpY2UsIG1vcmUgZGV0YWlscyBvbgorCSAgdGhlIG1pa3JvQlVTIGRy
aXZlciBzdXBwb3J0IGFuZCBkaXNjdXNzaW9uIGNhbiBiZSBmb3VuZCBpbgorCSAgdGhpcyBlTGlu
dXggd2lraSA6IGVsaW51eC5vcmcvTWlrcm9idXMKKworCisJICBTYXkgWSBoZXJlIHRvIGVuYWJs
ZSBzdXBwb3J0IGZvciB0aGlzIGRyaXZlci4KKworCSAgVG8gY29tcGlsZSB0aGlzIGNvZGUgYXMg
YSBtb2R1bGUsIGNob3NlIE0gaGVyZTogdGhlIG1vZHVsZQorCSAgd2lsbCBiZSBjYWxsZWQgbWlr
cm9idXMua28KZGlmZiAtLWdpdCBhL2RyaXZlcnMvbWlzYy9taWtyb2J1cy9NYWtlZmlsZSBiL2Ry
aXZlcnMvbWlzYy9taWtyb2J1cy9NYWtlZmlsZQpuZXcgZmlsZSBtb2RlIDEwMDY0NAppbmRleCAw
MDAwMDAwMDAwMDAuLjFmODBlZDQwNjRkOAotLS0gL2Rldi9udWxsCisrKyBiL2RyaXZlcnMvbWlz
Yy9taWtyb2J1cy9NYWtlZmlsZQpAQCAtMCwwICsxLDUgQEAKKyMgU1BEWC1MaWNlbnNlLUlkZW50
aWZpZXI6IEdQTC0yLjAKKyMgbWlrcm9CVVMgQ29yZQorCittaWtyb2J1cy15IDo9CW1pa3JvYnVz
X2NvcmUubwltaWtyb2J1c19tYW5pZmVzdC5vCitvYmotJChDT05GSUdfTUlLUk9CVVMpICs9IG1p
a3JvYnVzLm8KXCBObyBuZXdsaW5lIGF0IGVuZCBvZiBmaWxlCmRpZmYgLS1naXQgYS9kcml2ZXJz
L21pc2MvbWlrcm9idXMvbWlrcm9idXNfY29yZS5jIGIvZHJpdmVycy9taXNjL21pa3JvYnVzL21p
a3JvYnVzX2NvcmUuYwpuZXcgZmlsZSBtb2RlIDEwMDY0NAppbmRleCAwMDAwMDAwMDAwMDAuLjc4
Yzk2YzYzNzYzMgotLS0gL2Rldi9udWxsCisrKyBiL2RyaXZlcnMvbWlzYy9taWtyb2J1cy9taWty
b2J1c19jb3JlLmMKQEAgLTAsMCArMSw2NDkgQEAKKy8vIFNQRFgtTGljZW5zZS1JZGVudGlmaWVy
OiBHUEwtMi4wCisvKgorICogbWlrcm9CVVMgZHJpdmVyIGZvciBpbnN0YW50aWF0aW5nIGFkZC1v
bgorICogYm9hcmQgZGV2aWNlcyB3aXRoIGFuIGlkZW50aWZpZXIgRUVQUk9NCisgKgorICogQ29w
eXJpZ2h0IDIwMjAgVmFpc2huYXYgTSBBLCBCZWFnbGVCb2FyZC5vcmcgRm91bmRhdGlvbi4KKyAq
LworCisjZGVmaW5lIHByX2ZtdChmbXQpICJtaWtyb2J1czogIiBmbXQKKworI2luY2x1ZGUgPGxp
bnV4L2Vyci5oPgorI2luY2x1ZGUgPGxpbnV4L2Vycm5vLmg+CisjaW5jbHVkZSA8bGludXgvaWRy
Lmg+CisjaW5jbHVkZSA8bGludXgvaW5pdC5oPgorI2luY2x1ZGUgPGxpbnV4L2p1bXBfbGFiZWwu
aD4KKyNpbmNsdWRlIDxsaW51eC9rZXJuZWwuaD4KKyNpbmNsdWRlIDxsaW51eC9tb2R1bGUuaD4K
KyNpbmNsdWRlIDxsaW51eC9ncGlvL2NvbnN1bWVyLmg+CisjaW5jbHVkZSA8bGludXgvbXV0ZXgu
aD4KKyNpbmNsdWRlIDxsaW51eC9kZXZpY2UuaD4KKyNpbmNsdWRlIDxsaW51eC9vZi5oPgorI2lu
Y2x1ZGUgPGxpbnV4L29mX2RldmljZS5oPgorI2luY2x1ZGUgPGxpbnV4L2kyYy5oPgorI2luY2x1
ZGUgPGxpbnV4L2dwaW8uaD4KKyNpbmNsdWRlIDxsaW51eC9ncGlvL21hY2hpbmUuaD4KKyNpbmNs
dWRlIDxsaW51eC9udm1lbS1jb25zdW1lci5oPgorI2luY2x1ZGUgPGxpbnV4L252bWVtLXByb3Zp
ZGVyLmg+CisjaW5jbHVkZSA8bGludXgvaW50ZXJydXB0Lmg+CisjaW5jbHVkZSA8bGludXgvc3Bp
L3NwaS5oPgorI2luY2x1ZGUgPGxpbnV4L3NlcmRldi5oPgorI2luY2x1ZGUgPGxpbnV4L3Byb3Bl
cnR5Lmg+CisjaW5jbHVkZSA8bGludXgvc2xhYi5oPgorCisjaW5jbHVkZSAibWlrcm9idXNfY29y
ZS5oIgorI2luY2x1ZGUgIm1pa3JvYnVzX21hbmlmZXN0LmgiCisKKyNkZWZpbmUgQVRNRUxfMjRD
MzJfSTJDX0FERFIgMHg1NworCitzdGF0aWMgREVGSU5FX0lEUihtaWtyb2J1c19wb3J0X2lkcik7
CitzdGF0aWMgc3RydWN0IGNsYXNzX2NvbXBhdCAqbWlrcm9idXNfcG9ydF9jb21wYXRfY2xhc3M7
CitzdGF0aWMgYm9vbCBpc19yZWdpc3RlcmVkOworCitzdGF0aWMgc3NpemVfdCBhZGRfcG9ydF9z
dG9yZShzdHJ1Y3QgYnVzX3R5cGUgKmJ0LCBjb25zdCBjaGFyICpidWYsCisJCQkgICAgICBzaXpl
X3QgY291bnQpCit7CisJc3RydWN0IG1pa3JvYnVzX3BvcnRfY29uZmlnICpjZmc7CisKKwlpZiAo
Y291bnQgPCBzaXplb2YoKmNmZykpIHsKKwkJcHJfZXJyKCJhZGRfcG9ydDogaW5jb3JyZWN0IGNv
bmZpZyBkYXRhIHJlY2VpdmVkOiAlc1xuIiwgYnVmKTsKKwkJcmV0dXJuIC1FSU5WQUw7CisJfQor
CW1pa3JvYnVzX3JlZ2lzdGVyX3BvcnRfY29uZmlnKCh2b2lkICopYnVmKTsKKwlyZXR1cm4gY291
bnQ7Cit9CitCVVNfQVRUUl9XTyhhZGRfcG9ydCk7CisKK3N0YXRpYyBzc2l6ZV90IGRlbF9wb3J0
X3N0b3JlKHN0cnVjdCBidXNfdHlwZSAqYnQsIGNvbnN0IGNoYXIgKmJ1ZiwKKwkJCQkJCQkgIHNp
emVfdCBjb3VudCkKK3sKKwlpbnQgaWQ7CisJY2hhciBlbmQ7CisJaW50IHJlczsKKworCXJlcyA9
IHNzY2FuZihidWYsICIlZCVjIiwgJmlkLCAmZW5kKTsKKwlpZiAocmVzIDwgMSkgeworCQlwcl9l
cnIoImRlbGV0ZV9wb3J0OiBjYW5ub3QgcGFyc2UgbWlrcm9idXMgcG9ydCBJRFxuIik7CisJCXJl
dHVybiAtRUlOVkFMOworCX0KKwlpZiAoIWlkcl9maW5kKCZtaWtyb2J1c19wb3J0X2lkciwgaWQp
KSB7CisJCXByX2VycigiYXR0ZW1wdGluZyB0byBkZWxldGUgdW5yZWdpc3RlcmVkIHBvcnQgWyVk
XVxuIiwgaWQpOworCQlyZXR1cm4gLUVJTlZBTDsKKwl9CisJbWlrcm9idXNfZGVsX3BvcnQoaWRy
X2ZpbmQoJm1pa3JvYnVzX3BvcnRfaWRyLCBpZCkpOworCXJldHVybiBjb3VudDsKK30KK0JVU19B
VFRSX1dPKGRlbF9wb3J0KTsKKworc3RhdGljIHN0cnVjdCBhdHRyaWJ1dGUgKm1pa3JvYnVzX2F0
dHJzW10gPSB7CisJJmJ1c19hdHRyX2FkZF9wb3J0LmF0dHIsCisJJmJ1c19hdHRyX2RlbF9wb3J0
LmF0dHIsCisJIE5VTEwKK307CitBVFRSSUJVVEVfR1JPVVBTKG1pa3JvYnVzKTsKKworc3RydWN0
IGJ1c190eXBlIG1pa3JvYnVzX2J1c190eXBlID0geworCS5uYW1lID0gIm1pa3JvYnVzIiwKKwku
YnVzX2dyb3VwcyA9IG1pa3JvYnVzX2dyb3VwcywKK307CitFWFBPUlRfU1lNQk9MX0dQTChtaWty
b2J1c19idXNfdHlwZSk7CisKK3N0YXRpYyBpbnQgbWlrcm9idXNfcG9ydF9zY2FuX2VlcHJvbShz
dHJ1Y3QgbWlrcm9idXNfcG9ydCAqcG9ydCkKK3sKKwljaGFyIGhlYWRlclsxMl07CisJc3RydWN0
IGFkZG9uX2JvYXJkX2luZm8gKmJvYXJkOworCWludCBtYW5pZmVzdF9zaXplOworCWludCByZXR2
YWw7CisJY2hhciAqYnVmOworCisJbnZtZW1fZGV2aWNlX3JlYWQocG9ydC0+ZWVwcm9tLCAwLCAx
MiwgaGVhZGVyKTsKKwltYW5pZmVzdF9zaXplID0gbWlrcm9idXNfbWFuaWZlc3RfaGVhZGVyX3Zh
bGlkYXRlKGhlYWRlciwgMTIpOworCWlmIChtYW5pZmVzdF9zaXplID4gMCkgeworCQlidWYgPSBr
emFsbG9jKG1hbmlmZXN0X3NpemUsIEdGUF9LRVJORUwpOworCQludm1lbV9kZXZpY2VfcmVhZChw
b3J0LT5lZXByb20sIDAsIG1hbmlmZXN0X3NpemUsIGJ1Zik7CisJCWJvYXJkID0ga3phbGxvYyhz
aXplb2YoKmJvYXJkKSwgR0ZQX0tFUk5FTCk7CisJCWlmICghYm9hcmQpCisJCQlyZXR1cm4gLUVO
T01FTTsKKwkJSU5JVF9MSVNUX0hFQUQoJmJvYXJkLT5tYW5pZmVzdF9kZXNjcyk7CisJCUlOSVRf
TElTVF9IRUFEKCZib2FyZC0+ZGV2aWNlcyk7CisJCXJldHZhbCA9IG1pa3JvYnVzX21hbmlmZXN0
X3BhcnNlKGJvYXJkLCAodm9pZCAqKWJ1ZiwgbWFuaWZlc3Rfc2l6ZSk7CisJCWlmICghcmV0dmFs
KSB7CisJCQlwcl9lcnIoImZhaWxlZCB0byBwYXJzZSBtYW5pZmVzdCwgc2l6ZTogJWQiLCBtYW5p
ZmVzdF9zaXplKTsKKwkJCXJldHVybiAtRUlOVkFMOworCQl9CisJCXJldHZhbCA9IG1pa3JvYnVz
X3JlZ2lzdGVyX2JvYXJkKHBvcnQsIGJvYXJkKTsKKwkJaWYgKHJldHZhbCkgeworCQkJcHJfZXJy
KCJmYWlsZWQgdG8gcmVnaXN0ZXIgYm9hcmQ6ICVzIiwgYm9hcmQtPm5hbWUpOworCQkJcmV0dXJu
IC1FSU5WQUw7CisJCX0KKwkJa2ZyZWUoYnVmKTsKKwl9IGVsc2UgeworCQlwcl9lcnIoImluYXZs
aWRlIG1hbmlmZXN0IHBvcnQgJWQiLCBwb3J0LT5pZCk7CisJCXJldHVybiAtRUlOVkFMOworCX0K
KwlyZXR1cm4gMDsKK30KKworc3RhdGljIHNzaXplX3QgbmFtZV9zaG93KHN0cnVjdCBkZXZpY2Ug
KmRldiwgc3RydWN0IGRldmljZV9hdHRyaWJ1dGUgKmF0dHIsCisJCQkJCQkgY2hhciAqYnVmKQor
eworCXJldHVybiBzcHJpbnRmKGJ1ZiwgIiVzXG4iLCB0b19taWtyb2J1c19wb3J0KGRldiktPm5h
bWUpOworfQorc3RhdGljIERFVklDRV9BVFRSX1JPKG5hbWUpOworCitzdGF0aWMgc3NpemVfdCBu
ZXdfZGV2aWNlX3N0b3JlKHN0cnVjdCBkZXZpY2UgKmRldiwgc3RydWN0IGRldmljZV9hdHRyaWJ1
dGUgKmF0dHIsCisJCQkJCSBjb25zdCBjaGFyICpidWYsIHNpemVfdCBjb3VudCkKK3sKKwlzdHJ1
Y3QgbWlrcm9idXNfcG9ydCAqcG9ydCA9IHRvX21pa3JvYnVzX3BvcnQoZGV2KTsKKwlzdHJ1Y3Qg
YWRkb25fYm9hcmRfaW5mbyAqYm9hcmQ7CisJaW50IHJldHZhbDsKKworCWlmIChwb3J0LT5ib2Fy
ZCA9PSBOVUxMKSB7CisJCWJvYXJkID0ga3phbGxvYyhzaXplb2YoKmJvYXJkKSwgR0ZQX0tFUk5F
TCk7CisJCWlmICghYm9hcmQpCisJCQlyZXR1cm4gLUVJTlZBTDsKKwkJSU5JVF9MSVNUX0hFQUQo
JmJvYXJkLT5tYW5pZmVzdF9kZXNjcyk7CisJCUlOSVRfTElTVF9IRUFEKCZib2FyZC0+ZGV2aWNl
cyk7CisJfSBlbHNlIHsKKwkJcHJfZXJyKCJwb3J0ICVkIGFscmVhZHkgaGFzIGJvYXJkIHJlZ2lz
dGVyZWQiLCBwb3J0LT5pZCk7CisJCXJldHVybiAtRUlOVkFMOworCX0KKwlyZXR2YWwgPSBtaWty
b2J1c19tYW5pZmVzdF9wYXJzZShib2FyZCwgKHZvaWQgKilidWYsIGNvdW50KTsKKwlpZiAoIXJl
dHZhbCkgeworCQlwcl9lcnIoImZhaWxlZCB0byBwYXJzZSBtYW5pZmVzdCIpOworCQlyZXR1cm4g
LUVJTlZBTDsKKwl9CisJcmV0dmFsID0gbWlrcm9idXNfcmVnaXN0ZXJfYm9hcmQocG9ydCwgYm9h
cmQpOworCWlmIChyZXR2YWwpIHsKKwkJcHJfZXJyKCJmYWlsZWQgdG8gcmVnaXN0ZXIgYm9hcmQ6
ICVzIiwgYm9hcmQtPm5hbWUpOworCQlyZXR1cm4gLUVJTlZBTDsKKwl9CisJcmV0dXJuIGNvdW50
OworfQorc3RhdGljIERFVklDRV9BVFRSX1dPKG5ld19kZXZpY2UpOworCitzdGF0aWMgc3NpemVf
dCByZXNjYW5fc3RvcmUoc3RydWN0IGRldmljZSAqZGV2LCBzdHJ1Y3QgZGV2aWNlX2F0dHJpYnV0
ZSAqYXR0ciwKKwkJCQkJCQljb25zdCBjaGFyICpidWYsIHNpemVfdCBjb3VudCkKK3sKKwlzdHJ1
Y3QgbWlrcm9idXNfcG9ydCAqcG9ydCA9IHRvX21pa3JvYnVzX3BvcnQoZGV2KTsKKwlpbnQgaWQ7
CisJY2hhciBlbmQ7CisJaW50IHJlczsKKwlpbnQgcmV0dmFsOworCisJcmVzID0gc3NjYW5mKGJ1
ZiwgIiVkJWMiLCAmaWQsICZlbmQpOworCWlmIChyZXMgPCAxKSB7CisJCXByX2VycigicmVzY2Fu
OiBDYW4ndCBwYXJzZSB0cmlnZ2VyXG4iKTsKKwkJcmV0dXJuIC1FSU5WQUw7CisJfQorCWlmIChw
b3J0LT5ib2FyZCAhPSBOVUxMKSB7CisJCXByX2VycigicG9ydCAlZCBhbHJlYWR5IGhhcyBib2Fy
ZCByZWdpc3RlcmVkIiwgcG9ydC0+aWQpOworCQlyZXR1cm4gLUVJTlZBTDsKKwl9CisJcmV0dmFs
ID0gbWlrcm9idXNfcG9ydF9zY2FuX2VlcHJvbShwb3J0KTsKKwlpZiAocmV0dmFsKSB7CisJCXBy
X2VycigicG9ydCAlZCBib2FyZCByZWdpc3RlciBmcm9tIG1hbmlmZXN0IGZhaWxlZCIsIHBvcnQt
PmlkKTsKKwkJcmV0dXJuIC1FSU5WQUw7CisJfQorCXJldHVybiBjb3VudDsKK30KK3N0YXRpYyBE
RVZJQ0VfQVRUUl9XTyhyZXNjYW4pOworCitzdGF0aWMgc3NpemVfdCBkZWxldGVfZGV2aWNlX3N0
b3JlKHN0cnVjdCBkZXZpY2UgKmRldiwgc3RydWN0IGRldmljZV9hdHRyaWJ1dGUgKmF0dHIsCisJ
CQkJCQkJY29uc3QgY2hhciAqYnVmLCBzaXplX3QgY291bnQpCit7CisJaW50IGlkOworCWNoYXIg
ZW5kOworCWludCByZXM7CisJc3RydWN0IG1pa3JvYnVzX3BvcnQgKnBvcnQgPSB0b19taWtyb2J1
c19wb3J0KGRldik7CisKKwlyZXMgPSBzc2NhbmYoYnVmLCAiJWQlYyIsICZpZCwgJmVuZCk7CisJ
aWYgKHJlcyA8IDEpIHsKKwkJcHJfZXJyKCJkZWxldGVfYm9hcmQ6IENhbid0IHBhcnNlIGJvYXJk
IElEXG4iKTsKKwkJcmV0dXJuIC1FSU5WQUw7CisJfQorCWlmIChwb3J0LT5ib2FyZCA9PSBOVUxM
KSB7CisJCXByX2VycigiZGVsZXRlX2JvYXJkOiBwb3J0IGRvZXMgbm90IGhhdmUgYW55IGJvYXJk
cyByZWdpc3RlcmVkXG4iKTsKKwkJcmV0dXJuIC1FSU5WQUw7CisJfQorCW1pa3JvYnVzX3VucmVn
aXN0ZXJfYm9hcmQocG9ydCwgcG9ydC0+Ym9hcmQpOworCXJldHVybiBjb3VudDsKK30KK3N0YXRp
YyBERVZJQ0VfQVRUUl9JR05PUkVfTE9DS0RFUChkZWxldGVfZGV2aWNlLCAwMjAwLCBOVUxMLCBk
ZWxldGVfZGV2aWNlX3N0b3JlKTsKKworc3RhdGljIHN0cnVjdCBhdHRyaWJ1dGUgKm1pa3JvYnVz
X3BvcnRfYXR0cnNbXSA9IHsKKwkmZGV2X2F0dHJfbmV3X2RldmljZS5hdHRyLCAmZGV2X2F0dHJf
cmVzY2FuLmF0dHIsCisJJmRldl9hdHRyX2RlbGV0ZV9kZXZpY2UuYXR0ciwgJmRldl9hdHRyX25h
bWUuYXR0ciwgTlVMTH07CitBVFRSSUJVVEVfR1JPVVBTKG1pa3JvYnVzX3BvcnQpOworCitzdGF0
aWMgdm9pZCBtaWtyb2J1c19kZXZfcmVsZWFzZShzdHJ1Y3QgZGV2aWNlICpkZXYpCit7CisJc3Ry
dWN0IG1pa3JvYnVzX3BvcnQgKnBvcnQgPSB0b19taWtyb2J1c19wb3J0KGRldik7CisKKwlpZHJf
cmVtb3ZlKCZtaWtyb2J1c19wb3J0X2lkciwgcG9ydC0+aWQpOworCWtmcmVlKHBvcnQpOworfQor
CitzdHJ1Y3QgZGV2aWNlX3R5cGUgbWlrcm9idXNfcG9ydF90eXBlID0geworCS5ncm91cHMgPSBt
aWtyb2J1c19wb3J0X2dyb3VwcywKKwkucmVsZWFzZSA9IG1pa3JvYnVzX2Rldl9yZWxlYXNlLAor
fTsKK0VYUE9SVF9TWU1CT0xfR1BMKG1pa3JvYnVzX3BvcnRfdHlwZSk7CisKK3N0YXRpYyBpbnQg
bWlrcm9idXNfZ2V0X2lycShzdHJ1Y3QgbWlrcm9idXNfcG9ydCAqcG9ydCwgaW50IGlycW5vLAor
CQkJCQkJCWludCBpcnFfdHlwZSkKK3sKKwlpbnQgaXJxOworCisJc3dpdGNoIChpcnFubykgewor
CWNhc2UgTUlLUk9CVVNfR1BJT19JTlQ6CisJaXJxID0gZ3Bpb2RfdG9faXJxKHBvcnQtPmludF9n
cGlvKTsKKwlicmVhazsKKwljYXNlIE1JS1JPQlVTX0dQSU9fUlNUOgorCWlycSA9IGdwaW9kX3Rv
X2lycShwb3J0LT5yc3RfZ3Bpbyk7CisJYnJlYWs7CisJY2FzZSBNSUtST0JVU19HUElPX1BXTToK
KwlpcnEgPSBncGlvZF90b19pcnEocG9ydC0+cHdtX2dwaW8pOworCWJyZWFrOworCWRlZmF1bHQ6
CisJcmV0dXJuIC1FSU5WQUw7CisJfQorCWlmIChpcnEgPCAwKSB7CisJCXByX2VycigiQ291bGQg
bm90IGdldCBpcnEgZm9yIGlycSB0eXBlOiAlZCIsIGlycW5vKTsKKwkJcmV0dXJuIC1FSU5WQUw7
CisJfQorCWlycV9zZXRfaXJxX3R5cGUoaXJxLCBpcnFfdHlwZSk7CisJcmV0dXJuIGlycTsKK30K
Kworc3RhdGljIGludCBtaWtyb2J1c19zZXR1cF9ncGlvKHN0cnVjdCBncGlvX2Rlc2MgKmdwaW8s
IGludCBncGlvX3N0YXRlKQoreworCWludCByZXR2YWw7CisKKwlpZiAoZ3Bpb19zdGF0ZSA9PSBN
SUtST0JVU19HUElPX1VOVVNFRCkKKwkJcmV0dXJuIDA7CisJc3dpdGNoIChncGlvX3N0YXRlKSB7
CisJY2FzZSBNSUtST0JVU19HUElPX0lOUFVUOgorCXJldHZhbCA9IGdwaW9kX2RpcmVjdGlvbl9p
bnB1dChncGlvKTsKKwlicmVhazsKKwljYXNlIE1JS1JPQlVTX0dQSU9fT1VUUFVUX0hJR0g6CisJ
cmV0dmFsID0gZ3Bpb2RfZGlyZWN0aW9uX291dHB1dChncGlvLCAxKTsKKwlncGlvZF9zZXRfdmFs
dWVfY2Fuc2xlZXAoZ3BpbywgMSk7CisJYnJlYWs7CisJY2FzZSBNSUtST0JVU19HUElPX09VVFBV
VF9MT1c6CisJcmV0dmFsID0gZ3Bpb2RfZGlyZWN0aW9uX291dHB1dChncGlvLCAwKTsKKwlncGlv
ZF9zZXRfdmFsdWVfY2Fuc2xlZXAoZ3BpbywgMCk7CisJYnJlYWs7CisJZGVmYXVsdDoKKwlyZXR1
cm4gLUVJTlZBTDsKKwl9CisJcmV0dXJuIHJldHZhbDsKK30KKworc3RhdGljIHZvaWQgbWlrcm9i
dXNfc3BpX2RldmljZV9kZWxldGUoc3RydWN0IHNwaV9tYXN0ZXIgKm1hc3RlciwgdW5zaWduZWQg
aW50IGNzKQoreworCXN0cnVjdCBkZXZpY2UgKmRldjsKKwljaGFyIHN0clszMl07CisKKwlzbnBy
aW50ZihzdHIsIHNpemVvZihzdHIpLCAiJXMuJXUiLCBkZXZfbmFtZSgmbWFzdGVyLT5kZXYpLCBj
cyk7CisJZGV2ID0gYnVzX2ZpbmRfZGV2aWNlX2J5X25hbWUoJnNwaV9idXNfdHlwZSwgTlVMTCwg
c3RyKTsKKwlpZiAoZGV2ICE9IE5VTEwpIHsKKwkJc3BpX3VucmVnaXN0ZXJfZGV2aWNlKHRvX3Nw
aV9kZXZpY2UoZGV2KSk7CisJCXB1dF9kZXZpY2UoZGV2KTsKKwl9Cit9CisKK3N0YXRpYyBjaGFy
ICptaWtyb2J1c19nZXRfZ3Bpb19jaGlwX25hbWUoc3RydWN0IG1pa3JvYnVzX3BvcnQgKnBvcnQs
IGludCBncGlvKQoreworCWNoYXIgKm5hbWU7CisJc3RydWN0IGdwaW9fY2hpcCAqZ3Bpb2NoaXA7
CisKKwlzd2l0Y2ggKGdwaW8pIHsKKwljYXNlIE1JS1JPQlVTX0dQSU9fSU5UOgorCWdwaW9jaGlw
ID0gZ3Bpb2RfdG9fY2hpcChwb3J0LT5pbnRfZ3Bpbyk7CisJbmFtZSA9IGttZW1kdXAoZ3Bpb2No
aXAtPmxhYmVsLCA0MCwgR0ZQX0tFUk5FTCk7CisJYnJlYWs7CisJY2FzZSBNSUtST0JVU19HUElP
X1JTVDoKKwlncGlvY2hpcCA9IGdwaW9kX3RvX2NoaXAocG9ydC0+cnN0X2dwaW8pOworCW5hbWUg
PSBrbWVtZHVwKGdwaW9jaGlwLT5sYWJlbCwgNDAsIEdGUF9LRVJORUwpOworCWJyZWFrOworCWNh
c2UgTUlLUk9CVVNfR1BJT19QV006CisJZ3Bpb2NoaXAgPSBncGlvZF90b19jaGlwKHBvcnQtPnB3
bV9ncGlvKTsKKwluYW1lID0ga21lbWR1cChncGlvY2hpcC0+bGFiZWwsIDQwLCBHRlBfS0VSTkVM
KTsKKwlicmVhazsKKwl9CisJcmV0dXJuIG5hbWU7Cit9CisKK3N0YXRpYyBpbnQgbWlrcm9idXNf
Z2V0X2dwaW9faHdudW0oc3RydWN0IG1pa3JvYnVzX3BvcnQgKnBvcnQsIGludCBncGlvKQorewor
CWludCBod251bTsKKwlzdHJ1Y3QgZ3Bpb19jaGlwICpncGlvY2hpcDsKKworCXN3aXRjaCAoZ3Bp
bykgeworCWNhc2UgTUlLUk9CVVNfR1BJT19JTlQ6CisJZ3Bpb2NoaXAgPSBncGlvZF90b19jaGlw
KHBvcnQtPmludF9ncGlvKTsKKwlod251bSA9IGRlc2NfdG9fZ3Bpbyhwb3J0LT5pbnRfZ3Bpbykg
LSBncGlvY2hpcC0+YmFzZTsKKwlicmVhazsKKwljYXNlIE1JS1JPQlVTX0dQSU9fUlNUOgorCWdw
aW9jaGlwID0gZ3Bpb2RfdG9fY2hpcChwb3J0LT5yc3RfZ3Bpbyk7CisJaHdudW0gPSBkZXNjX3Rv
X2dwaW8ocG9ydC0+cnN0X2dwaW8pIC0gZ3Bpb2NoaXAtPmJhc2U7CisJYnJlYWs7CisJY2FzZSBN
SUtST0JVU19HUElPX1BXTToKKwlncGlvY2hpcCA9IGdwaW9kX3RvX2NoaXAocG9ydC0+cHdtX2dw
aW8pOworCWh3bnVtID0gZGVzY190b19ncGlvKHBvcnQtPnB3bV9ncGlvKSAtIGdwaW9jaGlwLT5i
YXNlOworCWJyZWFrOworCX0KKwlyZXR1cm4gaHdudW07Cit9CisKK3N0YXRpYyB2b2lkIHJlbGVh
c2VfbWlrcm9idXNfZGV2aWNlKHN0cnVjdCBib2FyZF9kZXZpY2VfaW5mbyAqZGV2KQoreworCWxp
c3RfZGVsKCZkZXYtPmxpbmtzKTsKKwlrZnJlZShkZXYpOworfQorCitzdGF0aWMgdm9pZCByZWxl
YXNlX2JvYXJkX2RldmljZXMoc3RydWN0IGFkZG9uX2JvYXJkX2luZm8gKmluZm8pCit7CisJc3Ry
dWN0IGJvYXJkX2RldmljZV9pbmZvICpkZXY7CisJc3RydWN0IGJvYXJkX2RldmljZV9pbmZvICpu
ZXh0OworCisJbGlzdF9mb3JfZWFjaF9lbnRyeV9zYWZlKGRldiwgbmV4dCwgJmluZm8tPmRldmlj
ZXMsIGxpbmtzKQorCQlyZWxlYXNlX21pa3JvYnVzX2RldmljZShkZXYpOworfQorCitzdGF0aWMg
aW50IG1pa3JvYnVzX3JlZ2lzdGVyX2RldmljZShzdHJ1Y3QgbWlrcm9idXNfcG9ydCAqcG9ydCwK
KwkJCQkJc3RydWN0IGJvYXJkX2RldmljZV9pbmZvICpkZXYsIGNoYXIgKmJvYXJkX25hbWUpCit7
CisJc3RydWN0IGkyY19ib2FyZF9pbmZvICppMmM7CisJc3RydWN0IHNwaV9ib2FyZF9pbmZvICpz
cGk7CisJc3RydWN0IGdwaW9kX2xvb2t1cF90YWJsZSAqbG9va3VwOworCWNoYXIgZGV2bmFtZVs0
MF07CisJaW50IGk7CisKKwlwcl9pbmZvKCIgcmVnaXN0ZXJpbmcgZGV2aWNlIDogJXNcbiIsIGRl
di0+ZHJ2X25hbWUpOworCisJaWYgKGRldi0+Z3Bpb19sb29rdXAgIT0gTlVMTCkgeworCQlsb29r
dXAgPSBkZXYtPmdwaW9fbG9va3VwOworCQlpZiAoZGV2LT5wcm90b2NvbCA9PSBNSUtST0JVU19Q
Uk9UT0NPTF9TUEkpIHsKKwkJCXNucHJpbnRmKGRldm5hbWUsIHNpemVvZihkZXZuYW1lKSwgIiVz
LiV1IiwKKwkJCQlkZXZfbmFtZSgmcG9ydC0+c3BpX21zdHItPmRldiksIGRldi0+cmVnKTsKKwkJ
CWxvb2t1cC0+ZGV2X2lkID0ga21lbWR1cChkZXZuYW1lLCA0MCwgR0ZQX0tFUk5FTCk7CisJCX0g
ZWxzZSBpZiAoZGV2LT5wcm90b2NvbCA9PSBNSUtST0JVU19QUk9UT0NPTF9JMkMpCisJCQlsb29r
dXAtPmRldl9pZCA9IGRldi0+ZHJ2X25hbWU7CisJCXByX2luZm8oIiBhZGRpbmcgbG9va3VwIHRh
YmxlIDogJXNcbiIsIGxvb2t1cC0+ZGV2X2lkKTsKKwkJZm9yIChpID0gMDsgaSA8IGRldi0+bnVt
X2dwaW9fcmVzb3VyY2VzOyBpKyspIHsKKwkJCWxvb2t1cC0+dGFibGVbaV0ua2V5ID0KKwkJCW1p
a3JvYnVzX2dldF9ncGlvX2NoaXBfbmFtZShwb3J0LCBsb29rdXAtPnRhYmxlW2ldLmNoaXBfaHdu
dW0pOworCQkJbG9va3VwLT50YWJsZVtpXS5jaGlwX2h3bnVtID0KKwkJCW1pa3JvYnVzX2dldF9n
cGlvX2h3bnVtKHBvcnQsIGxvb2t1cC0+dGFibGVbaV0uY2hpcF9od251bSk7CisJCQlsb29rdXAt
PnRhYmxlW2ldLmZsYWdzID0gR1BJT19BQ1RJVkVfSElHSDsKKwkJfQorCQlncGlvZF9hZGRfbG9v
a3VwX3RhYmxlKGxvb2t1cCk7CisJfQorCXN3aXRjaCAoZGV2LT5wcm90b2NvbCkgeworCWNhc2Ug
TUlLUk9CVVNfUFJPVE9DT0xfU1BJOgorCXNwaSA9IGt6YWxsb2Moc2l6ZW9mKCpzcGkpLCBHRlBf
S0VSTkVMKTsKKwlpZiAoIXNwaSkKKwkJcmV0dXJuIC1FTk9NRU07CisJc3RybmNweShzcGktPm1v
ZGFsaWFzLCBkZXYtPmRydl9uYW1lLCBzaXplb2Yoc3BpLT5tb2RhbGlhcykgLSAxKTsKKwlpZiAo
ZGV2LT5pcnEpCisJCXNwaS0+aXJxID0gbWlrcm9idXNfZ2V0X2lycShwb3J0LCBkZXYtPmlycSwg
ZGV2LT5pcnFfdHlwZSk7CisJaWYgKGRldi0+cHJvcGVydGllcykKKwkJc3BpLT5wcm9wZXJ0aWVz
ID0gZGV2LT5wcm9wZXJ0aWVzOworCXNwaS0+Y2hpcF9zZWxlY3QgPSBkZXYtPnJlZzsKKwlzcGkt
Pm1heF9zcGVlZF9oeiA9IGRldi0+bWF4X3NwZWVkX2h6OworCXNwaS0+bW9kZSA9IGRldi0+bW9k
ZTsKKwltaWtyb2J1c19zcGlfZGV2aWNlX2RlbGV0ZShwb3J0LT5zcGlfbXN0ciwgZGV2LT5yZWcp
OworCWRldi0+ZGV2X2NsaWVudCA9ICh2b2lkICopc3BpX25ld19kZXZpY2UocG9ydC0+c3BpX21z
dHIsIHNwaSk7CisJYnJlYWs7CisJY2FzZSBNSUtST0JVU19QUk9UT0NPTF9JMkM6CisJaTJjID0g
a3phbGxvYyhzaXplb2YoKmkyYyksIEdGUF9LRVJORUwpOworCWlmICghaTJjKQorCQlyZXR1cm4g
LUVOT01FTTsKKwlzdHJuY3B5KGkyYy0+dHlwZSwgZGV2LT5kcnZfbmFtZSwgc2l6ZW9mKGkyYy0+
dHlwZSkgLSAxKTsKKwlpZiAoZGV2LT5pcnEpCisJCWkyYy0+aXJxID0gbWlrcm9idXNfZ2V0X2ly
cShwb3J0LCBkZXYtPmlycSwgZGV2LT5pcnFfdHlwZSk7CisJaWYgKGRldi0+cHJvcGVydGllcykK
KwkJaTJjLT5wcm9wZXJ0aWVzID0gZGV2LT5wcm9wZXJ0aWVzOworCWkyYy0+YWRkciA9IGRldi0+
cmVnOworCWRldi0+ZGV2X2NsaWVudCA9ICh2b2lkICopaTJjX25ld19jbGllbnRfZGV2aWNlKHBv
cnQtPmkyY19hZGFwLCBpMmMpOworCWJyZWFrOworCWNhc2UgTUlLUk9CVVNfUFJPVE9DT0xfVUFS
VDoKKwlwcl9pbmZvKCJTRVJERVYgZGV2aWNlcyBzdXBwb3J0IG5vdCB5ZXQgYWRkZWQiKTsKKwli
cmVhazsKKwlkZWZhdWx0OgorCXJldHVybiAtRUlOVkFMOworCX0KKwlyZXR1cm4gMDsKK30KKwor
c3RhdGljIHZvaWQgbWlrcm9idXNfdW5yZWdpc3Rlcl9kZXZpY2Uoc3RydWN0IG1pa3JvYnVzX3Bv
cnQgKnBvcnQsIHN0cnVjdCBib2FyZF9kZXZpY2VfaW5mbyAqZGV2LAorCQkJCQkJCQkJCWNoYXIg
KmJvYXJkX25hbWUpCit7CisJcHJfaW5mbygiIHJlbW92aW5nIGRldmljZSA6ICVzXG4iLCBkZXYt
PmRydl9uYW1lKTsKKwlpZiAoZGV2LT5ncGlvX2xvb2t1cCAhPSBOVUxMKSB7CisJCWdwaW9kX3Jl
bW92ZV9sb29rdXBfdGFibGUoZGV2LT5ncGlvX2xvb2t1cCk7CisJCWtmcmVlKGRldi0+Z3Bpb19s
b29rdXApOworCX0KKwlpZiAoZGV2LT5wcm9wZXJ0aWVzICE9IE5VTEwpCisJCWtmcmVlKGRldi0+
cHJvcGVydGllcyk7CisJc3dpdGNoIChkZXYtPnByb3RvY29sKSB7CisJY2FzZSBNSUtST0JVU19Q
Uk9UT0NPTF9TUEk6CisJc3BpX3VucmVnaXN0ZXJfZGV2aWNlKChzdHJ1Y3Qgc3BpX2RldmljZSAq
KWRldi0+ZGV2X2NsaWVudCk7CisJYnJlYWs7CisJY2FzZSBNSUtST0JVU19QUk9UT0NPTF9JMkM6
CisJaTJjX3VucmVnaXN0ZXJfZGV2aWNlKChzdHJ1Y3QgaTJjX2NsaWVudCAqKWRldi0+ZGV2X2Ns
aWVudCk7CisJYnJlYWs7CisJY2FzZSBNSUtST0JVU19QUk9UT0NPTF9VQVJUOgorCXByX2Vycigi
U0VSREVWIGRldmljZXMgc3VwcG9ydCBub3QgeWV0IGFkZGVkIik7CisJYnJlYWs7CisJfQorfQor
CitpbnQgbWlrcm9idXNfcmVnaXN0ZXJfYm9hcmQoc3RydWN0IG1pa3JvYnVzX3BvcnQgKnBvcnQs
CXN0cnVjdCBhZGRvbl9ib2FyZF9pbmZvICpib2FyZCkKK3sKKwlzdHJ1Y3QgYm9hcmRfZGV2aWNl
X2luZm8gKmRldmluZm87CisJc3RydWN0IGJvYXJkX2RldmljZV9pbmZvICpuZXh0OworCWludCBy
ZXR2YWw7CisKKwlpZiAoV0FSTl9PTihsaXN0X2VtcHR5KCZib2FyZC0+ZGV2aWNlcykpKQorCQly
ZXR1cm4gZmFsc2U7CisKKwlyZXR2YWwgPSBtaWtyb2J1c19zZXR1cF9ncGlvKHBvcnQtPnB3bV9n
cGlvLCBib2FyZC0+cHdtX2dwaW9fc3RhdGUpOworCWlmIChyZXR2YWwpIHsKKwkJcHJfZXJyKCJt
aWtyb2J1c19zZXR1cF9ncGlvIDogY2FuJ3Qgc2V0dXAgcHdtIGdwaW8gc3RhdGU6ICglZClcbiIs
IHJldHZhbCk7CisJCXJldHVybiByZXR2YWw7CisJfQorCXJldHZhbCA9IG1pa3JvYnVzX3NldHVw
X2dwaW8ocG9ydC0+aW50X2dwaW8sIGJvYXJkLT5pbnRfZ3Bpb19zdGF0ZSk7CisJaWYgKHJldHZh
bCkgeworCQlwcl9lcnIoIm1pa3JvYnVzX3NldHVwX2dwaW8gOiBjYW4ndCBzZXR1cCBpbnQgZ3Bp
byBzdGF0ZTogKCVkKVxuIiwgcmV0dmFsKTsKKwkJcmV0dXJuIHJldHZhbDsKKwl9CisJcmV0dmFs
ID0gbWlrcm9idXNfc2V0dXBfZ3Bpbyhwb3J0LT5yc3RfZ3BpbywgYm9hcmQtPnJzdF9ncGlvX3N0
YXRlKTsKKwlpZiAocmV0dmFsKSB7CisJCXByX2VycigibWlrcm9idXNfc2V0dXBfZ3BpbyA6IGNh
bid0IHNldHVwIHJzdCBncGlvIHN0YXRlOiAoJWQpXG4iLCByZXR2YWwpOworCQlyZXR1cm4gcmV0
dmFsOworCX0KKwlsaXN0X2Zvcl9lYWNoX2VudHJ5X3NhZmUoZGV2aW5mbywgbmV4dCwgJmJvYXJk
LT5kZXZpY2VzLCBsaW5rcykKKwkJbWlrcm9idXNfcmVnaXN0ZXJfZGV2aWNlKHBvcnQsIGRldmlu
Zm8sIGJvYXJkLT5uYW1lKTsKKwlwb3J0LT5ib2FyZCA9IGJvYXJkOworCXJldHVybiAwOworfQor
RVhQT1JUX1NZTUJPTF9HUEwobWlrcm9idXNfcmVnaXN0ZXJfYm9hcmQpOworCit2b2lkIG1pa3Jv
YnVzX3VucmVnaXN0ZXJfYm9hcmQoc3RydWN0IG1pa3JvYnVzX3BvcnQgKnBvcnQsIHN0cnVjdCBh
ZGRvbl9ib2FyZF9pbmZvICpib2FyZCkKK3sKKwlzdHJ1Y3QgYm9hcmRfZGV2aWNlX2luZm8gKmRl
dmluZm87CisJc3RydWN0IGJvYXJkX2RldmljZV9pbmZvICpuZXh0OworCisJaWYgKFdBUk5fT04o
bGlzdF9lbXB0eSgmYm9hcmQtPmRldmljZXMpKSkKKwkJcmV0dXJuOworCXBvcnQtPmJvYXJkID0g
TlVMTDsKKwlsaXN0X2Zvcl9lYWNoX2VudHJ5X3NhZmUoZGV2aW5mbywgbmV4dCwgJmJvYXJkLT5k
ZXZpY2VzLCBsaW5rcykKKwkJbWlrcm9idXNfdW5yZWdpc3Rlcl9kZXZpY2UocG9ydCwgZGV2aW5m
bywgYm9hcmQtPm5hbWUpOworCXJlbGVhc2VfYm9hcmRfZGV2aWNlcyhib2FyZCk7CisJa2ZyZWUo
Ym9hcmQpOworCXBvcnQtPmJvYXJkID0gTlVMTDsKK30KK0VYUE9SVF9TWU1CT0xfR1BMKG1pa3Jv
YnVzX3VucmVnaXN0ZXJfYm9hcmQpOworCitpbnQgbWlrcm9idXNfcmVnaXN0ZXJfcG9ydF9jb25m
aWcoc3RydWN0IG1pa3JvYnVzX3BvcnRfY29uZmlnICpjZmcpCit7CisJc3RydWN0IG1pa3JvYnVz
X3BvcnQgKnBvcnQ7CisJaW50IHJldHZhbDsKKworCWlmIChXQVJOX09OKCFpc19yZWdpc3RlcmVk
KSkKKwkJcmV0dXJuIC1FQUdBSU47CisJcG9ydCA9IGt6YWxsb2Moc2l6ZW9mKCpwb3J0KSwgR0ZQ
X0tFUk5FTCk7CisJaWYgKCFwb3J0KQorCQlyZXR1cm4gLUVOT01FTTsKKwlwb3J0LT5wd21fZ3Bp
byA9IGdwaW9fdG9fZGVzYyhjZmctPnB3bV9ncGlvX25yKTsKKwlwb3J0LT5pbnRfZ3BpbyA9IGdw
aW9fdG9fZGVzYyhjZmctPmludF9ncGlvX25yKTsKKwlwb3J0LT5yc3RfZ3BpbyA9IGdwaW9fdG9f
ZGVzYyhjZmctPnJzdF9ncGlvX25yKTsKKwlwb3J0LT5zcGlfbXN0ciA9IHNwaV9idXNudW1fdG9f
bWFzdGVyKGNmZy0+c3BpX21hc3Rlcl9ucik7CisJcG9ydC0+aTJjX2FkYXAgPSBpMmNfZ2V0X2Fk
YXB0ZXIoY2ZnLT5pMmNfYWRhcF9ucik7CisJcmV0dmFsID0gbWlrcm9idXNfcmVnaXN0ZXJfcG9y
dChwb3J0KTsKKwlpZiAocmV0dmFsKSB7CisJCXByX2VycigicG9ydCA6IGNhbid0IHJlZ2lzdGVy
IHBvcnQgZnJvbSBjb25maWcgKCVkKVxuIiwgcmV0dmFsKTsKKwkJcmV0dXJuIHJldHZhbDsKKwl9
CisJcmV0dXJuIHJldHZhbDsKK30KK0VYUE9SVF9TWU1CT0xfR1BMKG1pa3JvYnVzX3JlZ2lzdGVy
X3BvcnRfY29uZmlnKTsKKworc3RhdGljIHN0cnVjdCBpMmNfYm9hcmRfaW5mbyBtaWtyb2J1c19l
ZXByb21faW5mbyA9IHsKKwlJMkNfQk9BUkRfSU5GTygiMjRjMzIiLCBBVE1FTF8yNEMzMl9JMkNf
QUREUiksCit9OworCitzdGF0aWMgaW50IG1pa3JvYnVzX3BvcnRfcHJvYmVfZWVwcm9tKHN0cnVj
dCBtaWtyb2J1c19wb3J0ICpwb3J0KQoreworCXN0cnVjdCBpMmNfY2xpZW50ICplZXByb21fY2xp
ZW50OworCXN0cnVjdCBudm1lbV9kZXZpY2UgKmVlcHJvbTsKKwljaGFyIGRldl9uYW1lWzQwXTsK
KworCWVlcHJvbV9jbGllbnQgPSBpMmNfbmV3X2NsaWVudF9kZXZpY2UocG9ydC0+aTJjX2FkYXAs
ICZtaWtyb2J1c19lZXByb21faW5mbyk7CisJaWYgKCFJU19FUlIoZWVwcm9tX2NsaWVudCkpIHsK
KwkJcHJfaW5mbygiIG1pa3JvYnVzIHBvcnQgJWQgZGVmYXVsdCBlZXByb20gaXMgcHJvYmVkIGF0
ICUwMnhcbiIsIHBvcnQtPmlkLAorCQkJCQkJCQkJZWVwcm9tX2NsaWVudC0+YWRkcik7CisJCXNu
cHJpbnRmKGRldl9uYW1lLCBzaXplb2YoZGV2X25hbWUpLCAiJWQtJTA0eDAiLCBwb3J0LT5pMmNf
YWRhcC0+bnIsCisJCQkJIGVlcHJvbV9jbGllbnQtPmFkZHIpOworCQllZXByb20gPSBudm1lbV9k
ZXZpY2VfZ2V0KCZlZXByb21fY2xpZW50LT5kZXYsIGRldl9uYW1lKTsKKwkJaWYgKElTX0VSUihl
ZXByb20pKSB7CisJCQlwcl9lcnIoIiBtaWtyb2J1cyBwb3J0ICVkIGVlcHJvbSBudm1lbSBkZXZp
Y2UgcHJvYmUgZmFpbGVkXG4iLCBwb3J0LT5pZCk7CisJCQlpMmNfdW5yZWdpc3Rlcl9kZXZpY2Uo
ZWVwcm9tX2NsaWVudCk7CisJCQlwb3J0LT5lZXByb20gPSBOVUxMOworCQkJcmV0dXJuIDA7CisJ
CX0KKwl9IGVsc2UgeworCQlwcl9pbmZvKCIgbWlrcm9idXMgcG9ydCAlZCBkZWZhdWx0IGVlcHJv
bSBwcm9iZSBmYWlsZWRcbiIsIHBvcnQtPmlkKTsKKwkJcmV0dXJuIDA7CisJfQorCXBvcnQtPmVl
cHJvbSA9IGVlcHJvbTsKKwlwb3J0LT5lZXByb21fY2xpZW50ID0gZWVwcm9tX2NsaWVudDsKKwly
ZXR1cm4gMDsKK30KKworaW50IG1pa3JvYnVzX3JlZ2lzdGVyX3BvcnQoc3RydWN0IG1pa3JvYnVz
X3BvcnQgKnBvcnQpCit7CisJaW50IHJldHZhbDsKKwlpbnQgaWQ7CisKKwlpZiAoV0FSTl9PTigh
aXNfcmVnaXN0ZXJlZCkpCisJCXJldHVybiAtRUFHQUlOOworCWlkID0gaWRyX2FsbG9jKCZtaWty
b2J1c19wb3J0X2lkciwgcG9ydCwgMCwgMCwgR0ZQX0tFUk5FTCk7CisJaWYgKGlkIDwgMCkKKwkJ
cmV0dXJuIGlkOworCXBvcnQtPmlkID0gaWQ7CisJcG9ydC0+ZGV2LmJ1cyA9ICZtaWtyb2J1c19i
dXNfdHlwZTsKKwlwb3J0LT5kZXYudHlwZSA9ICZtaWtyb2J1c19wb3J0X3R5cGU7CisJc3RybmNw
eShwb3J0LT5uYW1lLCAibWlrcm9idXMtcG9ydCIsIHNpemVvZihwb3J0LT5uYW1lKSAtIDEpOwor
CWRldl9zZXRfbmFtZSgmcG9ydC0+ZGV2LCAibWlrcm9idXMtJWQiLCBwb3J0LT5pZCk7CisJcHJf
aW5mbygicmVnaXN0ZXJpbmcgcG9ydCBtaWtyb2J1cy0lZFxuICIsIHBvcnQtPmlkKTsKKwlyZXR2
YWwgPSBkZXZpY2VfcmVnaXN0ZXIoJnBvcnQtPmRldik7CisJaWYgKHJldHZhbCkgeworCQlwcl9l
cnIoInBvcnQgJyVkJzogY2FuJ3QgcmVnaXN0ZXIgZGV2aWNlICglZClcbiIsIHBvcnQtPmlkLCBy
ZXR2YWwpOworCQlwdXRfZGV2aWNlKCZwb3J0LT5kZXYpOworCQlyZXR1cm4gcmV0dmFsOworCX0K
KwlyZXR2YWwgPSBjbGFzc19jb21wYXRfY3JlYXRlX2xpbmsobWlrcm9idXNfcG9ydF9jb21wYXRf
Y2xhc3MsICZwb3J0LT5kZXYsCisJCQkJCQkJCXBvcnQtPmRldi5wYXJlbnQpOworCWlmIChyZXR2
YWwpCisJCWRldl93YXJuKCZwb3J0LT5kZXYsICJmYWlsZWQgdG8gY3JlYXRlIGNvbXBhdGliaWxp
dHkgY2xhc3MgbGlua1xuIik7CisJaWYgKCFwb3J0LT5lZXByb20pIHsKKwkJcHJfaW5mbygibWlr
cm9idXMgcG9ydCAlZCBlZXByb20gZW1wdHkgcHJvYmluZyBkZWZhdWx0IGVlcHJvbVxuIiwgcG9y
dC0+aWQpOworCQlyZXR2YWwgPSBtaWtyb2J1c19wb3J0X3Byb2JlX2VlcHJvbShwb3J0KTsKKwl9
CisJaWYgKHBvcnQtPmVlcHJvbSkgeworCQlyZXR2YWwgPSBtaWtyb2J1c19wb3J0X3NjYW5fZWVw
cm9tKHBvcnQpOworCQlpZiAocmV0dmFsKQorCQkJZGV2X3dhcm4oJnBvcnQtPmRldiwgImZhaWxl
ZCB0byByZWdpc3RlciBib2FyZCBmcm9tIG1hbmlmZXN0XG4iKTsKKwl9CisJcmV0dXJuIHJldHZh
bDsKK30KK0VYUE9SVF9TWU1CT0xfR1BMKG1pa3JvYnVzX3JlZ2lzdGVyX3BvcnQpOworCit2b2lk
IG1pa3JvYnVzX2RlbF9wb3J0KHN0cnVjdCBtaWtyb2J1c19wb3J0ICpwb3J0KQoreworCXN0cnVj
dCBtaWtyb2J1c19wb3J0ICpmb3VuZDsKKworCWZvdW5kID0gaWRyX2ZpbmQoJm1pa3JvYnVzX3Bv
cnRfaWRyLCBwb3J0LT5pZCk7CisJaWYgKGZvdW5kICE9IHBvcnQpIHsKKwkJcHJfZXJyKCJhdHRl
bXB0aW5nIHRvIGRlbGV0ZSB1bnJlZ2lzdGVyZWQgcG9ydCBbJXNdXG4iLCBwb3J0LT5uYW1lKTsK
KwkJcmV0dXJuOworCX0KKwlpZiAocG9ydC0+Ym9hcmQgIT0gTlVMTCkgeworCQlwcl9lcnIoImF0
dGVtcHRpbmcgdG8gZGVsZXRlIHBvcnQgd2l0aCByZWdpc3RlcmVkIGJvYXJkcywgcG9ydCBbJXNd
XG4iLAorCQkJCQkJCQkJcG9ydC0+bmFtZSk7CisJCXJldHVybjsKKwl9CisKKwlpZiAocG9ydC0+
ZWVwcm9tKSB7CisJCW52bWVtX2RldmljZV9wdXQocG9ydC0+ZWVwcm9tKTsKKwkJaTJjX3VucmVn
aXN0ZXJfZGV2aWNlKHBvcnQtPmVlcHJvbV9jbGllbnQpOworCX0KKworCWNsYXNzX2NvbXBhdF9y
ZW1vdmVfbGluayhtaWtyb2J1c19wb3J0X2NvbXBhdF9jbGFzcywgJnBvcnQtPmRldiwKKwkJCQkJ
CQlwb3J0LT5kZXYucGFyZW50KTsKKwlkZXZpY2VfdW5yZWdpc3RlcigmcG9ydC0+ZGV2KTsKKwlp
ZHJfcmVtb3ZlKCZtaWtyb2J1c19wb3J0X2lkciwgcG9ydC0+aWQpOworCW1lbXNldCgmcG9ydC0+
ZGV2LCAwLCBzaXplb2YocG9ydC0+ZGV2KSk7Cit9CitFWFBPUlRfU1lNQk9MX0dQTChtaWtyb2J1
c19kZWxfcG9ydCk7CisKK3N0YXRpYyBpbnQgX19pbml0IG1pa3JvYnVzX2luaXQodm9pZCkKK3sK
KwlpbnQgcmV0dmFsOworCisJcmV0dmFsID0gYnVzX3JlZ2lzdGVyKCZtaWtyb2J1c19idXNfdHlw
ZSk7CisJaWYgKHJldHZhbCkgeworCQlwcl9lcnIoImJ1c19yZWdpc3RlciBmYWlsZWQgKCVkKVxu
IiwgcmV0dmFsKTsKKwkJcmV0dXJuIHJldHZhbDsKKwl9CisJbWlrcm9idXNfcG9ydF9jb21wYXRf
Y2xhc3MgPSBjbGFzc19jb21wYXRfcmVnaXN0ZXIoIm1pa3JvYnVzLXBvcnQiKTsKKwlpZiAoIW1p
a3JvYnVzX3BvcnRfY29tcGF0X2NsYXNzKSB7CisJCXByX2VycigiY2xhc3NfY29tcGF0IHJlZ2lz
dGVyIGZhaWxlZCAoJWQpXG4iLCByZXR2YWwpOworCQlyZXR2YWwgPSAtRU5PTUVNOworCQlnb3Rv
IGNsYXNzX2VycjsKKwl9CisJaXNfcmVnaXN0ZXJlZCA9IHRydWU7CisJcmV0dXJuIDA7CitjbGFz
c19lcnI6CisJYnVzX3VucmVnaXN0ZXIoJm1pa3JvYnVzX2J1c190eXBlKTsKKwlpZHJfZGVzdHJv
eSgmbWlrcm9idXNfcG9ydF9pZHIpOworCWlzX3JlZ2lzdGVyZWQgPSBmYWxzZTsKKwlyZXR1cm4g
cmV0dmFsOworfQorc3Vic3lzX2luaXRjYWxsKG1pa3JvYnVzX2luaXQpOworCitzdGF0aWMgdm9p
ZCBfX2V4aXQgbWlrcm9idXNfZXhpdCh2b2lkKQoreworCWJ1c191bnJlZ2lzdGVyKCZtaWtyb2J1
c19idXNfdHlwZSk7CisJY2xhc3NfY29tcGF0X3VucmVnaXN0ZXIobWlrcm9idXNfcG9ydF9jb21w
YXRfY2xhc3MpOworCWlkcl9kZXN0cm95KCZtaWtyb2J1c19wb3J0X2lkcik7Cit9Cittb2R1bGVf
ZXhpdChtaWtyb2J1c19leGl0KTsKKworTU9EVUxFX0FVVEhPUigiVmFpc2huYXYgTSBBIDx2YWlz
aG5hdkBiZWFnbGVib2FyZC5vcmc+Iik7CitNT0RVTEVfREVTQ1JJUFRJT04oIm1pa3JvQlVTIG1h
aW4gbW9kdWxlIik7CitNT0RVTEVfTElDRU5TRSgiR1BMIHYyIik7CmRpZmYgLS1naXQgYS9kcml2
ZXJzL21pc2MvbWlrcm9idXMvbWlrcm9idXNfY29yZS5oIGIvZHJpdmVycy9taXNjL21pa3JvYnVz
L21pa3JvYnVzX2NvcmUuaApuZXcgZmlsZSBtb2RlIDEwMDY0NAppbmRleCAwMDAwMDAwMDAwMDAu
Ljk2ODRkMzE1ZjU2NAotLS0gL2Rldi9udWxsCisrKyBiL2RyaXZlcnMvbWlzYy9taWtyb2J1cy9t
aWtyb2J1c19jb3JlLmgKQEAgLTAsMCArMSwxMzAgQEAKKy8qIFNQRFgtTGljZW5zZS1JZGVudGlm
aWVyOiBHUEwtMi4wICovCisvKgorICogbWlrcm9CVVMgRHJpdmVyIGZvciBpbnN0YW50aWF0aW5n
IGFkZC1vbgorICogYm9hcmQgZGV2aWNlcyB3aXRoIGFuIGlkZW50aWZpZXIgRUVQUk9NCisgKgor
ICogQ29weXJpZ2h0IDIwMjAgVmFpc2huYXYgTSBBLCBCZWFnbGVCb2FyZC5vcmcgRm91bmRhdGlv
bi4KKyAqLworCisjaWZuZGVmIF9fTUlLUk9CVVNfSAorI2RlZmluZSBfX01JS1JPQlVTX0gKKwor
I2luY2x1ZGUgPGxpbnV4L2Vyci5oPgorI2luY2x1ZGUgPGxpbnV4L2Vycm5vLmg+CisjaW5jbHVk
ZSA8bGludXgvaTJjLmg+CisjaW5jbHVkZSA8bGludXgvZ3Bpby5oPgorI2luY2x1ZGUgPGxpbnV4
L2dwaW8vY29uc3VtZXIuaD4KKyNpbmNsdWRlIDxsaW51eC9ncGlvL21hY2hpbmUuaD4KKyNpbmNs
dWRlIDxsaW51eC9zcGkvc3BpLmg+CisjaW5jbHVkZSA8bGludXgvaWRyLmg+CisjaW5jbHVkZSA8
bGludXgvaW5pdC5oPgorI2luY2x1ZGUgPGxpbnV4L2p1bXBfbGFiZWwuaD4KKyNpbmNsdWRlIDxs
aW51eC9rZXJuZWwuaD4KKyNpbmNsdWRlIDxsaW51eC9tb2R1bGUuaD4KKyNpbmNsdWRlIDxsaW51
eC9tdXRleC5oPgorI2luY2x1ZGUgPGxpbnV4L2RldmljZS5oPgorI2luY2x1ZGUgPGxpbnV4L29m
X2RldmljZS5oPgorI2luY2x1ZGUgPGxpbnV4L3NlcmRldi5oPgorI2luY2x1ZGUgPGxpbnV4L29m
Lmg+CisjaW5jbHVkZSA8bGludXgvcHJvcGVydHkuaD4KKyNpbmNsdWRlIDxsaW51eC9zbGFiLmg+
CisKKyNkZWZpbmUgTUlLUk9CVVNfVkVSU0lPTl9NQUpPUiAweDAwCisjZGVmaW5lIE1JS1JPQlVT
X1ZFUlNJT05fTUlOT1IgMHgwMgorCitleHRlcm4gc3RydWN0IGJ1c190eXBlIG1pa3JvYnVzX2J1
c190eXBlOworZXh0ZXJuIHN0cnVjdCBkZXZpY2VfdHlwZSBtaWtyb2J1c19wb3J0X3R5cGU7CisK
K2VudW0gbWlrcm9idXNfcHJvcGVydHlfdHlwZSB7CisJTUlLUk9CVVNfUFJPUEVSVFlfVFlQRV9M
SU5LID0gMHgwMCwKKwlNSUtST0JVU19QUk9QRVJUWV9UWVBFX0dQSU8gPSAweDAxLAorCU1JS1JP
QlVTX1BST1BFUlRZX1RZUEVfVTggPSAweDAyLAorCU1JS1JPQlVTX1BST1BFUlRZX1RZUEVfVTE2
ID0gMHgwMywKKwlNSUtST0JVU19QUk9QRVJUWV9UWVBFX1UzMiA9IDB4MDQsCisJTUlLUk9CVVNf
UFJPUEVSVFlfVFlQRV9VNjQgPSAweDA1LAorfTsKKworZW51bSBtaWtyb2J1c19ncGlvX3BpbiB7
CisJTUlLUk9CVVNfR1BJT19JTlZBTElEID0gMHgwMCwKKwlNSUtST0JVU19HUElPX0lOVCA9IDB4
MDEsCisJTUlLUk9CVVNfR1BJT19SU1QgPSAweDAyLAorCU1JS1JPQlVTX0dQSU9fUFdNID0gMHgw
MywKK307CisKK2VudW0gbWlrcm9idXNfcHJvdG9jb2wgeworCU1JS1JPQlVTX1BST1RPQ09MX1NQ
SSA9IDB4MDEsCisJTUlLUk9CVVNfUFJPVE9DT0xfSTJDID0gMHgwMiwKKwlNSUtST0JVU19QUk9U
T0NPTF9VQVJUID0gMHgwMywKKwlNSUtST0JVU19QUk9UT0NPTF9TUElfR1BJT0NTID0gMHgwNCwK
KwlNSUtST0JVU19QUk9UT0NPTF9JMkNfTVVYID0gMHgwNQorfTsKKworZW51bSBtaWtyb2J1c19n
cGlvX3N0YXRlIHsKKwlNSUtST0JVU19HUElPX1VOVVNFRCA9IDB4MDAsCisJTUlLUk9CVVNfR1BJ
T19JTlBVVCA9IDB4MDEsCisJTUlLUk9CVVNfR1BJT19PVVRQVVRfSElHSCA9IDB4MDIsCisJTUlL
Uk9CVVNfR1BJT19PVVRQVVRfTE9XID0gMHgwMywKK307CisKK3N0cnVjdCBtaWtyb2J1c19wb3J0
X2NvbmZpZyB7CisJX191OCBpMmNfYWRhcF9ucjsKKwlfX3U4IHNwaV9tYXN0ZXJfbnI7CisJX191
OCBzZXJkZXZfY3Rscl9ucjsKKwlfX3U4IHJzdF9ncGlvX25yOworCV9fdTggcHdtX2dwaW9fbnI7
CisJX191OCBpbnRfZ3Bpb19ucjsKK30gX19wYWNrZWQ7CisKK3N0cnVjdCBib2FyZF9kZXZpY2Vf
aW5mbyB7CisJc3RydWN0IGxpc3RfaGVhZCBsaW5rczsKKwlpbnQgaWQ7CisJY2hhciAqZHJ2X25h
bWU7CisJdW5zaWduZWQgc2hvcnQgcHJvdG9jb2w7CisJdW5zaWduZWQgc2hvcnQgcmVnOworCXUz
MiBtYXhfc3BlZWRfaHo7CisJdW5zaWduZWQgaW50IG1vZGU7CisJaW50IGlycTsKKwlpbnQgaXJx
X3R5cGU7CisJaW50IGNzX2dwaW87CisJdW5zaWduZWQgc2hvcnQgbnVtX2dwaW9fcmVzb3VyY2Vz
OworCXVuc2lnbmVkIHNob3J0IG51bV9wcm9wZXJ0aWVzOworCXN0cnVjdCBwcm9wZXJ0eV9lbnRy
eSAqcHJvcGVydGllczsKKwlzdHJ1Y3QgZ3Bpb2RfbG9va3VwX3RhYmxlICpncGlvX2xvb2t1cDsK
Kwl2b2lkICpkZXZfY2xpZW50OworfTsKKworc3RydWN0IGFkZG9uX2JvYXJkX2luZm8geworCWNo
YXIgKm5hbWU7CisJdW5zaWduZWQgc2hvcnQgbnVtX2RldmljZXM7CisJdW5zaWduZWQgc2hvcnQg
cnN0X2dwaW9fc3RhdGU7CisJdW5zaWduZWQgc2hvcnQgcHdtX2dwaW9fc3RhdGU7CisJdW5zaWdu
ZWQgc2hvcnQgaW50X2dwaW9fc3RhdGU7CisJc3RydWN0IGxpc3RfaGVhZCBtYW5pZmVzdF9kZXNj
czsKKwlzdHJ1Y3QgbGlzdF9oZWFkIGRldmljZXM7Cit9OworCitzdHJ1Y3QgbWlrcm9idXNfcG9y
dCB7CisJY2hhciBuYW1lWzQ4XTsKKwlzdHJ1Y3QgbW9kdWxlICpvd25lcjsKKwlzdHJ1Y3QgZGV2
aWNlIGRldjsKKwlpbnQgaWQ7CisJc3RydWN0IGdwaW9fZGVzYyAqcHdtX2dwaW87CisJc3RydWN0
IGdwaW9fZGVzYyAqaW50X2dwaW87CisJc3RydWN0IGdwaW9fZGVzYyAqcnN0X2dwaW87CisJc3Ry
dWN0IHNwaV9tYXN0ZXIgKnNwaV9tc3RyOworCXN0cnVjdCBpMmNfYWRhcHRlciAqaTJjX2FkYXA7
CisJc3RydWN0IGFkZG9uX2JvYXJkX2luZm8gKmJvYXJkOworCXN0cnVjdCBpMmNfY2xpZW50ICpl
ZXByb21fY2xpZW50OworCXN0cnVjdCBudm1lbV9kZXZpY2UgKmVlcHJvbTsKK307CisjZGVmaW5l
IHRvX21pa3JvYnVzX3BvcnQoZCkgY29udGFpbmVyX29mKGQsIHN0cnVjdCBtaWtyb2J1c19wb3J0
LCBkZXYpCisKK2ludCBtaWtyb2J1c19yZWdpc3Rlcl9ib2FyZChzdHJ1Y3QgbWlrcm9idXNfcG9y
dCAqcG9ydCwKKwkJCQkJCQlzdHJ1Y3QgYWRkb25fYm9hcmRfaW5mbyAqYm9hcmQpOwordm9pZCBt
aWtyb2J1c191bnJlZ2lzdGVyX2JvYXJkKHN0cnVjdCBtaWtyb2J1c19wb3J0ICpwb3J0LAorCQkJ
CQkJCSAgIHN0cnVjdCBhZGRvbl9ib2FyZF9pbmZvICpib2FyZCk7CitpbnQgbWlrcm9idXNfcmVn
aXN0ZXJfcG9ydF9jb25maWcoc3RydWN0IG1pa3JvYnVzX3BvcnRfY29uZmlnICpjZmcpOworaW50
IG1pa3JvYnVzX3JlZ2lzdGVyX3BvcnQoc3RydWN0IG1pa3JvYnVzX3BvcnQgKnBvcnQpOwordm9p
ZCBtaWtyb2J1c19kZWxfcG9ydChzdHJ1Y3QgbWlrcm9idXNfcG9ydCAqcG9ydCk7CisKKyNlbmRp
ZiAvKiBfX01JS1JPQlVTX0ggKi8KZGlmZiAtLWdpdCBhL2RyaXZlcnMvbWlzYy9taWtyb2J1cy9t
aWtyb2J1c19tYW5pZmVzdC5jIGIvZHJpdmVycy9taXNjL21pa3JvYnVzL21pa3JvYnVzX21hbmlm
ZXN0LmMKbmV3IGZpbGUgbW9kZSAxMDA2NDQKaW5kZXggMDAwMDAwMDAwMDAwLi42MGViY2E1NjBm
MGQKLS0tIC9kZXYvbnVsbAorKysgYi9kcml2ZXJzL21pc2MvbWlrcm9idXMvbWlrcm9idXNfbWFu
aWZlc3QuYwpAQCAtMCwwICsxLDM5MCBAQAorLy8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQ
TC0yLjAKKy8qCisgKiBtaWtyb0JVUyBtYW5pZmVzdCBwYXJzaW5nLCBhbgorICogZXh0ZW5zaW9u
IHRvIEdyZXlidXMgTWFuaWZlc3QgUGFyc2luZworICogdW5kZXIgZHJpdmVycy9ncmV5YnVzL21h
bmlmZXN0LmMKKyAqCisgKiBDb3B5cmlnaHQgMjAxNC0yMDE1IEdvb2dsZSBJbmMuCisgKiBDb3B5
cmlnaHQgMjAxNC0yMDE1IExpbmFybyBMdGQuCisgKi8KKworI2RlZmluZSBwcl9mbXQoZm10KSAi
bWlrcm9idXNfbWFuaWZlc3Q6ICIgZm10CisKKyNpbmNsdWRlIDxsaW51eC9iaXRzLmg+CisjaW5j
bHVkZSA8bGludXgvdHlwZXMuaD4KKyNpbmNsdWRlIDxsaW51eC9wcm9wZXJ0eS5oPgorI2luY2x1
ZGUgPGxpbnV4L2dyZXlidXMvZ3JleWJ1c19tYW5pZmVzdC5oPgorCisjaW5jbHVkZSAibWlrcm9i
dXNfbWFuaWZlc3QuaCIKKworc3RydWN0IG1hbmlmZXN0X2Rlc2MgeworCXN0cnVjdCBsaXN0X2hl
YWQgbGlua3M7CisJc2l6ZV90IHNpemU7CisJdm9pZCAqZGF0YTsKKwllbnVtIGdyZXlidXNfZGVz
Y3JpcHRvcl90eXBlIHR5cGU7Cit9OworCitzdGF0aWMgdm9pZCByZWxlYXNlX21hbmlmZXN0X2Rl
c2NyaXB0b3Ioc3RydWN0IG1hbmlmZXN0X2Rlc2MgKmRlc2NyaXB0b3IpCit7CisJbGlzdF9kZWwo
JmRlc2NyaXB0b3ItPmxpbmtzKTsKKwlrZnJlZShkZXNjcmlwdG9yKTsKK30KKworc3RhdGljIHZv
aWQgcmVsZWFzZV9tYW5pZmVzdF9kZXNjcmlwdG9ycyhzdHJ1Y3QgYWRkb25fYm9hcmRfaW5mbyAq
aW5mbykKK3sKKwlzdHJ1Y3QgbWFuaWZlc3RfZGVzYyAqZGVzY3JpcHRvcjsKKwlzdHJ1Y3QgbWFu
aWZlc3RfZGVzYyAqbmV4dDsKKworCWxpc3RfZm9yX2VhY2hfZW50cnlfc2FmZShkZXNjcmlwdG9y
LCBuZXh0LCAmaW5mby0+bWFuaWZlc3RfZGVzY3MsIGxpbmtzKQorCQlyZWxlYXNlX21hbmlmZXN0
X2Rlc2NyaXB0b3IoZGVzY3JpcHRvcik7Cit9CisKK3N0YXRpYyBpbnQgaWRlbnRpZnlfZGVzY3Jp
cHRvcihzdHJ1Y3QgYWRkb25fYm9hcmRfaW5mbyAqaW5mbywgc3RydWN0IGdyZXlidXNfZGVzY3Jp
cHRvciAqZGVzYywKKwkJCQkJCQkJCQkgc2l6ZV90IHNpemUpCit7CisJc3RydWN0IGdyZXlidXNf
ZGVzY3JpcHRvcl9oZWFkZXIgKmRlc2NfaGVhZGVyID0gJmRlc2MtPmhlYWRlcjsKKwlzdHJ1Y3Qg
bWFuaWZlc3RfZGVzYyAqZGVzY3JpcHRvcjsKKwlzaXplX3QgZGVzY19zaXplOworCXNpemVfdCBl
eHBlY3RlZF9zaXplOworCisJaWYgKHNpemUgPCBzaXplb2YoKmRlc2NfaGVhZGVyKSkKKwkJcmV0
dXJuIC1FSU5WQUw7CisJZGVzY19zaXplID0gbGUxNl90b19jcHUoZGVzY19oZWFkZXItPnNpemUp
OworCWlmIChkZXNjX3NpemUgPiBzaXplKQorCQlyZXR1cm4gLUVJTlZBTDsKKwlleHBlY3RlZF9z
aXplID0gc2l6ZW9mKCpkZXNjX2hlYWRlcik7CisJc3dpdGNoIChkZXNjX2hlYWRlci0+dHlwZSkg
eworCWNhc2UgR1JFWUJVU19UWVBFX1NUUklORzoKKwlleHBlY3RlZF9zaXplICs9IHNpemVvZihz
dHJ1Y3QgZ3JleWJ1c19kZXNjcmlwdG9yX3N0cmluZyk7CisJZXhwZWN0ZWRfc2l6ZSArPSBkZXNj
LT5zdHJpbmcubGVuZ3RoOworCWV4cGVjdGVkX3NpemUgPSBBTElHTihleHBlY3RlZF9zaXplLCA0
KTsKKwlicmVhazsKKwljYXNlIEdSRVlCVVNfVFlQRV9QUk9QRVJUWToKKwlleHBlY3RlZF9zaXpl
ICs9IHNpemVvZihzdHJ1Y3QgZ3JleWJ1c19kZXNjcmlwdG9yX3Byb3BlcnR5KTsKKwlleHBlY3Rl
ZF9zaXplICs9IGRlc2MtPnByb3BlcnR5Lmxlbmd0aDsKKwlleHBlY3RlZF9zaXplID0gQUxJR04o
ZXhwZWN0ZWRfc2l6ZSwgNCk7CisJYnJlYWs7CisJY2FzZSBHUkVZQlVTX1RZUEVfREVWSUNFOgor
CWV4cGVjdGVkX3NpemUgKz0gc2l6ZW9mKHN0cnVjdCBncmV5YnVzX2Rlc2NyaXB0b3JfZGV2aWNl
KTsKKwlicmVhazsKKwljYXNlIEdSRVlCVVNfVFlQRV9NSUtST0JVUzoKKwlleHBlY3RlZF9zaXpl
ICs9IHNpemVvZihzdHJ1Y3QgZ3JleWJ1c19kZXNjcmlwdG9yX21pa3JvYnVzKTsKKwlicmVhazsK
KwljYXNlIEdSRVlCVVNfVFlQRV9JTlRFUkZBQ0U6CisJZXhwZWN0ZWRfc2l6ZSArPSBzaXplb2Yo
c3RydWN0IGdyZXlidXNfZGVzY3JpcHRvcl9pbnRlcmZhY2UpOworCWJyZWFrOworCWNhc2UgR1JF
WUJVU19UWVBFX0NQT1JUOgorCWV4cGVjdGVkX3NpemUgKz0gc2l6ZW9mKHN0cnVjdCBncmV5YnVz
X2Rlc2NyaXB0b3JfY3BvcnQpOworCWJyZWFrOworCWNhc2UgR1JFWUJVU19UWVBFX0JVTkRMRToK
KwlleHBlY3RlZF9zaXplICs9IHNpemVvZihzdHJ1Y3QgZ3JleWJ1c19kZXNjcmlwdG9yX2J1bmRs
ZSk7CisJYnJlYWs7CisJY2FzZSBHUkVZQlVTX1RZUEVfSU5WQUxJRDoKKwlkZWZhdWx0OgorCXJl
dHVybiAtRUlOVkFMOworCX0KKworCWRlc2NyaXB0b3IgPSBremFsbG9jKHNpemVvZigqZGVzY3Jp
cHRvciksIEdGUF9LRVJORUwpOworCWlmICghZGVzY3JpcHRvcikKKwkJcmV0dXJuIC1FTk9NRU07
CisJZGVzY3JpcHRvci0+c2l6ZSA9IGRlc2Nfc2l6ZTsKKwlkZXNjcmlwdG9yLT5kYXRhID0gKGNo
YXIgKilkZXNjICsgc2l6ZW9mKCpkZXNjX2hlYWRlcik7CisJZGVzY3JpcHRvci0+dHlwZSA9IGRl
c2NfaGVhZGVyLT50eXBlOworCWxpc3RfYWRkX3RhaWwoJmRlc2NyaXB0b3ItPmxpbmtzLCAmaW5m
by0+bWFuaWZlc3RfZGVzY3MpOworCXJldHVybiBkZXNjX3NpemU7Cit9CisKK3N0YXRpYyBjaGFy
ICptaWtyb2J1c19zdHJpbmdfZ2V0KHN0cnVjdCBhZGRvbl9ib2FyZF9pbmZvICppbmZvLCB1OCBz
dHJpbmdfaWQpCit7CisJc3RydWN0IGdyZXlidXNfZGVzY3JpcHRvcl9zdHJpbmcgKmRlc2Nfc3Ry
aW5nOworCXN0cnVjdCBtYW5pZmVzdF9kZXNjICpkZXNjcmlwdG9yOworCWJvb2wgZm91bmQgPSBm
YWxzZTsKKwljaGFyICpzdHJpbmc7CisKKwlpZiAoIXN0cmluZ19pZCkKKwkJcmV0dXJuIE5VTEw7
CisKKwlsaXN0X2Zvcl9lYWNoX2VudHJ5KGRlc2NyaXB0b3IsICZpbmZvLT5tYW5pZmVzdF9kZXNj
cywgbGlua3MpIHsKKwkJaWYgKGRlc2NyaXB0b3ItPnR5cGUgIT0gR1JFWUJVU19UWVBFX1NUUklO
RykKKwkJCWNvbnRpbnVlOworCQlkZXNjX3N0cmluZyA9IGRlc2NyaXB0b3ItPmRhdGE7CisJCWlm
IChkZXNjX3N0cmluZy0+aWQgPT0gc3RyaW5nX2lkKSB7CisJCQlmb3VuZCA9IHRydWU7CisJCQli
cmVhazsKKwkJfQorCX0KKwlpZiAoIWZvdW5kKQorCQlyZXR1cm4gRVJSX1BUUigtRU5PRU5UKTsK
KwlzdHJpbmcgPSBrbWVtZHVwKCZkZXNjX3N0cmluZy0+c3RyaW5nLCBkZXNjX3N0cmluZy0+bGVu
Z3RoICsgMSwgR0ZQX0tFUk5FTCk7CisJaWYgKCFzdHJpbmcpCisJCXJldHVybiBFUlJfUFRSKC1F
Tk9NRU0pOworCXN0cmluZ1tkZXNjX3N0cmluZy0+bGVuZ3RoXSA9ICdcMCc7CisJcmV0dXJuIHN0
cmluZzsKK30KKworc3RhdGljIHZvaWQgbWlrcm9idXNfc3RhdGVfZ2V0KHN0cnVjdCBhZGRvbl9i
b2FyZF9pbmZvICppbmZvKQoreworCXN0cnVjdCBncmV5YnVzX2Rlc2NyaXB0b3JfbWlrcm9idXMg
Km1pa3JvYnVzOworCXN0cnVjdCBncmV5YnVzX2Rlc2NyaXB0b3JfaW50ZXJmYWNlICppbnRlcmZh
Y2U7CisJc3RydWN0IG1hbmlmZXN0X2Rlc2MgKmRlc2NyaXB0b3I7CisJYm9vbCBmb3VuZCA9IGZh
bHNlOworCisJbGlzdF9mb3JfZWFjaF9lbnRyeShkZXNjcmlwdG9yLCAmaW5mby0+bWFuaWZlc3Rf
ZGVzY3MsIGxpbmtzKSB7CisJCWlmIChkZXNjcmlwdG9yLT50eXBlID09IEdSRVlCVVNfVFlQRV9N
SUtST0JVUykgeworCQkJbWlrcm9idXMgPSBkZXNjcmlwdG9yLT5kYXRhOworCQkJZm91bmQgPSB0
cnVlOworCQkJYnJlYWs7CisJCX0KKwl9CisKKwlpZiAoZm91bmQpIHsKKwkJaW5mby0+bnVtX2Rl
dmljZXMgPSBtaWtyb2J1cy0+bnVtX2RldmljZXM7CisJCWluZm8tPnJzdF9ncGlvX3N0YXRlID0g
bWlrcm9idXMtPnJzdF9ncGlvX3N0YXRlOworCQlpbmZvLT5wd21fZ3Bpb19zdGF0ZSA9IG1pa3Jv
YnVzLT5wd21fZ3Bpb19zdGF0ZTsKKwkJaW5mby0+aW50X2dwaW9fc3RhdGUgPSBtaWtyb2J1cy0+
aW50X2dwaW9fc3RhdGU7CisJfSBlbHNlIHsKKwkJaW5mby0+bnVtX2RldmljZXMgPSAxOworCQlp
bmZvLT5yc3RfZ3Bpb19zdGF0ZSA9IE1JS1JPQlVTX0dQSU9fVU5VU0VEOworCQlpbmZvLT5wd21f
Z3Bpb19zdGF0ZSA9IE1JS1JPQlVTX0dQSU9fVU5VU0VEOworCQlpbmZvLT5pbnRfZ3Bpb19zdGF0
ZSA9IE1JS1JPQlVTX0dQSU9fVU5VU0VEOworCX0KKworCWxpc3RfZm9yX2VhY2hfZW50cnkoZGVz
Y3JpcHRvciwgJmluZm8tPm1hbmlmZXN0X2Rlc2NzLCBsaW5rcykgeworCQlpZiAoZGVzY3JpcHRv
ci0+dHlwZSA9PSBHUkVZQlVTX1RZUEVfSU5URVJGQUNFKSB7CisJCQlpbnRlcmZhY2UgPSBkZXNj
cmlwdG9yLT5kYXRhOworCQkJYnJlYWs7CisJCX0KKwl9CisJaW5mby0+bmFtZSA9IG1pa3JvYnVz
X3N0cmluZ19nZXQoaW5mbywgaW50ZXJmYWNlLT5wcm9kdWN0X3N0cmluZ2lkKTsKK30KKworc3Rh
dGljIHN0cnVjdCBwcm9wZXJ0eV9lbnRyeSAqCittaWtyb2J1c19wcm9wZXJ0eV9lbnRyeV9nZXQo
c3RydWN0IGFkZG9uX2JvYXJkX2luZm8gKmluZm8sIHU4ICpwcm9wX2xpbmssCisJCQkJCQkJaW50
IG51bV9wcm9wZXJ0aWVzKQoreworCXN0cnVjdCBncmV5YnVzX2Rlc2NyaXB0b3JfcHJvcGVydHkg
KmRlc2NfcHJvcGVydHk7CisJc3RydWN0IG1hbmlmZXN0X2Rlc2MgKmRlc2NyaXB0b3I7CisJc3Ry
dWN0IHByb3BlcnR5X2VudHJ5ICpwcm9wZXJ0aWVzOworCWludCBpOworCWNoYXIgKnByb3BfbmFt
ZTsKKwlib29sIGZvdW5kID0gZmFsc2U7CisJdTggKnZhbF91ODsKKwl1MTYgKnZhbF91MTY7CisJ
dTMyICp2YWxfdTMyOworCXU2NCAqdmFsX3U2NDsKKworCXByb3BlcnRpZXMgPSBrY2FsbG9jKG51
bV9wcm9wZXJ0aWVzLCBzaXplb2YoKnByb3BlcnRpZXMpLCBHRlBfS0VSTkVMKTsKKwlpZiAoIXBy
b3BlcnRpZXMpCisJCXJldHVybiBFUlJfUFRSKC1FTk9NRU0pOworCWZvciAoaSA9IDA7IGkgPCBu
dW1fcHJvcGVydGllczsgaSsrKSB7CisJCWxpc3RfZm9yX2VhY2hfZW50cnkoZGVzY3JpcHRvciwg
JmluZm8tPm1hbmlmZXN0X2Rlc2NzLCBsaW5rcykgeworCQkJaWYgKGRlc2NyaXB0b3ItPnR5cGUg
IT0gR1JFWUJVU19UWVBFX1BST1BFUlRZKQorCQkJCWNvbnRpbnVlOworCQkJZGVzY19wcm9wZXJ0
eSA9IGRlc2NyaXB0b3ItPmRhdGE7CisJCQlpZiAoZGVzY19wcm9wZXJ0eS0+aWQgPT0gcHJvcF9s
aW5rW2ldKSB7CisJCQkJZm91bmQgPSB0cnVlOworCQkJCWJyZWFrOworCQkJfQorCQl9CisJCWlm
ICghZm91bmQpCisJCQlyZXR1cm4gRVJSX1BUUigtRU5PRU5UKTsKKwkJcHJvcF9uYW1lID0gbWlr
cm9idXNfc3RyaW5nX2dldChpbmZvLCBkZXNjX3Byb3BlcnR5LT5wcm9wbmFtZV9zdHJpbmdpZCk7
CisJCXN3aXRjaCAoZGVzY19wcm9wZXJ0eS0+dHlwZSkgeworCQljYXNlIE1JS1JPQlVTX1BST1BF
UlRZX1RZUEVfVTg6CisJCXZhbF91OCA9IGttZW1kdXAoJmRlc2NfcHJvcGVydHktPnZhbHVlLAor
CQkJCShkZXNjX3Byb3BlcnR5LT5sZW5ndGgpICogc2l6ZW9mKHU4KSwgR0ZQX0tFUk5FTCk7CisJ
CWlmIChkZXNjX3Byb3BlcnR5LT5sZW5ndGggPT0gMSkKKwkJCXByb3BlcnRpZXNbaV0gPSBQUk9Q
RVJUWV9FTlRSWV9VOChwcm9wX25hbWUsICp2YWxfdTgpOworCQllbHNlCisJCQlwcm9wZXJ0aWVz
W2ldID0gUFJPUEVSVFlfRU5UUllfVThfQVJSQVlfTEVOKAorCQkJCXByb3BfbmFtZSwgKHZvaWQg
KilkZXNjX3Byb3BlcnR5LT52YWx1ZSwgZGVzY19wcm9wZXJ0eS0+bGVuZ3RoKTsKKwkJYnJlYWs7
CisJCWNhc2UgTUlLUk9CVVNfUFJPUEVSVFlfVFlQRV9VMTY6CisJCXZhbF91MTYgPSBrbWVtZHVw
KCZkZXNjX3Byb3BlcnR5LT52YWx1ZSwKKwkJCQkJKGRlc2NfcHJvcGVydHktPmxlbmd0aCkgKiBz
aXplb2YodTE2KSwgR0ZQX0tFUk5FTCk7CisJCWlmIChkZXNjX3Byb3BlcnR5LT5sZW5ndGggPT0g
MSkKKwkJCXByb3BlcnRpZXNbaV0gPSBQUk9QRVJUWV9FTlRSWV9VMTYocHJvcF9uYW1lLCAqdmFs
X3UxNik7CisJCWVsc2UKKwkJCXByb3BlcnRpZXNbaV0gPSBQUk9QRVJUWV9FTlRSWV9VMTZfQVJS
QVlfTEVOKAorCQkJCXByb3BfbmFtZSwgKHZvaWQgKilkZXNjX3Byb3BlcnR5LT52YWx1ZSwgZGVz
Y19wcm9wZXJ0eS0+bGVuZ3RoKTsKKwkJYnJlYWs7CisJCWNhc2UgTUlLUk9CVVNfUFJPUEVSVFlf
VFlQRV9VMzI6CisJCXZhbF91MzIgPSBrbWVtZHVwKCZkZXNjX3Byb3BlcnR5LT52YWx1ZSwKKwkJ
CQkJKGRlc2NfcHJvcGVydHktPmxlbmd0aCkgKiBzaXplb2YodTMyKSwgR0ZQX0tFUk5FTCk7CisJ
CWlmIChkZXNjX3Byb3BlcnR5LT5sZW5ndGggPT0gMSkKKwkJCXByb3BlcnRpZXNbaV0gPSBQUk9Q
RVJUWV9FTlRSWV9VMzIocHJvcF9uYW1lLCAqdmFsX3UzMik7CisJCWVsc2UKKwkJCXByb3BlcnRp
ZXNbaV0gPSBQUk9QRVJUWV9FTlRSWV9VMzJfQVJSQVlfTEVOKAorCQkJcHJvcF9uYW1lLCAodm9p
ZCAqKWRlc2NfcHJvcGVydHktPnZhbHVlLCBkZXNjX3Byb3BlcnR5LT5sZW5ndGgpOworCQlicmVh
azsKKwkJY2FzZSBNSUtST0JVU19QUk9QRVJUWV9UWVBFX1U2NDoKKwkJdmFsX3U2NCA9IGttZW1k
dXAoJmRlc2NfcHJvcGVydHktPnZhbHVlLAorCQkJCQkJKGRlc2NfcHJvcGVydHktPmxlbmd0aCkg
KiBzaXplb2YodTY0KSwgR0ZQX0tFUk5FTCk7CisJCWlmIChkZXNjX3Byb3BlcnR5LT5sZW5ndGgg
PT0gMSkKKwkJCXByb3BlcnRpZXNbaV0gPSBQUk9QRVJUWV9FTlRSWV9VNjQocHJvcF9uYW1lLCAq
dmFsX3U2NCk7CisJCWVsc2UKKwkJCXByb3BlcnRpZXNbaV0gPSBQUk9QRVJUWV9FTlRSWV9VNjRf
QVJSQVlfTEVOKAorCQkJCXByb3BfbmFtZSwgKHZvaWQgKilkZXNjX3Byb3BlcnR5LT52YWx1ZSwg
ZGVzY19wcm9wZXJ0eS0+bGVuZ3RoKTsKKwkJYnJlYWs7CisJCWRlZmF1bHQ6CisJCXJldHVybiBF
UlJfUFRSKC1FSU5WQUwpOworCQl9CisJfQorCXJldHVybiBwcm9wZXJ0aWVzOworfQorCitzdGF0
aWMgdTggKm1pa3JvYnVzX3Byb3BlcnR5X2xpbmtfZ2V0KHN0cnVjdCBhZGRvbl9ib2FyZF9pbmZv
ICppbmZvLCB1OCBwcm9wX2lkLAorCQkJCQkJCQkJICB1OCBwcm9wX3R5cGUpCit7CisJc3RydWN0
IGdyZXlidXNfZGVzY3JpcHRvcl9wcm9wZXJ0eSAqZGVzY19wcm9wZXJ0eTsKKwlzdHJ1Y3QgbWFu
aWZlc3RfZGVzYyAqZGVzY3JpcHRvcjsKKwlib29sIGZvdW5kID0gZmFsc2U7CisJdTggKnZhbF91
ODsKKworCWlmICghcHJvcF9pZCkKKwkJcmV0dXJuIE5VTEw7CisJbGlzdF9mb3JfZWFjaF9lbnRy
eShkZXNjcmlwdG9yLCAmaW5mby0+bWFuaWZlc3RfZGVzY3MsIGxpbmtzKSB7CisJCWlmIChkZXNj
cmlwdG9yLT50eXBlICE9IEdSRVlCVVNfVFlQRV9QUk9QRVJUWSkKKwkJCWNvbnRpbnVlOworCQlk
ZXNjX3Byb3BlcnR5ID0gZGVzY3JpcHRvci0+ZGF0YTsKKwkJaWYgKGRlc2NfcHJvcGVydHktPmlk
ID09IHByb3BfaWQgJiYgZGVzY19wcm9wZXJ0eS0+dHlwZSA9PSBwcm9wX3R5cGUpIHsKKwkJCWZv
dW5kID0gdHJ1ZTsKKwkJCWJyZWFrOworCQl9CisJfQorCWlmICghZm91bmQpCisJCXJldHVybiBF
UlJfUFRSKC1FTk9FTlQpOworCXZhbF91OCA9IGttZW1kdXAoJmRlc2NfcHJvcGVydHktPnZhbHVl
LCBkZXNjX3Byb3BlcnR5LT5sZW5ndGgsIEdGUF9LRVJORUwpOworCXJldHVybiB2YWxfdTg7Cit9
CisKK3N0YXRpYyBpbnQgbWlrcm9idXNfbWFuaWZlc3RfYXR0YWNoX2RldmljZShzdHJ1Y3QgYWRk
b25fYm9hcmRfaW5mbyAqaW5mbywKKwkJCQkJCXN0cnVjdCBncmV5YnVzX2Rlc2NyaXB0b3JfZGV2
aWNlICpkZXZfZGVzYykKK3sKKwlzdHJ1Y3QgYm9hcmRfZGV2aWNlX2luZm8gKmRldjsKKwlzdHJ1
Y3QgZ3Bpb2RfbG9va3VwX3RhYmxlICpsb29rdXA7CisJc3RydWN0IGdyZXlidXNfZGVzY3JpcHRv
cl9wcm9wZXJ0eSAqZGVzY19wcm9wZXJ0eTsKKwlzdHJ1Y3QgbWFuaWZlc3RfZGVzYyAqZGVzY3Jp
cHRvcjsKKwlpbnQgaTsKKwl1OCAqcHJvcF9saW5rOworCXU4ICpncGlvX2Rlc2NfbGluazsKKwor
CWRldiA9IGt6YWxsb2Moc2l6ZW9mKCpkZXYpLCBHRlBfS0VSTkVMKTsKKwlpZiAoIWRldikKKwkJ
cmV0dXJuIC1FTk9NRU07CisJZGV2LT5pZCA9IGRldl9kZXNjLT5pZDsKKwlkZXYtPmRydl9uYW1l
ID0gbWlrcm9idXNfc3RyaW5nX2dldChpbmZvLCBkZXZfZGVzYy0+ZHJpdmVyX3N0cmluZ2lkKTsK
KwlkZXYtPnByb3RvY29sID0gZGV2X2Rlc2MtPnByb3RvY29sOworCWRldi0+cmVnID0gZGV2X2Rl
c2MtPnJlZzsKKwlkZXYtPmlycSA9IGRldl9kZXNjLT5pcnE7CisJZGV2LT5pcnFfdHlwZSA9IGRl
dl9kZXNjLT5pcnFfdHlwZTsKKwlkZXYtPm1heF9zcGVlZF9oeiA9IGxlMzJfdG9fY3B1KGRldl9k
ZXNjLT5tYXhfc3BlZWRfaHopOworCWRldi0+bW9kZSA9IGRldl9kZXNjLT5tb2RlOworCWRldi0+
Y3NfZ3BpbyA9IGRldl9kZXNjLT5jc19ncGlvOworCWRldi0+bnVtX2dwaW9fcmVzb3VyY2VzID0g
ZGV2X2Rlc2MtPm51bV9ncGlvX3Jlc291cmNlczsKKwlkZXYtPm51bV9wcm9wZXJ0aWVzID0gZGV2
X2Rlc2MtPm51bV9wcm9wZXJ0aWVzOworCXByX2luZm8oImRldmljZSAlZCAsIG51bWJlciBvZiBw
cm9wZXJ0aWVzPSVkICwgbnVtYmVyIG9mIGdwaW8gcmVzb3VyY2VzPSVkXG4iLAorCWRldi0+aWQs
IGRldi0+bnVtX3Byb3BlcnRpZXMsIGRldi0+bnVtX2dwaW9fcmVzb3VyY2VzKTsKKwlpZiAoZGV2
LT5udW1fcHJvcGVydGllcyA+IDApIHsKKwkJcHJvcF9saW5rID0gbWlrcm9idXNfcHJvcGVydHlf
bGlua19nZXQoaW5mbywgZGV2X2Rlc2MtPnByb3BfbGluaywKKwkJCQkJCQkJTUlLUk9CVVNfUFJP
UEVSVFlfVFlQRV9MSU5LKTsKKwkJZGV2LT5wcm9wZXJ0aWVzID0gbWlrcm9idXNfcHJvcGVydHlf
ZW50cnlfZ2V0KGluZm8sIHByb3BfbGluaywgZGV2LT5udW1fcHJvcGVydGllcyk7CisJfQorCWlm
IChkZXYtPm51bV9ncGlvX3Jlc291cmNlcyA+IDApIHsKKwkJbG9va3VwID0ga3phbGxvYyhzdHJ1
Y3Rfc2l6ZShsb29rdXAsIHRhYmxlLCBkZXYtPm51bV9ncGlvX3Jlc291cmNlcyksCisJCQkJCUdG
UF9LRVJORUwpOworCWlmICghbG9va3VwKQorCQlyZXR1cm4gLUVOT01FTTsKKwlncGlvX2Rlc2Nf
bGluayA9IG1pa3JvYnVzX3Byb3BlcnR5X2xpbmtfZ2V0KGluZm8sIGRldl9kZXNjLT5ncGlvX2xp
bmssCisJCQkJCQlNSUtST0JVU19QUk9QRVJUWV9UWVBFX0dQSU8pOworCWZvciAoaSA9IDA7IGkg
PCBkZXYtPm51bV9ncGlvX3Jlc291cmNlczsgaSsrKSB7CisJCWxpc3RfZm9yX2VhY2hfZW50cnko
ZGVzY3JpcHRvciwgJmluZm8tPm1hbmlmZXN0X2Rlc2NzLCBsaW5rcykgeworCQkJaWYgKGRlc2Ny
aXB0b3ItPnR5cGUgIT0gR1JFWUJVU19UWVBFX1BST1BFUlRZKQorCQkJCWNvbnRpbnVlOworCQkJ
ZGVzY19wcm9wZXJ0eSA9IGRlc2NyaXB0b3ItPmRhdGE7CisJCQlpZiAoZGVzY19wcm9wZXJ0eS0+
aWQgPT0gZ3Bpb19kZXNjX2xpbmtbaV0pIHsKKwkJCQlsb29rdXAtPnRhYmxlW2ldLmNoaXBfaHdu
dW0gPSAqZGVzY19wcm9wZXJ0eS0+dmFsdWU7CisJCQkJbG9va3VwLT50YWJsZVtpXS5jb25faWQg
PQorCQkJCW1pa3JvYnVzX3N0cmluZ19nZXQoaW5mbywgZGVzY19wcm9wZXJ0eS0+cHJvcG5hbWVf
c3RyaW5naWQpOworCQkJCWJyZWFrOworCQkJCX0KKwkJfQorCX0KKwlkZXYtPmdwaW9fbG9va3Vw
ID0gbG9va3VwOworCX0KKwlsaXN0X2FkZF90YWlsKCZkZXYtPmxpbmtzLCAmaW5mby0+ZGV2aWNl
cyk7CisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyBpbnQgbWlrcm9idXNfbWFuaWZlc3RfcGFyc2Vf
ZGV2aWNlcyhzdHJ1Y3QgYWRkb25fYm9hcmRfaW5mbyAqaW5mbykKK3sKKwlzdHJ1Y3QgZ3JleWJ1
c19kZXNjcmlwdG9yX2RldmljZSAqZGVzY19kZXZpY2U7CisJc3RydWN0IG1hbmlmZXN0X2Rlc2Mg
KmRlc2MsICpuZXh0OworCWludCBkZXZjb3VudCA9IDA7CisKKwlpZiAoV0FSTl9PTighbGlzdF9l
bXB0eSgmaW5mby0+ZGV2aWNlcykpKQorCQlyZXR1cm4gZmFsc2U7CisJbGlzdF9mb3JfZWFjaF9l
bnRyeV9zYWZlKGRlc2MsIG5leHQsICZpbmZvLT5tYW5pZmVzdF9kZXNjcywgbGlua3MpIHsKKwkJ
aWYgKGRlc2MtPnR5cGUgIT0gR1JFWUJVU19UWVBFX0RFVklDRSkKKwkJCWNvbnRpbnVlOworCQlk
ZXNjX2RldmljZSA9IGRlc2MtPmRhdGE7CisJCW1pa3JvYnVzX21hbmlmZXN0X2F0dGFjaF9kZXZp
Y2UoaW5mbywgZGVzY19kZXZpY2UpOworCQlkZXZjb3VudCsrOworCX0KKwlyZXR1cm4gZGV2Y291
bnQ7Cit9CisKK2Jvb2wgbWlrcm9idXNfbWFuaWZlc3RfcGFyc2Uoc3RydWN0IGFkZG9uX2JvYXJk
X2luZm8gKmluZm8sIHZvaWQgKmRhdGEsCisJCQkJCQkJIHNpemVfdCBzaXplKQoreworCXN0cnVj
dCBncmV5YnVzX21hbmlmZXN0ICptYW5pZmVzdDsKKwlzdHJ1Y3QgZ3JleWJ1c19tYW5pZmVzdF9o
ZWFkZXIgKmhlYWRlcjsKKwlzdHJ1Y3QgZ3JleWJ1c19kZXNjcmlwdG9yICpkZXNjOworCXUxNiBt
YW5pZmVzdF9zaXplOworCWludCBkZXZfY291bnQ7CisJaW50IGRlc2Nfc2l6ZTsKKworCWlmIChX
QVJOX09OKCFsaXN0X2VtcHR5KCZpbmZvLT5tYW5pZmVzdF9kZXNjcykpKQorCQlyZXR1cm4gZmFs
c2U7CisJaWYgKHNpemUgPCBzaXplb2YoKmhlYWRlcikpCisJCXJldHVybiBmYWxzZTsKKwltYW5p
ZmVzdCA9IGRhdGE7CisJaGVhZGVyID0gJm1hbmlmZXN0LT5oZWFkZXI7CisJbWFuaWZlc3Rfc2l6
ZSA9IGxlMTZfdG9fY3B1KGhlYWRlci0+c2l6ZSk7CisJaWYgKG1hbmlmZXN0X3NpemUgIT0gc2l6
ZSkKKwkJcmV0dXJuIGZhbHNlOworCWlmIChoZWFkZXItPnZlcnNpb25fbWFqb3IgPiBNSUtST0JV
U19WRVJTSU9OX01BSk9SKQorCQlyZXR1cm4gZmFsc2U7CisJZGVzYyA9IG1hbmlmZXN0LT5kZXNj
cmlwdG9yczsKKwlzaXplIC09IHNpemVvZigqaGVhZGVyKTsKKwl3aGlsZSAoc2l6ZSkgeworCQlk
ZXNjX3NpemUgPSBpZGVudGlmeV9kZXNjcmlwdG9yKGluZm8sIGRlc2MsIHNpemUpOworCQlpZiAo
ZGVzY19zaXplIDwgMCkgeworCQkJcHJfZXJyKCJpbnZhbGlkIG1hbmlmZXN0IGRlc2NyaXB0b3Ii
KTsKKwkJcmV0dXJuIC1FSU5WQUw7CisJCX0KKwkJZGVzYyA9IChzdHJ1Y3QgZ3JleWJ1c19kZXNj
cmlwdG9yICopKChjaGFyICopZGVzYyArIGRlc2Nfc2l6ZSk7CisJCXNpemUgLT0gZGVzY19zaXpl
OworCX0KKwltaWtyb2J1c19zdGF0ZV9nZXQoaW5mbyk7CisJZGV2X2NvdW50ID0gbWlrcm9idXNf
bWFuaWZlc3RfcGFyc2VfZGV2aWNlcyhpbmZvKTsKKwlwcl9pbmZvKCIgJXMgbWFuaWZlc3QgcGFy
c2VkIHdpdGggJWQgZGV2aWNlKHMpXG4iLCBpbmZvLT5uYW1lLAorCQlpbmZvLT5udW1fZGV2aWNl
cyk7CisJcmVsZWFzZV9tYW5pZmVzdF9kZXNjcmlwdG9ycyhpbmZvKTsKKwlyZXR1cm4gdHJ1ZTsK
K30KKworc2l6ZV90IG1pa3JvYnVzX21hbmlmZXN0X2hlYWRlcl92YWxpZGF0ZSh2b2lkICpkYXRh
LCBzaXplX3Qgc2l6ZSkKK3sKKwlzdHJ1Y3QgZ3JleWJ1c19tYW5pZmVzdF9oZWFkZXIgKmhlYWRl
cjsKKwl1MTYgbWFuaWZlc3Rfc2l6ZTsKKworCWlmIChzaXplIDwgc2l6ZW9mKCpoZWFkZXIpKQor
CQlyZXR1cm4gMDsKKworCWhlYWRlciA9IGRhdGE7CisJbWFuaWZlc3Rfc2l6ZSA9IGxlMTZfdG9f
Y3B1KGhlYWRlci0+c2l6ZSk7CisJaWYgKGhlYWRlci0+dmVyc2lvbl9tYWpvciA+IE1JS1JPQlVT
X1ZFUlNJT05fTUFKT1IpCisJCXJldHVybiAwOworCXJldHVybiBtYW5pZmVzdF9zaXplOworfQpk
aWZmIC0tZ2l0IGEvZHJpdmVycy9taXNjL21pa3JvYnVzL21pa3JvYnVzX21hbmlmZXN0LmggYi9k
cml2ZXJzL21pc2MvbWlrcm9idXMvbWlrcm9idXNfbWFuaWZlc3QuaApuZXcgZmlsZSBtb2RlIDEw
MDY0NAppbmRleCAwMDAwMDAwMDAwMDAuLmExOTVkMWMyNjQ5MwotLS0gL2Rldi9udWxsCisrKyBi
L2RyaXZlcnMvbWlzYy9taWtyb2J1cy9taWtyb2J1c19tYW5pZmVzdC5oCkBAIC0wLDAgKzEsMjEg
QEAKKy8qIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBHUEwtMi4wICovCisvKgorICogbWlrcm9C
VVMgbWFuaWZlc3QgZGVmaW5pdGlvbgorICogZXh0ZW5zaW9uIHRvIEdyZXlidXMgTWFuaWZlc3Qg
RGVmaW5pdGlvbgorICoKKyAqIENvcHlyaWdodCAyMDE0LTIwMTUgR29vZ2xlIEluYy4KKyAqIENv
cHlyaWdodCAyMDE0LTIwMTUgTGluYXJvIEx0ZC4KKyAqCisgKiBSZWxlYXNlZCB1bmRlciB0aGUg
R1BMdjIgYW5kIEJTRCBsaWNlbnNlcy4KKyAqLworCisjaWZuZGVmIF9fTUlLUk9CVVNfTUFOSUZF
U1RfSAorI2RlZmluZSBfX01JS1JPQlVTX01BTklGRVNUX0gKKworI2luY2x1ZGUgIm1pa3JvYnVz
X2NvcmUuaCIKKworYm9vbCBtaWtyb2J1c19tYW5pZmVzdF9wYXJzZShzdHJ1Y3QgYWRkb25fYm9h
cmRfaW5mbyAqaW5mbywgdm9pZCAqZGF0YSwKKwkJCQkJCQkgc2l6ZV90IHNpemUpOworc2l6ZV90
IG1pa3JvYnVzX21hbmlmZXN0X2hlYWRlcl92YWxpZGF0ZSh2b2lkICpkYXRhLCBzaXplX3Qgc2l6
ZSk7CisKKyNlbmRpZiAvKiBfX01JS1JPQlVTX01BTklGRVNUX0ggKi8KZGlmZiAtLWdpdCBhL2lu
Y2x1ZGUvbGludXgvZ3JleWJ1cy9ncmV5YnVzX21hbmlmZXN0LmggYi9pbmNsdWRlL2xpbnV4L2dy
ZXlidXMvZ3JleWJ1c19tYW5pZmVzdC5oCmluZGV4IDZlNjJmZTQ3ODcxMi4uNzljOGNhYjllZjk2
IDEwMDY0NAotLS0gYS9pbmNsdWRlL2xpbnV4L2dyZXlidXMvZ3JleWJ1c19tYW5pZmVzdC5oCisr
KyBiL2luY2x1ZGUvbGludXgvZ3JleWJ1cy9ncmV5YnVzX21hbmlmZXN0LmgKQEAgLTIzLDYgKzIz
LDkgQEAgZW51bSBncmV5YnVzX2Rlc2NyaXB0b3JfdHlwZSB7CiAJR1JFWUJVU19UWVBFX1NUUklO
RwkJPSAweDAyLAogCUdSRVlCVVNfVFlQRV9CVU5ETEUJCT0gMHgwMywKIAlHUkVZQlVTX1RZUEVf
Q1BPUlQJCT0gMHgwNCwKKwlHUkVZQlVTX1RZUEVfTUlLUk9CVVMJPSAweDA1LAorCUdSRVlCVVNf
VFlQRV9QUk9QRVJUWQk9IDB4MDYsCisJR1JFWUJVU19UWVBFX0RFVklDRQk9IDB4MDcsCiB9Owog
CiBlbnVtIGdyZXlidXNfcHJvdG9jb2wgewpAQCAtMTUxLDYgKzE1NCw1MyBAQCBzdHJ1Y3QgZ3Jl
eWJ1c19kZXNjcmlwdG9yX2Nwb3J0IHsKIAlfX3U4CXByb3RvY29sX2lkOwkvKiBlbnVtIGdyZXli
dXNfcHJvdG9jb2wgKi8KIH0gX19wYWNrZWQ7CiAKKy8qCisgKiBBIG1pa3JvYnVzIGRlc2NyaXB0
b3IgaXMgdXNlZCB0byBkZXNjcmliZSB0aGUgZGV0YWlscworICogYWJvdXQgdGhlIGFkZC1vbiBi
b2FyZCBjb25uZWN0ZWQgdG8gdGhlIG1pa3JvYnVzIHBvcnQuCisgKiBJdCBkZXNjcmliZXMgdGhl
IG51bWJlciBvZiBpbmRpdmR1YWwgZGV2aWNlcyBvbiB0aGUKKyAqIGFkZC1vbiBib2FyZCBhbmQg
dGhlIGRlZmF1bHQgc3RhdGVzIG9mIHRoZSBHUElPcworICovCitzdHJ1Y3QgZ3JleWJ1c19kZXNj
cmlwdG9yX21pa3JvYnVzIHsKKwlfX3U4IG51bV9kZXZpY2VzOworCV9fdTggcnN0X2dwaW9fc3Rh
dGU7CisJX191OCBwd21fZ3Bpb19zdGF0ZTsKKwlfX3U4IGludF9ncGlvX3N0YXRlOworfSBfX3Bh
Y2tlZDsKKworLyoKKyAqIEEgcHJvcGVydHkgZGVzY3JpcHRvciBpcyB1c2VkIHRvIHBhc3MgbmFt
ZWQgcHJvcGVydGllcworICogdG8gZGV2aWNlIGRyaXZlcnMgdGhyb3VnaCB0aGUgdW5pZmllZCBk
ZXZpY2UgcHJvcGVydGllcworICogaW50ZXJmYWNlIHVuZGVyIGxpbnV4L3Byb3BlcnR5LmgKKyAq
Lworc3RydWN0IGdyZXlidXNfZGVzY3JpcHRvcl9wcm9wZXJ0eSB7CisJX191OCBsZW5ndGg7CisJ
X191OCBpZDsKKwlfX3U4IHByb3BuYW1lX3N0cmluZ2lkOworCV9fdTggdHlwZTsKKwlfX3U4IHZh
bHVlWzBdOworfSBfX3BhY2tlZDsKKworLyoKKyAqIEEgZGV2aWNlIGRlc2NyaXB0b3IgaXMgdXNl
ZCB0byBkZXNjcmliZSB0aGUKKyAqIGRldGFpbHMgcmVxdWlyZWQgYnkgYSBhZGQtb24gYm9hcmQg
ZGV2aWNlCisgKiBkcml2ZXIuCisgKi8KK3N0cnVjdCBncmV5YnVzX2Rlc2NyaXB0b3JfZGV2aWNl
IHsKKwlfX3U4IGlkOworCV9fdTggZHJpdmVyX3N0cmluZ2lkOworCV9fdTggbnVtX3Byb3BlcnRp
ZXM7CisJX191OCBwcm90b2NvbDsKKwlfX2xlMzIgbWF4X3NwZWVkX2h6OworCV9fdTggcmVnOwor
CV9fdTggbW9kZTsKKwlfX3U4IG51bV9ncGlvX3Jlc291cmNlczsKKwlfX3U4IGNzX2dwaW87CisJ
X191OCBpcnE7CisJX191OCBpcnFfdHlwZTsKKwlfX3U4IHByb3BfbGluazsKKwlfX3U4IGdwaW9f
bGluazsKK30gX19wYWNrZWQ7CisKIHN0cnVjdCBncmV5YnVzX2Rlc2NyaXB0b3JfaGVhZGVyIHsK
IAlfX2xlMTYJc2l6ZTsKIAlfX3U4CXR5cGU7CQkvKiBlbnVtIGdyZXlidXNfZGVzY3JpcHRvcl90
eXBlICovCkBAIC0xNjQsNiArMjE0LDkgQEAgc3RydWN0IGdyZXlidXNfZGVzY3JpcHRvciB7CiAJ
CXN0cnVjdCBncmV5YnVzX2Rlc2NyaXB0b3JfaW50ZXJmYWNlCWludGVyZmFjZTsKIAkJc3RydWN0
IGdyZXlidXNfZGVzY3JpcHRvcl9idW5kbGUJYnVuZGxlOwogCQlzdHJ1Y3QgZ3JleWJ1c19kZXNj
cmlwdG9yX2Nwb3J0CQljcG9ydDsKKwkJc3RydWN0IGdyZXlidXNfZGVzY3JpcHRvcl9taWtyb2J1
cwltaWtyb2J1czsKKwkJc3RydWN0IGdyZXlidXNfZGVzY3JpcHRvcl9wcm9wZXJ0eQlwcm9wZXJ0
eTsKKwkJc3RydWN0IGdyZXlidXNfZGVzY3JpcHRvcl9kZXZpY2UJZGV2aWNlOwogCX07CiB9IF9f
cGFja2VkOwogCi0tIAoyLjI1LjEKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fCmdyZXlidXMtZGV2IG1haWxpbmcgbGlzdApncmV5YnVzLWRldkBsaXN0cy5s
aW5hcm8ub3JnCmh0dHBzOi8vbGlzdHMubGluYXJvLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2dyZXli
dXMtZGV2Cg==
