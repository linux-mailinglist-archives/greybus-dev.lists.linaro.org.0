Return-Path: <greybus-dev-bounces@lists.linaro.org>
X-Original-To: lists+greybus-dev@lfdr.de
Delivered-To: lists+greybus-dev@lfdr.de
Received: from lists.linaro.org (lists.linaro.org [107.22.173.205])
	by mail.lfdr.de (Postfix) with ESMTPS id 3CDD31EB7CB
	for <lists+greybus-dev@lfdr.de>; Tue,  2 Jun 2020 11:02:16 +0200 (CEST)
Received: from lists.linaro.org (localhost [127.0.0.1])
	by lists.linaro.org (Postfix) with ESMTP id 61B3260DA3
	for <lists+greybus-dev@lfdr.de>; Tue,  2 Jun 2020 09:02:15 +0000 (UTC)
Received: by lists.linaro.org (Postfix, from userid 109)
	id 4C87260F10; Tue,  2 Jun 2020 09:02:15 +0000 (UTC)
X-Spam-Checker-Version: SpamAssassin 3.4.2 (2018-09-13) on lists.linaro.org
X-Spam-Level: 
X-Spam-Status: No, score=-2.9 required=5.0 tests=BAYES_00,MAILING_LIST_MULTI,
	RCVD_IN_DNSWL_NONE,RCVD_IN_MSPIKE_H3,RCVD_IN_MSPIKE_WL,SPF_HELO_NONE
	autolearn=disabled version=3.4.2
Received: from lists.linaro.org (localhost [127.0.0.1])
	by lists.linaro.org (Postfix) with ESMTP id 0DEDA60F4F;
	Tue,  2 Jun 2020 09:01:38 +0000 (UTC)
X-Original-To: greybus-dev@lists.linaro.org
Delivered-To: greybus-dev@lists.linaro.org
Received: from lists.linaro.org (localhost [127.0.0.1])
 by lists.linaro.org (Postfix) with ESMTP id 3FF3961805
 for <greybus-dev@lists.linaro.org>; Tue, 26 May 2020 08:33:50 +0000 (UTC)
Received: by lists.linaro.org (Postfix, from userid 109)
 id 1B720618F4; Tue, 26 May 2020 08:33:50 +0000 (UTC)
Received: from mail-ot1-f67.google.com (mail-ot1-f67.google.com
 [209.85.210.67])
 by lists.linaro.org (Postfix) with ESMTPS id C199561805
 for <greybus-dev@lists.linaro.org>; Tue, 26 May 2020 08:33:47 +0000 (UTC)
Received: by mail-ot1-f67.google.com with SMTP id z3so15617207otp.9
 for <greybus-dev@lists.linaro.org>; Tue, 26 May 2020 01:33:47 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:mime-version:references:in-reply-to:from:date
 :message-id:subject:to:cc:content-transfer-encoding;
 bh=xqwx4Jc2H37OdksQTVzbDpdEmrIEPoemMtqVyiXEljw=;
 b=ThSrbfV9U8GulP597uAR0WRNqzNYDmvfMbe0S+/TocG6AHXE2XUTLZ5Uh8nQFCeS9Z
 Zxf0/4uT+NfgEMWNDnJKRlA/gAQMpU4W84+usQEPytTuHjjlyH4m2c6J7NaJCxO/8Kno
 P6coj4wwDwW0jPR+gcHjS15CQdygHGcqBtGPprZCu8050FwP0eoiixII8RCIOqbCAtNZ
 QSNX0vWgjkRYsJMmR0etzg28/mc1+dbAenB+ElPppxhbAIM25yGjPX4yBnQc3w+zD9l8
 FYU0KeJGon5LNY7D8jpWgPqVzhtwy33mwoqny7MFwpxDmmTg0zVGC6D/nsyuwHu6lYsy
 w5Lw==
X-Gm-Message-State: AOAM531uSUwzf8VO+n9ELUrcO/1lZN8+cAC0Ec9k4ijPW/40XZ9X40WW
 7yKBpx+BacBCEZtigCYbutrRPxxzQaKzcxuwUlc=
X-Google-Smtp-Source: ABdhPJyNysLWVKRczFBkQ43E30zRMxZYV4/+Y8mbsCWT22nMW3MidJq/4M9bYbWziVMtomZyKvvgUfhmzVxAJU8js1I=
X-Received: by 2002:a9d:6c0f:: with SMTP id f15mr84522otq.118.1590482027093;
 Tue, 26 May 2020 01:33:47 -0700 (PDT)
MIME-Version: 1.0
References: <20200525182608.1823735-1-kw@linux.com>
 <20200525182608.1823735-8-kw@linux.com>
In-Reply-To: <20200525182608.1823735-8-kw@linux.com>
From: "Rafael J. Wysocki" <rafael@kernel.org>
Date: Tue, 26 May 2020 10:33:34 +0200
Message-ID: <CAJZ5v0h7hMJW5iprAU406oMPFBE6mSaj4u9KOGBEfP82SzPqAg@mail.gmail.com>
To: =?UTF-8?Q?Krzysztof_Wilczy=C5=84ski?= <kw@linux.com>
X-Virus-Scanned: ClamAV using ClamSMTP
X-Mailman-Approved-At: Tue, 02 Jun 2020 09:01:36 +0000
Cc: Ulf Hansson <ulf.hansson@linaro.org>, Linux PCI <linux-pci@vger.kernel.org>,
 Bjorn Andersson <bjorn.andersson@linaro.org>, Pavel Machek <pavel@ucw.cz>,
 linux-s390@vger.kernel.org,
 "open list:TARGET SUBSYSTEM" <linux-scsi@vger.kernel.org>,
 Kevin Hilman <khilman@kernel.org>, Julian Wiedmann <jwi@linux.ibm.com>,
 ACPI Devel Maling List <linux-acpi@vger.kernel.org>,
 Jakub Kicinski <kuba@kernel.org>, Dan Carpenter <dan.carpenter@oracle.com>,
 Len Brown <lenb@kernel.org>, Linux PM <linux-pm@vger.kernel.org>,
 "James E.J. Bottomley" <jejb@linux.ibm.com>,
 Ursula Braun <ubraun@linux.ibm.com>, Johan Hovold <johan@kernel.org>,
 greybus-dev@lists.linaro.org, John Stultz <john.stultz@linaro.org>,
 Bjorn Helgaas <bhelgaas@google.com>, Felipe Balbi <balbi@kernel.org>,
 Alex Elder <elder@kernel.org>,
 "Martin K. Petersen" <martin.petersen@oracle.com>,
 "open list:ULTRA-WIDEBAND \(UWB\) SUBSYSTEM:" <linux-usb@vger.kernel.org>,
 "Rafael J. Wysocki" <rjw@rjwysocki.net>, Karsten Graul <kgraul@linux.ibm.com>,
 netdev <netdev@vger.kernel.org>, "David S. Miller" <davem@davemloft.net>
Subject: Re: [greybus-dev] [PATCH 7/8] PM: Use the new device_to_pm() helper
 to access struct dev_pm_ops
X-BeenThere: greybus-dev@lists.linaro.org
X-Mailman-Version: 2.1.16
Precedence: list
List-Id: Greybus Development Mail List <greybus-dev.lists.linaro.org>
List-Unsubscribe: <https://lists.linaro.org/mailman/options/greybus-dev>,
 <mailto:greybus-dev-request@lists.linaro.org?subject=unsubscribe>
List-Archive: <http://lists.linaro.org/pipermail/greybus-dev/>
List-Post: <mailto:greybus-dev@lists.linaro.org>
List-Help: <mailto:greybus-dev-request@lists.linaro.org?subject=help>
List-Subscribe: <https://lists.linaro.org/mailman/listinfo/greybus-dev>,
 <mailto:greybus-dev-request@lists.linaro.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: greybus-dev-bounces@lists.linaro.org
Sender: "greybus-dev" <greybus-dev-bounces@lists.linaro.org>
X-Virus-Scanned: ClamAV using ClamSMTP

T24gTW9uLCBNYXkgMjUsIDIwMjAgYXQgODoyNiBQTSBLcnp5c3p0b2YgV2lsY3p5xYRza2kgPGt3
QGxpbnV4LmNvbT4gd3JvdGU6Cj4KPiBVc2UgdGhlIG5ldyBkZXZpY2VfdG9fcG0oKSBoZWxwZXIg
dG8gYWNjZXNzIFBvd2VyIE1hbmFnZW1lbnQgY2FsbGJhY3MKPiAoc3RydWN0IGRldl9wbV9vcHMp
IGZvciBhIHBhcnRpY3VsYXIgZGV2aWNlIChzdHJ1Y3QgZGV2aWNlX2RyaXZlcikuCj4KPiBObyBm
dW5jdGlvbmFsIGNoYW5nZSBpbnRlbmRlZC4KPgo+IFRoaXMgY2hhbmdlIGJ1aWxkcyBvbiB0b3Ag
b2YgdGhlIHByZXZpb3VzIGNvbW1pdCA2ZGEyZjJjY2ZkMmQgKCJQQ0kvUE06Cj4gTWFrZSBwb3dl
ciBtYW5hZ2VtZW50IG9wIGNvZGluZyBzdHlsZSBjb25zaXN0ZW50IikuCj4KPiBMaW5rczoKPiAg
IGh0dHBzOi8vbG9yZS5rZXJuZWwub3JnL2RyaXZlcmRldi1kZXZlbC8yMDE5MTAxNDIzMDAxNi4y
NDA5MTItNi1oZWxnYWFzQGtlcm5lbC5vcmcvCj4gICBodHRwczovL2xvcmUua2VybmVsLm9yZy9k
cml2ZXJkZXYtZGV2ZWwvODU5MjMwMi5yNHhDNlJJeTY5QGtyZWFjaGVyLwo+ICAgaHR0cHM6Ly9s
b3JlLmtlcm5lbC5vcmcvZHJpdmVyZGV2LWRldmVsLzIwMTkxMDE2MTM1MDAyLkdBMjQ2NzhAa2Fk
YW0vCj4KPiBTaWduZWQtb2ZmLWJ5OiBLcnp5c3p0b2YgV2lsY3p5xYRza2kgPGt3QGxpbnV4LmNv
bT4KPiAtLS0KPiAgZHJpdmVycy9iYXNlL3Bvd2VyL2RvbWFpbi5jICAgICAgfCAxMiArKysrLS0K
PiAgZHJpdmVycy9iYXNlL3Bvd2VyL2dlbmVyaWNfb3BzLmMgfCA2NSArKysrKysrKysrKysrKy0t
LS0tLS0tLS0tLS0tLS0tLQo+ICBkcml2ZXJzL2Jhc2UvcG93ZXIvbWFpbi5jICAgICAgICB8IDQ4
ICsrKysrKysrKysrKysrKy0tLS0tLS0tCj4gIGRyaXZlcnMvYmFzZS9wb3dlci9ydW50aW1lLmMg
ICAgIHwgIDcgKystLQo+ICA0IGZpbGVzIGNoYW5nZWQsIDczIGluc2VydGlvbnMoKyksIDU5IGRl
bGV0aW9ucygtKQo+Cj4gZGlmZiAtLWdpdCBhL2RyaXZlcnMvYmFzZS9wb3dlci9kb21haW4uYyBi
L2RyaXZlcnMvYmFzZS9wb3dlci9kb21haW4uYwo+IGluZGV4IDBhMDFkZjYwODg0OS4uOTJhOTZm
Y2IyNzE3IDEwMDY0NAo+IC0tLSBhL2RyaXZlcnMvYmFzZS9wb3dlci9kb21haW4uYwo+ICsrKyBi
L2RyaXZlcnMvYmFzZS9wb3dlci9kb21haW4uYwo+IEBAIC03MDMsNiArNzAzLDcgQEAgc3RhdGlj
IHZvaWQgZ2VucGRfcG93ZXJfb2ZmX3dvcmtfZm4oc3RydWN0IHdvcmtfc3RydWN0ICp3b3JrKQo+
ICBzdGF0aWMgaW50IF9fZ2VucGRfcnVudGltZV9zdXNwZW5kKHN0cnVjdCBkZXZpY2UgKmRldikK
PiAgewo+ICAgICAgICAgaW50ICgqY2IpKHN0cnVjdCBkZXZpY2UgKl9fZGV2KTsKPiArICAgICAg
IGNvbnN0IHN0cnVjdCBkZXZfcG1fb3BzICpwbTsKPgo+ICAgICAgICAgaWYgKGRldi0+dHlwZSAm
JiBkZXYtPnR5cGUtPnBtKQo+ICAgICAgICAgICAgICAgICBjYiA9IGRldi0+dHlwZS0+cG0tPnJ1
bnRpbWVfc3VzcGVuZDsKPiBAQCAtNzEzLDggKzcxNCw5IEBAIHN0YXRpYyBpbnQgX19nZW5wZF9y
dW50aW1lX3N1c3BlbmQoc3RydWN0IGRldmljZSAqZGV2KQo+ICAgICAgICAgZWxzZQo+ICAgICAg
ICAgICAgICAgICBjYiA9IE5VTEw7Cj4KPiAtICAgICAgIGlmICghY2IgJiYgZGV2LT5kcml2ZXIg
JiYgZGV2LT5kcml2ZXItPnBtKQo+IC0gICAgICAgICAgICAgICBjYiA9IGRldi0+ZHJpdmVyLT5w
bS0+cnVudGltZV9zdXNwZW5kOwo+ICsgICAgICAgcG0gPSBkcml2ZXJfdG9fcG0oZGV2LT5kcml2
ZXIpOwo+ICsgICAgICAgaWYgKCFjYiAmJiBwbSkKPiArICAgICAgICAgICAgICAgY2IgPSBwbS0+
cnVudGltZV9zdXNwZW5kOwoKU28gd2h5IGV4YWN0bHkgaXMgdGhlIG5ldyB2ZXJzaW9uIGJldHRl
cj8KCjEuIEl0IGFkZHMgbGluZXMgb2YgY29kZS4KMi4gSXQgYWRkcyBjaGVja3MuCjMuIEl0IGFk
ZHMgZnVuY3Rpb24gY2FsbHMuCjQuIEl0IG1ha2VzIG9uZSBuZWVkIHRvIHNlZSB0aGUgZXh0cmEg
ZHJpdmVyX3RvX3BtKCkgZnVuY3Rpb24gdG8gZmluZApvdXQgd2hhdCdzIGdvaW5nIG9uLgoKV2hp
Y2ggb2YgdGhlIGFib3ZlIGlzIGFuIGltcHJvdmVtZW50PwoKPiAgICAgICAgIHJldHVybiBjYiA/
IGNiKGRldikgOiAwOwo+ICB9Cj4gQEAgLTcyNiw2ICs3MjgsNyBAQCBzdGF0aWMgaW50IF9fZ2Vu
cGRfcnVudGltZV9zdXNwZW5kKHN0cnVjdCBkZXZpY2UgKmRldikKPiAgc3RhdGljIGludCBfX2dl
bnBkX3J1bnRpbWVfcmVzdW1lKHN0cnVjdCBkZXZpY2UgKmRldikKPiAgewo+ICAgICAgICAgaW50
ICgqY2IpKHN0cnVjdCBkZXZpY2UgKl9fZGV2KTsKPiArICAgICAgIGNvbnN0IHN0cnVjdCBkZXZf
cG1fb3BzICpwbTsKPgo+ICAgICAgICAgaWYgKGRldi0+dHlwZSAmJiBkZXYtPnR5cGUtPnBtKQo+
ICAgICAgICAgICAgICAgICBjYiA9IGRldi0+dHlwZS0+cG0tPnJ1bnRpbWVfcmVzdW1lOwo+IEBA
IC03MzYsOCArNzM5LDkgQEAgc3RhdGljIGludCBfX2dlbnBkX3J1bnRpbWVfcmVzdW1lKHN0cnVj
dCBkZXZpY2UgKmRldikKPiAgICAgICAgIGVsc2UKPiAgICAgICAgICAgICAgICAgY2IgPSBOVUxM
Owo+Cj4gLSAgICAgICBpZiAoIWNiICYmIGRldi0+ZHJpdmVyICYmIGRldi0+ZHJpdmVyLT5wbSkK
PiAtICAgICAgICAgICAgICAgY2IgPSBkZXYtPmRyaXZlci0+cG0tPnJ1bnRpbWVfcmVzdW1lOwo+
ICsgICAgICAgcG0gPSBkcml2ZXJfdG9fcG0oZGV2LT5kcml2ZXIpOwo+ICsgICAgICAgaWYgKCFj
YiAmJiBwbSkKPiArICAgICAgICAgICAgICAgY2IgPSBwbS0+cnVudGltZV9yZXN1bWU7Cj4KPiAg
ICAgICAgIHJldHVybiBjYiA/IGNiKGRldikgOiAwOwo+ICB9Cj4gZGlmZiAtLWdpdCBhL2RyaXZl
cnMvYmFzZS9wb3dlci9nZW5lcmljX29wcy5jIGIvZHJpdmVycy9iYXNlL3Bvd2VyL2dlbmVyaWNf
b3BzLmMKPiBpbmRleCA0ZmE1MjU2NjhjYjcuLmZiZDJlZGVmMDIwMSAxMDA2NDQKPiAtLS0gYS9k
cml2ZXJzL2Jhc2UvcG93ZXIvZ2VuZXJpY19vcHMuYwo+ICsrKyBiL2RyaXZlcnMvYmFzZS9wb3dl
ci9nZW5lcmljX29wcy5jCj4gQEAgLTE5LDEyICsxOSw5IEBACj4gICAqLwo+ICBpbnQgcG1fZ2Vu
ZXJpY19ydW50aW1lX3N1c3BlbmQoc3RydWN0IGRldmljZSAqZGV2KQo+ICB7Cj4gLSAgICAgICBj
b25zdCBzdHJ1Y3QgZGV2X3BtX29wcyAqcG0gPSBkZXYtPmRyaXZlciA/IGRldi0+ZHJpdmVyLT5w
bSA6IE5VTEw7Cj4gLSAgICAgICBpbnQgcmV0Owo+ICsgICAgICAgY29uc3Qgc3RydWN0IGRldl9w
bV9vcHMgKnBtID0gZHJpdmVyX3RvX3BtKGRldi0+ZHJpdmVyKTsKPgo+IC0gICAgICAgcmV0ID0g
cG0gJiYgcG0tPnJ1bnRpbWVfc3VzcGVuZCA/IHBtLT5ydW50aW1lX3N1c3BlbmQoZGV2KSA6IDA7
Cj4gLQo+IC0gICAgICAgcmV0dXJuIHJldDsKPiArICAgICAgIHJldHVybiBwbSAmJiBwbS0+cnVu
dGltZV9zdXNwZW5kID8gcG0tPnJ1bnRpbWVfc3VzcGVuZChkZXYpIDogMDsKPiAgfQo+ICBFWFBP
UlRfU1lNQk9MX0dQTChwbV9nZW5lcmljX3J1bnRpbWVfc3VzcGVuZCk7Cj4KPiBAQCAtMzgsMTIg
KzM1LDkgQEAgRVhQT1JUX1NZTUJPTF9HUEwocG1fZ2VuZXJpY19ydW50aW1lX3N1c3BlbmQpOwo+
ICAgKi8KPiAgaW50IHBtX2dlbmVyaWNfcnVudGltZV9yZXN1bWUoc3RydWN0IGRldmljZSAqZGV2
KQo+ICB7Cj4gLSAgICAgICBjb25zdCBzdHJ1Y3QgZGV2X3BtX29wcyAqcG0gPSBkZXYtPmRyaXZl
ciA/IGRldi0+ZHJpdmVyLT5wbSA6IE5VTEw7Cj4gLSAgICAgICBpbnQgcmV0Owo+IC0KPiAtICAg
ICAgIHJldCA9IHBtICYmIHBtLT5ydW50aW1lX3Jlc3VtZSA/IHBtLT5ydW50aW1lX3Jlc3VtZShk
ZXYpIDogMDsKPiArICAgICAgIGNvbnN0IHN0cnVjdCBkZXZfcG1fb3BzICpwbSA9IGRyaXZlcl90
b19wbShkZXYtPmRyaXZlcik7Cj4KPiAtICAgICAgIHJldHVybiByZXQ7Cj4gKyAgICAgICByZXR1
cm4gcG0gJiYgcG0tPnJ1bnRpbWVfcmVzdW1lID8gcG0tPnJ1bnRpbWVfcmVzdW1lKGRldikgOiAw
Owo+ICB9Cj4gIEVYUE9SVF9TWU1CT0xfR1BMKHBtX2dlbmVyaWNfcnVudGltZV9yZXN1bWUpOwo+
ICAjZW5kaWYgLyogQ09ORklHX1BNICovCj4gQEAgLTU3LDEzICs1MSwxMiBAQCBFWFBPUlRfU1lN
Qk9MX0dQTChwbV9nZW5lcmljX3J1bnRpbWVfcmVzdW1lKTsKPiAgICovCj4gIGludCBwbV9nZW5l
cmljX3ByZXBhcmUoc3RydWN0IGRldmljZSAqZGV2KQo+ICB7Cj4gLSAgICAgICBzdHJ1Y3QgZGV2
aWNlX2RyaXZlciAqZHJ2ID0gZGV2LT5kcml2ZXI7Cj4gLSAgICAgICBpbnQgcmV0ID0gMDsKPiAr
ICAgICAgIGNvbnN0IHN0cnVjdCBkZXZfcG1fb3BzICpwbSA9IGRyaXZlcl90b19wbShkZXYtPmRy
aXZlcik7Cj4KPiAtICAgICAgIGlmIChkcnYgJiYgZHJ2LT5wbSAmJiBkcnYtPnBtLT5wcmVwYXJl
KQo+IC0gICAgICAgICAgICAgICByZXQgPSBkcnYtPnBtLT5wcmVwYXJlKGRldik7Cj4gKyAgICAg
ICBpZiAocG0gJiYgcG0tPnByZXBhcmUpCj4gKyAgICAgICAgICAgICAgIHJldHVybiBwbS0+cHJl
cGFyZShkZXYpOwo+Cj4gLSAgICAgICByZXR1cm4gcmV0Owo+ICsgICAgICAgcmV0dXJuIDA7Cj4g
IH0KPgo+ICAvKioKPiBAQCAtNzIsNyArNjUsNyBAQCBpbnQgcG1fZ2VuZXJpY19wcmVwYXJlKHN0
cnVjdCBkZXZpY2UgKmRldikKPiAgICovCj4gIGludCBwbV9nZW5lcmljX3N1c3BlbmRfbm9pcnEo
c3RydWN0IGRldmljZSAqZGV2KQo+ICB7Cj4gLSAgICAgICBjb25zdCBzdHJ1Y3QgZGV2X3BtX29w
cyAqcG0gPSBkZXYtPmRyaXZlciA/IGRldi0+ZHJpdmVyLT5wbSA6IE5VTEw7Cj4gKyAgICAgICBj
b25zdCBzdHJ1Y3QgZGV2X3BtX29wcyAqcG0gPSBkcml2ZXJfdG9fcG0oZGV2LT5kcml2ZXIpOwo+
Cj4gICAgICAgICByZXR1cm4gcG0gJiYgcG0tPnN1c3BlbmRfbm9pcnEgPyBwbS0+c3VzcGVuZF9u
b2lycShkZXYpIDogMDsKPiAgfQo+IEBAIC04NCw3ICs3Nyw3IEBAIEVYUE9SVF9TWU1CT0xfR1BM
KHBtX2dlbmVyaWNfc3VzcGVuZF9ub2lycSk7Cj4gICAqLwo+ICBpbnQgcG1fZ2VuZXJpY19zdXNw
ZW5kX2xhdGUoc3RydWN0IGRldmljZSAqZGV2KQo+ICB7Cj4gLSAgICAgICBjb25zdCBzdHJ1Y3Qg
ZGV2X3BtX29wcyAqcG0gPSBkZXYtPmRyaXZlciA/IGRldi0+ZHJpdmVyLT5wbSA6IE5VTEw7Cj4g
KyAgICAgICBjb25zdCBzdHJ1Y3QgZGV2X3BtX29wcyAqcG0gPSBkcml2ZXJfdG9fcG0oZGV2LT5k
cml2ZXIpOwo+Cj4gICAgICAgICByZXR1cm4gcG0gJiYgcG0tPnN1c3BlbmRfbGF0ZSA/IHBtLT5z
dXNwZW5kX2xhdGUoZGV2KSA6IDA7Cj4gIH0KPiBAQCAtOTYsNyArODksNyBAQCBFWFBPUlRfU1lN
Qk9MX0dQTChwbV9nZW5lcmljX3N1c3BlbmRfbGF0ZSk7Cj4gICAqLwo+ICBpbnQgcG1fZ2VuZXJp
Y19zdXNwZW5kKHN0cnVjdCBkZXZpY2UgKmRldikKPiAgewo+IC0gICAgICAgY29uc3Qgc3RydWN0
IGRldl9wbV9vcHMgKnBtID0gZGV2LT5kcml2ZXIgPyBkZXYtPmRyaXZlci0+cG0gOiBOVUxMOwo+
ICsgICAgICAgY29uc3Qgc3RydWN0IGRldl9wbV9vcHMgKnBtID0gZHJpdmVyX3RvX3BtKGRldi0+
ZHJpdmVyKTsKPgo+ICAgICAgICAgcmV0dXJuIHBtICYmIHBtLT5zdXNwZW5kID8gcG0tPnN1c3Bl
bmQoZGV2KSA6IDA7Cj4gIH0KPiBAQCAtMTA4LDcgKzEwMSw3IEBAIEVYUE9SVF9TWU1CT0xfR1BM
KHBtX2dlbmVyaWNfc3VzcGVuZCk7Cj4gICAqLwo+ICBpbnQgcG1fZ2VuZXJpY19mcmVlemVfbm9p
cnEoc3RydWN0IGRldmljZSAqZGV2KQo+ICB7Cj4gLSAgICAgICBjb25zdCBzdHJ1Y3QgZGV2X3Bt
X29wcyAqcG0gPSBkZXYtPmRyaXZlciA/IGRldi0+ZHJpdmVyLT5wbSA6IE5VTEw7Cj4gKyAgICAg
ICBjb25zdCBzdHJ1Y3QgZGV2X3BtX29wcyAqcG0gPSBkcml2ZXJfdG9fcG0oZGV2LT5kcml2ZXIp
Owo+Cj4gICAgICAgICByZXR1cm4gcG0gJiYgcG0tPmZyZWV6ZV9ub2lycSA/IHBtLT5mcmVlemVf
bm9pcnEoZGV2KSA6IDA7Cj4gIH0KPiBAQCAtMTIwLDcgKzExMyw3IEBAIEVYUE9SVF9TWU1CT0xf
R1BMKHBtX2dlbmVyaWNfZnJlZXplX25vaXJxKTsKPiAgICovCj4gIGludCBwbV9nZW5lcmljX2Zy
ZWV6ZV9sYXRlKHN0cnVjdCBkZXZpY2UgKmRldikKPiAgewo+IC0gICAgICAgY29uc3Qgc3RydWN0
IGRldl9wbV9vcHMgKnBtID0gZGV2LT5kcml2ZXIgPyBkZXYtPmRyaXZlci0+cG0gOiBOVUxMOwo+
ICsgICAgICAgY29uc3Qgc3RydWN0IGRldl9wbV9vcHMgKnBtID0gZHJpdmVyX3RvX3BtKGRldi0+
ZHJpdmVyKTsKPgo+ICAgICAgICAgcmV0dXJuIHBtICYmIHBtLT5mcmVlemVfbGF0ZSA/IHBtLT5m
cmVlemVfbGF0ZShkZXYpIDogMDsKPiAgfQo+IEBAIC0xMzIsNyArMTI1LDcgQEAgRVhQT1JUX1NZ
TUJPTF9HUEwocG1fZ2VuZXJpY19mcmVlemVfbGF0ZSk7Cj4gICAqLwo+ICBpbnQgcG1fZ2VuZXJp
Y19mcmVlemUoc3RydWN0IGRldmljZSAqZGV2KQo+ICB7Cj4gLSAgICAgICBjb25zdCBzdHJ1Y3Qg
ZGV2X3BtX29wcyAqcG0gPSBkZXYtPmRyaXZlciA/IGRldi0+ZHJpdmVyLT5wbSA6IE5VTEw7Cj4g
KyAgICAgICBjb25zdCBzdHJ1Y3QgZGV2X3BtX29wcyAqcG0gPSBkcml2ZXJfdG9fcG0oZGV2LT5k
cml2ZXIpOwo+Cj4gICAgICAgICByZXR1cm4gcG0gJiYgcG0tPmZyZWV6ZSA/IHBtLT5mcmVlemUo
ZGV2KSA6IDA7Cj4gIH0KPiBAQCAtMTQ0LDcgKzEzNyw3IEBAIEVYUE9SVF9TWU1CT0xfR1BMKHBt
X2dlbmVyaWNfZnJlZXplKTsKPiAgICovCj4gIGludCBwbV9nZW5lcmljX3Bvd2Vyb2ZmX25vaXJx
KHN0cnVjdCBkZXZpY2UgKmRldikKPiAgewo+IC0gICAgICAgY29uc3Qgc3RydWN0IGRldl9wbV9v
cHMgKnBtID0gZGV2LT5kcml2ZXIgPyBkZXYtPmRyaXZlci0+cG0gOiBOVUxMOwo+ICsgICAgICAg
Y29uc3Qgc3RydWN0IGRldl9wbV9vcHMgKnBtID0gZHJpdmVyX3RvX3BtKGRldi0+ZHJpdmVyKTsK
Pgo+ICAgICAgICAgcmV0dXJuIHBtICYmIHBtLT5wb3dlcm9mZl9ub2lycSA/IHBtLT5wb3dlcm9m
Zl9ub2lycShkZXYpIDogMDsKPiAgfQo+IEBAIC0xNTYsNyArMTQ5LDcgQEAgRVhQT1JUX1NZTUJP
TF9HUEwocG1fZ2VuZXJpY19wb3dlcm9mZl9ub2lycSk7Cj4gICAqLwo+ICBpbnQgcG1fZ2VuZXJp
Y19wb3dlcm9mZl9sYXRlKHN0cnVjdCBkZXZpY2UgKmRldikKPiAgewo+IC0gICAgICAgY29uc3Qg
c3RydWN0IGRldl9wbV9vcHMgKnBtID0gZGV2LT5kcml2ZXIgPyBkZXYtPmRyaXZlci0+cG0gOiBO
VUxMOwo+ICsgICAgICAgY29uc3Qgc3RydWN0IGRldl9wbV9vcHMgKnBtID0gZHJpdmVyX3RvX3Bt
KGRldi0+ZHJpdmVyKTsKPgo+ICAgICAgICAgcmV0dXJuIHBtICYmIHBtLT5wb3dlcm9mZl9sYXRl
ID8gcG0tPnBvd2Vyb2ZmX2xhdGUoZGV2KSA6IDA7Cj4gIH0KPiBAQCAtMTY4LDcgKzE2MSw3IEBA
IEVYUE9SVF9TWU1CT0xfR1BMKHBtX2dlbmVyaWNfcG93ZXJvZmZfbGF0ZSk7Cj4gICAqLwo+ICBp
bnQgcG1fZ2VuZXJpY19wb3dlcm9mZihzdHJ1Y3QgZGV2aWNlICpkZXYpCj4gIHsKPiAtICAgICAg
IGNvbnN0IHN0cnVjdCBkZXZfcG1fb3BzICpwbSA9IGRldi0+ZHJpdmVyID8gZGV2LT5kcml2ZXIt
PnBtIDogTlVMTDsKPiArICAgICAgIGNvbnN0IHN0cnVjdCBkZXZfcG1fb3BzICpwbSA9IGRyaXZl
cl90b19wbShkZXYtPmRyaXZlcik7Cj4KPiAgICAgICAgIHJldHVybiBwbSAmJiBwbS0+cG93ZXJv
ZmYgPyBwbS0+cG93ZXJvZmYoZGV2KSA6IDA7Cj4gIH0KPiBAQCAtMTgwLDcgKzE3Myw3IEBAIEVY
UE9SVF9TWU1CT0xfR1BMKHBtX2dlbmVyaWNfcG93ZXJvZmYpOwo+ICAgKi8KPiAgaW50IHBtX2dl
bmVyaWNfdGhhd19ub2lycShzdHJ1Y3QgZGV2aWNlICpkZXYpCj4gIHsKPiAtICAgICAgIGNvbnN0
IHN0cnVjdCBkZXZfcG1fb3BzICpwbSA9IGRldi0+ZHJpdmVyID8gZGV2LT5kcml2ZXItPnBtIDog
TlVMTDsKPiArICAgICAgIGNvbnN0IHN0cnVjdCBkZXZfcG1fb3BzICpwbSA9IGRyaXZlcl90b19w
bShkZXYtPmRyaXZlcik7Cj4KPiAgICAgICAgIHJldHVybiBwbSAmJiBwbS0+dGhhd19ub2lycSA/
IHBtLT50aGF3X25vaXJxKGRldikgOiAwOwo+ICB9Cj4gQEAgLTE5Miw3ICsxODUsNyBAQCBFWFBP
UlRfU1lNQk9MX0dQTChwbV9nZW5lcmljX3RoYXdfbm9pcnEpOwo+ICAgKi8KPiAgaW50IHBtX2dl
bmVyaWNfdGhhd19lYXJseShzdHJ1Y3QgZGV2aWNlICpkZXYpCj4gIHsKPiAtICAgICAgIGNvbnN0
IHN0cnVjdCBkZXZfcG1fb3BzICpwbSA9IGRldi0+ZHJpdmVyID8gZGV2LT5kcml2ZXItPnBtIDog
TlVMTDsKPiArICAgICAgIGNvbnN0IHN0cnVjdCBkZXZfcG1fb3BzICpwbSA9IGRyaXZlcl90b19w
bShkZXYtPmRyaXZlcik7Cj4KPiAgICAgICAgIHJldHVybiBwbSAmJiBwbS0+dGhhd19lYXJseSA/
IHBtLT50aGF3X2Vhcmx5KGRldikgOiAwOwo+ICB9Cj4gQEAgLTIwNCw3ICsxOTcsNyBAQCBFWFBP
UlRfU1lNQk9MX0dQTChwbV9nZW5lcmljX3RoYXdfZWFybHkpOwo+ICAgKi8KPiAgaW50IHBtX2dl
bmVyaWNfdGhhdyhzdHJ1Y3QgZGV2aWNlICpkZXYpCj4gIHsKPiAtICAgICAgIGNvbnN0IHN0cnVj
dCBkZXZfcG1fb3BzICpwbSA9IGRldi0+ZHJpdmVyID8gZGV2LT5kcml2ZXItPnBtIDogTlVMTDsK
PiArICAgICAgIGNvbnN0IHN0cnVjdCBkZXZfcG1fb3BzICpwbSA9IGRyaXZlcl90b19wbShkZXYt
PmRyaXZlcik7Cj4KPiAgICAgICAgIHJldHVybiBwbSAmJiBwbS0+dGhhdyA/IHBtLT50aGF3KGRl
dikgOiAwOwo+ICB9Cj4gQEAgLTIxNiw3ICsyMDksNyBAQCBFWFBPUlRfU1lNQk9MX0dQTChwbV9n
ZW5lcmljX3RoYXcpOwo+ICAgKi8KPiAgaW50IHBtX2dlbmVyaWNfcmVzdW1lX25vaXJxKHN0cnVj
dCBkZXZpY2UgKmRldikKPiAgewo+IC0gICAgICAgY29uc3Qgc3RydWN0IGRldl9wbV9vcHMgKnBt
ID0gZGV2LT5kcml2ZXIgPyBkZXYtPmRyaXZlci0+cG0gOiBOVUxMOwo+ICsgICAgICAgY29uc3Qg
c3RydWN0IGRldl9wbV9vcHMgKnBtID0gZHJpdmVyX3RvX3BtKGRldi0+ZHJpdmVyKTsKPgo+ICAg
ICAgICAgcmV0dXJuIHBtICYmIHBtLT5yZXN1bWVfbm9pcnEgPyBwbS0+cmVzdW1lX25vaXJxKGRl
dikgOiAwOwo+ICB9Cj4gQEAgLTIyOCw3ICsyMjEsNyBAQCBFWFBPUlRfU1lNQk9MX0dQTChwbV9n
ZW5lcmljX3Jlc3VtZV9ub2lycSk7Cj4gICAqLwo+ICBpbnQgcG1fZ2VuZXJpY19yZXN1bWVfZWFy
bHkoc3RydWN0IGRldmljZSAqZGV2KQo+ICB7Cj4gLSAgICAgICBjb25zdCBzdHJ1Y3QgZGV2X3Bt
X29wcyAqcG0gPSBkZXYtPmRyaXZlciA/IGRldi0+ZHJpdmVyLT5wbSA6IE5VTEw7Cj4gKyAgICAg
ICBjb25zdCBzdHJ1Y3QgZGV2X3BtX29wcyAqcG0gPSBkcml2ZXJfdG9fcG0oZGV2LT5kcml2ZXIp
Owo+Cj4gICAgICAgICByZXR1cm4gcG0gJiYgcG0tPnJlc3VtZV9lYXJseSA/IHBtLT5yZXN1bWVf
ZWFybHkoZGV2KSA6IDA7Cj4gIH0KPiBAQCAtMjQwLDcgKzIzMyw3IEBAIEVYUE9SVF9TWU1CT0xf
R1BMKHBtX2dlbmVyaWNfcmVzdW1lX2Vhcmx5KTsKPiAgICovCj4gIGludCBwbV9nZW5lcmljX3Jl
c3VtZShzdHJ1Y3QgZGV2aWNlICpkZXYpCj4gIHsKPiAtICAgICAgIGNvbnN0IHN0cnVjdCBkZXZf
cG1fb3BzICpwbSA9IGRldi0+ZHJpdmVyID8gZGV2LT5kcml2ZXItPnBtIDogTlVMTDsKPiArICAg
ICAgIGNvbnN0IHN0cnVjdCBkZXZfcG1fb3BzICpwbSA9IGRyaXZlcl90b19wbShkZXYtPmRyaXZl
cik7Cj4KPiAgICAgICAgIHJldHVybiBwbSAmJiBwbS0+cmVzdW1lID8gcG0tPnJlc3VtZShkZXYp
IDogMDsKPiAgfQo+IEBAIC0yNTIsNyArMjQ1LDcgQEAgRVhQT1JUX1NZTUJPTF9HUEwocG1fZ2Vu
ZXJpY19yZXN1bWUpOwo+ICAgKi8KPiAgaW50IHBtX2dlbmVyaWNfcmVzdG9yZV9ub2lycShzdHJ1
Y3QgZGV2aWNlICpkZXYpCj4gIHsKPiAtICAgICAgIGNvbnN0IHN0cnVjdCBkZXZfcG1fb3BzICpw
bSA9IGRldi0+ZHJpdmVyID8gZGV2LT5kcml2ZXItPnBtIDogTlVMTDsKPiArICAgICAgIGNvbnN0
IHN0cnVjdCBkZXZfcG1fb3BzICpwbSA9IGRyaXZlcl90b19wbShkZXYtPmRyaXZlcik7Cj4KPiAg
ICAgICAgIHJldHVybiBwbSAmJiBwbS0+cmVzdG9yZV9ub2lycSA/IHBtLT5yZXN0b3JlX25vaXJx
KGRldikgOiAwOwo+ICB9Cj4gQEAgLTI2NCw3ICsyNTcsNyBAQCBFWFBPUlRfU1lNQk9MX0dQTChw
bV9nZW5lcmljX3Jlc3RvcmVfbm9pcnEpOwo+ICAgKi8KPiAgaW50IHBtX2dlbmVyaWNfcmVzdG9y
ZV9lYXJseShzdHJ1Y3QgZGV2aWNlICpkZXYpCj4gIHsKPiAtICAgICAgIGNvbnN0IHN0cnVjdCBk
ZXZfcG1fb3BzICpwbSA9IGRldi0+ZHJpdmVyID8gZGV2LT5kcml2ZXItPnBtIDogTlVMTDsKPiAr
ICAgICAgIGNvbnN0IHN0cnVjdCBkZXZfcG1fb3BzICpwbSA9IGRyaXZlcl90b19wbShkZXYtPmRy
aXZlcik7Cj4KPiAgICAgICAgIHJldHVybiBwbSAmJiBwbS0+cmVzdG9yZV9lYXJseSA/IHBtLT5y
ZXN0b3JlX2Vhcmx5KGRldikgOiAwOwo+ICB9Cj4gQEAgLTI3Niw3ICsyNjksNyBAQCBFWFBPUlRf
U1lNQk9MX0dQTChwbV9nZW5lcmljX3Jlc3RvcmVfZWFybHkpOwo+ICAgKi8KPiAgaW50IHBtX2dl
bmVyaWNfcmVzdG9yZShzdHJ1Y3QgZGV2aWNlICpkZXYpCj4gIHsKPiAtICAgICAgIGNvbnN0IHN0
cnVjdCBkZXZfcG1fb3BzICpwbSA9IGRldi0+ZHJpdmVyID8gZGV2LT5kcml2ZXItPnBtIDogTlVM
TDsKPiArICAgICAgIGNvbnN0IHN0cnVjdCBkZXZfcG1fb3BzICpwbSA9IGRyaXZlcl90b19wbShk
ZXYtPmRyaXZlcik7Cj4KPiAgICAgICAgIHJldHVybiBwbSAmJiBwbS0+cmVzdG9yZSA/IHBtLT5y
ZXN0b3JlKGRldikgOiAwOwo+ICB9Cj4gQEAgLTI5MCw5ICsyODMsOSBAQCBFWFBPUlRfU1lNQk9M
X0dQTChwbV9nZW5lcmljX3Jlc3RvcmUpOwo+ICAgKi8KPiAgdm9pZCBwbV9nZW5lcmljX2NvbXBs
ZXRlKHN0cnVjdCBkZXZpY2UgKmRldikKPiAgewo+IC0gICAgICAgc3RydWN0IGRldmljZV9kcml2
ZXIgKmRydiA9IGRldi0+ZHJpdmVyOwo+ICsgICAgICAgY29uc3Qgc3RydWN0IGRldl9wbV9vcHMg
KnBtID0gZHJpdmVyX3RvX3BtKGRldi0+ZHJpdmVyKTsKPgo+IC0gICAgICAgaWYgKGRydiAmJiBk
cnYtPnBtICYmIGRydi0+cG0tPmNvbXBsZXRlKQo+IC0gICAgICAgICAgICAgICBkcnYtPnBtLT5j
b21wbGV0ZShkZXYpOwo+ICsgICAgICAgaWYgKHBtICYmIHBtLT5jb21wbGV0ZSkKPiArICAgICAg
ICAgICAgICAgcG0tPmNvbXBsZXRlKGRldik7Cj4gIH0KPiAgI2VuZGlmIC8qIENPTkZJR19QTV9T
TEVFUCAqLwo+IGRpZmYgLS1naXQgYS9kcml2ZXJzL2Jhc2UvcG93ZXIvbWFpbi5jIGIvZHJpdmVy
cy9iYXNlL3Bvd2VyL21haW4uYwo+IGluZGV4IDBlMDdlMTdjMmRlZi4uNmM0MWRhMGJlYmIwIDEw
MDY0NAo+IC0tLSBhL2RyaXZlcnMvYmFzZS9wb3dlci9tYWluLmMKPiArKysgYi9kcml2ZXJzL2Jh
c2UvcG93ZXIvbWFpbi5jCj4gQEAgLTY0MCw2ICs2NDAsNyBAQCBzdGF0aWMgcG1fY2FsbGJhY2tf
dCBkcG1fc3Vic3lzX3N1c3BlbmRfbGF0ZV9jYihzdHJ1Y3QgZGV2aWNlICpkZXYsCj4gIHN0YXRp
YyBpbnQgZGV2aWNlX3Jlc3VtZV9ub2lycShzdHJ1Y3QgZGV2aWNlICpkZXYsIHBtX21lc3NhZ2Vf
dCBzdGF0ZSwgYm9vbCBhc3luYykKPiAgewo+ICAgICAgICAgcG1fY2FsbGJhY2tfdCBjYWxsYmFj
azsKPiArICAgICAgIGNvbnN0IHN0cnVjdCBkZXZfcG1fb3BzICpwbTsKPiAgICAgICAgIGNvbnN0
IGNoYXIgKmluZm87Cj4gICAgICAgICBib29sIHNraXBfcmVzdW1lOwo+ICAgICAgICAgaW50IGVy
cm9yID0gMDsKPiBAQCAtNjg3LDkgKzY4OCwxMCBAQCBzdGF0aWMgaW50IGRldmljZV9yZXN1bWVf
bm9pcnEoc3RydWN0IGRldmljZSAqZGV2LCBwbV9tZXNzYWdlX3Qgc3RhdGUsIGJvb2wgYXN5bgo+
ICAgICAgICAgICAgICAgICB9Cj4gICAgICAgICB9Cj4KPiAtICAgICAgIGlmIChkZXYtPmRyaXZl
ciAmJiBkZXYtPmRyaXZlci0+cG0pIHsKPiArICAgICAgIHBtID0gZHJpdmVyX3RvX3BtKGRldi0+
ZHJpdmVyKTsKPiArICAgICAgIGlmIChwbSkgewo+ICAgICAgICAgICAgICAgICBpbmZvID0gIm5v
aXJxIGRyaXZlciAiOwo+IC0gICAgICAgICAgICAgICBjYWxsYmFjayA9IHBtX25vaXJxX29wKGRl
di0+ZHJpdmVyLT5wbSwgc3RhdGUpOwo+ICsgICAgICAgICAgICAgICBjYWxsYmFjayA9IHBtX25v
aXJxX29wKHBtLCBzdGF0ZSk7Cj4gICAgICAgICB9Cj4KPiAgUnVuOgo+IEBAIC04NTAsNiArODUy
LDcgQEAgc3RhdGljIHBtX2NhbGxiYWNrX3QgZHBtX3N1YnN5c19yZXN1bWVfZWFybHlfY2Ioc3Ry
dWN0IGRldmljZSAqZGV2LAo+ICBzdGF0aWMgaW50IGRldmljZV9yZXN1bWVfZWFybHkoc3RydWN0
IGRldmljZSAqZGV2LCBwbV9tZXNzYWdlX3Qgc3RhdGUsIGJvb2wgYXN5bmMpCj4gIHsKPiAgICAg
ICAgIHBtX2NhbGxiYWNrX3QgY2FsbGJhY2s7Cj4gKyAgICAgICBjb25zdCBzdHJ1Y3QgZGV2X3Bt
X29wcyAqcG07Cj4gICAgICAgICBjb25zdCBjaGFyICppbmZvOwo+ICAgICAgICAgaW50IGVycm9y
ID0gMDsKPgo+IEBAIC04NjcsOSArODcwLDEwIEBAIHN0YXRpYyBpbnQgZGV2aWNlX3Jlc3VtZV9l
YXJseShzdHJ1Y3QgZGV2aWNlICpkZXYsIHBtX21lc3NhZ2VfdCBzdGF0ZSwgYm9vbCBhc3luCj4K
PiAgICAgICAgIGNhbGxiYWNrID0gZHBtX3N1YnN5c19yZXN1bWVfZWFybHlfY2IoZGV2LCBzdGF0
ZSwgJmluZm8pOwo+Cj4gLSAgICAgICBpZiAoIWNhbGxiYWNrICYmIGRldi0+ZHJpdmVyICYmIGRl
di0+ZHJpdmVyLT5wbSkgewo+ICsgICAgICAgcG0gPSBkcml2ZXJfdG9fcG0oZGV2LT5kcml2ZXIp
Owo+ICsgICAgICAgaWYgKCFjYWxsYmFjayAmJiBwbSkgewo+ICAgICAgICAgICAgICAgICBpbmZv
ID0gImVhcmx5IGRyaXZlciAiOwo+IC0gICAgICAgICAgICAgICBjYWxsYmFjayA9IHBtX2xhdGVf
ZWFybHlfb3AoZGV2LT5kcml2ZXItPnBtLCBzdGF0ZSk7Cj4gKyAgICAgICAgICAgICAgIGNhbGxi
YWNrID0gcG1fbGF0ZV9lYXJseV9vcChwbSwgc3RhdGUpOwo+ICAgICAgICAgfQo+Cj4gICAgICAg
ICBlcnJvciA9IGRwbV9ydW5fY2FsbGJhY2soY2FsbGJhY2ssIGRldiwgc3RhdGUsIGluZm8pOwo+
IEBAIC05NjMsNiArOTY3LDcgQEAgc3RhdGljIGludCBkZXZpY2VfcmVzdW1lKHN0cnVjdCBkZXZp
Y2UgKmRldiwgcG1fbWVzc2FnZV90IHN0YXRlLCBib29sIGFzeW5jKQo+ICB7Cj4gICAgICAgICBw
bV9jYWxsYmFja190IGNhbGxiYWNrID0gTlVMTDsKPiAgICAgICAgIGNvbnN0IGNoYXIgKmluZm8g
PSBOVUxMOwo+ICsgICAgICAgY29uc3Qgc3RydWN0IGRldl9wbV9vcHMgKnBtID0gTlVMTDsKPiAg
ICAgICAgIGludCBlcnJvciA9IDA7Cj4gICAgICAgICBERUNMQVJFX0RQTV9XQVRDSERPR19PTl9T
VEFDSyh3ZCk7Cj4KPiBAQCAtMTAyMyw5ICsxMDI4LDEwIEBAIHN0YXRpYyBpbnQgZGV2aWNlX3Jl
c3VtZShzdHJ1Y3QgZGV2aWNlICpkZXYsIHBtX21lc3NhZ2VfdCBzdGF0ZSwgYm9vbCBhc3luYykK
PiAgICAgICAgIH0KPgo+ICAgRHJpdmVyOgo+IC0gICAgICAgaWYgKCFjYWxsYmFjayAmJiBkZXYt
PmRyaXZlciAmJiBkZXYtPmRyaXZlci0+cG0pIHsKPiArICAgICAgIHBtID0gZHJpdmVyX3RvX3Bt
KGRldi0+ZHJpdmVyKTsKPiArICAgICAgIGlmICghY2FsbGJhY2sgJiYgcG0pIHsKPiAgICAgICAg
ICAgICAgICAgaW5mbyA9ICJkcml2ZXIgIjsKPiAtICAgICAgICAgICAgICAgY2FsbGJhY2sgPSBw
bV9vcChkZXYtPmRyaXZlci0+cG0sIHN0YXRlKTsKPiArICAgICAgICAgICAgICAgY2FsbGJhY2sg
PSBwbV9vcChwbSwgc3RhdGUpOwo+ICAgICAgICAgfQo+Cj4gICBFbmQ6Cj4gQEAgLTExMTYsNiAr
MTEyMiw3IEBAIHZvaWQgZHBtX3Jlc3VtZShwbV9tZXNzYWdlX3Qgc3RhdGUpCj4gIHN0YXRpYyB2
b2lkIGRldmljZV9jb21wbGV0ZShzdHJ1Y3QgZGV2aWNlICpkZXYsIHBtX21lc3NhZ2VfdCBzdGF0
ZSkKPiAgewo+ICAgICAgICAgdm9pZCAoKmNhbGxiYWNrKShzdHJ1Y3QgZGV2aWNlICopID0gTlVM
TDsKPiArICAgICAgIGNvbnN0IHN0cnVjdCBkZXZfcG1fb3BzICpwbSA9IE5VTEw7Cj4gICAgICAg
ICBjb25zdCBjaGFyICppbmZvID0gTlVMTDsKPgo+ICAgICAgICAgaWYgKGRldi0+cG93ZXIuc3lz
Y29yZSkKPiBAQCAtMTEzNyw5ICsxMTQ0LDEwIEBAIHN0YXRpYyB2b2lkIGRldmljZV9jb21wbGV0
ZShzdHJ1Y3QgZGV2aWNlICpkZXYsIHBtX21lc3NhZ2VfdCBzdGF0ZSkKPiAgICAgICAgICAgICAg
ICAgY2FsbGJhY2sgPSBkZXYtPmJ1cy0+cG0tPmNvbXBsZXRlOwo+ICAgICAgICAgfQo+Cj4gLSAg
ICAgICBpZiAoIWNhbGxiYWNrICYmIGRldi0+ZHJpdmVyICYmIGRldi0+ZHJpdmVyLT5wbSkgewo+
ICsgICAgICAgcG0gPSBkcml2ZXJfdG9fcG0oZGV2LT5kcml2ZXIpOwo+ICsgICAgICAgaWYgKCFj
YWxsYmFjayAmJiBwbSkgewo+ICAgICAgICAgICAgICAgICBpbmZvID0gImNvbXBsZXRpbmcgZHJp
dmVyICI7Cj4gLSAgICAgICAgICAgICAgIGNhbGxiYWNrID0gZGV2LT5kcml2ZXItPnBtLT5jb21w
bGV0ZTsKPiArICAgICAgICAgICAgICAgY2FsbGJhY2sgPSBwbS0+Y29tcGxldGU7Cj4gICAgICAg
ICB9Cj4KPiAgICAgICAgIGlmIChjYWxsYmFjaykgewo+IEBAIC0xMzEyLDYgKzEzMjAsNyBAQCBz
dGF0aWMgYm9vbCBkZXZpY2VfbXVzdF9yZXN1bWUoc3RydWN0IGRldmljZSAqZGV2LCBwbV9tZXNz
YWdlX3Qgc3RhdGUsCj4gIHN0YXRpYyBpbnQgX19kZXZpY2Vfc3VzcGVuZF9ub2lycShzdHJ1Y3Qg
ZGV2aWNlICpkZXYsIHBtX21lc3NhZ2VfdCBzdGF0ZSwgYm9vbCBhc3luYykKPiAgewo+ICAgICAg
ICAgcG1fY2FsbGJhY2tfdCBjYWxsYmFjazsKPiArICAgICAgIGNvbnN0IHN0cnVjdCBkZXZfcG1f
b3BzICpwbTsKPiAgICAgICAgIGNvbnN0IGNoYXIgKmluZm87Cj4gICAgICAgICBib29sIG5vX3N1
YnN5c19jYiA9IGZhbHNlOwo+ICAgICAgICAgaW50IGVycm9yID0gMDsKPiBAQCAtMTMzNiw5ICsx
MzQ1LDEwIEBAIHN0YXRpYyBpbnQgX19kZXZpY2Vfc3VzcGVuZF9ub2lycShzdHJ1Y3QgZGV2aWNl
ICpkZXYsIHBtX21lc3NhZ2VfdCBzdGF0ZSwgYm9vbCBhCj4gICAgICAgICBpZiAoZGV2X3BtX3Nt
YXJ0X3N1c3BlbmRfYW5kX3N1c3BlbmRlZChkZXYpICYmIG5vX3N1YnN5c19jYikKPiAgICAgICAg
ICAgICAgICAgZ290byBTa2lwOwo+Cj4gLSAgICAgICBpZiAoZGV2LT5kcml2ZXIgJiYgZGV2LT5k
cml2ZXItPnBtKSB7Cj4gKyAgICAgICBwbSA9IGRyaXZlcl90b19wbShkZXYtPmRyaXZlcik7Cj4g
KyAgICAgICBpZiAocG0pIHsKPiAgICAgICAgICAgICAgICAgaW5mbyA9ICJub2lycSBkcml2ZXIg
IjsKPiAtICAgICAgICAgICAgICAgY2FsbGJhY2sgPSBwbV9ub2lycV9vcChkZXYtPmRyaXZlci0+
cG0sIHN0YXRlKTsKPiArICAgICAgICAgICAgICAgY2FsbGJhY2sgPSBwbV9ub2lycV9vcChwbSwg
c3RhdGUpOwo+ICAgICAgICAgfQo+Cj4gIFJ1bjoKPiBAQCAtMTUxNCw2ICsxNTI0LDcgQEAgc3Rh
dGljIHBtX2NhbGxiYWNrX3QgZHBtX3N1YnN5c19zdXNwZW5kX2xhdGVfY2Ioc3RydWN0IGRldmlj
ZSAqZGV2LAo+ICBzdGF0aWMgaW50IF9fZGV2aWNlX3N1c3BlbmRfbGF0ZShzdHJ1Y3QgZGV2aWNl
ICpkZXYsIHBtX21lc3NhZ2VfdCBzdGF0ZSwgYm9vbCBhc3luYykKPiAgewo+ICAgICAgICAgcG1f
Y2FsbGJhY2tfdCBjYWxsYmFjazsKPiArICAgICAgIGNvbnN0IHN0cnVjdCBkZXZfcG1fb3BzICpw
bTsKPiAgICAgICAgIGNvbnN0IGNoYXIgKmluZm87Cj4gICAgICAgICBpbnQgZXJyb3IgPSAwOwo+
Cj4gQEAgLTE1NDMsOSArMTU1NCwxMCBAQCBzdGF0aWMgaW50IF9fZGV2aWNlX3N1c3BlbmRfbGF0
ZShzdHJ1Y3QgZGV2aWNlICpkZXYsIHBtX21lc3NhZ2VfdCBzdGF0ZSwgYm9vbCBhcwo+ICAgICAg
ICAgICAgICFkcG1fc3Vic3lzX3N1c3BlbmRfbm9pcnFfY2IoZGV2LCBzdGF0ZSwgTlVMTCkpCj4g
ICAgICAgICAgICAgICAgIGdvdG8gU2tpcDsKPgo+IC0gICAgICAgaWYgKGRldi0+ZHJpdmVyICYm
IGRldi0+ZHJpdmVyLT5wbSkgewo+ICsgICAgICAgcG0gPSBkcml2ZXJfdG9fcG0oZGV2LT5kcml2
ZXIpOwo+ICsgICAgICAgaWYgKHBtKSB7Cj4gICAgICAgICAgICAgICAgIGluZm8gPSAibGF0ZSBk
cml2ZXIgIjsKPiAtICAgICAgICAgICAgICAgY2FsbGJhY2sgPSBwbV9sYXRlX2Vhcmx5X29wKGRl
di0+ZHJpdmVyLT5wbSwgc3RhdGUpOwo+ICsgICAgICAgICAgICAgICBjYWxsYmFjayA9IHBtX2xh
dGVfZWFybHlfb3AocG0sIHN0YXRlKTsKPiAgICAgICAgIH0KPgo+ICBSdW46Cj4gQEAgLTE3MTcs
NiArMTcyOSw3IEBAIHN0YXRpYyB2b2lkIGRwbV9jbGVhcl9zdXBlcmlvcnNfZGlyZWN0X2NvbXBs
ZXRlKHN0cnVjdCBkZXZpY2UgKmRldikKPiAgc3RhdGljIGludCBfX2RldmljZV9zdXNwZW5kKHN0
cnVjdCBkZXZpY2UgKmRldiwgcG1fbWVzc2FnZV90IHN0YXRlLCBib29sIGFzeW5jKQo+ICB7Cj4g
ICAgICAgICBwbV9jYWxsYmFja190IGNhbGxiYWNrID0gTlVMTDsKPiArICAgICAgIGNvbnN0IHN0
cnVjdCBkZXZfcG1fb3BzICpwbSA9IE5VTEw7Cj4gICAgICAgICBjb25zdCBjaGFyICppbmZvID0g
TlVMTDsKPiAgICAgICAgIGludCBlcnJvciA9IDA7Cj4gICAgICAgICBERUNMQVJFX0RQTV9XQVRD
SERPR19PTl9TVEFDSyh3ZCk7Cj4gQEAgLTE4MDMsOSArMTgxNiwxMCBAQCBzdGF0aWMgaW50IF9f
ZGV2aWNlX3N1c3BlbmQoc3RydWN0IGRldmljZSAqZGV2LCBwbV9tZXNzYWdlX3Qgc3RhdGUsIGJv
b2wgYXN5bmMpCj4gICAgICAgICB9Cj4KPiAgIFJ1bjoKPiAtICAgICAgIGlmICghY2FsbGJhY2sg
JiYgZGV2LT5kcml2ZXIgJiYgZGV2LT5kcml2ZXItPnBtKSB7Cj4gKyAgICAgICBwbSA9IGRyaXZl
cl90b19wbShkZXYtPmRyaXZlcik7Cj4gKyAgICAgICBpZiAoIWNhbGxiYWNrICYmIHBtKSB7Cj4g
ICAgICAgICAgICAgICAgIGluZm8gPSAiZHJpdmVyICI7Cj4gLSAgICAgICAgICAgICAgIGNhbGxi
YWNrID0gcG1fb3AoZGV2LT5kcml2ZXItPnBtLCBzdGF0ZSk7Cj4gKyAgICAgICAgICAgICAgIGNh
bGxiYWNrID0gcG1fb3AocG0sIHN0YXRlKTsKPiAgICAgICAgIH0KPgo+ICAgICAgICAgZXJyb3Ig
PSBkcG1fcnVuX2NhbGxiYWNrKGNhbGxiYWNrLCBkZXYsIHN0YXRlLCBpbmZvKTsKPiBAQCAtMTkx
Nyw2ICsxOTMxLDcgQEAgaW50IGRwbV9zdXNwZW5kKHBtX21lc3NhZ2VfdCBzdGF0ZSkKPiAgc3Rh
dGljIGludCBkZXZpY2VfcHJlcGFyZShzdHJ1Y3QgZGV2aWNlICpkZXYsIHBtX21lc3NhZ2VfdCBz
dGF0ZSkKPiAgewo+ICAgICAgICAgaW50ICgqY2FsbGJhY2spKHN0cnVjdCBkZXZpY2UgKikgPSBO
VUxMOwo+ICsgICAgICAgY29uc3Qgc3RydWN0IGRldl9wbV9vcHMgKnBtID0gTlVMTDsKPiAgICAg
ICAgIGludCByZXQgPSAwOwo+Cj4gICAgICAgICBpZiAoZGV2LT5wb3dlci5zeXNjb3JlKQo+IEBA
IC0xOTQ2LDggKzE5NjEsOSBAQCBzdGF0aWMgaW50IGRldmljZV9wcmVwYXJlKHN0cnVjdCBkZXZp
Y2UgKmRldiwgcG1fbWVzc2FnZV90IHN0YXRlKQo+ICAgICAgICAgZWxzZSBpZiAoZGV2LT5idXMg
JiYgZGV2LT5idXMtPnBtKQo+ICAgICAgICAgICAgICAgICBjYWxsYmFjayA9IGRldi0+YnVzLT5w
bS0+cHJlcGFyZTsKPgo+IC0gICAgICAgaWYgKCFjYWxsYmFjayAmJiBkZXYtPmRyaXZlciAmJiBk
ZXYtPmRyaXZlci0+cG0pCj4gLSAgICAgICAgICAgICAgIGNhbGxiYWNrID0gZGV2LT5kcml2ZXIt
PnBtLT5wcmVwYXJlOwo+ICsgICAgICAgcG0gPSBkcml2ZXJfdG9fcG0oZGV2LT5kcml2ZXIpOwo+
ICsgICAgICAgaWYgKCFjYWxsYmFjayAmJiBwbSkKPiArICAgICAgICAgICAgICAgY2FsbGJhY2sg
PSBwbS0+cHJlcGFyZTsKPgo+ICAgICAgICAgaWYgKGNhbGxiYWNrKQo+ICAgICAgICAgICAgICAg
ICByZXQgPSBjYWxsYmFjayhkZXYpOwo+IGRpZmYgLS1naXQgYS9kcml2ZXJzL2Jhc2UvcG93ZXIv
cnVudGltZS5jIGIvZHJpdmVycy9iYXNlL3Bvd2VyL3J1bnRpbWUuYwo+IGluZGV4IDk5YzdkYTEx
MmM5NS4uYzE0MjgyNGM3NTQxIDEwMDY0NAo+IC0tLSBhL2RyaXZlcnMvYmFzZS9wb3dlci9ydW50
aW1lLmMKPiArKysgYi9kcml2ZXJzL2Jhc2UvcG93ZXIvcnVudGltZS5jCj4gQEAgLTIxLDcgKzIx
LDcgQEAgdHlwZWRlZiBpbnQgKCpwbV9jYWxsYmFja190KShzdHJ1Y3QgZGV2aWNlICopOwo+ICBz
dGF0aWMgcG1fY2FsbGJhY2tfdCBfX3JwbV9nZXRfY2FsbGJhY2soc3RydWN0IGRldmljZSAqZGV2
LCBzaXplX3QgY2Jfb2Zmc2V0KQo+ICB7Cj4gICAgICAgICBwbV9jYWxsYmFja190IGNiOwo+IC0g
ICAgICAgY29uc3Qgc3RydWN0IGRldl9wbV9vcHMgKm9wczsKPiArICAgICAgIGNvbnN0IHN0cnVj
dCBkZXZfcG1fb3BzICpvcHMsICpwbTsKPgo+ICAgICAgICAgaWYgKGRldi0+cG1fZG9tYWluKQo+
ICAgICAgICAgICAgICAgICBvcHMgPSAmZGV2LT5wbV9kb21haW4tPm9wczsKPiBAQCAtMzksOCAr
MzksOSBAQCBzdGF0aWMgcG1fY2FsbGJhY2tfdCBfX3JwbV9nZXRfY2FsbGJhY2soc3RydWN0IGRl
dmljZSAqZGV2LCBzaXplX3QgY2Jfb2Zmc2V0KQo+ICAgICAgICAgZWxzZQo+ICAgICAgICAgICAg
ICAgICBjYiA9IE5VTEw7Cj4KPiAtICAgICAgIGlmICghY2IgJiYgZGV2LT5kcml2ZXIgJiYgZGV2
LT5kcml2ZXItPnBtKQo+IC0gICAgICAgICAgICAgICBjYiA9ICoocG1fY2FsbGJhY2tfdCAqKSgo
dm9pZCAqKWRldi0+ZHJpdmVyLT5wbSArIGNiX29mZnNldCk7Cj4gKyAgICAgICBwbSA9IGRyaXZl
cl90b19wbShkZXYtPmRyaXZlcik7Cj4gKyAgICAgICBpZiAoIWNiICYmIHBtKQo+ICsgICAgICAg
ICAgICAgICBjYiA9ICoocG1fY2FsbGJhY2tfdCAqKSgodm9pZCAqKXBtICsgY2Jfb2Zmc2V0KTsK
Pgo+ICAgICAgICAgcmV0dXJuIGNiOwo+ICB9Cj4gLS0KPiAyLjI2LjIKPgpfX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpncmV5YnVzLWRldiBtYWlsaW5nIGxp
c3QKZ3JleWJ1cy1kZXZAbGlzdHMubGluYXJvLm9yZwpodHRwczovL2xpc3RzLmxpbmFyby5vcmcv
bWFpbG1hbi9saXN0aW5mby9ncmV5YnVzLWRldgo=
