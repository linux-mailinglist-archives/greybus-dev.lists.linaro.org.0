Return-Path: <greybus-dev-bounces@lists.linaro.org>
X-Original-To: lists+greybus-dev@lfdr.de
Delivered-To: lists+greybus-dev@lfdr.de
Received: from lists.linaro.org (lists.linaro.org [107.22.173.205])
	by mail.lfdr.de (Postfix) with ESMTPS id EFEDE1E1D0A
	for <lists+greybus-dev@lfdr.de>; Tue, 26 May 2020 10:15:24 +0200 (CEST)
Received: from lists.linaro.org (localhost [127.0.0.1])
	by lists.linaro.org (Postfix) with ESMTP id 0EBD261805
	for <lists+greybus-dev@lfdr.de>; Tue, 26 May 2020 08:15:24 +0000 (UTC)
Received: by lists.linaro.org (Postfix, from userid 109)
	id 0366B618D3; Tue, 26 May 2020 08:15:23 +0000 (UTC)
X-Spam-Checker-Version: SpamAssassin 3.4.2 (2018-09-13) on lists.linaro.org
X-Spam-Level: 
X-Spam-Status: No, score=-2.9 required=5.0 tests=BAYES_00,MAILING_LIST_MULTI,
	RCVD_IN_DNSWL_BLOCKED,RCVD_IN_MSPIKE_H3,RCVD_IN_MSPIKE_WL,
	SPF_HELO_NONE autolearn=disabled version=3.4.2
Received: from lists.linaro.org (localhost [127.0.0.1])
	by lists.linaro.org (Postfix) with ESMTP id E0BAF6601E;
	Tue, 26 May 2020 08:11:03 +0000 (UTC)
X-Original-To: greybus-dev@lists.linaro.org
Delivered-To: greybus-dev@lists.linaro.org
Received: from lists.linaro.org (localhost [127.0.0.1])
 by lists.linaro.org (Postfix) with ESMTP id 75467618F4
 for <greybus-dev@lists.linaro.org>; Mon, 25 May 2020 18:26:37 +0000 (UTC)
Received: by lists.linaro.org (Postfix, from userid 109)
 id 67DD06193C; Mon, 25 May 2020 18:26:37 +0000 (UTC)
Received: from mail-ej1-f67.google.com (mail-ej1-f67.google.com
 [209.85.218.67])
 by lists.linaro.org (Postfix) with ESMTPS id EBDBA619D9
 for <greybus-dev@lists.linaro.org>; Mon, 25 May 2020 18:26:22 +0000 (UTC)
Received: by mail-ej1-f67.google.com with SMTP id d7so21340416eja.7
 for <greybus-dev@lists.linaro.org>; Mon, 25 May 2020 11:26:22 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=zC1sdnSC7gmB2OcNZjocITMtxNUn1YHh0qE5EhXuaW4=;
 b=N8ItRS3qBZIOF8NWlyWEOYA6P7s+WkH/tAZT0slYR/A0jTAEtK+8/JNvYncNEhH3HO
 pPe9uDKDNckeapyOVgmVj9Ga/0/mr7xf0xqSs5mzGVvUIBB5HyPB9qGuTf348YJWkY2l
 ZsqOEdLgxW2BbfXT1DH8IZMaolnBaBVM2rdbtpNICWUjRN+Dpd3ODXUfJ/3jL2BndlBb
 3D+iuWqvRRfQfEyr30Qh/hl9tt1h/2Wdq75CwH/mLyOZvU0fORoPMUN+m+Ma9a8w4lWZ
 pgbWGCLFSWIf6CC9N+1rSEZKs68rzv4kNJRT3oa5PHtkPsqGBeziEX7M3k+fduWF/Bcu
 B3Ow==
X-Gm-Message-State: AOAM530P5uV+/sMsQc0iF8JugFJWbbmmRAq6kGHWE/BzYtqqQiCFpSk3
 2oGyokbYIATbNj/UwuDRnQA=
X-Google-Smtp-Source: ABdhPJwAZcGCs5OVpkzmitXxPnlCt0gtxwYqTDvcBpN73Kp+EmhxEze7qyyPuNofrda5TH25DnLshg==
X-Received: by 2002:a17:906:914a:: with SMTP id
 y10mr19232438ejw.355.1590431181904; 
 Mon, 25 May 2020 11:26:21 -0700 (PDT)
Received: from workstation.lan ([95.155.85.46])
 by smtp.gmail.com with ESMTPSA id n15sm15555707ejs.10.2020.05.25.11.26.20
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Mon, 25 May 2020 11:26:21 -0700 (PDT)
From: =?UTF-8?q?Krzysztof=20Wilczy=C5=84ski?= <kw@linux.com>
To: Dan Carpenter <dan.carpenter@oracle.com>
Date: Mon, 25 May 2020 18:26:07 +0000
Message-Id: <20200525182608.1823735-8-kw@linux.com>
X-Mailer: git-send-email 2.26.2
In-Reply-To: <20200525182608.1823735-1-kw@linux.com>
References: <20200525182608.1823735-1-kw@linux.com>
MIME-Version: 1.0
X-Virus-Scanned: ClamAV using ClamSMTP
X-Mailman-Approved-At: Tue, 26 May 2020 08:10:58 +0000
Cc: Ulf Hansson <ulf.hansson@linaro.org>, linux-pci@vger.kernel.org,
 Bjorn Andersson <bjorn.andersson@linaro.org>, Pavel Machek <pavel@ucw.cz>,
 linux-s390@vger.kernel.org, linux-scsi@vger.kernel.org,
 Kevin Hilman <khilman@kernel.org>, Julian Wiedmann <jwi@linux.ibm.com>,
 linux-acpi@vger.kernel.org, Jakub Kicinski <kuba@kernel.org>,
 Len Brown <lenb@kernel.org>, linux-pm@vger.kernel.org,
 "James E.J. Bottomley" <jejb@linux.ibm.com>,
 Ursula Braun <ubraun@linux.ibm.com>, Johan Hovold <johan@kernel.org>,
 greybus-dev@lists.linaro.org, John Stultz <john.stultz@linaro.org>,
 Bjorn Helgaas <bhelgaas@google.com>, Felipe Balbi <balbi@kernel.org>,
 Alex Elder <elder@kernel.org>,
 "Martin K. Petersen" <martin.petersen@oracle.com>, linux-usb@vger.kernel.org,
 "Rafael J. Wysocki" <rjw@rjwysocki.net>, Karsten Graul <kgraul@linux.ibm.com>,
 netdev@vger.kernel.org, "David S. Miller" <davem@davemloft.net>
Subject: [greybus-dev] [PATCH 7/8] PM: Use the new device_to_pm() helper to
	access struct dev_pm_ops
X-BeenThere: greybus-dev@lists.linaro.org
X-Mailman-Version: 2.1.16
Precedence: list
List-Id: Greybus Development Mail List <greybus-dev.lists.linaro.org>
List-Unsubscribe: <https://lists.linaro.org/mailman/options/greybus-dev>,
 <mailto:greybus-dev-request@lists.linaro.org?subject=unsubscribe>
List-Archive: <http://lists.linaro.org/pipermail/greybus-dev/>
List-Post: <mailto:greybus-dev@lists.linaro.org>
List-Help: <mailto:greybus-dev-request@lists.linaro.org?subject=help>
List-Subscribe: <https://lists.linaro.org/mailman/listinfo/greybus-dev>,
 <mailto:greybus-dev-request@lists.linaro.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: greybus-dev-bounces@lists.linaro.org
Sender: "greybus-dev" <greybus-dev-bounces@lists.linaro.org>
X-Virus-Scanned: ClamAV using ClamSMTP

VXNlIHRoZSBuZXcgZGV2aWNlX3RvX3BtKCkgaGVscGVyIHRvIGFjY2VzcyBQb3dlciBNYW5hZ2Vt
ZW50IGNhbGxiYWNzCihzdHJ1Y3QgZGV2X3BtX29wcykgZm9yIGEgcGFydGljdWxhciBkZXZpY2Ug
KHN0cnVjdCBkZXZpY2VfZHJpdmVyKS4KCk5vIGZ1bmN0aW9uYWwgY2hhbmdlIGludGVuZGVkLgoK
VGhpcyBjaGFuZ2UgYnVpbGRzIG9uIHRvcCBvZiB0aGUgcHJldmlvdXMgY29tbWl0IDZkYTJmMmNj
ZmQyZCAoIlBDSS9QTToKTWFrZSBwb3dlciBtYW5hZ2VtZW50IG9wIGNvZGluZyBzdHlsZSBjb25z
aXN0ZW50IikuCgpMaW5rczoKICBodHRwczovL2xvcmUua2VybmVsLm9yZy9kcml2ZXJkZXYtZGV2
ZWwvMjAxOTEwMTQyMzAwMTYuMjQwOTEyLTYtaGVsZ2Fhc0BrZXJuZWwub3JnLwogIGh0dHBzOi8v
bG9yZS5rZXJuZWwub3JnL2RyaXZlcmRldi1kZXZlbC84NTkyMzAyLnI0eEM2Ukl5NjlAa3JlYWNo
ZXIvCiAgaHR0cHM6Ly9sb3JlLmtlcm5lbC5vcmcvZHJpdmVyZGV2LWRldmVsLzIwMTkxMDE2MTM1
MDAyLkdBMjQ2NzhAa2FkYW0vCgpTaWduZWQtb2ZmLWJ5OiBLcnp5c3p0b2YgV2lsY3p5xYRza2kg
PGt3QGxpbnV4LmNvbT4KLS0tCiBkcml2ZXJzL2Jhc2UvcG93ZXIvZG9tYWluLmMgICAgICB8IDEy
ICsrKystLQogZHJpdmVycy9iYXNlL3Bvd2VyL2dlbmVyaWNfb3BzLmMgfCA2NSArKysrKysrKysr
KysrKy0tLS0tLS0tLS0tLS0tLS0tLQogZHJpdmVycy9iYXNlL3Bvd2VyL21haW4uYyAgICAgICAg
fCA0OCArKysrKysrKysrKysrKystLS0tLS0tLQogZHJpdmVycy9iYXNlL3Bvd2VyL3J1bnRpbWUu
YyAgICAgfCAgNyArKy0tCiA0IGZpbGVzIGNoYW5nZWQsIDczIGluc2VydGlvbnMoKyksIDU5IGRl
bGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvYmFzZS9wb3dlci9kb21haW4uYyBiL2Ry
aXZlcnMvYmFzZS9wb3dlci9kb21haW4uYwppbmRleCAwYTAxZGY2MDg4NDkuLjkyYTk2ZmNiMjcx
NyAxMDA2NDQKLS0tIGEvZHJpdmVycy9iYXNlL3Bvd2VyL2RvbWFpbi5jCisrKyBiL2RyaXZlcnMv
YmFzZS9wb3dlci9kb21haW4uYwpAQCAtNzAzLDYgKzcwMyw3IEBAIHN0YXRpYyB2b2lkIGdlbnBk
X3Bvd2VyX29mZl93b3JrX2ZuKHN0cnVjdCB3b3JrX3N0cnVjdCAqd29yaykKIHN0YXRpYyBpbnQg
X19nZW5wZF9ydW50aW1lX3N1c3BlbmQoc3RydWN0IGRldmljZSAqZGV2KQogewogCWludCAoKmNi
KShzdHJ1Y3QgZGV2aWNlICpfX2Rldik7CisJY29uc3Qgc3RydWN0IGRldl9wbV9vcHMgKnBtOwog
CiAJaWYgKGRldi0+dHlwZSAmJiBkZXYtPnR5cGUtPnBtKQogCQljYiA9IGRldi0+dHlwZS0+cG0t
PnJ1bnRpbWVfc3VzcGVuZDsKQEAgLTcxMyw4ICs3MTQsOSBAQCBzdGF0aWMgaW50IF9fZ2VucGRf
cnVudGltZV9zdXNwZW5kKHN0cnVjdCBkZXZpY2UgKmRldikKIAllbHNlCiAJCWNiID0gTlVMTDsK
IAotCWlmICghY2IgJiYgZGV2LT5kcml2ZXIgJiYgZGV2LT5kcml2ZXItPnBtKQotCQljYiA9IGRl
di0+ZHJpdmVyLT5wbS0+cnVudGltZV9zdXNwZW5kOworCXBtID0gZHJpdmVyX3RvX3BtKGRldi0+
ZHJpdmVyKTsKKwlpZiAoIWNiICYmIHBtKQorCQljYiA9IHBtLT5ydW50aW1lX3N1c3BlbmQ7CiAK
IAlyZXR1cm4gY2IgPyBjYihkZXYpIDogMDsKIH0KQEAgLTcyNiw2ICs3MjgsNyBAQCBzdGF0aWMg
aW50IF9fZ2VucGRfcnVudGltZV9zdXNwZW5kKHN0cnVjdCBkZXZpY2UgKmRldikKIHN0YXRpYyBp
bnQgX19nZW5wZF9ydW50aW1lX3Jlc3VtZShzdHJ1Y3QgZGV2aWNlICpkZXYpCiB7CiAJaW50ICgq
Y2IpKHN0cnVjdCBkZXZpY2UgKl9fZGV2KTsKKwljb25zdCBzdHJ1Y3QgZGV2X3BtX29wcyAqcG07
CiAKIAlpZiAoZGV2LT50eXBlICYmIGRldi0+dHlwZS0+cG0pCiAJCWNiID0gZGV2LT50eXBlLT5w
bS0+cnVudGltZV9yZXN1bWU7CkBAIC03MzYsOCArNzM5LDkgQEAgc3RhdGljIGludCBfX2dlbnBk
X3J1bnRpbWVfcmVzdW1lKHN0cnVjdCBkZXZpY2UgKmRldikKIAllbHNlCiAJCWNiID0gTlVMTDsK
IAotCWlmICghY2IgJiYgZGV2LT5kcml2ZXIgJiYgZGV2LT5kcml2ZXItPnBtKQotCQljYiA9IGRl
di0+ZHJpdmVyLT5wbS0+cnVudGltZV9yZXN1bWU7CisJcG0gPSBkcml2ZXJfdG9fcG0oZGV2LT5k
cml2ZXIpOworCWlmICghY2IgJiYgcG0pCisJCWNiID0gcG0tPnJ1bnRpbWVfcmVzdW1lOwogCiAJ
cmV0dXJuIGNiID8gY2IoZGV2KSA6IDA7CiB9CmRpZmYgLS1naXQgYS9kcml2ZXJzL2Jhc2UvcG93
ZXIvZ2VuZXJpY19vcHMuYyBiL2RyaXZlcnMvYmFzZS9wb3dlci9nZW5lcmljX29wcy5jCmluZGV4
IDRmYTUyNTY2OGNiNy4uZmJkMmVkZWYwMjAxIDEwMDY0NAotLS0gYS9kcml2ZXJzL2Jhc2UvcG93
ZXIvZ2VuZXJpY19vcHMuYworKysgYi9kcml2ZXJzL2Jhc2UvcG93ZXIvZ2VuZXJpY19vcHMuYwpA
QCAtMTksMTIgKzE5LDkgQEAKICAqLwogaW50IHBtX2dlbmVyaWNfcnVudGltZV9zdXNwZW5kKHN0
cnVjdCBkZXZpY2UgKmRldikKIHsKLQljb25zdCBzdHJ1Y3QgZGV2X3BtX29wcyAqcG0gPSBkZXYt
PmRyaXZlciA/IGRldi0+ZHJpdmVyLT5wbSA6IE5VTEw7Ci0JaW50IHJldDsKKwljb25zdCBzdHJ1
Y3QgZGV2X3BtX29wcyAqcG0gPSBkcml2ZXJfdG9fcG0oZGV2LT5kcml2ZXIpOwogCi0JcmV0ID0g
cG0gJiYgcG0tPnJ1bnRpbWVfc3VzcGVuZCA/IHBtLT5ydW50aW1lX3N1c3BlbmQoZGV2KSA6IDA7
Ci0KLQlyZXR1cm4gcmV0OworCXJldHVybiBwbSAmJiBwbS0+cnVudGltZV9zdXNwZW5kID8gcG0t
PnJ1bnRpbWVfc3VzcGVuZChkZXYpIDogMDsKIH0KIEVYUE9SVF9TWU1CT0xfR1BMKHBtX2dlbmVy
aWNfcnVudGltZV9zdXNwZW5kKTsKIApAQCAtMzgsMTIgKzM1LDkgQEAgRVhQT1JUX1NZTUJPTF9H
UEwocG1fZ2VuZXJpY19ydW50aW1lX3N1c3BlbmQpOwogICovCiBpbnQgcG1fZ2VuZXJpY19ydW50
aW1lX3Jlc3VtZShzdHJ1Y3QgZGV2aWNlICpkZXYpCiB7Ci0JY29uc3Qgc3RydWN0IGRldl9wbV9v
cHMgKnBtID0gZGV2LT5kcml2ZXIgPyBkZXYtPmRyaXZlci0+cG0gOiBOVUxMOwotCWludCByZXQ7
Ci0KLQlyZXQgPSBwbSAmJiBwbS0+cnVudGltZV9yZXN1bWUgPyBwbS0+cnVudGltZV9yZXN1bWUo
ZGV2KSA6IDA7CisJY29uc3Qgc3RydWN0IGRldl9wbV9vcHMgKnBtID0gZHJpdmVyX3RvX3BtKGRl
di0+ZHJpdmVyKTsKIAotCXJldHVybiByZXQ7CisJcmV0dXJuIHBtICYmIHBtLT5ydW50aW1lX3Jl
c3VtZSA/IHBtLT5ydW50aW1lX3Jlc3VtZShkZXYpIDogMDsKIH0KIEVYUE9SVF9TWU1CT0xfR1BM
KHBtX2dlbmVyaWNfcnVudGltZV9yZXN1bWUpOwogI2VuZGlmIC8qIENPTkZJR19QTSAqLwpAQCAt
NTcsMTMgKzUxLDEyIEBAIEVYUE9SVF9TWU1CT0xfR1BMKHBtX2dlbmVyaWNfcnVudGltZV9yZXN1
bWUpOwogICovCiBpbnQgcG1fZ2VuZXJpY19wcmVwYXJlKHN0cnVjdCBkZXZpY2UgKmRldikKIHsK
LQlzdHJ1Y3QgZGV2aWNlX2RyaXZlciAqZHJ2ID0gZGV2LT5kcml2ZXI7Ci0JaW50IHJldCA9IDA7
CisJY29uc3Qgc3RydWN0IGRldl9wbV9vcHMgKnBtID0gZHJpdmVyX3RvX3BtKGRldi0+ZHJpdmVy
KTsKIAotCWlmIChkcnYgJiYgZHJ2LT5wbSAmJiBkcnYtPnBtLT5wcmVwYXJlKQotCQlyZXQgPSBk
cnYtPnBtLT5wcmVwYXJlKGRldik7CisJaWYgKHBtICYmIHBtLT5wcmVwYXJlKQorCQlyZXR1cm4g
cG0tPnByZXBhcmUoZGV2KTsKIAotCXJldHVybiByZXQ7CisJcmV0dXJuIDA7CiB9CiAKIC8qKgpA
QCAtNzIsNyArNjUsNyBAQCBpbnQgcG1fZ2VuZXJpY19wcmVwYXJlKHN0cnVjdCBkZXZpY2UgKmRl
dikKICAqLwogaW50IHBtX2dlbmVyaWNfc3VzcGVuZF9ub2lycShzdHJ1Y3QgZGV2aWNlICpkZXYp
CiB7Ci0JY29uc3Qgc3RydWN0IGRldl9wbV9vcHMgKnBtID0gZGV2LT5kcml2ZXIgPyBkZXYtPmRy
aXZlci0+cG0gOiBOVUxMOworCWNvbnN0IHN0cnVjdCBkZXZfcG1fb3BzICpwbSA9IGRyaXZlcl90
b19wbShkZXYtPmRyaXZlcik7CiAKIAlyZXR1cm4gcG0gJiYgcG0tPnN1c3BlbmRfbm9pcnEgPyBw
bS0+c3VzcGVuZF9ub2lycShkZXYpIDogMDsKIH0KQEAgLTg0LDcgKzc3LDcgQEAgRVhQT1JUX1NZ
TUJPTF9HUEwocG1fZ2VuZXJpY19zdXNwZW5kX25vaXJxKTsKICAqLwogaW50IHBtX2dlbmVyaWNf
c3VzcGVuZF9sYXRlKHN0cnVjdCBkZXZpY2UgKmRldikKIHsKLQljb25zdCBzdHJ1Y3QgZGV2X3Bt
X29wcyAqcG0gPSBkZXYtPmRyaXZlciA/IGRldi0+ZHJpdmVyLT5wbSA6IE5VTEw7CisJY29uc3Qg
c3RydWN0IGRldl9wbV9vcHMgKnBtID0gZHJpdmVyX3RvX3BtKGRldi0+ZHJpdmVyKTsKIAogCXJl
dHVybiBwbSAmJiBwbS0+c3VzcGVuZF9sYXRlID8gcG0tPnN1c3BlbmRfbGF0ZShkZXYpIDogMDsK
IH0KQEAgLTk2LDcgKzg5LDcgQEAgRVhQT1JUX1NZTUJPTF9HUEwocG1fZ2VuZXJpY19zdXNwZW5k
X2xhdGUpOwogICovCiBpbnQgcG1fZ2VuZXJpY19zdXNwZW5kKHN0cnVjdCBkZXZpY2UgKmRldikK
IHsKLQljb25zdCBzdHJ1Y3QgZGV2X3BtX29wcyAqcG0gPSBkZXYtPmRyaXZlciA/IGRldi0+ZHJp
dmVyLT5wbSA6IE5VTEw7CisJY29uc3Qgc3RydWN0IGRldl9wbV9vcHMgKnBtID0gZHJpdmVyX3Rv
X3BtKGRldi0+ZHJpdmVyKTsKIAogCXJldHVybiBwbSAmJiBwbS0+c3VzcGVuZCA/IHBtLT5zdXNw
ZW5kKGRldikgOiAwOwogfQpAQCAtMTA4LDcgKzEwMSw3IEBAIEVYUE9SVF9TWU1CT0xfR1BMKHBt
X2dlbmVyaWNfc3VzcGVuZCk7CiAgKi8KIGludCBwbV9nZW5lcmljX2ZyZWV6ZV9ub2lycShzdHJ1
Y3QgZGV2aWNlICpkZXYpCiB7Ci0JY29uc3Qgc3RydWN0IGRldl9wbV9vcHMgKnBtID0gZGV2LT5k
cml2ZXIgPyBkZXYtPmRyaXZlci0+cG0gOiBOVUxMOworCWNvbnN0IHN0cnVjdCBkZXZfcG1fb3Bz
ICpwbSA9IGRyaXZlcl90b19wbShkZXYtPmRyaXZlcik7CiAKIAlyZXR1cm4gcG0gJiYgcG0tPmZy
ZWV6ZV9ub2lycSA/IHBtLT5mcmVlemVfbm9pcnEoZGV2KSA6IDA7CiB9CkBAIC0xMjAsNyArMTEz
LDcgQEAgRVhQT1JUX1NZTUJPTF9HUEwocG1fZ2VuZXJpY19mcmVlemVfbm9pcnEpOwogICovCiBp
bnQgcG1fZ2VuZXJpY19mcmVlemVfbGF0ZShzdHJ1Y3QgZGV2aWNlICpkZXYpCiB7Ci0JY29uc3Qg
c3RydWN0IGRldl9wbV9vcHMgKnBtID0gZGV2LT5kcml2ZXIgPyBkZXYtPmRyaXZlci0+cG0gOiBO
VUxMOworCWNvbnN0IHN0cnVjdCBkZXZfcG1fb3BzICpwbSA9IGRyaXZlcl90b19wbShkZXYtPmRy
aXZlcik7CiAKIAlyZXR1cm4gcG0gJiYgcG0tPmZyZWV6ZV9sYXRlID8gcG0tPmZyZWV6ZV9sYXRl
KGRldikgOiAwOwogfQpAQCAtMTMyLDcgKzEyNSw3IEBAIEVYUE9SVF9TWU1CT0xfR1BMKHBtX2dl
bmVyaWNfZnJlZXplX2xhdGUpOwogICovCiBpbnQgcG1fZ2VuZXJpY19mcmVlemUoc3RydWN0IGRl
dmljZSAqZGV2KQogewotCWNvbnN0IHN0cnVjdCBkZXZfcG1fb3BzICpwbSA9IGRldi0+ZHJpdmVy
ID8gZGV2LT5kcml2ZXItPnBtIDogTlVMTDsKKwljb25zdCBzdHJ1Y3QgZGV2X3BtX29wcyAqcG0g
PSBkcml2ZXJfdG9fcG0oZGV2LT5kcml2ZXIpOwogCiAJcmV0dXJuIHBtICYmIHBtLT5mcmVlemUg
PyBwbS0+ZnJlZXplKGRldikgOiAwOwogfQpAQCAtMTQ0LDcgKzEzNyw3IEBAIEVYUE9SVF9TWU1C
T0xfR1BMKHBtX2dlbmVyaWNfZnJlZXplKTsKICAqLwogaW50IHBtX2dlbmVyaWNfcG93ZXJvZmZf
bm9pcnEoc3RydWN0IGRldmljZSAqZGV2KQogewotCWNvbnN0IHN0cnVjdCBkZXZfcG1fb3BzICpw
bSA9IGRldi0+ZHJpdmVyID8gZGV2LT5kcml2ZXItPnBtIDogTlVMTDsKKwljb25zdCBzdHJ1Y3Qg
ZGV2X3BtX29wcyAqcG0gPSBkcml2ZXJfdG9fcG0oZGV2LT5kcml2ZXIpOwogCiAJcmV0dXJuIHBt
ICYmIHBtLT5wb3dlcm9mZl9ub2lycSA/IHBtLT5wb3dlcm9mZl9ub2lycShkZXYpIDogMDsKIH0K
QEAgLTE1Niw3ICsxNDksNyBAQCBFWFBPUlRfU1lNQk9MX0dQTChwbV9nZW5lcmljX3Bvd2Vyb2Zm
X25vaXJxKTsKICAqLwogaW50IHBtX2dlbmVyaWNfcG93ZXJvZmZfbGF0ZShzdHJ1Y3QgZGV2aWNl
ICpkZXYpCiB7Ci0JY29uc3Qgc3RydWN0IGRldl9wbV9vcHMgKnBtID0gZGV2LT5kcml2ZXIgPyBk
ZXYtPmRyaXZlci0+cG0gOiBOVUxMOworCWNvbnN0IHN0cnVjdCBkZXZfcG1fb3BzICpwbSA9IGRy
aXZlcl90b19wbShkZXYtPmRyaXZlcik7CiAKIAlyZXR1cm4gcG0gJiYgcG0tPnBvd2Vyb2ZmX2xh
dGUgPyBwbS0+cG93ZXJvZmZfbGF0ZShkZXYpIDogMDsKIH0KQEAgLTE2OCw3ICsxNjEsNyBAQCBF
WFBPUlRfU1lNQk9MX0dQTChwbV9nZW5lcmljX3Bvd2Vyb2ZmX2xhdGUpOwogICovCiBpbnQgcG1f
Z2VuZXJpY19wb3dlcm9mZihzdHJ1Y3QgZGV2aWNlICpkZXYpCiB7Ci0JY29uc3Qgc3RydWN0IGRl
dl9wbV9vcHMgKnBtID0gZGV2LT5kcml2ZXIgPyBkZXYtPmRyaXZlci0+cG0gOiBOVUxMOworCWNv
bnN0IHN0cnVjdCBkZXZfcG1fb3BzICpwbSA9IGRyaXZlcl90b19wbShkZXYtPmRyaXZlcik7CiAK
IAlyZXR1cm4gcG0gJiYgcG0tPnBvd2Vyb2ZmID8gcG0tPnBvd2Vyb2ZmKGRldikgOiAwOwogfQpA
QCAtMTgwLDcgKzE3Myw3IEBAIEVYUE9SVF9TWU1CT0xfR1BMKHBtX2dlbmVyaWNfcG93ZXJvZmYp
OwogICovCiBpbnQgcG1fZ2VuZXJpY190aGF3X25vaXJxKHN0cnVjdCBkZXZpY2UgKmRldikKIHsK
LQljb25zdCBzdHJ1Y3QgZGV2X3BtX29wcyAqcG0gPSBkZXYtPmRyaXZlciA/IGRldi0+ZHJpdmVy
LT5wbSA6IE5VTEw7CisJY29uc3Qgc3RydWN0IGRldl9wbV9vcHMgKnBtID0gZHJpdmVyX3RvX3Bt
KGRldi0+ZHJpdmVyKTsKIAogCXJldHVybiBwbSAmJiBwbS0+dGhhd19ub2lycSA/IHBtLT50aGF3
X25vaXJxKGRldikgOiAwOwogfQpAQCAtMTkyLDcgKzE4NSw3IEBAIEVYUE9SVF9TWU1CT0xfR1BM
KHBtX2dlbmVyaWNfdGhhd19ub2lycSk7CiAgKi8KIGludCBwbV9nZW5lcmljX3RoYXdfZWFybHko
c3RydWN0IGRldmljZSAqZGV2KQogewotCWNvbnN0IHN0cnVjdCBkZXZfcG1fb3BzICpwbSA9IGRl
di0+ZHJpdmVyID8gZGV2LT5kcml2ZXItPnBtIDogTlVMTDsKKwljb25zdCBzdHJ1Y3QgZGV2X3Bt
X29wcyAqcG0gPSBkcml2ZXJfdG9fcG0oZGV2LT5kcml2ZXIpOwogCiAJcmV0dXJuIHBtICYmIHBt
LT50aGF3X2Vhcmx5ID8gcG0tPnRoYXdfZWFybHkoZGV2KSA6IDA7CiB9CkBAIC0yMDQsNyArMTk3
LDcgQEAgRVhQT1JUX1NZTUJPTF9HUEwocG1fZ2VuZXJpY190aGF3X2Vhcmx5KTsKICAqLwogaW50
IHBtX2dlbmVyaWNfdGhhdyhzdHJ1Y3QgZGV2aWNlICpkZXYpCiB7Ci0JY29uc3Qgc3RydWN0IGRl
dl9wbV9vcHMgKnBtID0gZGV2LT5kcml2ZXIgPyBkZXYtPmRyaXZlci0+cG0gOiBOVUxMOworCWNv
bnN0IHN0cnVjdCBkZXZfcG1fb3BzICpwbSA9IGRyaXZlcl90b19wbShkZXYtPmRyaXZlcik7CiAK
IAlyZXR1cm4gcG0gJiYgcG0tPnRoYXcgPyBwbS0+dGhhdyhkZXYpIDogMDsKIH0KQEAgLTIxNiw3
ICsyMDksNyBAQCBFWFBPUlRfU1lNQk9MX0dQTChwbV9nZW5lcmljX3RoYXcpOwogICovCiBpbnQg
cG1fZ2VuZXJpY19yZXN1bWVfbm9pcnEoc3RydWN0IGRldmljZSAqZGV2KQogewotCWNvbnN0IHN0
cnVjdCBkZXZfcG1fb3BzICpwbSA9IGRldi0+ZHJpdmVyID8gZGV2LT5kcml2ZXItPnBtIDogTlVM
TDsKKwljb25zdCBzdHJ1Y3QgZGV2X3BtX29wcyAqcG0gPSBkcml2ZXJfdG9fcG0oZGV2LT5kcml2
ZXIpOwogCiAJcmV0dXJuIHBtICYmIHBtLT5yZXN1bWVfbm9pcnEgPyBwbS0+cmVzdW1lX25vaXJx
KGRldikgOiAwOwogfQpAQCAtMjI4LDcgKzIyMSw3IEBAIEVYUE9SVF9TWU1CT0xfR1BMKHBtX2dl
bmVyaWNfcmVzdW1lX25vaXJxKTsKICAqLwogaW50IHBtX2dlbmVyaWNfcmVzdW1lX2Vhcmx5KHN0
cnVjdCBkZXZpY2UgKmRldikKIHsKLQljb25zdCBzdHJ1Y3QgZGV2X3BtX29wcyAqcG0gPSBkZXYt
PmRyaXZlciA/IGRldi0+ZHJpdmVyLT5wbSA6IE5VTEw7CisJY29uc3Qgc3RydWN0IGRldl9wbV9v
cHMgKnBtID0gZHJpdmVyX3RvX3BtKGRldi0+ZHJpdmVyKTsKIAogCXJldHVybiBwbSAmJiBwbS0+
cmVzdW1lX2Vhcmx5ID8gcG0tPnJlc3VtZV9lYXJseShkZXYpIDogMDsKIH0KQEAgLTI0MCw3ICsy
MzMsNyBAQCBFWFBPUlRfU1lNQk9MX0dQTChwbV9nZW5lcmljX3Jlc3VtZV9lYXJseSk7CiAgKi8K
IGludCBwbV9nZW5lcmljX3Jlc3VtZShzdHJ1Y3QgZGV2aWNlICpkZXYpCiB7Ci0JY29uc3Qgc3Ry
dWN0IGRldl9wbV9vcHMgKnBtID0gZGV2LT5kcml2ZXIgPyBkZXYtPmRyaXZlci0+cG0gOiBOVUxM
OworCWNvbnN0IHN0cnVjdCBkZXZfcG1fb3BzICpwbSA9IGRyaXZlcl90b19wbShkZXYtPmRyaXZl
cik7CiAKIAlyZXR1cm4gcG0gJiYgcG0tPnJlc3VtZSA/IHBtLT5yZXN1bWUoZGV2KSA6IDA7CiB9
CkBAIC0yNTIsNyArMjQ1LDcgQEAgRVhQT1JUX1NZTUJPTF9HUEwocG1fZ2VuZXJpY19yZXN1bWUp
OwogICovCiBpbnQgcG1fZ2VuZXJpY19yZXN0b3JlX25vaXJxKHN0cnVjdCBkZXZpY2UgKmRldikK
IHsKLQljb25zdCBzdHJ1Y3QgZGV2X3BtX29wcyAqcG0gPSBkZXYtPmRyaXZlciA/IGRldi0+ZHJp
dmVyLT5wbSA6IE5VTEw7CisJY29uc3Qgc3RydWN0IGRldl9wbV9vcHMgKnBtID0gZHJpdmVyX3Rv
X3BtKGRldi0+ZHJpdmVyKTsKIAogCXJldHVybiBwbSAmJiBwbS0+cmVzdG9yZV9ub2lycSA/IHBt
LT5yZXN0b3JlX25vaXJxKGRldikgOiAwOwogfQpAQCAtMjY0LDcgKzI1Nyw3IEBAIEVYUE9SVF9T
WU1CT0xfR1BMKHBtX2dlbmVyaWNfcmVzdG9yZV9ub2lycSk7CiAgKi8KIGludCBwbV9nZW5lcmlj
X3Jlc3RvcmVfZWFybHkoc3RydWN0IGRldmljZSAqZGV2KQogewotCWNvbnN0IHN0cnVjdCBkZXZf
cG1fb3BzICpwbSA9IGRldi0+ZHJpdmVyID8gZGV2LT5kcml2ZXItPnBtIDogTlVMTDsKKwljb25z
dCBzdHJ1Y3QgZGV2X3BtX29wcyAqcG0gPSBkcml2ZXJfdG9fcG0oZGV2LT5kcml2ZXIpOwogCiAJ
cmV0dXJuIHBtICYmIHBtLT5yZXN0b3JlX2Vhcmx5ID8gcG0tPnJlc3RvcmVfZWFybHkoZGV2KSA6
IDA7CiB9CkBAIC0yNzYsNyArMjY5LDcgQEAgRVhQT1JUX1NZTUJPTF9HUEwocG1fZ2VuZXJpY19y
ZXN0b3JlX2Vhcmx5KTsKICAqLwogaW50IHBtX2dlbmVyaWNfcmVzdG9yZShzdHJ1Y3QgZGV2aWNl
ICpkZXYpCiB7Ci0JY29uc3Qgc3RydWN0IGRldl9wbV9vcHMgKnBtID0gZGV2LT5kcml2ZXIgPyBk
ZXYtPmRyaXZlci0+cG0gOiBOVUxMOworCWNvbnN0IHN0cnVjdCBkZXZfcG1fb3BzICpwbSA9IGRy
aXZlcl90b19wbShkZXYtPmRyaXZlcik7CiAKIAlyZXR1cm4gcG0gJiYgcG0tPnJlc3RvcmUgPyBw
bS0+cmVzdG9yZShkZXYpIDogMDsKIH0KQEAgLTI5MCw5ICsyODMsOSBAQCBFWFBPUlRfU1lNQk9M
X0dQTChwbV9nZW5lcmljX3Jlc3RvcmUpOwogICovCiB2b2lkIHBtX2dlbmVyaWNfY29tcGxldGUo
c3RydWN0IGRldmljZSAqZGV2KQogewotCXN0cnVjdCBkZXZpY2VfZHJpdmVyICpkcnYgPSBkZXYt
PmRyaXZlcjsKKwljb25zdCBzdHJ1Y3QgZGV2X3BtX29wcyAqcG0gPSBkcml2ZXJfdG9fcG0oZGV2
LT5kcml2ZXIpOwogCi0JaWYgKGRydiAmJiBkcnYtPnBtICYmIGRydi0+cG0tPmNvbXBsZXRlKQot
CQlkcnYtPnBtLT5jb21wbGV0ZShkZXYpOworCWlmIChwbSAmJiBwbS0+Y29tcGxldGUpCisJCXBt
LT5jb21wbGV0ZShkZXYpOwogfQogI2VuZGlmIC8qIENPTkZJR19QTV9TTEVFUCAqLwpkaWZmIC0t
Z2l0IGEvZHJpdmVycy9iYXNlL3Bvd2VyL21haW4uYyBiL2RyaXZlcnMvYmFzZS9wb3dlci9tYWlu
LmMKaW5kZXggMGUwN2UxN2MyZGVmLi42YzQxZGEwYmViYjAgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMv
YmFzZS9wb3dlci9tYWluLmMKKysrIGIvZHJpdmVycy9iYXNlL3Bvd2VyL21haW4uYwpAQCAtNjQw
LDYgKzY0MCw3IEBAIHN0YXRpYyBwbV9jYWxsYmFja190IGRwbV9zdWJzeXNfc3VzcGVuZF9sYXRl
X2NiKHN0cnVjdCBkZXZpY2UgKmRldiwKIHN0YXRpYyBpbnQgZGV2aWNlX3Jlc3VtZV9ub2lycShz
dHJ1Y3QgZGV2aWNlICpkZXYsIHBtX21lc3NhZ2VfdCBzdGF0ZSwgYm9vbCBhc3luYykKIHsKIAlw
bV9jYWxsYmFja190IGNhbGxiYWNrOworCWNvbnN0IHN0cnVjdCBkZXZfcG1fb3BzICpwbTsKIAlj
b25zdCBjaGFyICppbmZvOwogCWJvb2wgc2tpcF9yZXN1bWU7CiAJaW50IGVycm9yID0gMDsKQEAg
LTY4Nyw5ICs2ODgsMTAgQEAgc3RhdGljIGludCBkZXZpY2VfcmVzdW1lX25vaXJxKHN0cnVjdCBk
ZXZpY2UgKmRldiwgcG1fbWVzc2FnZV90IHN0YXRlLCBib29sIGFzeW4KIAkJfQogCX0KIAotCWlm
IChkZXYtPmRyaXZlciAmJiBkZXYtPmRyaXZlci0+cG0pIHsKKwlwbSA9IGRyaXZlcl90b19wbShk
ZXYtPmRyaXZlcik7CisJaWYgKHBtKSB7CiAJCWluZm8gPSAibm9pcnEgZHJpdmVyICI7Ci0JCWNh
bGxiYWNrID0gcG1fbm9pcnFfb3AoZGV2LT5kcml2ZXItPnBtLCBzdGF0ZSk7CisJCWNhbGxiYWNr
ID0gcG1fbm9pcnFfb3AocG0sIHN0YXRlKTsKIAl9CiAKIFJ1bjoKQEAgLTg1MCw2ICs4NTIsNyBA
QCBzdGF0aWMgcG1fY2FsbGJhY2tfdCBkcG1fc3Vic3lzX3Jlc3VtZV9lYXJseV9jYihzdHJ1Y3Qg
ZGV2aWNlICpkZXYsCiBzdGF0aWMgaW50IGRldmljZV9yZXN1bWVfZWFybHkoc3RydWN0IGRldmlj
ZSAqZGV2LCBwbV9tZXNzYWdlX3Qgc3RhdGUsIGJvb2wgYXN5bmMpCiB7CiAJcG1fY2FsbGJhY2tf
dCBjYWxsYmFjazsKKwljb25zdCBzdHJ1Y3QgZGV2X3BtX29wcyAqcG07CiAJY29uc3QgY2hhciAq
aW5mbzsKIAlpbnQgZXJyb3IgPSAwOwogCkBAIC04NjcsOSArODcwLDEwIEBAIHN0YXRpYyBpbnQg
ZGV2aWNlX3Jlc3VtZV9lYXJseShzdHJ1Y3QgZGV2aWNlICpkZXYsIHBtX21lc3NhZ2VfdCBzdGF0
ZSwgYm9vbCBhc3luCiAKIAljYWxsYmFjayA9IGRwbV9zdWJzeXNfcmVzdW1lX2Vhcmx5X2NiKGRl
diwgc3RhdGUsICZpbmZvKTsKIAotCWlmICghY2FsbGJhY2sgJiYgZGV2LT5kcml2ZXIgJiYgZGV2
LT5kcml2ZXItPnBtKSB7CisJcG0gPSBkcml2ZXJfdG9fcG0oZGV2LT5kcml2ZXIpOworCWlmICgh
Y2FsbGJhY2sgJiYgcG0pIHsKIAkJaW5mbyA9ICJlYXJseSBkcml2ZXIgIjsKLQkJY2FsbGJhY2sg
PSBwbV9sYXRlX2Vhcmx5X29wKGRldi0+ZHJpdmVyLT5wbSwgc3RhdGUpOworCQljYWxsYmFjayA9
IHBtX2xhdGVfZWFybHlfb3AocG0sIHN0YXRlKTsKIAl9CiAKIAllcnJvciA9IGRwbV9ydW5fY2Fs
bGJhY2soY2FsbGJhY2ssIGRldiwgc3RhdGUsIGluZm8pOwpAQCAtOTYzLDYgKzk2Nyw3IEBAIHN0
YXRpYyBpbnQgZGV2aWNlX3Jlc3VtZShzdHJ1Y3QgZGV2aWNlICpkZXYsIHBtX21lc3NhZ2VfdCBz
dGF0ZSwgYm9vbCBhc3luYykKIHsKIAlwbV9jYWxsYmFja190IGNhbGxiYWNrID0gTlVMTDsKIAlj
b25zdCBjaGFyICppbmZvID0gTlVMTDsKKwljb25zdCBzdHJ1Y3QgZGV2X3BtX29wcyAqcG0gPSBO
VUxMOwogCWludCBlcnJvciA9IDA7CiAJREVDTEFSRV9EUE1fV0FUQ0hET0dfT05fU1RBQ0sod2Qp
OwogCkBAIC0xMDIzLDkgKzEwMjgsMTAgQEAgc3RhdGljIGludCBkZXZpY2VfcmVzdW1lKHN0cnVj
dCBkZXZpY2UgKmRldiwgcG1fbWVzc2FnZV90IHN0YXRlLCBib29sIGFzeW5jKQogCX0KIAogIERy
aXZlcjoKLQlpZiAoIWNhbGxiYWNrICYmIGRldi0+ZHJpdmVyICYmIGRldi0+ZHJpdmVyLT5wbSkg
eworCXBtID0gZHJpdmVyX3RvX3BtKGRldi0+ZHJpdmVyKTsKKwlpZiAoIWNhbGxiYWNrICYmIHBt
KSB7CiAJCWluZm8gPSAiZHJpdmVyICI7Ci0JCWNhbGxiYWNrID0gcG1fb3AoZGV2LT5kcml2ZXIt
PnBtLCBzdGF0ZSk7CisJCWNhbGxiYWNrID0gcG1fb3AocG0sIHN0YXRlKTsKIAl9CiAKICBFbmQ6
CkBAIC0xMTE2LDYgKzExMjIsNyBAQCB2b2lkIGRwbV9yZXN1bWUocG1fbWVzc2FnZV90IHN0YXRl
KQogc3RhdGljIHZvaWQgZGV2aWNlX2NvbXBsZXRlKHN0cnVjdCBkZXZpY2UgKmRldiwgcG1fbWVz
c2FnZV90IHN0YXRlKQogewogCXZvaWQgKCpjYWxsYmFjaykoc3RydWN0IGRldmljZSAqKSA9IE5V
TEw7CisJY29uc3Qgc3RydWN0IGRldl9wbV9vcHMgKnBtID0gTlVMTDsKIAljb25zdCBjaGFyICpp
bmZvID0gTlVMTDsKIAogCWlmIChkZXYtPnBvd2VyLnN5c2NvcmUpCkBAIC0xMTM3LDkgKzExNDQs
MTAgQEAgc3RhdGljIHZvaWQgZGV2aWNlX2NvbXBsZXRlKHN0cnVjdCBkZXZpY2UgKmRldiwgcG1f
bWVzc2FnZV90IHN0YXRlKQogCQljYWxsYmFjayA9IGRldi0+YnVzLT5wbS0+Y29tcGxldGU7CiAJ
fQogCi0JaWYgKCFjYWxsYmFjayAmJiBkZXYtPmRyaXZlciAmJiBkZXYtPmRyaXZlci0+cG0pIHsK
KwlwbSA9IGRyaXZlcl90b19wbShkZXYtPmRyaXZlcik7CisJaWYgKCFjYWxsYmFjayAmJiBwbSkg
ewogCQlpbmZvID0gImNvbXBsZXRpbmcgZHJpdmVyICI7Ci0JCWNhbGxiYWNrID0gZGV2LT5kcml2
ZXItPnBtLT5jb21wbGV0ZTsKKwkJY2FsbGJhY2sgPSBwbS0+Y29tcGxldGU7CiAJfQogCiAJaWYg
KGNhbGxiYWNrKSB7CkBAIC0xMzEyLDYgKzEzMjAsNyBAQCBzdGF0aWMgYm9vbCBkZXZpY2VfbXVz
dF9yZXN1bWUoc3RydWN0IGRldmljZSAqZGV2LCBwbV9tZXNzYWdlX3Qgc3RhdGUsCiBzdGF0aWMg
aW50IF9fZGV2aWNlX3N1c3BlbmRfbm9pcnEoc3RydWN0IGRldmljZSAqZGV2LCBwbV9tZXNzYWdl
X3Qgc3RhdGUsIGJvb2wgYXN5bmMpCiB7CiAJcG1fY2FsbGJhY2tfdCBjYWxsYmFjazsKKwljb25z
dCBzdHJ1Y3QgZGV2X3BtX29wcyAqcG07CiAJY29uc3QgY2hhciAqaW5mbzsKIAlib29sIG5vX3N1
YnN5c19jYiA9IGZhbHNlOwogCWludCBlcnJvciA9IDA7CkBAIC0xMzM2LDkgKzEzNDUsMTAgQEAg
c3RhdGljIGludCBfX2RldmljZV9zdXNwZW5kX25vaXJxKHN0cnVjdCBkZXZpY2UgKmRldiwgcG1f
bWVzc2FnZV90IHN0YXRlLCBib29sIGEKIAlpZiAoZGV2X3BtX3NtYXJ0X3N1c3BlbmRfYW5kX3N1
c3BlbmRlZChkZXYpICYmIG5vX3N1YnN5c19jYikKIAkJZ290byBTa2lwOwogCi0JaWYgKGRldi0+
ZHJpdmVyICYmIGRldi0+ZHJpdmVyLT5wbSkgeworCXBtID0gZHJpdmVyX3RvX3BtKGRldi0+ZHJp
dmVyKTsKKwlpZiAocG0pIHsKIAkJaW5mbyA9ICJub2lycSBkcml2ZXIgIjsKLQkJY2FsbGJhY2sg
PSBwbV9ub2lycV9vcChkZXYtPmRyaXZlci0+cG0sIHN0YXRlKTsKKwkJY2FsbGJhY2sgPSBwbV9u
b2lycV9vcChwbSwgc3RhdGUpOwogCX0KIAogUnVuOgpAQCAtMTUxNCw2ICsxNTI0LDcgQEAgc3Rh
dGljIHBtX2NhbGxiYWNrX3QgZHBtX3N1YnN5c19zdXNwZW5kX2xhdGVfY2Ioc3RydWN0IGRldmlj
ZSAqZGV2LAogc3RhdGljIGludCBfX2RldmljZV9zdXNwZW5kX2xhdGUoc3RydWN0IGRldmljZSAq
ZGV2LCBwbV9tZXNzYWdlX3Qgc3RhdGUsIGJvb2wgYXN5bmMpCiB7CiAJcG1fY2FsbGJhY2tfdCBj
YWxsYmFjazsKKwljb25zdCBzdHJ1Y3QgZGV2X3BtX29wcyAqcG07CiAJY29uc3QgY2hhciAqaW5m
bzsKIAlpbnQgZXJyb3IgPSAwOwogCkBAIC0xNTQzLDkgKzE1NTQsMTAgQEAgc3RhdGljIGludCBf
X2RldmljZV9zdXNwZW5kX2xhdGUoc3RydWN0IGRldmljZSAqZGV2LCBwbV9tZXNzYWdlX3Qgc3Rh
dGUsIGJvb2wgYXMKIAkgICAgIWRwbV9zdWJzeXNfc3VzcGVuZF9ub2lycV9jYihkZXYsIHN0YXRl
LCBOVUxMKSkKIAkJZ290byBTa2lwOwogCi0JaWYgKGRldi0+ZHJpdmVyICYmIGRldi0+ZHJpdmVy
LT5wbSkgeworCXBtID0gZHJpdmVyX3RvX3BtKGRldi0+ZHJpdmVyKTsKKwlpZiAocG0pIHsKIAkJ
aW5mbyA9ICJsYXRlIGRyaXZlciAiOwotCQljYWxsYmFjayA9IHBtX2xhdGVfZWFybHlfb3AoZGV2
LT5kcml2ZXItPnBtLCBzdGF0ZSk7CisJCWNhbGxiYWNrID0gcG1fbGF0ZV9lYXJseV9vcChwbSwg
c3RhdGUpOwogCX0KIAogUnVuOgpAQCAtMTcxNyw2ICsxNzI5LDcgQEAgc3RhdGljIHZvaWQgZHBt
X2NsZWFyX3N1cGVyaW9yc19kaXJlY3RfY29tcGxldGUoc3RydWN0IGRldmljZSAqZGV2KQogc3Rh
dGljIGludCBfX2RldmljZV9zdXNwZW5kKHN0cnVjdCBkZXZpY2UgKmRldiwgcG1fbWVzc2FnZV90
IHN0YXRlLCBib29sIGFzeW5jKQogewogCXBtX2NhbGxiYWNrX3QgY2FsbGJhY2sgPSBOVUxMOwor
CWNvbnN0IHN0cnVjdCBkZXZfcG1fb3BzICpwbSA9IE5VTEw7CiAJY29uc3QgY2hhciAqaW5mbyA9
IE5VTEw7CiAJaW50IGVycm9yID0gMDsKIAlERUNMQVJFX0RQTV9XQVRDSERPR19PTl9TVEFDSyh3
ZCk7CkBAIC0xODAzLDkgKzE4MTYsMTAgQEAgc3RhdGljIGludCBfX2RldmljZV9zdXNwZW5kKHN0
cnVjdCBkZXZpY2UgKmRldiwgcG1fbWVzc2FnZV90IHN0YXRlLCBib29sIGFzeW5jKQogCX0KIAog
IFJ1bjoKLQlpZiAoIWNhbGxiYWNrICYmIGRldi0+ZHJpdmVyICYmIGRldi0+ZHJpdmVyLT5wbSkg
eworCXBtID0gZHJpdmVyX3RvX3BtKGRldi0+ZHJpdmVyKTsKKwlpZiAoIWNhbGxiYWNrICYmIHBt
KSB7CiAJCWluZm8gPSAiZHJpdmVyICI7Ci0JCWNhbGxiYWNrID0gcG1fb3AoZGV2LT5kcml2ZXIt
PnBtLCBzdGF0ZSk7CisJCWNhbGxiYWNrID0gcG1fb3AocG0sIHN0YXRlKTsKIAl9CiAKIAllcnJv
ciA9IGRwbV9ydW5fY2FsbGJhY2soY2FsbGJhY2ssIGRldiwgc3RhdGUsIGluZm8pOwpAQCAtMTkx
Nyw2ICsxOTMxLDcgQEAgaW50IGRwbV9zdXNwZW5kKHBtX21lc3NhZ2VfdCBzdGF0ZSkKIHN0YXRp
YyBpbnQgZGV2aWNlX3ByZXBhcmUoc3RydWN0IGRldmljZSAqZGV2LCBwbV9tZXNzYWdlX3Qgc3Rh
dGUpCiB7CiAJaW50ICgqY2FsbGJhY2spKHN0cnVjdCBkZXZpY2UgKikgPSBOVUxMOworCWNvbnN0
IHN0cnVjdCBkZXZfcG1fb3BzICpwbSA9IE5VTEw7CiAJaW50IHJldCA9IDA7CiAKIAlpZiAoZGV2
LT5wb3dlci5zeXNjb3JlKQpAQCAtMTk0Niw4ICsxOTYxLDkgQEAgc3RhdGljIGludCBkZXZpY2Vf
cHJlcGFyZShzdHJ1Y3QgZGV2aWNlICpkZXYsIHBtX21lc3NhZ2VfdCBzdGF0ZSkKIAllbHNlIGlm
IChkZXYtPmJ1cyAmJiBkZXYtPmJ1cy0+cG0pCiAJCWNhbGxiYWNrID0gZGV2LT5idXMtPnBtLT5w
cmVwYXJlOwogCi0JaWYgKCFjYWxsYmFjayAmJiBkZXYtPmRyaXZlciAmJiBkZXYtPmRyaXZlci0+
cG0pCi0JCWNhbGxiYWNrID0gZGV2LT5kcml2ZXItPnBtLT5wcmVwYXJlOworCXBtID0gZHJpdmVy
X3RvX3BtKGRldi0+ZHJpdmVyKTsKKwlpZiAoIWNhbGxiYWNrICYmIHBtKQorCQljYWxsYmFjayA9
IHBtLT5wcmVwYXJlOwogCiAJaWYgKGNhbGxiYWNrKQogCQlyZXQgPSBjYWxsYmFjayhkZXYpOwpk
aWZmIC0tZ2l0IGEvZHJpdmVycy9iYXNlL3Bvd2VyL3J1bnRpbWUuYyBiL2RyaXZlcnMvYmFzZS9w
b3dlci9ydW50aW1lLmMKaW5kZXggOTljN2RhMTEyYzk1Li5jMTQyODI0Yzc1NDEgMTAwNjQ0Ci0t
LSBhL2RyaXZlcnMvYmFzZS9wb3dlci9ydW50aW1lLmMKKysrIGIvZHJpdmVycy9iYXNlL3Bvd2Vy
L3J1bnRpbWUuYwpAQCAtMjEsNyArMjEsNyBAQCB0eXBlZGVmIGludCAoKnBtX2NhbGxiYWNrX3Qp
KHN0cnVjdCBkZXZpY2UgKik7CiBzdGF0aWMgcG1fY2FsbGJhY2tfdCBfX3JwbV9nZXRfY2FsbGJh
Y2soc3RydWN0IGRldmljZSAqZGV2LCBzaXplX3QgY2Jfb2Zmc2V0KQogewogCXBtX2NhbGxiYWNr
X3QgY2I7Ci0JY29uc3Qgc3RydWN0IGRldl9wbV9vcHMgKm9wczsKKwljb25zdCBzdHJ1Y3QgZGV2
X3BtX29wcyAqb3BzLCAqcG07CiAKIAlpZiAoZGV2LT5wbV9kb21haW4pCiAJCW9wcyA9ICZkZXYt
PnBtX2RvbWFpbi0+b3BzOwpAQCAtMzksOCArMzksOSBAQCBzdGF0aWMgcG1fY2FsbGJhY2tfdCBf
X3JwbV9nZXRfY2FsbGJhY2soc3RydWN0IGRldmljZSAqZGV2LCBzaXplX3QgY2Jfb2Zmc2V0KQog
CWVsc2UKIAkJY2IgPSBOVUxMOwogCi0JaWYgKCFjYiAmJiBkZXYtPmRyaXZlciAmJiBkZXYtPmRy
aXZlci0+cG0pCi0JCWNiID0gKihwbV9jYWxsYmFja190ICopKCh2b2lkICopZGV2LT5kcml2ZXIt
PnBtICsgY2Jfb2Zmc2V0KTsKKwlwbSA9IGRyaXZlcl90b19wbShkZXYtPmRyaXZlcik7CisJaWYg
KCFjYiAmJiBwbSkKKwkJY2IgPSAqKHBtX2NhbGxiYWNrX3QgKikoKHZvaWQgKilwbSArIGNiX29m
ZnNldCk7CiAKIAlyZXR1cm4gY2I7CiB9Ci0tIAoyLjI2LjIKCl9fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fCmdyZXlidXMtZGV2IG1haWxpbmcgbGlzdApncmV5
YnVzLWRldkBsaXN0cy5saW5hcm8ub3JnCmh0dHBzOi8vbGlzdHMubGluYXJvLm9yZy9tYWlsbWFu
L2xpc3RpbmZvL2dyZXlidXMtZGV2Cg==
